<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="utf-8" />
        <title>BIP39 - Mnemonic Code</title>
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/app.css">
        <meta content="Mnemonic code for generating deterministic keys" name="description"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <meta content="bitcoin mnemonic converter" name="description" />
        <meta content="Ian Coleman" name="author" />
        <link type="image/x-icon" rel="icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" />
    </head>
    <body>
        <div class="container">

            <h1 class="text-center">Deterministic Key Generator</h1>
            <p class="text-center">
                <span class="text-danger">
                    <strong>Do not use this site for wallets with real money. This website is intended solely for developers to better understand how it works!</strong>
                </span>
            </p>
            <p class="version">v0.5.6</p>
            
            <div class="row">
                <div class="col-md-12">
                    <h2>Start with</h2>
                    <ul class="nav nav-tabs" role="tablist" id="start-with-tabs">
                        <li class="active">
                            <a href="#start-mnemonic" role="tab" data-toggle="tab">Mnemonic</a>
                        </li>
                        <li>
                            <a href="#start-private-key" role="tab" data-toggle="tab">Private Key</a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="tab-content">
                <div id="start-mnemonic" class="tab-pane active">
                    <div class="row">
                        <div class="col-md-12">
                            <h2>Mnemonic</h2>
                    <form class="form-horizontal" role="form">
                        <div class="form-group">
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">
                                <p>You can enter an existing BIP39 mnemonic, or generate a new random one. Typing your own twelve words will probably not work how you expect, since the words require a particular structure (the last word contains a checksum).</p>
                                <p>
                                    For more info see the
                                    <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank">BIP39 spec</a>.
                                </p>
                            </div>
                        </div>
                        <div class="form-group generate-container">
                            <label class="col-sm-2 control-label"></label>
                            <div class="col-sm-10">
                                <div class="form-inline">
                                    <div class="input-group-inline">
                                        <p>
                                            To begin you can:
                                        </p>
                                        <ul>
                                            <li style="margin-bottom: 8px;">Generate a random mnemonic <button class="btn generate"><b>GENERATE</b></button> <select id="strength"
                                                    class="strength form-control">
                                                    <option value="3">3</option>
                                                    <option value="6">6</option>
                                                    <option value="9">9</option>
                                                    <option value="12" selected>12</option>
                                                    <option value="15">15</option>
                                                    <option value="18">18</option>
                                                    <option value="21">21</option>
                                                    <option value="24">24</option>
                                                </select>
                                            </li>
                                            <li style="margin-bottom: 8px;">Scan a QR code <button id="scan-qr" class="btn scan-qr"><b>SCAN QR</b></button></li>
                                            <li>or enter your own mnemonic below</li>
                                        </ul>
                                        <p class="warning help-block hidden">
                                            <span class="text-danger">
                                                Mnemonics with less than 12 words have low entropy and may be guessed by an attacker.
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="entropy-container hidden">
                            <div class="form-group text-danger">
                                <label class="col-sm-2 control-label">Warning</label>
                                <div class="col-sm-10 form-control-static">
                                    <span>Entropy is an advanced feature. Your mnemonic may be insecure if this feature is used incorrectly.</span>
                                    <a href="#entropy-notes">Read more</a>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="entropy" class="col-sm-2 control-label">Entropy</label>
                                <div class="col-sm-7">
                                    <textarea id="entropy" rows="2" class="entropy private-data form-control" placeholder="Accepts either binary, base 6, 6-sided dice, base 10, hexadecimal or cards" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                    <div class="row filter-warning text-danger hidden">
                                        <p class="col-sm-12">
                                        <strong>
                                        Some characters have been discarded
                                        </strong>
                                        </p>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-3 control-label"><span class="more-info" title="Based on estimates from zxcvbn using Filtered Entropy">Time To Crack</span></label>
                                        <div class="crack-time col-sm-3 form-control-static"></div>
                                        <label class="col-sm-3 control-label">Event Count</label>
                                        <div class="event-count col-sm-3 form-control-static"></div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-3 control-label">Entropy Type</label>
                                        <div class="type col-sm-3 form-control-static"></div>
                                        <label class="col-sm-3 control-label">Avg Bits Per Event</label>
                                        <div class="bits-per-event col-sm-3 form-control-static"></div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-3 control-label">Raw Entropy Words</label>
                                        <div class="word-count col-sm-3 form-control-static"></div>
                                        <label class="col-sm-3 control-label"><span class="more-info" title="Total bits of entropy may be less than indicated if any entropy event uses a weak source.">Total Bits</span></label>
                                        <div class="bits col-sm-3 form-control-static"></div>
                                    </div>
                                    <label class="col-sm-3 control-label">Filtered Entropy</label>
                                    <div class="filtered private-data col-sm-9 form-control-static"></div>
                                    <label class="col-sm-3 control-label">Raw Binary</label>
                                    <div class="binary private-data col-sm-9 form-control-static"></div>
                                    <label class="col-sm-3 control-label">Binary Checksum</label>
                                    <div class="checksum private-data col-sm-9 form-control-static">&nbsp;</div>
                                    <label class="col-sm-3 control-label">Word Indexes</label>
                                    <div class="word-indexes private-data col-sm-9 form-control-static">&nbsp;</div>
                                    <label class="col-sm-3 control-label">Mnemonic Length</label>
                                    <div class="col-sm-9">
                                        <select class="mnemonic-length form-control">
                                            <option value="raw" selected>Use Raw Entropy (3 words per 32 bits)</option>
                                            <option value="12">12 <span>Words</span></option>
                                            <option value="15">15 <span>Words</span></option>
                                            <option value="18">18 <span>Words</span></option>
                                            <option value="21">21 <span>Words</span></option>
                                            <option value="24">24 <span>Words</span></option>
                                        </select>
                                        <p class="weak-entropy-override-warning hidden">
                                            <span class="text-danger">
                                                The mnemonic will appear more secure than it really is.
                                            </span>
                                        </p>
                                    </div>
                                    <label class="col-sm-3 control-label">PBKDF2 rounds</label>
                                    <div class="col-sm-9">
                                        <select class="pbkdf2-rounds form-control" style="width: 60%;float: left;">
                                            <option value="2048" selected>2048 <span>(compatibility)</span></option>
                                            <option value="4096">4096 <span>iterations</span></option>
                                            <option value="8192">8192 <span>iterations</span></option>
                                            <option value="16384">16384 <span>iterations</span></option>
                                            <option value="32768">32768 <span>iterations</span></option>
                                            <option value="custom">Custom <span>iterations</span></option>
                                        </select>
                                        <input type="number" class="form-control hidden" id="pbkdf2-custom-input" value="1" min="1" pattern="[0-9]" style="float: right;width: 40%;">
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <p>Valid entropy values include:</p>
                                    <ul>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="binary">
                                                <strong>Binary</strong> [0-1]<br>101010011
                                            </label>
                                        </li>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="base 6">
                                                <strong>Base 6</strong> [0-5]<br>123434014
                                            </label>
                                        </li>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="dice">
                                                <strong>Dice</strong> [1-6]<br>62535634
                                            </label>
                                        </li>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="base 10">
                                                <strong>Base 10</strong> [0-9]<br>90834528
                                            </label>
                                        </li>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="hexadecimal" checked>
                                                <strong>Hex</strong> [0-9A-F]<br>4187a8bfd9
                                            </label>
                                        </li>
                                        <li>
                                            <label>
                                                <input type="radio" name="entropy-type" value="card">
                                                <strong>Card</strong> [A2-9TJQK][CDHS]<br>ahqs9dtc
                                            </label>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10 checkbox">
                                <label>
                                    <input type="checkbox" class="use-entropy">
                                    <span>Show entropy details</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10 checkbox">
                                <label>
                                    <input type="checkbox" class="privacy-screen-toggle">
                                    <span>Hide all private info</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10 checkbox">
                                <label>
                                    <input type="checkbox" class="autoCompute" checked>
                                    <span>Auto compute</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Mnemonic Language</label>
                            <div class="col-sm-10 languages">
                                <div class="form-control no-border">
                                    <a href="#english">English</a>
                                    <a href="#japanese" title="Japanese">日本語</a>
                                    <a href="#spanish"  title="Spanish">Español</a>
                                    <a href="#chinese_simplified"  title="Chinese (Simplified)">中文(简体)</a>
                                    <a href="#chinese_traditional"  title="Chinese (Traditional)">中文(繁體)</a>
                                    <a href="#french"  title="French">Français</a>
                                    <a href="#italian"  title="Italian">Italiano</a>
                                    <a href="#korean"  title="Korean">한국어</a>
                                    <a href="#czech" title="Czech">Čeština</a>
                                    <a href="#portuguese" title="Portuguese">Português</a>
                                </div>
                            </div>
                        </div>
                        <div class="form-group text-danger PBKDF2-infos-danger hidden">
                            <label class="col-sm-2 control-label">Warning</label>
                            <div class="col-sm-10 form-control-static">
                                <span>You are using a custom number of PBKDF2 iterations. Your BIP39 seed may not show same addresses on a different software.</span>
                                <a href="#PBKDF2-notes">Read more</a>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="phrase" class="col-sm-2 control-label">BIP39 Mnemonic</label>
                            <div class="col-sm-10">
                                <div class="row">
                                    <div class="col-sm-6 col-xs-12">
                                        <textarea id="phrase" class="phrase private-data form-control" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                    </div>
                                    <div class="col-sm-3 col-xs-6">
                                        <div id="seed-qr" class="text-center seed-qr-xs-margin"></div>
                                        <div class="text-center">
                                            <span>Mnemonic QR Code (BIP39)</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 col-xs-6">
                                        <div id="standard-seed-qr" class="text-center seed-qr-xs-margin"></div>
                                        <div class="text-center">
                                            <span>Standard SeedQR (Word Indexes)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div  class="splitMnemonic hidden">
                                <label for="phrase" class="col-sm-2 control-label">BIP39 Split Mnemonic</label>
                                <div class="col-sm-10">
                                    <textarea id="phraseSplit" class="phraseSplit private-data form-control" title="Only 2 of 3 cards needed to recover." rows="3"></textarea>
                                    <p class="help-block">
                                        <span id="phraseSplitWarn" class="phraseSplitWarn"></span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-sm-2">
                            </div>
                            <div class="col-sm-10">
                                <label class="control-label text-weight-normal">
                                    <input type="checkbox" class="showSplitMnemonic">
                                    Show split mnemonic cards
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="passphrase" class="col-sm-2 control-label">BIP39 Passphrase (optional)</label>
                            <div class="col-sm-10">
                                <textarea id="passphrase" class="passphrase private-data form-control" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="seed" class="col-sm-2 control-label">BIP39 Seed</label>
                            <div class="col-sm-10">
                                <textarea id="seed" class="seed private-data form-control" data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="network-phrase" class="col-sm-2 control-label">Coin</label>
                            <div class="col-sm-10">
                                <select id="network-phrase" class="network form-control">
                                    <!-- populated by javascript -->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="root-key" class="col-sm-2 control-label">BIP32 Root Key</label>
                            <div class="col-sm-10">
                                <textarea id="root-key" class="root-key private-data form-control" data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">
                                <label class="control-label text-weight-normal">
                                    <input type="checkbox" class="showBip85" />
                                    Show BIP85
                                </label>
                            </div>
                        </div>

                        <div class="form-group bip85 hidden">
                            <div class="form-group text-danger">
                                <label class="col-sm-2 control-label">Warning</label>
                                <div class="col-sm-10 form-control-static">
                                    This is an advanced feature and should only be used if you understand what it does.
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2"></label>
                                <div class="col-sm-10">
                                    <p>
                                    The value of the "BIP85 Child Key" field shown below is not used
                                    elsewhere on this page. It can be used as a new key.
                                    </p>
                                    <p>
                                    In case of the BIP39 application, you can paste it into the "BIP39 Mnemonic"
                                    field to use it as a new mnemonic.
                                    </p>
                                    <p>
                                    Please read the
                                    <a href="https://github.com/bitcoin/bips/blob/master/bip-0085.mediawiki" target="_blank">
                                        BIP85 spec
                                    </a>
                                    for more information.
                                    </p>
                                </div>
                            </div>
                            <label for="bip85-application" class="col-sm-2 control-label">BIP85 Application</label>
                            <div class="col-sm-10">
                                <select id="bip85-application" class="form-control">
                                    <option value="bip39" selected>BIP39</option>
                                    <option value="wif">WIF</option>
                                    <option value="xprv">Xprv</option>
                                    <option value="hex">Hex</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group bip85 bip85-mnemonic-language-input hidden">
                            <label for="bip85-mnemonic-language" class="col-sm-2 control-label">BIP85 Mnemonic Language</label>
                            <div class="col-sm-10 languages">
                                <select id="bip85-mnemonic-language" class="strength form-control">
                                    <option value="0" selected>English</option>
                                    <!--<option value="1">日本語</option>
                                    <option value="2">한국어</option>
                                    <option value="3">Español</option>
                                    <option value="4">中文(简体)</option>
                                    <option value="5">中文(繁體)</option>
                                    <option value="6">Français</option>
                                    <option value="7">Italiano</option>
                                    <option value="8">Čeština</option>
                                    <option value="9">Português</option>-->
                                </select>
                            </div>
                        </div>

                        <div class="form-group bip85 bip85-mnemonic-length-input hidden">
                            <label for="bip85-mnemonic-length" class="col-sm-2 control-label">BIP85 Mnemonic Length</label>
                            <div class="col-sm-10">
                                <select id="bip85-mnemonic-length" class="strength form-control">
                                    <option value="12" selected>12</option>
                                    <option value="18">18</option>
                                    <option value="24">24</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group bip85 hidden">
                            <span class="bip85-bytes-input">
                                <label for="bip85-bytes" class="col-sm-2 control-label">BIP85 Bytes</label>
                                <div class="col-sm-10">
                                    <input id="bip85-bytes" type="text" class="change form-control" value="64" />
                                </div>
                            </span>
                        </div>

                        <div class="form-group bip85 bip85-index-input hidden">
                            <label for="bip85-index" class="col-sm-2 control-label">BIP85 Index</label>
                            <div class="col-sm-10">
                                <input id="bip85-index" type="text" class="change form-control" value="0" />
                            </div>
                        </div>

                        <div class="form-group bip85 hidden">
                            <label for="phrase" class="col-sm-2 control-label">BIP85 Child Key</label>
                            <div class="col-sm-10">
                                <textarea
                                    id="bip85Field"
                                    data-show-qr
                                    class="bip85Field private-data form-control"
                                    title="BIP85 Child Key"
                                    rows="3"
                                ></textarea>
                            </div>
                        </div>

                        <div class="form-group litecoin-ltub-container hidden">
                            <label for="litecoin-use-ltub" class="col-sm-2 control-label">Prefixes</label>
                            <div class="col-sm-10 checkbox">
                                <label>
                                    <input type="checkbox" id="litecoin-use-ltub" class="litecoin-use-ltub" checked="checked">
                                    Use <code>Ltpv / Ltub</code> instead of <code>xprv / xpub</code>
                                </label>
                            </div>
                        </div>
                    </form>
                        </div>
                    </div>
                </div>
                
                <div id="start-private-key" class="tab-pane">
                    <div class="row">
                        <div class="col-md-12">
                            <h2>Private Key</h2>
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label for="network-private-key" class="col-sm-2 control-label">Coin</label>
                                    <div class="col-sm-10">
                                        <select id="network-private-key" class="network-private form-control">
                                            <!-- populated by javascript -->
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="private-key-input" class="col-sm-2 control-label">Private Key</label>
                                    <div class="col-sm-8">
                                        <textarea id="private-key-input" class="private-key-field private-data form-control" placeholder="Enter private key (WIF, Hex, or Nostr nsec format)" data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        <span class="help-block">Supported formats: WIF, Hexadecimal (64 chars, with or without 0x prefix), Nostr nsec</span>
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="button" id="generate-private-key" class="btn btn-primary btn-block"><b>GENERATE</b></button>
                                    </div>
                                </div>
                                
                                <!-- Additional parameters for specific coins -->
                                <div id="private-key-additional-params" class="hidden">
                                    <div class="form-group segwit-options hidden">
                                        <label class="col-sm-2 control-label">Address Type</label>
                                        <div class="col-sm-10">
                                            <select id="private-key-address-type" class="form-control">
                                                <option value="p2pkh">Legacy (P2PKH)</option>
                                                <option value="p2sh-p2wpkh">Nested SegWit (P2SH-P2WPKH)</option>
                                                <option value="p2wpkh">Native SegWit (P2WPKH/Bech32)</option>
                                                <option value="p2tr">Taproot (P2TR/Bech32m)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group compressed-key-option hidden">
                                        <label class="col-sm-2 control-label">Key Type</label>
                                        <div class="col-sm-10">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" id="private-key-compressed" checked>
                                                    Use compressed public key
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ark specific parameters -->
                                    <div class="ark-params hidden">
                                        <hr>
                                        <h4>Ark Server Configuration</h4>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Ark Server URL</label>
                                            <div class="col-sm-8">
                                                <input type="text" id="ark-server-url" class="form-control" value="https://mutinynet.arkade.sh">
                                            </div>
                                            <div class="col-sm-2">
                                                <button type="button" id="fetch-ark-info" class="btn btn-primary btn-block">Fetch Info</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Server Public Key (S)</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-server-pubkey" class="form-control" placeholder="Will be fetched from server">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Exit Delay (T)</label>
                                            <div class="col-sm-10">
                                                <input type="number" id="ark-exit-delay" class="form-control" placeholder="Blocks">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Network</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-network" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">VTXO Tree Expiry</label>
                                            <div class="col-sm-10">
                                                <input type="number" id="ark-vtxo-expiry" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Round Interval</label>
                                            <div class="col-sm-10">
                                                <input type="number" id="ark-round-interval" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Dust</label>
                                            <div class="col-sm-10">
                                                <input type="number" id="ark-dust" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Forfeit Address</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-forfeit-address" class="form-control">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <hr>
                                
                                <!-- Results section -->
                                <div id="private-key-results" class="hidden">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">Private Key (WIF)</label>
                                        <div class="col-sm-10">
                                            <textarea id="private-key-wif" class="form-control private-data" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">Public Key</label>
                                        <div class="col-sm-10">
                                            <textarea id="private-key-public" class="form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">Address</label>
                                        <div class="col-sm-10">
                                            <textarea id="private-key-address" class="form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <!-- Ark Address Result Fields -->
                                    <div class="ark-result-fields hidden">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Standard Ark Address</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-standard-address" class="form-control" readonly title="Standard P2TR address with ark/tark prefix">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Protocol VTXO Address</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-protocol-address" class="form-control" readonly title="Ark Protocol address for off-chain transactions">
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">User Pubkey (A)</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-user-pubkey" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Server Pubkey (S)</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-server-pubkey" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Exit Delay (T)</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-exit-delay" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Network</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-network" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">VTXO Taproot Key</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-vtxo-key" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Script</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-script" class="form-control" readonly value="A + S | A after T">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Note</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="ark-result-note" class="form-control" readonly value="Full address encoding requires @arkade-os/sdk">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Error display -->
                                <div id="private-key-error" class="alert alert-danger hidden"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <div class="row" id="derivation-path-section">
                <div class="col-md-12">
                    <h2>Derivation Path</h2>
                    <ul class="derivation-type nav nav-tabs" role="tablist">
                        <li id="bip32-tab">
                            <a href="#bip32" role="tab" data-toggle="tab">BIP32</a>
                        </li>
                        <li id="bip44-tab" class="active">
                            <a href="#bip44" role="tab" data-toggle="tab">BIP44</a>
                        </li>
                        <li id="bip49-tab">
                            <a href="#bip49" role="tab" data-toggle="tab">BIP49</a>
                        </li>
                        <li id="bip84-tab">
                            <a href="#bip84" role="tab" data-toggle="tab">BIP84</a>
                        </li>
                        <li id="bip86-tab">
                            <a href="#bip86" role="tab" data-toggle="tab">BIP86</a>
                        </li>
                        <li id="bip141-tab">
                            <a href="#bip141" role="tab" data-toggle="tab">BIP141</a>
                        </li>
                        <li id="lds-tab">
                            <a href="#lds" role="tab" data-toggle="tab">LDS</a>
                        </li>
                    </ul>
                    <div class="derivation-type tab-content">
                        <div id="bip44" class="tab-pane active">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="col-sm-2"></div>
                                <div class="col-sm-10">
                                    <p>
                                        For more info see the
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank">BIP44 spec</a>.
                                    </p>
                                </div>
                                <div class="form-group">
                                    <label for="purpose-bip44" class="col-sm-2 control-label">
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#purpose" target="_blank">Purpose</a>
                                    </label>
                                    <div class="col-sm-10">
                                        <input id="purpose-bip44" type="text" class="purpose form-control" value="44" readonly>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="coin-bip44" class="col-sm-2 control-label">
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#registered-coin-types" target="_blank">Coin</a>
                                    </label>
                                    <div class="col-sm-10">
                                        <input id="coin-bip44" type="text" class="coin form-control" value="0" readonly>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="account-bip44" class="col-sm-2 control-label">
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#account" target="_blank">Account</a>
                                    </label>
                                    <div class="col-sm-10">
                                        <input id="account-bip44" type="text" class="account form-control" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="change-bip44" class="col-sm-2 control-label">
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#change" target="_blank">External / Internal</a>
                                    </label>
                                    <div class="col-sm-10">
                                      <input id="change-bip44" type="text" class="change form-control" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                    </label>
                                    <div class="col-sm-10">
                                        <p>The account extended keys can be used for importing to most BIP44 compatible wallets, such as mycelium or electrum.</p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="account-xprv" class="col-sm-2 control-label">
                                        <span>Account Extended Private Key</span>
                                    </label>
                                    <div class="col-sm-10">
                                        <textarea id="account-xprv-bip44" type="text" class="account-xprv private-data form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="account-xpub" class="col-sm-2 control-label">
                                        <span>Account Extended Public Key</span>
                                    </label>
                                    <div class="col-sm-10">
                                        <textarea id="account-xpub-bip44" type="text" class="account-xpub form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                    </label>
                                    <div class="col-sm-10">
                                        <p>The BIP32 derivation path and extended keys are the basis for the derived addresses.</p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="bip44-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                    <div class="col-sm-10">
                                        <input id="bip44-path" type="text" class="path form-control" value="m/44'/0'/0'/0" readonly="readonly">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="bip32" class="tab-pane">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="col-sm-2"></div>
                                <div class="col-sm-10">
                                    <p>
                                        For more info see the
                                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank">BIP32 spec</a>
                                    </p>
                                </div>
                                <div class="form-group">
                                    <label for="bip32-client" class="col-sm-2 control-label">Client</label>
                                    <div class="col-sm-10">
                                        <select id="bip32-client" class="client form-control">
                                            <option value="custom">Custom derivation path</option>
                                            <!-- populated by javascript -->
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="bip32-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                    <div class="col-sm-10">
                                        <input id="bip32-path" type="text" class="path form-control" value="m/0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="core-path" class="col-sm-2 control-label">Bitcoin Core</label>
                                    <div class="col-sm-10">
                                        <p class="form-control no-border">
                                        Use path <code>m/0'/0'</code> with hardened addresses.
                                        </p>
                                        <p class="form-control no-border">
                                            For more info see the
                                            <a href="https://github.com/bitcoin/bitcoin/pull/8035" target="_blank">Bitcoin Core BIP32 implementation</a>
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="core-path" class="col-sm-2 control-label">Multibit</label>
                                    <div class="col-sm-10">
                                        <p class="form-control no-border">
                                            <span>Use path <code>m/0'/0</code>.</span>
                                            <span>For change addresses use path <code>m/0'/1</code>.</span>
                                        </p>
                                        <p class="form-control no-border">
                                            <span>For more info see</span>
                                            <a href="https://multibit.org/" target="_blank">MultiBit HD</a>
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">Block Explorers</label>
                                    <div class="col-sm-10">
                                        <p class="form-control no-border">
                                            <span>Use path <code>m/44'/0'/0'</code>.</span>
                                            <span>Only enter the <code>xpub</code> extended key into block explorer search fields, never the <code>xprv</code> key.</span>
                                        </p>
                                        <p class="form-control no-border">
                                            <span>Can be used with</span>:
                                            <a href="https://blockchain.info/" target="_blank">blockchain.info</a>
                                        </p>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="bip49" class="tab-pane">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="unavailable hidden">
                                    <div class="form-group">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-10">
                                            <p>BIP49 is unavailable for this coin.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="available">
                                    <div class="col-sm-2"></div>
                                    <div class="col-sm-10">
                                        <p>
                                            For more info see the
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki" target="_blank">BIP49 spec</a>.
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <label for="purpose-bip49" class="col-sm-2 control-label">
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#purpose" target="_blank">Purpose</a>
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="purpose-bip49" type="text" class="purpose form-control" value="49" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="coin-bip49" class="col-sm-2 control-label">
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#registered-coin-types" target="_blank">Coin</a>
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="coin-bip49" type="text" class="coin form-control" value="0" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-bip49" class="col-sm-2 control-label">
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#account" target="_blank">Account</a>
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="account-bip49" type="text" class="account form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="change-bip49" class="col-sm-2 control-label">
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#change" target="_blank">External / Internal</a>
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="change-bip49" type="text" class="change form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The account extended keys can be used for importing to most BIP49 compatible wallets.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xprv" class="col-sm-2 control-label">
                                            <span>Account Extended Private Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xprv-bip49" type="text" class="account-xprv private-data form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xpub" class="col-sm-2 control-label">
                                            <span>Account Extended Public Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xpub-bip49" type="text" class="account-xpub form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The BIP32 derivation path and extended keys are the basis for the derived addresses.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="bip49-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                        <div class="col-sm-10">
                                            <input id="bip49-path" type="text" class="path form-control" value="m/49'/0'/0'/0" readonly="readonly">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="bip141" class="tab-pane">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="unavailable hidden">
                                    <div class="form-group">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-10">
                                            <p>BIP141 is unavailable for this coin.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="available">
                                    <div class="col-sm-2"></div>
                                    <div class="col-sm-10">
                                        <p>
                                            For more info see the
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" target="_blank">BIP141 spec</a>
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <label for="bip141-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                        <div class="col-sm-10">
                                            <input id="bip141-path" type="text" class="bip141-path form-control" value="m/0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">Script Semantics</label>
                                        <div class="col-sm-10">
                                            <select class="form-control bip141-semantics">
                                                <option value="p2wpkh">P2WPKH</option>
                                                <option value="p2wpkh-p2sh" selected>P2WPKH nested in P2SH</option>
                                                <option value="p2wsh">P2WSH (1-of-1 multisig)</option>
                                                <option value="p2wsh-p2sh">P2WSH nested in P2SH (1-of-1 multisig)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="bip84" class="tab-pane">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="unavailable hidden">
                                    <div class="form-group">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-10">
                                            <p>BIP84 is unavailable for this coin.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="available">
                                    <div class="col-sm-2"></div>
                                    <div class="col-sm-10">
                                        <p>
                                            For more info see the
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0084.mediawiki" target="_blank">BIP84 spec</a>.
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <label for="purpose-bip84" class="col-sm-2 control-label">
                                            Purpose
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="purpose-bip84" type="text" class="purpose form-control" value="84" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="coin-bip84" class="col-sm-2 control-label">
                                            Coin
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="coin-bip84" type="text" class="coin form-control" value="0" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-bip84" class="col-sm-2 control-label">
                                            Account
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="account-bip84" type="text" class="account form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="change-bip84" class="col-sm-2 control-label">
                                            External / Internal
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="change-bip84" type="text" class="change form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The account extended keys can be used for importing to most BIP84 compatible wallets.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xprv" class="col-sm-2 control-label">
                                            <span>Account Extended Private Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xprv-bip84" type="text" class="account-xprv private-data form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xpub" class="col-sm-2 control-label">
                                            <span>Account Extended Public Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xpub-bip84" type="text" class="account-xpub form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The BIP32 derivation path and extended keys are the basis for the derived addresses.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="bip84-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                        <div class="col-sm-10">
                                            <input id="bip84-path" type="text" class="path form-control" value="m/84'/0'/0'/0" readonly="readonly">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="bip86" class="tab-pane">
                            <form class="form-horizontal" role="form">
                                <br>
                                <div class="unavailable hidden">
                                    <div class="form-group">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-10">
                                            <p>BIP86 is unavailable for this coin.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="available">
                                    <div class="col-sm-2"></div>
                                    <div class="col-sm-10">
                                        <p>
                                            For more info see the
                                            <a href="https://github.com/bitcoin/bips/blob/master/bip-0086.mediawiki" target="_blank">BIP86 spec</a>.
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <label for="purpose-bip86" class="col-sm-2 control-label">
                                            Purpose
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="purpose-bip86" type="text" class="purpose form-control" value="86" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="coin-bip86" class="col-sm-2 control-label">
                                            Coin
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="coin-bip86" type="text" class="coin form-control" value="0" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-bip86" class="col-sm-2 control-label">
                                            Account
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="account-bip86" type="text" class="account form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="change-bip86" class="col-sm-2 control-label">
                                            External / Internal
                                        </label>
                                        <div class="col-sm-10">
                                            <input id="change-bip86" type="text" class="change form-control" value="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The account extended keys can be used for importing to most BIP86 compatible wallets.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xprv" class="col-sm-2 control-label">
                                            <span>Account Extended Private Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xprv-bip86" type="text" class="account-xprv private-data form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="account-xpub" class="col-sm-2 control-label">
                                            <span>Account Extended Public Key</span>
                                        </label>
                                        <div class="col-sm-10">
                                            <textarea id="account-xpub-bip86" type="text" class="account-xpub form-control" readonly data-show-qr autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                        </label>
                                        <div class="col-sm-10">
                                            <p>The BIP32 derivation path and extended keys are the basis for the derived addresses.</p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="bip86-path" class="col-sm-2 control-label">BIP32 Derivation Path</label>
                                        <div class="col-sm-10">
                                            <input id="bip86-path" type="text" class="path form-control" value="m/86'/0'/0'/0" readonly="readonly">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="lds" class="tab-pane">
                            <div class="lds-container row">
                                <form class="form-horizontal col-sm-8 col-xs-12" role="form">
                                    <br>
                                    <div class="available">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-10">
                                            <p>
                                                For more info see the
                                                <a href="https://github.com/LightningDotSpace/api" target="_blank">LightningDotSpace API</a>.
                                            </p>
                                        </div>
                                        <div class="form-group">
                                            <label for="lds-lnurl" class="col-sm-2 control-label">
                                                LNURL
                                            </label>
                                            <div class="col-sm-10">
                                                <textarea id="lds-lnurl" type="text" class="lds-lnurl form-control" value="" readonly></textarea>
                                            </div> 
                                        </div>
                                        <div class="form-group">
                                            <label for="lightning-address" class="col-sm-2 control-label">
                                                Lightning Address
                                            </label>
                                            <div class="col-sm-10">
                                                <input id="lightning-address" type="text" class="lightning-address form-control" value="" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="address-proof-of-ownership" class="col-sm-2 control-label">
                                                Address Proof of Ownership
                                            </label>
                                            <div class="col-sm-10">
                                                <textarea id="address-proof-of-ownership" type="text" class="address-proof-of-ownership form-control" value="" readonly></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="lnhub-admin-url" class="col-sm-2 control-label">
                                                LNHub Admin URL
                                            </label>
                                            <div class="col-sm-10">
                                                <textarea id="lnhub-admin-url" type="text" class="lnhub-admin-url form-control" value="" readonly></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="associated-address" class="col-sm-2 control-label">
                                                Associated Address
                                            </label>
                                            <div class="col-sm-10">
                                                <input id="associated-address" type="text" class="associated-address form-control" value="" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="lds-derivation-path" class="col-sm-2 control-label">
                                                Derivation Path
                                            </label>
                                            <div class="col-sm-10">
                                                <input id="lds-derivation-path" type="text" class="lds-derivation-path form-control" value="" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="lds-segwit-type" class="col-sm-2 control-label">
                                                SegWit Type
                                            </label>
                                            <div class="col-sm-10">
                                                <input id="lds-segwit-type" type="text" class="lds-segwit-type form-control" value="" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <div class="col-sm-4 col-xs-12">
                                    <br><br>
                                    <div id="lds-qr" class="d-flex justify-content-center align-items-center"></div>
                                    <p class="text-center">Scan the QR code with your lightning wallet to transfer funds.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <div class="row" id="derived-addresses-section">
                <div class="col-md-12">
                    <h2>Derived Addresses</h2>
                    <p>Note these addresses are derived from the BIP32 Extended Key</p>
                </div>
                <div class="col-md-12 bch-addr-type-container hidden">
                    <div class="radio">
                        <label>
                            <input type="radio" value="cashaddr" name="bch-addr-type" class="use-bch-cashaddr-addresses" checked="checked">
                            <span>Use CashAddr addresses for Bitcoin Cash (ie starting with 'q' instead of '1')</span>
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" value="bitpay" name="bch-addr-type" class="use-bch-bitpay-addresses">
                            <span>Use BitPay-style addresses for Bitcoin Cash (ie starting with 'C' instead of '1')</span>
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" value="legacy" name="bch-addr-type" class="use-bch-legacy-addresses">
                            <span>Use legacy addresses for Bitcoin Cash (ie starting with '1')</span>
                        </label>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" class="use-bip38">
                            <span>Encrypt private keys using BIP38 and this password:</span>
                        </label>
                        <input class="bip38-password private-data" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                        <span>Enabling BIP38 means each key will take several minutes to generate.</span>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="checkbox">
                        <label>
                            <input class="hardened-addresses" type="checkbox">
                            <span>Use hardened addresses</span>
                        </label>
                    </div>
                </div>
                <ul class="addresses-type nav nav-tabs" role="tablist">
                    <li id="table-tab" class="active">
                        <a href="#table" role="tab" data-toggle="tab">Table</a>
                    </li>
                    <li id="csv-tab">
                        <a href="#csv" role="tab" data-toggle="tab">CSV</a>
                    </li>
                </ul>
                <div class="addresses-type tab-content">
                    <div id="table" class="tab-pane active">
                        <div class="col-md-12">
                            <table class="table table-striped">
                                <thead>
                                    <th>
                                        <div class="input-group">
                                            <span>Path</span>&nbsp;&nbsp;
                                            <button class="index-toggle">Toggle</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="input-group">
                                            <span>Address</span>&nbsp;&nbsp;
                                            <button class="address-toggle">Toggle</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="input-group">
                                            <span>Public Key</span>&nbsp;&nbsp;
                                            <button class="public-key-toggle">Toggle</button>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="input-group">
                                            <span>Private Key</span>&nbsp;&nbsp;
                                            <button class="private-key-toggle">Toggle</button>
                                        </div>
                                    </th>
                                </thead>
                                <tbody class="addresses monospace">
                                    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                                    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                                    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                                    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                                    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="csv" class="tab-pane">
                        <div class="col-md-12">
                            <textarea class="csv form-control" rows="25" readonly autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div id="more-rows-section">
                <span>Show</span>
                <input type="number" class="rows-to-add" value="20">
                <button class="more">more rows</button>
                <span>starting from index</span>
                <input type="number" class="more-rows-start-index">
                <span>(leave blank to generate from next index)</span>
            </div>

            <hr>

            <div class="row">
                <div class="col-md-12">
                    <h2>More info</h2>
                    <h3>BIP39 <span class="small">Mnemonic code for generating deterministic keys</span></h3>
                    <p>
                        Read more at the
                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">official BIP39 spec</a>
                    </p>
                    <h3>BIP32 <span class="small">Hierarchical Deterministic Wallets</span></h3>
                    <p>
                        Read more at the
                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank">official BIP32 spec</a>
                    </p>
                    <p>
                        See the demo at
                        <a href="http://bip32.org/" target="_blank">bip32.org</a>
                    </p>
                    <h3>BIP44 <span class="small">Multi-Account Hierarchy for Deterministic Wallets</span></h3>
                    <p>
                        Read more at the
                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank">official BIP44 spec</a>
                    </p>
                    <h3>BIP49 <span class="small">Derivation scheme for P2WPKH-nested-in-P2SH based accounts</span></h3>
                    <p>
                        Read more at the
                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0049.mediawiki" target="_blank">official BIP49 spec</a>
                    </p>
                    <h3>BIP85 <span class="small">Deterministic Entropy From BIP32 Keychains</span></h3>
                    <p>
                        Read more at the
                        <a href="https://github.com/bitcoin/bips/blob/master/bip-0085.mediawiki" target="_blank">official BIP85 spec</a>
                    </p>
                    <h3 id="entropy-notes">Entropy</h3>
                    <p>
                        <span>Entropy values should not include the BIP39 checksum. This is automatically added by the tool.</span>
                    </p>
                    <p>
                        <span>
                            Entropy values must be sourced from a
                            <a href="https://en.wikipedia.org/wiki/Random_number_generation" target="_blank">strong source of randomness</a>.
                        </span>
                        <span>This means flipping a fair coin, rolling a fair dice, noise measurements etc.</span>
                        <span>
                            Do <strong>NOT</strong> use phrases from books, lyrics from songs, your birthday or street address,
                            keyboard mashing, or anything you <i>think</i> is random, because chances are overwhelming it isn't
                            random enough for the needs of this tool.
                        </span>
                    </p>
                    <p>
                        <strong><span>Do not store entropy.</span></strong>
                    </p>
                    <p>
                        <span>Storing entropy (such as keeping a deck of cards in a specific shuffled order) is unreliable compared to storing a mnemonic.</span>
                        <span>Instead of storing entropy, store the mnemonic generated from the entropy.</span>
                        <span><a href="https://en.wikipedia.org/wiki/Steganography#Physical" target="_blank">Steganography</a> may be beneficial when storing the mnemonic.</span>
                    </p>
                    <p>
                        <span>
                            The random mnemonic generator on this page uses a
                            <a href="https://developer.mozilla.org/en-US/docs/Web/API/RandomSource/getRandomValues" target="_blank">cryptographically secure random number generator</a>.
                        </span>
                        <span>The built in random generator can generally be trusted more than your own intuition about randomness.</span>
                        <span>If cryptographic randomness isn't available in your browser, this page will show a warning and the generate button will not work.</span>
                        <span>In that case you might choose to use your own source of entropy.</span>
                    </p>
                    <p>
                        <a href="https://bitcointalk.org/index.php?topic=311000.msg3345309#msg3345309" target="_blank">You are not a good source of entropy.</a>
                    </p>
                    <p>
                        <span>Card entropy has been implemented assuming cards are replaced, not drawn one after another.</span>
                        <span>A full deck with replacement generates 232 bits of entropy (21 words). A full deck without replacement generates 225 bits of entropy (21 words).</span>
                        <span>Card entropy changed significantly from v0.4.3 to v0.5.0. The old version can be accessed at
                            <a href="https://github.com/iancoleman/bip39/releases/tag/0.4.3">
                                https://github.com/iancoleman/bip39/releases/tag/0.4.3
                            </a>
                            or
                            <a href="https://web.archive.org/web/20201018232020/https://iancoleman.io/bip39/">
                                https://web.archive.org/web/20201018232020/https://iancoleman.io/bip39/
                            </a>
                        </span>
                    </p>
                    <h3 id="PBKDF2-notes">PBKDF2</h3>
                    <p><a href="https://learnmeabitcoin.com/technical/mnemonic#pbkdf2---password-based-key-derivation-function-2   " target="_blank">What is PBKDF2 (Password Based Key Derivation Function 2) ?</a></p>
                    <p><span>Please refer to this <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank">wikipedia article</a> for more detail.
                    <span>Mail about PBKDF2 security <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2016-July/012902.html" target="_blank">here</a>.</p>
                    <p>Wallet software that implement BIP39 only use 2048 iterations as a norm. Increasing this parameter will increase security against brute force attack, but you will need to store this new parameter. However, as long as you back up your BIP39 seed there will not be risk to lost your fund. To access them with custom PBKDF2 iterations, use this file (or <a href="https://stuff.birkenstab.de/pbkdf2/" target="_blank">other</a>) to compute your targeted BIP39 seed.</p>
                    <p>Using less than 2048 PBKDF2 iterations is insecure without strong optional BIP39 Passphrase.</p>
                    <h3>License</h3>
                    <p>
                    <span>Please refer to <a href="https://github.com/iancoleman/bip39/blob/master/LICENSE" target="_blank">the software license</a> for more detail.
                    </span>
                    </p>
                    <p>The software is provided "as is", without warranty of any kind, express or implied, including but not limited to the warranties of merchantability, fitness for a particular purpose and noninfringement. In no event shall the authors or copyright holders be liable for any claim, damages or other liability, whether in an action of contract, tort or otherwise, arising from, out of or in connection with the software or the use or other dealings in the software.</p>
                </div>
            </div>

            <hr>

            <div class="row">
                <div class="col-md-12">
                    <h2>Alternative Tools</h2>
                    <p>This tool is interoperable with any BIP39 wallet.</p>
                    <p>Some similar tools to this one (ie not consumer wallets) are</p>
                    <p>
                        <a href="https://bip32jp.github.io/english/">
                            https://bip32jp.github.io/english/
                        </a>
                    </p>
                </div>
            </div>

            <hr>

            <div class="row">
                <div class="col-md-12">

                    <h2>This project is 100% open-source code</h2>

                    <p>
                        <span>Get the source code from the repository</span>
                        -
                        <a href="https://github.com/DFXswiss/deterministic-key-generator" target="_blank">
                            https://github.com/DFXswiss/deterministic-key-generator
                        </a>
                    </p>

                    <h3>Libraries</h3>

                    <p>
                        <span>BitcoinJS - </span>
                        <a href="https://github.com/bitcoinjs/bitcoinjs-lib" target="_blank">
                            https://github.com/bitcoinjs/bitcoinjs-lib
                        </a>
                    </p>

                    <p>
                        <span>jsBIP39 - </span>
                        <a href="https://github.com/iancoleman/jsbip39" target="_blank">
                            https://github.com/iancoleman/jsbip39
                        </a>
                    </p>

                    <p>
                        <span>sjcl - </span>
                        <a href="https://github.com/bitwiseshiftleft/sjcl" target="_blank">
                            https://github.com/bitwiseshiftleft/sjcl
                        </a>
                    </p>

                    <p>
                        <span>jQuery - </span>
                        <a href="https://jquery.com/" target="_blank">
                            https://jquery.com/
                        </a>
                    </p>

                    <p>
                        <span>Twitter Bootstrap - </span>
                        <a href="http://getbootstrap.com/" target="_blank">
                            http://getbootstrap.com/
                        </a>
                    </p>

                </div>
            </div>

        </div>

        <div class="qr-container hidden">
            <div class="qr-hint bg-primary hidden">Click field to hide QR</div>
            <div class="qr-hint bg-primary">Click field to show QR</div>
            <div class="qr-hider hidden">
                <div class="qr-image"></div>
                <div class="qr-warning bg-primary">Caution: Scanner may keep history</div>
            </div>
        </div>

        <div class="feedback-container">
            <div class="feedback">Loading...</div>
        </div>

        <div id="qr-scanner-overlay" class="qr-scanner-overlay hidden">
            <div class="qr-scanner-container">
                <video id="video" width="100%" height="100%"></video>
                <button id="close-qr-scanner" class="btn btn-primary">Close</button>
            </div>
        </div>

        <script type="text/template" id="address-row-template">
            <tr>
                <td class="index"><span></span></td>
                <td class="address"><span data-show-qr></span></td>
                <td class="pubkey"><span data-show-qr></span></td>
                <td class="privkey private-data"><span data-show-qr></span></td>
            </tr>
        </script>
        <script src="js/jquery-3.2.1.js"></script>
        <script src="js/bootstrap.js"></script>
        <script src="js/bip39-libs.js"></script>
    <script src="js/ark-sdk-bundle.js"></script>
        <script src="js/bitcoinjs-extensions.js"></script>
        <script src="js/segwit-parameters.js"></script>
        <script src="js/ripple-util.js"></script>
        <script src="js/jingtum-util.js"></script>
        <script src="js/casinocoin-util.js"></script>
        <script src="js/cosmos-util.js"></script>
        <script src="js/eos-util.js"></script>
        <script src="js/fio-util.js"></script>
        <script src="js/xwc-util.js"></script>
        <script src="js/sjcl-bip39.js"></script>
        <script src="js/wordlist_english.js"></script>
        <script src="js/wordlist_japanese.js"></script>
        <script src="js/wordlist_spanish.js"></script>
        <script src="js/wordlist_chinese_simplified.js"></script>
        <script src="js/wordlist_chinese_traditional.js"></script>
        <script src="js/wordlist_french.js"></script>
        <script src="js/wordlist_italian.js"></script>
        <script src="js/wordlist_korean.js"></script>
        <script src="js/wordlist_czech.js"></script>
        <script src="js/wordlist_portuguese.js"></script>
        <script src="js/jsbip39.js"></script>
        <script src="js/entropy.js"></script>
        <script src="js/zxing.js"></script>
        <script src="js/qr-scanner.js"></script>
        <script src="js/lds.js"></script>
        <script src="js/index.js"></script>
        <script>
            // Handle Start with tab switching
            $(document).ready(function() {
                // Check URL parameters to see if we should open a specific tab
                function checkUrlParameters() {
                    // For older browsers that don't support URLSearchParams
                    var urlParams;
                    if (typeof URLSearchParams !== 'undefined') {
                        urlParams = new URLSearchParams(window.location.search);
                    } else {
                        // Fallback for older browsers
                        urlParams = {
                            get: function(name) {
                                var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
                                return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
                            }
                        };
                    }
                    
                    var tab = urlParams.get('tab');
                    var coin = urlParams.get('coin');
                    
                    if (tab === 'privatekey' || tab === 'private-key' || tab === 'privkey' || tab === 'private') {
                        // Activate the Private Key tab
                        // Use setTimeout to ensure the DOM is fully loaded
                        setTimeout(function() {
                            $('#start-with-tabs a[href="#start-private-key"]').tab('show');
                            
                            // Set coin if specified
                            if (coin) {
                                selectCoinByParameter(coin, '#network-private-key');
                            }
                        }, 100);
                    } else if (tab === 'mnemonic') {
                        // Activate the Mnemonic tab (default)
                        $('#start-with-tabs a[href="#start-mnemonic"]').tab('show');
                        
                        // Set coin if specified
                        if (coin) {
                            setTimeout(function() {
                                selectCoinByParameter(coin, '#network-phrase');
                            }, 100);
                        }
                    } else if (coin) {
                        // If only coin is specified without tab, apply to current tab
                        setTimeout(function() {
                            selectCoinByParameter(coin, '#network-phrase');
                        }, 100);
                    }
                }
                
                // Function to select coin based on URL parameter
                function selectCoinByParameter(coinParam, selector) {
                    // Wait for network options to be loaded
                    var waitForOptions = setInterval(function() {
                        if ($(selector + ' option').length > 0) {
                            clearInterval(waitForOptions);
                            
                            // Convert parameter to lowercase for case-insensitive matching
                            var searchParam = coinParam.toLowerCase();
                            
                            // Try to find matching coin
                            var found = false;
                            $(selector + ' option').each(function() {
                                var optionText = $(this).text().toLowerCase();
                                var optionValue = $(this).val();
                                
                                // Check various matching patterns
                                if (optionText === searchParam || 
                                    optionText.includes(searchParam) ||
                                    optionText.replace(/\s+/g, '').includes(searchParam.replace(/\s+/g, '')) ||
                                    optionText.replace(/[\s-]/g, '').includes(searchParam.replace(/[\s-]/g, ''))) {
                                    
                                    // Special handling for common coin abbreviations
                                    if ((searchParam === 'btc' && optionText.includes('btc - bitcoin') && !optionText.includes('testnet') && !optionText.includes('ark')) ||
                                        (searchParam === 'bitcoin' && optionText === 'btc - bitcoin') ||
                                        (searchParam === 'btc testnet' && optionText === 'btc - bitcoin testnet') ||
                                        (searchParam === 'ark' && optionText === 'btc - bitcoin ark testnet') ||
                                        (searchParam === 'eth' && optionText.includes('eth - ethereum')) ||
                                        (searchParam === 'ltc' && optionText.includes('ltc - litecoin'))) {
                                        $(selector).val(optionValue).trigger('change');
                                        found = true;
                                        return false; // Break the loop
                                    }
                                    
                                    // If not a special case, take the first match
                                    if (!found) {
                                        $(selector).val(optionValue).trigger('change');
                                        found = true;
                                        return false; // Break the loop
                                    }
                                }
                            });
                        }
                    }, 50);
                    
                    // Stop waiting after 5 seconds
                    setTimeout(function() {
                        clearInterval(waitForOptions);
                    }, 5000);
                }
                
                // Call on page load
                checkUrlParameters();
                
                // Function to copy network options
                function copyNetworkOptions() {
                    if ($('#network-phrase option').length > 0 && $('#network-private-key option').length === 0) {
                        // List of coins that do NOT support private key import
                        var unsupportedCoins = [
                            'ETH', 'BSC', 'ETC', 'CLO', 'ESN', 'EWT', 'EXP', 'ELLA', 'PIRL', 
                            'MIX', 'MUSIC', 'MOAC', 'ERE', 'POA', // EVM chains
                            'ATOM', 'LUNA', 'RUNE', 'IOV', 'OSMO', 'KAVA', 'BAND', 'IRIS', // Cosmos
                            'XRP', 'XLM', 'NANO', 'NAS', 'TRX', 'EOS', 'FIO', 'HNS', 'NRG', 'XWC', // Others
                            'SOL', 'ALGO', 'DOT', 'KSM', 'ADA', 'XTZ', 'HBAR', 'NEAR', 'FLOW', 
                            'ICP', 'STX', 'AR', 'FIL', 'MINA', 'CELO', 'MATIC', 'AVAX', 'FTM', 
                            'xDAI', 'BNB'
                        ];
                        
                        $('#network-phrase option').each(function() {
                            var networkText = $(this).text();
                            var isUnsupported = false;
                            
                            // Check if this network is in the unsupported list
                            for (var i = 0; i < unsupportedCoins.length; i++) {
                                if (networkText.includes(unsupportedCoins[i] + ' -')) {
                                    isUnsupported = true;
                                    break;
                                }
                            }
                            
                            // Only add supported coins to the private key dropdown
                            if (!isUnsupported) {
                                var newOption = new Option($(this).text(), $(this).val());
                                if ($(this).text() === "BTC - Bitcoin") {
                                    newOption.selected = true;
                                }
                                $('#network-private-key').append(newOption);
                            }
                        });
                        // Trigger change event to show/hide appropriate options
                        $('#network-private-key').trigger('change');
                        return true;
                    }
                    return false;
                }
                
                // Moved to after event handlers are attached
                
                // Tagged hash function for BIP341
                function taggedHash(tag, data) {
                    // Create SHA256 hash of the tag
                    var tagHash = libs.bitcoin.crypto.sha256(tag);
                    
                    // Concatenate: tagHash || tagHash || data
                    var preimage = [];
                    for (var i = 0; i < tagHash.length; i++) {
                        preimage.push(tagHash[i]);
                    }
                    for (var i = 0; i < tagHash.length; i++) {
                        preimage.push(tagHash[i]);
                    }
                    for (var i = 0; i < data.length; i++) {
                        preimage.push(data[i]);
                    }
                    
                    // Return SHA256 of the preimage
                    return libs.bitcoin.crypto.sha256(preimage);
                }
                
                // Apply Taproot tweak to x-only public key (BIP341)
                // Bech32m encoding functions for Taproot and Ark addresses
                var bech32m = {
                    // Base32 character set
                    CHARSET: 'qpzry9x8gf2tvdw0s3jn54khce6mua7l',
                    
                    // Convert to 5-bit words
                    toWords: function(bytes) {
                        var words = [];
                        var acc = 0;
                        var bits = 0;
                        for (var i = 0; i < bytes.length; i++) {
                            acc = (acc << 8) | bytes[i];
                            bits += 8;
                            while (bits >= 5) {
                                bits -= 5;
                                words.push((acc >> bits) & 0x1f);
                            }
                        }
                        if (bits > 0) {
                            words.push((acc << (5 - bits)) & 0x1f);
                        }
                        return words;
                    },
                    
                    // Polymod for checksum
                    polymod: function(values) {
                        var gen = [0x3b6a57b2, 0x26508e6d, 0x1ea119fa, 0x3d4233dd, 0x2a1462b3];
                        var chk = 1;
                        for (var i = 0; i < values.length; i++) {
                            var top = chk >> 25;
                            chk = (chk & 0x1ffffff) << 5 ^ values[i];
                            for (var j = 0; j < 5; j++) {
                                if ((top >> j) & 1) {
                                    chk ^= gen[j];
                                }
                            }
                        }
                        return chk;
                    },
                    
                    // Create checksum
                    createChecksum: function(hrp, data) {
                        var values = [];
                        // Add HRP expansion
                        for (var i = 0; i < hrp.length; i++) {
                            values.push(hrp.charCodeAt(i) >> 5);
                        }
                        values.push(0);
                        for (var i = 0; i < hrp.length; i++) {
                            values.push(hrp.charCodeAt(i) & 31);
                        }
                        // Add data
                        values = values.concat(data);
                        // Add 6 zeros for checksum
                        values = values.concat([0, 0, 0, 0, 0, 0]);
                        // Calculate checksum
                        var polymodValue = this.polymod(values) ^ 0x2bc830a3; // Bech32m constant
                        var checksum = [];
                        for (var i = 0; i < 6; i++) {
                            checksum.push((polymodValue >> 5 * (5 - i)) & 31);
                        }
                        return checksum;
                    },
                    
                    // Encode to bech32m
                    encode: function(hrp, data) {
                        var combined = data.concat(this.createChecksum(hrp, data));
                        var result = hrp + '1';
                        for (var i = 0; i < combined.length; i++) {
                            result += this.CHARSET[combined[i]];
                        }
                        return result;
                    }
                };

                function applyTaprootTweak(xOnlyPubkey) {
                    try {
                        // Get a dummy ECPair to access the curve
                        var dummyKey = libs.bitcoin.ECPair.makeRandom();
                        var curve = dummyKey.Q.curve;
                        var BigIntClass = dummyKey.d.constructor;
                        
                        // Convert x-only pubkey to BigInteger
                        var x = BigIntClass.fromByteArrayUnsigned(xOnlyPubkey);
                        
                        // Constants
                        var p = curve.p;
                        var n = curve.n;
                        var G = curve.G;
                        var seven = new BigIntClass('7');
                        var three = new BigIntClass('3');
                        var one = BigIntClass.ONE;
                        var four = new BigIntClass('4');
                        var two = new BigIntClass('2');
                        var zero = BigIntClass.ZERO;
                        
                        // Lift x to point (compute y from x)
                        // y^2 = x^3 + 7 (mod p)
                        var x3 = x.modPow(three, p);
                        var ySquared = x3.add(seven).mod(p);
                        
                        // Compute y = ySquared^((p+1)/4) mod p
                        var exponent = p.add(one).divide(four);
                        var y = ySquared.modPow(exponent, p);
                        
                        // Verify that y^2 = x^3 + 7
                        var ySquaredCheck = y.modPow(two, p);
                        if (ySquaredCheck.compareTo(ySquared) !== 0) {
                            throw new Error('Invalid point: y^2 != x^3 + 7');
                        }
                        
                        // Ensure y is even (BIP340/341 convention)
                        if (y.mod(two).compareTo(zero) !== 0) {
                            y = p.subtract(y);
                        }
                        
                        // Create the internal pubkey point P
                        // In bitcoinjs-lib v3, we need to use the Point constructor with z=1 for affine points
                        var Point = dummyKey.Q.constructor;
                        var P = new Point(curve, x, y, one);
                        
                        // For BIP86 (key-path spending), we tweak with empty script tree
                        // tweak = hashTapTweak(bytes(P))
                        var tweakHash = taggedHash('TapTweak', xOnlyPubkey);
                        var tweakInt = BigIntClass.fromByteArrayUnsigned(tweakHash);
                        
                        // Ensure tweak is within valid range
                        tweakInt = tweakInt.mod(n);
                        
                        // Calculate Q = P + tweak*G
                        var tweakPoint = G.multiply(tweakInt);
                        var Q = P.add(tweakPoint);
                        
                        // No need to check Q's y coordinate - we just return the x-coordinate
                        // The tweaking is complete
                        
                        // Return x-coordinate of Q as 32 bytes
                        var QxBigInt = Q.affineX;
                        var QxBytes = [];
                        
                        // Convert BigInteger to bytes manually to ensure unsigned
                        var hex = QxBigInt.toString(16);
                        // Pad to 64 hex chars (32 bytes)
                        while (hex.length < 64) {
                            hex = '0' + hex;
                        }
                        
                        // Convert hex to byte array
                        for (var i = 0; i < hex.length; i += 2) {
                            QxBytes.push(parseInt(hex.substr(i, 2), 16));
                        }
                        
                        return QxBytes;
                    } catch (e) {
                        console.error('Taproot tweak error:', e);
                        throw e;
                    }
                }
                
                // Generate Taproot (P2TR) address using Bech32m encoding
                function generateTaprootAddress(keyPair, network) {
                    try {
                        // Get the public key
                        var pubkey = keyPair.getPublicKeyBuffer();
                        
                        // For taproot, we need the x-only public key (32 bytes instead of 33)
                        // Remove the first byte (0x02 or 0x03) which indicates y-coordinate parity
                        var xOnlyPubkeyBytes = [];
                        for (var i = 1; i < 33; i++) {
                            xOnlyPubkeyBytes.push(pubkey[i]);
                        }
                        
                        // Apply BIP341 Taproot tweaking for BIP86 (key-path spending)
                        // For BIP86, we tweak with an empty script tree
                        var tweakedPubkey = applyTaprootTweak(xOnlyPubkeyBytes);
                        
                        // Bech32m encoding for Taproot
                        var prefix = network === libs.bitcoin.networks.bitcoin ? 'bc' : 'tb';
                        
                        // Add witness version (1 for taproot) and convert tweaked pubkey to 5-bit words
                        var data = [1].concat(bech32m.toWords(tweakedPubkey));
                        
                        // Use the bech32m implementation to encode
                        return bech32m.encode(prefix, data);
                        
                    } catch (error) {
                        console.error('Error generating Taproot address:', error);
                        // Fallback to a descriptive message
                        return 'Taproot P2TR address (partial implementation)';
                    }
                }
                
                // (bech32m definition has been moved earlier in the file)

                // Helper function to convert byte array to hex string
                function bytesToHex(bytes) {
                    var hex = '';
                    for (var i = 0; i < bytes.length; i++) {
                        var byte = bytes[i].toString(16);
                        if (byte.length < 2) byte = '0' + byte;
                        hex += byte;
                    }
                    return hex;
                }
                
                // Generate standard Ark Taproot address (P2TR with ark/tark prefix)
                // This follows the standard from the Ark documentation
                function generateStandardArkAddress(publicKeyBuffer, network, networkName) {
                    try {
                        // Get x-only public key (remove the first byte if it's 33 bytes)
                        var xOnlyPubkey = [];
                        if (publicKeyBuffer.length === 33) {
                            // Skip the first byte (0x02 or 0x03)
                            for (var i = 1; i < publicKeyBuffer.length; i++) {
                                xOnlyPubkey.push(publicKeyBuffer[i]);
                            }
                        } else if (publicKeyBuffer.length === 32) {
                            for (var i = 0; i < publicKeyBuffer.length; i++) {
                                xOnlyPubkey.push(publicKeyBuffer[i]);
                            }
                        } else {
                            throw new Error('Invalid public key length');
                        }
                        
                        // Create witness program for Taproot (version 1 + 32 bytes x-only pubkey)
                        var witnessProgram = [0x01]; // Witness version 1 for Taproot
                        for (var i = 0; i < xOnlyPubkey.length; i++) {
                            witnessProgram.push(xOnlyPubkey[i]);
                        }
                        
                        // Convert to 5-bit words for bech32m
                        var words = bech32m.toWords(witnessProgram);
                        
                        // Determine HRP based on network
                        var hrp = 'tark'; // Default to testnet
                        if (networkName && networkName.indexOf('Testnet') === -1 && network === libs.bitcoin.networks.bitcoin) {
                            hrp = 'ark'; // Use mainnet only if explicitly mainnet and not testnet
                        }
                        
                        // Encode as bech32m
                        return bech32m.encode(hrp, words);
                        
                    } catch (error) {
                        console.error('Error in generateStandardArkAddress:', error);
                        return "Error: " + error.message;
                    }
                }
                
                // Generate Ark Protocol VTXO address using the official SDK
                async function generateArkAddress(userPubkeyBuffer, serverUrl, network, networkName) {
                    try {
                        // Check if SDK is available
                        if (typeof window.ArkSDK === 'undefined' || !window.ArkSDK.generateArkProtocolAddress) {
                            throw new Error('Ark SDK not loaded. Please refresh the page.');
                        }
                        
                        // Convert user pubkey buffer to hex string
                        var userPubkeyHex = bytesToHex(userPubkeyBuffer);
                        
                        // Determine network type
                        var networkType = (networkName && networkName.indexOf('Testnet') === -1 && 
                                          network === libs.bitcoin.networks.bitcoin) ? 'mainnet' : 'testnet';
                        
                        // Use SDK to generate the address with server URL
                        var result = await window.ArkSDK.generateArkProtocolAddress(
                            userPubkeyHex,
                            serverUrl,
                            networkType
                        );
                        
                        if (result.success) {
                            return {
                                address: result.address,
                                vtxoKey: result.vtxoKey
                            };
                        } else {
                            throw new Error(result.error || 'Failed to generate Ark Protocol address');
                        }
                        
                    } catch (error) {
                        console.error('Error in generateArkAddress:', error);
                        
                        // For manual fallback, try to get server pubkey and exit delay from input fields
                        var serverPubkeyHex = $('#ark-server-pubkey').val() || '';
                        var exitDelay = $('#ark-exit-delay').val() || '172544';
                        
                        if (!serverPubkeyHex) {
                            return {
                                success: false,
                                error: 'Server URL required for Protocol address generation'
                            };
                        }
                        
                        // Fallback to manual implementation if we have the server pubkey
                        console.log('Falling back to manual implementation...');
                        return generateArkAddressManual(userPubkeyBuffer, serverPubkeyHex, exitDelay, network, networkName);
                    }
                }
                
                // Manual fallback implementation using SDK manual method
                function generateArkAddressManual(userPubkeyBuffer, serverPubkeyHex, exitDelay, network, networkName) {
                    // If SDK is available, use its manual method
                    if (typeof window.ArkSDK !== 'undefined' && window.ArkSDK.generateArkProtocolAddressManual) {
                        var userPubkeyHex = bytesToHex(userPubkeyBuffer);
                        var networkType = (networkName && networkName.indexOf('Testnet') === -1 && 
                                          network === libs.bitcoin.networks.bitcoin) ? 'mainnet' : 'testnet';
                        
                        return window.ArkSDK.generateArkProtocolAddressManual(
                            userPubkeyHex,
                            serverPubkeyHex,
                            parseInt(exitDelay),
                            networkType
                        );
                    }
                    
                    // Otherwise use the old manual implementation
                    return generateArkAddressManualOld(userPubkeyBuffer, serverPubkeyHex, exitDelay, network, networkName);
                }
                
                // Old manual fallback implementation (previous code)
                function generateArkAddressManualOld(userPubkeyBuffer, serverPubkeyHex, exitDelay, network, networkName) {
                    try {
                        var bitcoin = libs.bitcoin;
                        
                        // Convert server pubkey hex to x-only format (32 bytes)
                        var serverXOnlyPubkey = [];
                        if (serverPubkeyHex.length === 66 && (serverPubkeyHex.substr(0, 2) === '02' || serverPubkeyHex.substr(0, 2) === '03')) {
                            for (var i = 2; i < serverPubkeyHex.length; i += 2) {
                                serverXOnlyPubkey.push(parseInt(serverPubkeyHex.substr(i, 2), 16));
                            }
                        } else if (serverPubkeyHex.length === 64) {
                            for (var i = 0; i < serverPubkeyHex.length; i += 2) {
                                serverXOnlyPubkey.push(parseInt(serverPubkeyHex.substr(i, 2), 16));
                            }
                        } else {
                            throw new Error('Invalid server public key format');
                        }
                        
                        // Get x-only pubkey for user
                        var userXOnlyPubkey = [];
                        if (userPubkeyBuffer.length === 33) {
                            for (var i = 1; i < userPubkeyBuffer.length; i++) {
                                userXOnlyPubkey.push(userPubkeyBuffer[i]);
                            }
                        } else if (userPubkeyBuffer.length === 32) {
                            for (var i = 0; i < userPubkeyBuffer.length; i++) {
                                userXOnlyPubkey.push(userPubkeyBuffer[i]);
                            }
                        } else {
                            throw new Error('Invalid user public key length');
                        }
                        
                        // Create hash for VTXO key (placeholder)
                        var dataToHash = [];
                        for (var i = 0; i < userXOnlyPubkey.length; i++) {
                            dataToHash.push(userXOnlyPubkey[i]);
                        }
                        for (var i = 0; i < serverXOnlyPubkey.length; i++) {
                            dataToHash.push(serverXOnlyPubkey[i]);
                        }
                        var delay = parseInt(exitDelay);
                        dataToHash.push(delay & 0xff);
                        dataToHash.push((delay >> 8) & 0xff);
                        dataToHash.push((delay >> 16) & 0xff);
                        dataToHash.push((delay >> 24) & 0xff);
                        
                        var vtxoTaprootKey = bitcoin.crypto.sha256(dataToHash);
                        
                        // Create address data
                        var addressData = [];
                        addressData.push(0); // version 0
                        
                        for (var i = 0; i < serverXOnlyPubkey.length; i++) {
                            addressData.push(serverXOnlyPubkey[i]);
                        }
                        
                        for (var i = 0; i < 32; i++) {
                            addressData.push(vtxoTaprootKey[i]);
                        }
                        
                        var words = bech32m.toWords(addressData);
                        
                        var hrp = 'tark';
                        if (networkName && networkName.indexOf('Testnet') === -1 && network === libs.bitcoin.networks.bitcoin) {
                            hrp = 'ark';
                        }
                        
                        var encodedAddress = bech32m.encode(hrp, words);
                        
                        return {
                            address: encodedAddress,
                            vtxoKey: bytesToHex(vtxoTaprootKey)
                        };
                        
                    } catch (error) {
                        console.error('Error in manual Ark address generation:', error);
                        return "Error: " + error.message;
                    }
                }
                
                // Private Key conversion functionality
                function processPrivateKey() {
                    var privKeyInput = $('#private-key-input').val().trim();
                    var networkIndex = $('#network-private-key').val();
                    
                    // Clear previous results and errors
                    $('#private-key-error').addClass('hidden').text('');
                    $('#private-key-results').addClass('hidden');
                    $('#private-key-public').val('');
                    $('#private-key-address').val('');
                    $('#private-key-wif').val('');
                    // Clear Ark result fields
                    $('#ark-result-user-pubkey').val('');
                    $('#ark-result-server-pubkey').val('');
                    $('#ark-result-exit-delay').val('');
                    $('#ark-result-network').val('');
                    $('.ark-result-fields').addClass('hidden');
                    
                    if (!privKeyInput) {
                        return;
                    }
                    
                    if (!networkIndex) {
                        $('#private-key-error').removeClass('hidden').text('Please select a coin');
                        return;
                    }
                    
                    try {
                        // Check if required global variables are available
                        if (typeof networks === 'undefined' || typeof libs === 'undefined') {
                            throw new Error('Required libraries not loaded. Please refresh the page.');
                        }
                        
                        // Get the network configuration
                        var networkConfig = networks[parseInt(networkIndex)];
                        
                        // Call onSelect to set up the network properly
                        if (networkConfig && networkConfig.onSelect) {
                            networkConfig.onSelect();
                        }
                        
                        // Now use the global network variable that was set by onSelect
                        // Note: network is a global variable set by onSelect
                        var bitcoinNetwork = (typeof network !== 'undefined' ? network : libs.bitcoin.networks.bitcoin);
                        
                        var networkName = networkConfig.name;
                        
                        // Note: Additional params visibility is now handled by network selection change event
                        
                        var keyPair;
                        var compressed = $('#private-key-compressed').is(':checked');
                        
                        // Try to parse the private key in different formats
                        var isWifFormat = false;
                        try {
                            // Try WIF format first with the selected network
                            keyPair = libs.bitcoin.ECPair.fromWIF(privKeyInput, bitcoinNetwork);
                            isWifFormat = true;
                        } catch (e1) {
                            // If that fails and we're on testnet, also try without network parameter
                            // This handles some edge cases with WIF parsing
                            if (networkName && networkName.includes("Testnet")) {
                                try {
                                    keyPair = libs.bitcoin.ECPair.fromWIF(privKeyInput);
                                    // Re-create with correct network
                                    var d = keyPair.d;
                                    keyPair = new libs.bitcoin.ECPair(d, null, {
                                        network: bitcoinNetwork,
                                        compressed: keyPair.compressed
                                    });
                                    isWifFormat = true;
                                } catch (e1b) {
                                    // Continue to hex parsing
                                }
                            }
                            
                            if (!isWifFormat) {
                            // Not WIF, try other formats
                            var hexKey = privKeyInput;
                            
                            // Check for Nostr nsec format (Bech32 encoded)
                            if (hexKey.startsWith('nsec1')) {
                                try {
                                    // Decode Nostr nsec (Bech32) to get the private key
                                    // The bech32 library structure varies
                                    var bech32lib = libs.bech32;
                                    
                                    // Check which API is available
                                    var decoded;
                                    if (bech32lib.bech32 && bech32lib.bech32.decode) {
                                        // Nested structure
                                        decoded = bech32lib.bech32.decode(hexKey);
                                        var bytes = bech32lib.bech32.fromWords(decoded.words);
                                    } else if (bech32lib.decode) {
                                        // Direct structure
                                        decoded = bech32lib.decode(hexKey);
                                        var bytes = bech32lib.fromWords(decoded.words);
                                    } else {
                                        throw new Error("Bech32 library not properly loaded");
                                    }
                                    
                                    // Convert bytes to hex
                                    hexKey = '';
                                    for (var i = 0; i < bytes.length; i++) {
                                        var hex = bytes[i].toString(16);
                                        if (hex.length === 1) hex = '0' + hex;
                                        hexKey += hex;
                                    }
                                } catch (bech32Error) {
                                    // Don't throw here, let it fall through to the general error
                                    // This allows the error message to be more helpful
                                    hexKey = privKeyInput; // Reset to original
                                }
                            }
                            // Remove 0x prefix if present (common for Ethereum)
                            else if (hexKey.indexOf('0x') === 0 || hexKey.indexOf('0X') === 0) {
                                hexKey = hexKey.substring(2);
                            }
                            
                            // Validate hex format (64 characters)
                            if (!hexKey.match(/^[0-9a-fA-F]{64}$/)) {
                                throw new Error("Invalid private key format. Expected WIF, 64 hex characters, or Nostr nsec format.");
                            }
                            
                            // Create ECPair from hex - we need a different approach
                            // Since we can't directly parse hex to BigInteger, we'll convert to WIF first
                            try {
                                // Convert hex to bytes first
                                var bytes = [];
                                for (var i = 0; i < hexKey.length; i += 2) {
                                    bytes.push(parseInt(hexKey.substr(i, 2), 16));
                                }
                                
                                // Get BigInteger class from a dummy HDNode
                                var dummyNode = libs.bitcoin.HDNode.fromSeedHex('0000000000000000000000000000000000000000000000000000000000000001');
                                var BigIntClass = dummyNode.keyPair.d.constructor;
                                
                                // Create BigInteger from bytes
                                var privateKeyBigInt;
                                if (BigIntClass.fromByteArrayUnsigned) {
                                    privateKeyBigInt = BigIntClass.fromByteArrayUnsigned(bytes);
                                } else {
                                    // Try direct constructor with reversed bytes (little-endian)
                                    privateKeyBigInt = new BigIntClass(bytes.reverse());
                                }
                                
                                // Create the key pair with the BigInteger private key
                                keyPair = new libs.bitcoin.ECPair(privateKeyBigInt, null, {
                                    network: bitcoinNetwork,
                                    compressed: compressed
                                });
                            } catch (e2) {
                                throw new Error("Failed to create key pair: " + e2.message);
                            }
                            } // Close the if (!isWifFormat) block
                        }
                        
                        // Generate public key and address based on network type
                        var pubkey = '';
                        var address = '';
                        var wif = '';
                        
                        // Handle Bitcoin Ark Testnet specially
                        if (networkName === "BTC - Bitcoin Ark Testnet") {
                            // For Ark, we need server info to generate special address
                            // Get user's public key
                            var userPubkey = keyPair.getPublicKeyBuffer();
                            pubkey = userPubkey.toString('hex');
                            wif = keyPair.toWIF();
                            
                            // Get server params from form fields
                            var serverPubkey = $('#ark-server-pubkey').val();
                            var exitDelay = $('#ark-exit-delay').val();
                            var arkNetwork = $('#ark-network').val();
                            
                            // Show Ark result fields
                            $('.ark-result-fields').removeClass('hidden');
                            
                            // Always generate standard Ark address
                            try {
                                var standardAddress = generateStandardArkAddress(userPubkey, bitcoinNetwork, networkName);
                                $('#ark-standard-address').val(standardAddress);
                                // Use standard address as main address if no server info
                                if (!serverPubkey || !exitDelay) {
                                    address = standardAddress;
                                }
                            } catch (e) {
                                console.error('Error generating standard Ark address:', e);
                                $('#ark-standard-address').val('Error: ' + e.message);
                            }
                            
                            if (serverPubkey && exitDelay) {
                                // Populate individual Ark result fields
                                $('#ark-result-user-pubkey').val(pubkey);
                                $('#ark-result-server-pubkey').val(serverPubkey);
                                $('#ark-result-exit-delay').val(exitDelay + ' blocks');
                                $('#ark-result-network').val(arkNetwork);
                                $('#ark-result-script').val('A + S | A after T');
                                $('#ark-result-note').val('Generated using official arkade-os SDK');
                                
                                // Generate Ark Protocol VTXO address
                                var serverUrl = $('#ark-server-url').val() || 'https://mutinynet.arkade.sh';
                                generateArkAddress(userPubkey, serverUrl, bitcoinNetwork, networkName).then(function(arkResult) {
                                    if (arkResult && typeof arkResult === 'object' && arkResult.address) {
                                        $('#ark-protocol-address').val(arkResult.address);
                                        $('#ark-result-vtxo-key').val(arkResult.vtxoKey);
                                        $('#ark-server-pubkey').val(arkResult.serverPubKey);
                                        $('#ark-exit-delay').val(arkResult.exitDelay || '');
                                        // Use protocol address as main address when server info available
                                        address = arkResult.address;
                                    } else if (arkResult && arkResult.error) {
                                        $('#ark-protocol-address').val('Error: ' + arkResult.error);
                                    } else {
                                        $('#ark-protocol-address').val(arkResult); // In case of error string
                                    }
                                }).catch(function(e) {
                                    console.error('Error generating Ark Protocol address:', e);
                                    $('#ark-protocol-address').val('Error: ' + e.message);
                                });
                            } else {
                                // Show user pubkey but indicate server info is needed
                                $('#ark-result-user-pubkey').val(pubkey);
                                $('#ark-result-server-pubkey').val('Please click "Fetch Info" to get server parameters');
                                $('#ark-result-exit-delay').val('');
                                $('#ark-result-network').val('');
                                $('#ark-result-script').val('A + S | A after T');
                                $('#ark-result-note').val('Server parameters required for address generation');
                                address = 'Please fetch server info to generate Ark address';
                            }
                            
                            // Display results
                            $('#private-key-public').val(pubkey);
                            $('#private-key-address').val(address);
                            $('#private-key-wif').val(wif);
                            $('#private-key-results').removeClass('hidden');
                            
                            return; // Exit early for Ark
                        }
                        // Only support Bitcoin and Bitcoin-like coins that use standard WIF format
                        // Unsupported: Ethereum, EVM chains, Cosmos, XRP, and other special formats
                        else if (networkName.includes("ETH") || networkName.includes("BNB") || networkName.includes("MATIC") || 
                            networkName.includes("AVAX") || networkName.includes("FTM") || networkName.includes("xDAI") ||
                            networkName.includes("ATOM") || networkName.includes("LUNA") || networkName.includes("OSMO") ||
                            networkName.includes("XRP") || networkName.includes("XLM") || networkName.includes("NANO") ||
                            networkName.includes("NAS") || networkName.includes("TRX") || networkName.includes("EOS") ||
                            networkName.includes("FIO") || networkName.includes("RUNE") || networkName.includes("SOL") ||
                            networkName.includes("ALGO") || networkName.includes("DOT") || networkName.includes("KSM") ||
                            networkName.includes("ADA") || networkName.includes("XTZ") || networkName.includes("HBAR") ||
                            networkName.includes("NEAR") || networkName.includes("FLOW") || networkName.includes("ICP") ||
                            networkName.includes("STX") || networkName.includes("HNS") || networkName.includes("AR") ||
                            networkName.includes("FIL") || networkName.includes("MINA") || networkName.includes("CELO") ||
                            networkName.includes("KAVA") || networkName.includes("BAND") || networkName.includes("IRIS") ||
                            networkName.includes("IOV") || networkName.includes("XWC") || networkName.includes("NRG")) {
                            throw new Error("This cryptocurrency is not supported for private key input. Please use the Mnemonic tab instead.");
                        }
                        // Handle Bitcoin and Bitcoin-like coins (BTC, BCH, LTC, DOGE, DASH, ZEC, etc.)
                        else {
                            pubkey = keyPair.getPublicKeyBuffer().toString('hex');
                            
                            // Check for SegWit address type selection
                            var addressType = $('#private-key-address-type').val();
                            
                            if ((networkName === "BTC - Bitcoin" || networkName === "BTC - Bitcoin Testnet") && addressType === "p2tr") {
                                // Taproot (P2TR) - Bech32m
                                address = generateTaprootAddress(keyPair, bitcoinNetwork);
                            } else if ((networkName === "BTC - Bitcoin" || networkName === "BTC - Bitcoin Testnet") && addressType === "p2wpkh") {
                                // Native SegWit (Bech32)
                                var keyhash = libs.bitcoin.crypto.hash160(keyPair.getPublicKeyBuffer());
                                var scriptpubkey = libs.bitcoin.script.witnessPubKeyHash.output.encode(keyhash);
                                address = libs.bitcoin.address.fromOutputScript(scriptpubkey, bitcoinNetwork);
                            } else if ((networkName === "BTC - Bitcoin" || networkName === "BTC - Bitcoin Testnet") && addressType === "p2sh-p2wpkh") {
                                // Nested SegWit
                                var keyhash = libs.bitcoin.crypto.hash160(keyPair.getPublicKeyBuffer());
                                var scriptsig = libs.bitcoin.script.witnessPubKeyHash.output.encode(keyhash);
                                var addressbytes = libs.bitcoin.crypto.hash160(scriptsig);
                                var scriptpubkey = libs.bitcoin.script.scriptHash.output.encode(addressbytes);
                                address = libs.bitcoin.address.fromOutputScript(scriptpubkey, bitcoinNetwork);
                            } else {
                                // Legacy P2PKH address - always use fromOutputScript to ensure correct network
                                var pubKeyHash = libs.bitcoin.crypto.hash160(keyPair.getPublicKeyBuffer());
                                var scriptPubKey = libs.bitcoin.script.pubKeyHash.output.encode(pubKeyHash);
                                address = libs.bitcoin.address.fromOutputScript(scriptPubKey, bitcoinNetwork);
                            }
                            
                            wif = keyPair.toWIF();
                        }
                        
                        // Display results
                        $('#private-key-public').val(pubkey);
                        $('#private-key-address').val(address);
                        
                        // Always show WIF field and display the WIF value
                        $('#private-key-wif').parent().parent().removeClass('hidden');
                        $('#private-key-wif').val(wif);
                        
                        // Don't show results here for Ark (already shown in async handler)
                        if (networkName !== "BTC - Bitcoin Ark Testnet") {
                            $('#private-key-results').removeClass('hidden');
                        }
                        
                    } catch (error) {
                        // Don't log error to console for security - it might contain private key info
                        var safeErrorMessage = 'Error: ' + (error.message || 'Invalid private key or network configuration');
                        // Sanitize error message to prevent XSS
                        $('#private-key-error').removeClass('hidden').text(safeErrorMessage.replace(/[<>]/g, ''));
                    }
                }
                
                // Expose functions to window for testing
                window.processPrivateKey = processPrivateKey;
                window.applyTaprootTweak = applyTaprootTweak;
                window.taggedHash = taggedHash;
                window.bech32m = bech32m;
                
                // Event handlers for private key input and Ark parameters
                $('#private-key-input, #private-key-address-type, #private-key-compressed').on('change input', function() {
                    processPrivateKey();
                });
                
                // Handle network selection change separately to show/hide params immediately
                $('#network-private-key').on('change', function() {
                    var networkName = $('#network-private-key option:selected').text();
                    
                    // Show/hide additional params based on selection
                    $('#private-key-additional-params').removeClass('hidden');
                    
                    // Show segwit options for Bitcoin and Bitcoin Testnet
                    if (networkName === "BTC - Bitcoin" || networkName === "BTC - Bitcoin Testnet" || networkName === "LTC - Litecoin") {
                        $('.segwit-options').removeClass('hidden');
                    } else {
                        $('.segwit-options').addClass('hidden');
                    }
                    
                    // Show Ark params for Bitcoin Ark Testnet
                    if (networkName === "BTC - Bitcoin Ark Testnet") {
                        $('.ark-params').removeClass('hidden');
                        // Auto-fetch server info if URL is present and fields are empty
                        if ($('#ark-server-url').val() && !$('#ark-server-pubkey').val()) {
                            $('#fetch-ark-info').click();
                        }
                    } else {
                        $('.ark-params').addClass('hidden');
                    }
                    
                    // Show compressed key option for Bitcoin-like coins
                    if (!networkName.includes("ETH") && !networkName.includes("EOS") && !networkName.includes("ATOM")) {
                        $('.compressed-key-option').removeClass('hidden');
                    } else {
                        $('.compressed-key-option').addClass('hidden');
                    }
                    
                    // Process private key if one is entered
                    if ($('#private-key-input').val()) {
                        processPrivateKey();
                    }
                });
                
                // Update display when Ark parameters change
                $('#ark-server-pubkey, #ark-exit-delay, #ark-network').on('change input', function() {
                    var networkName = $('#network-private-key option:selected').text();
                    if (networkName === "BTC - Bitcoin Ark Testnet" && $('#private-key-input').val()) {
                        processPrivateKey();
                    }
                });
                
                // Function to securely clear private key data
                function clearPrivateKeyData() {
                    // Overwrite values before clearing for better security
                    var fields = ['#private-key-input', '#private-key-public', '#private-key-address', '#private-key-wif', 
                                  '#ark-result-user-pubkey', '#ark-result-server-pubkey', '#ark-result-exit-delay', 
                                  '#ark-result-network'];
                    fields.forEach(function(field) {
                        var $field = $(field);
                        if ($field.val()) {
                            // Overwrite with random data before clearing
                            $field.val('0'.repeat($field.val().length));
                            $field.val('');
                        }
                    });
                    $('#private-key-results').addClass('hidden');
                    $('.ark-result-fields').addClass('hidden');
                    $('#private-key-error').addClass('hidden').text('');
                }
                
                // Fetch Ark server info button handler
                $('#fetch-ark-info').on('click', function() {
                    var serverUrl = $('#ark-server-url').val();
                    if (!serverUrl) {
                        alert('Please enter an Ark server URL');
                        return;
                    }
                    
                    // Show loading state
                    $(this).text('Fetching...').prop('disabled', true);
                    
                    $.ajax({
                        url: serverUrl + '/v1/info',
                        method: 'GET',
                        success: function(serverInfo) {
                            // Fill in all the form fields
                            $('#ark-server-pubkey').val(serverInfo.signerPubkey || '');
                            $('#ark-exit-delay').val(serverInfo.unilateralExitDelay || '');
                            $('#ark-network').val(serverInfo.network || '');
                            $('#ark-vtxo-expiry').val(serverInfo.vtxoTreeExpiry || '');
                            $('#ark-round-interval').val(serverInfo.roundInterval || '');
                            $('#ark-dust').val(serverInfo.dust || '');
                            $('#ark-forfeit-address').val(serverInfo.forfeitAddress || '');
                            
                            // Reset button
                            $('#fetch-ark-info').text('Fetch Info').prop('disabled', false);
                            
                            // Re-process private key to update the display
                            processPrivateKey();
                        },
                        error: function(xhr, status, error) {
                            alert('Error fetching server info: ' + error);
                            $('#fetch-ark-info').text('Fetch Info').prop('disabled', false);
                        }
                    });
                });
                
                // Generate random private key button handler
                $('#generate-private-key').on('click', function() {
                    var networkIndex = $('#network-private-key').val();
                    
                    if (!networkIndex) {
                        alert('Please select a coin first');
                        return;
                    }
                    
                    try {
                        // Check if required global variables are available
                        if (typeof networks === 'undefined' || typeof libs === 'undefined') {
                            throw new Error('Required libraries not loaded. Please refresh the page.');
                        }
                        
                        // Get the network configuration
                        var networkConfig = networks[parseInt(networkIndex)];
                        
                        // Call onSelect to set up the network properly
                        if (networkConfig && networkConfig.onSelect) {
                            networkConfig.onSelect();
                        }
                        
                        // Use the global network variable that was set by onSelect
                        var bitcoinNetwork = (typeof network !== 'undefined' ? network : libs.bitcoin.networks.bitcoin);
                        
                        // Generate random private key
                        var randomBytes = new Uint8Array(32);
                        if (window.crypto && window.crypto.getRandomValues) {
                            window.crypto.getRandomValues(randomBytes);
                        } else {
                            // Fallback for older browsers
                            for (var i = 0; i < 32; i++) {
                                randomBytes[i] = Math.floor(Math.random() * 256);
                            }
                        }
                        
                        // Convert to hex string
                        var hexKey = '';
                        for (var i = 0; i < randomBytes.length; i++) {
                            var hex = randomBytes[i].toString(16);
                            if (hex.length === 1) hex = '0' + hex;
                            hexKey += hex;
                        }
                        
                        // Create ECPair from the random bytes
                        var bytes = [];
                        for (var i = 0; i < hexKey.length; i += 2) {
                            bytes.push(parseInt(hexKey.substr(i, 2), 16));
                        }
                        
                        // Get BigInteger class from a dummy node
                        var dummyNode = libs.bitcoin.HDNode.fromSeedHex('0000000000000000000000000000000000000000000000000000000000000001');
                        var BigIntClass = dummyNode.keyPair.d.constructor;
                        
                        var privateKeyBigInt;
                        if (BigIntClass.fromByteArrayUnsigned) {
                            privateKeyBigInt = BigIntClass.fromByteArrayUnsigned(bytes);
                        } else {
                            privateKeyBigInt = new BigIntClass(hexKey, 16);
                        }
                        
                        // Create ECPair with compressed key by default
                        var keyPair = new libs.bitcoin.ECPair(privateKeyBigInt, null, {
                            network: bitcoinNetwork,
                            compressed: true
                        });
                        
                        // Convert to WIF format for display
                        var wif = keyPair.toWIF();
                        
                        // Set the private key in the input field
                        $('#private-key-input').val(wif);
                        
                        // Process the private key to show results
                        processPrivateKey();
                        
                    } catch (error) {
                        console.error('Error generating private key:', error);
                        alert('Error generating private key: ' + error.message);
                    }
                });
                
                // Now that all event handlers are attached, try to copy network options
                // This will also trigger the change event to show/hide appropriate options
                if (!copyNetworkOptions()) {
                    // If initial copy fails, try again after a short delay
                    setTimeout(function() {
                        copyNetworkOptions();
                    }, 100);
                }
                
                $('#start-with-tabs a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                    var target = $(e.target).attr("href");
                    if (target === "#start-private-key") {
                        // Try to copy options again when switching to Private Key tab
                        copyNetworkOptions();
                        
                        // Securely clear Private Key fields
                        clearPrivateKeyData();
                        
                        // Hide Derivation Path section
                        $('#derivation-path-section').hide();
                        $('#derivation-path-section').prev('hr').hide();
                        // Hide Derived Addresses section
                        $('#derived-addresses-section').hide();
                        $('#derived-addresses-section').prev('hr').hide();
                        // Hide More Rows section
                        $('#more-rows-section').hide();
                    } else if (target === "#start-mnemonic") {
                        // Clear Mnemonic fields when switching back from Private Key
                        $('#phrase').val('');
                        $('#passphrase').val('');
                        $('#seed').val('');
                        $('#root-key').val('');
                        $('.addresses').empty();
                        
                        // Show Derivation Path section
                        $('#derivation-path-section').show();
                        $('#derivation-path-section').prev('hr').show();
                        // Show Derived Addresses section
                        $('#derived-addresses-section').show();
                        $('#derived-addresses-section').prev('hr').show();
                        // Show More Rows section
                        $('#more-rows-section').show();
                    }
                });
            });
        </script>
    </body>
</html>
