/*! For license information please see ark-sdk-bundle.js.LICENSE.txt */
(()=>{var e={24:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vtxosToTxs=function(e,t,r){const d=[];let l=[...t];for(const s of[...e,...t]){if("preconfirmed"!==s.virtualStatus.state&&s.virtualStatus.commitmentTxIds&&s.virtualStatus.commitmentTxIds.some(e=>r.has(e)))continue;const e=o(l,s);l=u(l,e);const t=a(e);if(s.value<=t)continue;const c=i(l,s);l=u(l,c);const p=a(c);if(s.value<=p)continue;const h={commitmentTxid:s.spentBy||"",boardingTxid:"",arkTxid:""};let f="preconfirmed"!==s.virtualStatus.state;"preconfirmed"===s.virtualStatus.state&&(h.arkTxid=s.txid,s.spentBy&&(f=!0)),d.push({key:h,amount:s.value-t-p,type:n.TxType.TxReceived,createdAt:s.createdAt.getTime(),settled:f})}const p=new Map;for(const e of t){if(e.settledBy){p.has(e.settledBy)||p.set(e.settledBy,[]);const t=p.get(e.settledBy);p.set(e.settledBy,[...t,e])}if(!e.arkTxId)continue;p.has(e.arkTxId)||p.set(e.arkTxId,[]);const t=p.get(e.arkTxId);p.set(e.arkTxId,[...t,e])}for(const[r,o]of p){const i=s([...e,...t],r),u=a(i),l=a(o);if(l<=u)continue;const p=c(i,o),h={commitmentTxid:p.virtualStatus.commitmentTxIds?.[0]||"",boardingTxid:"",arkTxid:""};"preconfirmed"===p.virtualStatus.state&&(h.arkTxid=p.txid),d.push({key:h,amount:l-u,type:n.TxType.TxSent,createdAt:p.createdAt.getTime(),settled:!0})}return d};const n=r(6776);function o(e,t){return"preconfirmed"===t.virtualStatus.state?[]:e.filter(e=>!!e.settledBy&&(t.virtualStatus.commitmentTxIds?.includes(e.settledBy)??!1))}function i(e,t){return e.filter(e=>!!e.arkTxId&&e.arkTxId===t.txid)}function s(e,t){return e.filter(e=>!("preconfirmed"===e.virtualStatus.state||!e.virtualStatus.commitmentTxIds?.includes(t))||e.txid===t)}function a(e){return e.reduce((e,t)=>e+t.value,0)}function c(e,t){return 0===e.length?t[0]:e[0]}function u(e,t){return e.filter(e=>{for(const r of t)if(e.txid===r.txid&&e.vout===r.vout)return!1;return!0})}},227:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawPSBTV2=t.RawPSBTV0=t._DebugPSBT=t._RawPSBTV2=t._RawPSBTV0=t.PSBTOutputCoder=t.PSBTInputCoder=t.PSBTOutputUnsignedKeys=t.PSBTOutput=t.PSBTInputUnsignedKeys=t.PSBTInputFinalKeys=t.PSBTInput=t.PSBTGlobal=t.TaprootControlBlock=void 0,t.cleanPSBTFields=function(e,t,r){const n={};for(const o in r){const i=o;if("unknown"!==i){if(!t[i])continue;const{allowInc:r,silentIgnore:n}=E(t[i]);if(!r.includes(e)){if(n)continue;throw new Error(`Failed to serialize in PSBTv${e}: ${i} but versions allows inclusion=${r}`)}}n[i]=r[i]}return n},t.mergeKeyMap=function(e,t,r,o,i){const a={...r,...t};for(const i in e){const c=i,[u,d,l]=e[c],p=o&&!o.includes(i);if(void 0===t[i]&&i in t){if(p)throw new Error(`Cannot remove signed field=${i}`);delete a[i]}else if(d){const e=r&&r[i]?r[i]:[];let o=t[c];if(o){if(!Array.isArray(o))throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);o=o.map(e=>{if(2!==e.length)throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);return["string"==typeof e[0]?d.decode(n.hex.decode(e[0])):e[0],"string"==typeof e[1]?l.decode(n.hex.decode(e[1])):e[1]]});const t={},r=(e,r,o)=>{if(void 0===t[e])return void(t[e]=[r,o]);const i=n.hex.encode(l.encode(t[e][1])),s=n.hex.encode(l.encode(o));if(i!==s)throw new Error(`keyMap(${c}): same key=${e} oldVal=${i} newVal=${s}`)};for(const[t,o]of e)r(n.hex.encode(d.encode(t)),t,o);for(const[e,i]of o){const o=n.hex.encode(d.encode(e));if(void 0===i){if(p)throw new Error(`Cannot remove signed field=${c}/${e}`);delete t[o]}else r(o,e,i)}a[c]=Object.values(t)}}else if("string"==typeof a[i])a[i]=l.decode(n.hex.decode(a[i]));else if(p&&i in t&&r&&void 0!==r[i]&&!(0,s.equalBytes)(l.encode(t[i]),l.encode(r[i])))throw new Error(`Cannot change signed field=${i}`)}for(const t in a)if(!e[t]){if(i&&"unknown"===t)continue;delete a[t]}return a};const n=r(3203),o=r(2954),i=r(5327),s=r(5031),a=o.validate(o.bytes(null),e=>(0,s.validatePubkey)(e,s.PubT.ecdsa)),c=o.validate(o.bytes(32),e=>(0,s.validatePubkey)(e,s.PubT.schnorr)),u=o.validate(o.bytes(null),e=>{if(64!==e.length&&65!==e.length)throw new Error("Schnorr signature should be 64 or 65 bytes long");return e}),d=o.struct({fingerprint:o.U32BE,path:o.array(null,o.U32LE)}),l=o.struct({hashes:o.array(i.CompactSizeLen,o.bytes(32)),der:d}),p=o.bytes(78),h=o.struct({pubKey:c,leafHash:o.bytes(32)}),f=o.struct({version:o.U8,internalKey:o.bytes(32),merklePath:o.array(null,o.bytes(32))});t.TaprootControlBlock=o.validate(f,e=>{if(e.merklePath.length>128)throw new Error("TaprootControlBlock: merklePath should be of length 0..128 (inclusive)");return e});const g=o.array(null,o.struct({depth:o.U8,version:o.U8,script:i.VarBytes})),y=o.bytes(null),w=o.bytes(20),b=o.bytes(32);t.PSBTGlobal={unsignedTx:[0,!1,i.RawOldTx,[0],[0],!1],xpub:[1,p,d,[],[0,2],!1],txVersion:[2,!1,o.U32LE,[2],[2],!1],fallbackLocktime:[3,!1,o.U32LE,[],[2],!1],inputCount:[4,!1,i.CompactSizeLen,[2],[2],!1],outputCount:[5,!1,i.CompactSizeLen,[2],[2],!1],txModifiable:[6,!1,o.U8,[],[2],!1],version:[251,!1,o.U32LE,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTInput={nonWitnessUtxo:[0,!1,i.RawTx,[],[0,2],!1],witnessUtxo:[1,!1,i.RawOutput,[],[0,2],!1],partialSig:[2,a,y,[],[0,2],!1],sighashType:[3,!1,o.U32LE,[],[0,2],!1],redeemScript:[4,!1,y,[],[0,2],!1],witnessScript:[5,!1,y,[],[0,2],!1],bip32Derivation:[6,a,d,[],[0,2],!1],finalScriptSig:[7,!1,y,[],[0,2],!1],finalScriptWitness:[8,!1,i.RawWitness,[],[0,2],!1],porCommitment:[9,!1,y,[],[0,2],!1],ripemd160:[10,w,y,[],[0,2],!1],sha256:[11,b,y,[],[0,2],!1],hash160:[12,w,y,[],[0,2],!1],hash256:[13,b,y,[],[0,2],!1],txid:[14,!1,b,[2],[2],!0],index:[15,!1,o.U32LE,[2],[2],!0],sequence:[16,!1,o.U32LE,[],[2],!0],requiredTimeLocktime:[17,!1,o.U32LE,[],[2],!1],requiredHeightLocktime:[18,!1,o.U32LE,[],[2],!1],tapKeySig:[19,!1,u,[],[0,2],!1],tapScriptSig:[20,h,u,[],[0,2],!1],tapLeafScript:[21,t.TaprootControlBlock,y,[],[0,2],!1],tapBip32Derivation:[22,b,l,[],[0,2],!1],tapInternalKey:[23,!1,c,[],[0,2],!1],tapMerkleRoot:[24,!1,b,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTInputFinalKeys=["txid","sequence","index","witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknown"],t.PSBTInputUnsignedKeys=["partialSig","finalScriptSig","finalScriptWitness","tapKeySig","tapScriptSig"],t.PSBTOutput={redeemScript:[0,!1,y,[],[0,2],!1],witnessScript:[1,!1,y,[],[0,2],!1],bip32Derivation:[2,a,d,[],[0,2],!1],amount:[3,!1,o.I64LE,[2],[2],!0],script:[4,!1,y,[2],[2],!0],tapInternalKey:[5,!1,c,[],[0,2],!1],tapTree:[6,!1,g,[],[0,2],!1],tapBip32Derivation:[7,c,l,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTOutputUnsignedKeys=[];const m=o.array(o.NULL,o.struct({key:o.prefix(i.CompactSizeLen,o.struct({type:i.CompactSizeLen,key:o.bytes(null)})),value:o.bytes(i.CompactSizeLen)}));function E(e){const[t,r,n,o,i,s]=e;return{type:t,kc:r,vc:n,reqInc:o,allowInc:i,silentIgnore:s}}function S(e){const t={};for(const r in e){const[n,o,i]=e[r];t[n]=[r,o,i]}return o.wrap({encodeStream:(t,r)=>{let n=[];for(const t in e){const i=r[t];if(void 0===i)continue;const[a,c,u]=e[t];if(c){const e=i.map(([e,t])=>[c.encode(e),u.encode(t)]);e.sort((e,t)=>(0,s.compareBytes)(e[0],t[0]));for(const[t,r]of e)n.push({key:{key:t,type:a},value:r})}else n.push({key:{type:a,key:o.EMPTY},value:u.encode(i)})}if(r.unknown){r.unknown.sort((e,t)=>(0,s.compareBytes)(e[0].key,t[0].key));for(const[e,t]of r.unknown)n.push({key:e,value:t})}m.encodeStream(t,n)},decodeStream:e=>{const r=m.decodeStream(e),o={},i={};for(const e of r){let r="unknown",s=e.key.key,a=e.value;if(t[e.key.type]){const[c,u,d]=t[e.key.type];if(r=c,!u&&s.length)throw new Error(`PSBT: Non-empty key for ${r} (key=${n.hex.encode(s)} value=${n.hex.encode(a)}`);if(s=u?u.decode(s):void 0,a=d.decode(a),!u){if(o[r])throw new Error(`PSBT: Same keys: ${r} (key=${s} value=${a})`);o[r]=a,i[r]=!0;continue}}else s={type:e.key.type,key:e.key.key};if(i[r])throw new Error(`PSBT: Key type with empty key and no key=${r} val=${a}`);o[r]||(o[r]=[]),o[r].push([s,a])}return o}})}o.struct({type:i.CompactSizeLen,key:o.bytes(null)}),t.PSBTInputCoder=o.validate(S(t.PSBTInput),e=>{if(e.finalScriptWitness&&!e.finalScriptWitness.length)throw new Error("validateInput: empty finalScriptWitness");if(e.partialSig&&!e.partialSig.length)throw new Error("Empty partialSig");if(e.partialSig)for(const[t]of e.partialSig)(0,s.validatePubkey)(t,s.PubT.ecdsa);if(e.bip32Derivation)for(const[t]of e.bip32Derivation)(0,s.validatePubkey)(t,s.PubT.ecdsa);if(void 0!==e.requiredTimeLocktime&&e.requiredTimeLocktime<5e8)throw new Error(`validateInput: wrong timeLocktime=${e.requiredTimeLocktime}`);if(void 0!==e.requiredHeightLocktime&&(e.requiredHeightLocktime<=0||e.requiredHeightLocktime>=5e8))throw new Error(`validateInput: wrong heighLocktime=${e.requiredHeightLocktime}`);if(e.tapLeafScript)for(const[t,r]of e.tapLeafScript){if((254&t.version)!==r[r.length-1])throw new Error("validateInput: tapLeafScript version mimatch");if(1&r[r.length-1])throw new Error("validateInput: tapLeafScript version has parity bit!")}return e}),t.PSBTOutputCoder=o.validate(S(t.PSBTOutput),e=>{if(e.bip32Derivation)for(const[t]of e.bip32Derivation)(0,s.validatePubkey)(t,s.PubT.ecdsa);return e});const v=o.validate(S(t.PSBTGlobal),e=>{if(0===(e.version||0)){if(!e.unsignedTx)throw new Error("PSBTv0: missing unsignedTx");for(const t of e.unsignedTx.inputs)if(t.finalScriptSig&&t.finalScriptSig.length)throw new Error("PSBTv0: input scriptSig found in unsignedTx")}return e});function x(e,t,r){for(const n in r){if("unknown"===n)continue;if(!t[n])continue;const{allowInc:r}=E(t[n]);if(!r.includes(e))throw new Error(`PSBTv${e}: field ${n} is not allowed`)}for(const n in t){const{reqInc:o}=E(t[n]);if(o.includes(e)&&void 0===r[n])throw new Error(`PSBTv${e}: missing required field ${n}`)}}function T(e){const r=e&&e.global&&e.global.version||0;x(r,t.PSBTGlobal,e.global);for(const n of e.inputs)x(r,t.PSBTInput,n);for(const n of e.outputs)x(r,t.PSBTOutput,n);const n=r?e.global.inputCount:e.global.unsignedTx.inputs.length;if(e.inputs.length<n)throw new Error("Not enough inputs");const o=e.inputs.slice(n);if(o.length>1||o.length&&Object.keys(o[0]).length)throw new Error(`Unexpected inputs left in tx=${o}`);const i=r?e.global.outputCount:e.global.unsignedTx.outputs.length;if(e.outputs.length<i)throw new Error("Not outputs inputs");const s=e.outputs.slice(i);if(s.length>1||s.length&&Object.keys(s[0]).length)throw new Error(`Unexpected outputs left in tx=${s}`);return e}t._RawPSBTV0=o.struct({magic:o.magic(o.string(new Uint8Array([255])),"psbt"),global:v,inputs:o.array("global/unsignedTx/inputs/length",t.PSBTInputCoder),outputs:o.array(null,t.PSBTOutputCoder)}),t._RawPSBTV2=o.struct({magic:o.magic(o.string(new Uint8Array([255])),"psbt"),global:v,inputs:o.array("global/inputCount",t.PSBTInputCoder),outputs:o.array("global/outputCount",t.PSBTOutputCoder)}),t._DebugPSBT=o.struct({magic:o.magic(o.string(new Uint8Array([255])),"psbt"),items:o.array(null,o.apply(o.array(o.NULL,o.tuple([o.hex(i.CompactSizeLen),o.bytes(i.CompactSize)])),o.coders.dict()))}),t.RawPSBTV0=o.validate(t._RawPSBTV0,T),t.RawPSBTV2=o.validate(t._RawPSBTV2,T)},669:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VHTLC=void 0;const n=r(5046),o=r(5780),i=r(3203),s=r(9761);var a;!function(e){class t extends s.VtxoScript{constructor(e){!function(e){const{sender:t,receiver:r,server:n,preimageHash:o,refundLocktime:i,unilateralClaimDelay:s,unilateralRefundDelay:a,unilateralRefundWithoutReceiverDelay:c}=e;if(!o||20!==o.length)throw new Error("preimage hash must be 20 bytes");if(!r||32!==r.length)throw new Error("Invalid public key length (receiver)");if(!t||32!==t.length)throw new Error("Invalid public key length (sender)");if(!n||32!==n.length)throw new Error("Invalid public key length (server)");if("bigint"!=typeof i||i<=0n)throw new Error("refund locktime must be greater than 0");if(!s||"bigint"!=typeof s.value||s.value<=0n)throw new Error("unilateral claim delay must greater than 0");if("seconds"===s.type&&s.value%512n!=0n)throw new Error("seconds timelock must be multiple of 512");if("seconds"===s.type&&s.value<512n)throw new Error("seconds timelock must be greater or equal to 512");if(!a||"bigint"!=typeof a.value||a.value<=0n)throw new Error("unilateral refund delay must greater than 0");if("seconds"===a.type&&a.value%512n!=0n)throw new Error("seconds timelock must be multiple of 512");if("seconds"===a.type&&a.value<512n)throw new Error("seconds timelock must be greater or equal to 512");if(!c||"bigint"!=typeof c.value||c.value<=0n)throw new Error("unilateral refund without receiver delay must greater than 0");if("seconds"===c.type&&c.value%512n!=0n)throw new Error("seconds timelock must be multiple of 512");if("seconds"===c.type&&c.value<512n)throw new Error("seconds timelock must be greater or equal to 512")}(e);const{sender:t,receiver:r,server:s,preimageHash:a,refundLocktime:c,unilateralClaimDelay:u,unilateralRefundDelay:d,unilateralRefundWithoutReceiverDelay:l}=e,p=function(e){return n.Script.encode(["HASH160",e,"EQUAL"])}(a),h=o.ConditionMultisigTapscript.encode({conditionScript:p,pubkeys:[r,s]}).script,f=o.MultisigTapscript.encode({pubkeys:[t,r,s]}).script,g=o.CLTVMultisigTapscript.encode({absoluteTimelock:c,pubkeys:[t,s]}).script,y=o.ConditionCSVMultisigTapscript.encode({conditionScript:p,timelock:u,pubkeys:[r]}).script,w=o.CSVMultisigTapscript.encode({timelock:d,pubkeys:[t,r]}).script,b=o.CSVMultisigTapscript.encode({timelock:l,pubkeys:[t]}).script;super([h,f,g,y,w,b]),this.options=e,this.claimScript=i.hex.encode(h),this.refundScript=i.hex.encode(f),this.refundWithoutReceiverScript=i.hex.encode(g),this.unilateralClaimScript=i.hex.encode(y),this.unilateralRefundScript=i.hex.encode(w),this.unilateralRefundWithoutReceiverScript=i.hex.encode(b)}claim(){return this.findLeaf(this.claimScript)}refund(){return this.findLeaf(this.refundScript)}refundWithoutReceiver(){return this.findLeaf(this.refundWithoutReceiverScript)}unilateralClaim(){return this.findLeaf(this.unilateralClaimScript)}unilateralRefund(){return this.findLeaf(this.unilateralRefundScript)}unilateralRefundWithoutReceiver(){return this.findLeaf(this.unilateralRefundWithoutReceiverScript)}}e.Script=t}(a||(t.VHTLC=a={}))},682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestIndexerProvider=t.ChainTxType=t.IndexerTxType=void 0;const n=r(8233);var o,i,s;function a(e){return{txid:e.outpoint.txid,vout:e.outpoint.vout,value:Number(e.amount),status:{confirmed:!e.isSwept&&!e.isPreconfirmed},virtualStatus:{state:e.isSwept?"swept":e.isPreconfirmed?"preconfirmed":"settled",commitmentTxIds:e.commitmentTxids,batchExpiry:e.expiresAt?1e3*Number(e.expiresAt):void 0},spentBy:e.spentBy??"",settledBy:e.settledBy,arkTxId:e.arkTxid,createdAt:new Date(1e3*Number(e.createdAt)),isUnrolled:e.isUnrolled}}!function(e){e[e.INDEXER_TX_TYPE_UNSPECIFIED=0]="INDEXER_TX_TYPE_UNSPECIFIED",e[e.INDEXER_TX_TYPE_RECEIVED=1]="INDEXER_TX_TYPE_RECEIVED",e[e.INDEXER_TX_TYPE_SENT=2]="INDEXER_TX_TYPE_SENT"}(o||(t.IndexerTxType=o={})),function(e){e.UNSPECIFIED="INDEXER_CHAINED_TX_TYPE_UNSPECIFIED",e.COMMITMENT="INDEXER_CHAINED_TX_TYPE_COMMITMENT",e.ARK="INDEXER_CHAINED_TX_TYPE_ARK",e.TREE="INDEXER_CHAINED_TX_TYPE_TREE",e.CHECKPOINT="INDEXER_CHAINED_TX_TYPE_CHECKPOINT"}(i||(t.ChainTxType=i={})),t.RestIndexerProvider=class{constructor(e){this.serverUrl=e}async getVtxoTree(e,t){let r=`${this.serverUrl}/v1/batch/${e.txid}/${e.vout}/tree`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch vtxo tree: ${o.statusText}`);const i=await o.json();if(!s.isVtxoTreeResponse(i))throw new Error("Invalid vtxo tree data received");return i.vtxoTree.forEach(e=>{e.children=Object.fromEntries(Object.entries(e.children).map(([e,t])=>[Number(e),t]))}),i}async getVtxoTreeLeaves(e,t){let r=`${this.serverUrl}/v1/batch/${e.txid}/${e.vout}/tree/leaves`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch vtxo tree leaves: ${o.statusText}`);const i=await o.json();if(!s.isVtxoTreeLeavesResponse(i))throw new Error("Invalid vtxos tree leaves data received");return i}async getBatchSweepTransactions(e){const t=`${this.serverUrl}/v1/batch/${e.txid}/${e.vout}/sweepTxs`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch batch sweep transactions: ${r.statusText}`);const n=await r.json();if(!s.isBatchSweepTransactionsResponse(n))throw new Error("Invalid batch sweep transactions data received");return n}async getCommitmentTx(e){const t=`${this.serverUrl}/v1/commitmentTx/${e}`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch commitment tx: ${r.statusText}`);const n=await r.json();if(!s.isCommitmentTx(n))throw new Error("Invalid commitment tx data received");return n}async getCommitmentTxConnectors(e,t){let r=`${this.serverUrl}/v1/commitmentTx/${e}/connectors`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch commitment tx connectors: ${o.statusText}`);const i=await o.json();if(!s.isConnectorsResponse(i))throw new Error("Invalid commitment tx connectors data received");return i.connectors.forEach(e=>{e.children=Object.fromEntries(Object.entries(e.children).map(([e,t])=>[Number(e),t]))}),i}async getCommitmentTxForfeitTxs(e,t){let r=`${this.serverUrl}/v1/commitmentTx/${e}/forfeitTxs`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch commitment tx forfeitTxs: ${o.statusText}`);const i=await o.json();if(!s.isForfeitTxsResponse(i))throw new Error("Invalid commitment tx forfeitTxs data received");return i}async*getSubscription(e,t){const r=`${this.serverUrl}/v1/script/subscription/${e}`;for(;!t.aborted;)try{const e=await fetch(r,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`Unexpected status ${e.status} when subscribing to address updates`);if(!e.body)throw new Error("Response body is null");const n=e.body.getReader(),o=new TextDecoder;let i="";for(;!t.aborted;){const{done:e,value:t}=await n.read();if(e)break;i+=o.decode(t,{stream:!0});const r=i.split("\n");for(let e=0;e<r.length-1;e++){const t=r[e].trim();if(!t)continue;const n=JSON.parse(t);"result"in n&&(yield{txid:n.result.txid,scripts:n.result.scripts||[],newVtxos:(n.result.newVtxos||[]).map(a),spentVtxos:(n.result.spentVtxos||[]).map(a),tx:n.result.tx,checkpointTxs:n.result.checkpointTxs})}i=r[r.length-1]}}catch(e){if(e instanceof Error&&"AbortError"===e.name)break;if((0,n.isFetchTimeoutError)(e)){console.debug("Timeout error ignored");continue}throw console.error("Subscription error:",e),e}}async getVirtualTxs(e,t){let r=`${this.serverUrl}/v1/virtualTx/${e.join(",")}`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch virtual txs: ${o.statusText}`);const i=await o.json();if(!s.isVirtualTxsResponse(i))throw new Error("Invalid virtual txs data received");return i}async getVtxoChain(e,t){let r=`${this.serverUrl}/v1/vtxo/${e.txid}/${e.vout}/chain`;const n=new URLSearchParams;t&&(void 0!==t.pageIndex&&n.append("page.index",t.pageIndex.toString()),void 0!==t.pageSize&&n.append("page.size",t.pageSize.toString())),n.toString()&&(r+="?"+n.toString());const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch vtxo chain: ${o.statusText}`);const i=await o.json();if(!s.isVtxoChainResponse(i))throw new Error("Invalid vtxo chain data received");return i}async getVtxos(e){if(e?.scripts&&e?.outpoints)throw new Error("scripts and outpoints are mutually exclusive options");if(!e?.scripts&&!e?.outpoints)throw new Error("Either scripts or outpoints must be provided");let t=`${this.serverUrl}/v1/vtxos`;const r=new URLSearchParams;e?.scripts&&e.scripts.length>0&&e.scripts.forEach(e=>{r.append("scripts",e)}),e?.outpoints&&e.outpoints.length>0&&e.outpoints.forEach(e=>{r.append("outpoints",`${e.txid}:${e.vout}`)}),e&&(void 0!==e.spendableOnly&&r.append("spendableOnly",e.spendableOnly.toString()),void 0!==e.spentOnly&&r.append("spentOnly",e.spentOnly.toString()),void 0!==e.recoverableOnly&&r.append("recoverableOnly",e.recoverableOnly.toString()),void 0!==e.pageIndex&&r.append("page.index",e.pageIndex.toString()),void 0!==e.pageSize&&r.append("page.size",e.pageSize.toString())),r.toString()&&(t+="?"+r.toString());const n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch vtxos: ${n.statusText}`);const o=await n.json();if(!s.isVtxosResponse(o))throw new Error("Invalid vtxos data received");return{vtxos:o.vtxos.map(a),page:o.page}}async subscribeForScripts(e,t){const r=`${this.serverUrl}/v1/script/subscribe`,n=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({scripts:e,subscriptionId:t})});if(!n.ok){const e=await n.text();throw new Error(`Failed to subscribe to scripts: ${e}`)}const o=await n.json();if(!o.subscriptionId)throw new Error("Subscription ID not found");return o.subscriptionId}async unsubscribeForScripts(e,t){const r=`${this.serverUrl}/v1/script/unsubscribe`,n=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({subscriptionId:e,scripts:t})});if(!n.ok){const e=await n.text();throw new Error(`Failed to unsubscribe to scripts: ${e}`)}}},function(e){function t(e){return"object"==typeof e&&"string"==typeof e.totalOutputAmount&&"number"==typeof e.totalOutputVtxos&&"string"==typeof e.expiresAt&&"boolean"==typeof e.swept}function r(e){return"object"==typeof e&&"string"==typeof e.txid&&"string"==typeof e.expiresAt&&Object.values(i).includes(e.type)&&Array.isArray(e.spends)&&e.spends.every(e=>"string"==typeof e)}function n(e){return"object"==typeof e&&"string"==typeof e.txid&&"number"==typeof e.vout}function s(e){return"object"==typeof e&&"string"==typeof e.txid&&"object"==typeof e.children&&Object.values(e.children).every(c)&&Object.keys(e.children).every(e=>Number.isInteger(Number(e)))}function a(e){return"object"==typeof e&&"string"==typeof e.amount&&"string"==typeof e.createdAt&&"boolean"==typeof e.isSettled&&"string"==typeof e.settledBy&&Object.values(o).includes(e.type)&&(!e.commitmentTxid&&"string"==typeof e.virtualTxid||"string"==typeof e.commitmentTxid&&!e.virtualTxid)}function c(e){return"string"==typeof e&&64===e.length}function u(e){return"object"==typeof e&&n(e.outpoint)&&"string"==typeof e.createdAt&&"string"==typeof e.expiresAt&&"string"==typeof e.amount&&"string"==typeof e.script&&"boolean"==typeof e.isPreconfirmed&&"boolean"==typeof e.isSwept&&"boolean"==typeof e.isUnrolled&&"boolean"==typeof e.isSpent&&(!e.spentBy||"string"==typeof e.spentBy)&&(!e.settledBy||"string"==typeof e.settledBy)&&(!e.arkTxid||"string"==typeof e.arkTxid)&&Array.isArray(e.commitmentTxids)&&e.commitmentTxids.every(c)}function d(e){return"object"==typeof e&&"number"==typeof e.current&&"number"==typeof e.next&&"number"==typeof e.total}e.isCommitmentTx=function(e){return"object"==typeof e&&"string"==typeof e.startedAt&&"string"==typeof e.endedAt&&"string"==typeof e.totalInputAmount&&"number"==typeof e.totalInputVtxos&&"string"==typeof e.totalOutputAmount&&"number"==typeof e.totalOutputVtxos&&"object"==typeof e.batches&&Object.values(e.batches).every(t)},e.isOutpoint=n,e.isOutpointArray=function(e){return Array.isArray(e)&&e.every(n)},e.isTxsArray=function(e){return Array.isArray(e)&&e.every(s)},e.isTxHistoryRecordArray=function(e){return Array.isArray(e)&&e.every(a)},e.isTxidArray=function(e){return Array.isArray(e)&&e.every(c)},e.isVtxoTreeResponse=function(e){return"object"==typeof e&&Array.isArray(e.vtxoTree)&&e.vtxoTree.every(s)&&(!e.page||d(e.page))},e.isVtxoTreeLeavesResponse=function(e){return"object"==typeof e&&Array.isArray(e.leaves)&&e.leaves.every(n)&&(!e.page||d(e.page))},e.isConnectorsResponse=function(e){return"object"==typeof e&&Array.isArray(e.connectors)&&e.connectors.every(s)&&(!e.page||d(e.page))},e.isForfeitTxsResponse=function(e){return"object"==typeof e&&Array.isArray(e.txids)&&e.txids.every(c)&&(!e.page||d(e.page))},e.isSweptCommitmentTxResponse=function(e){return"object"==typeof e&&Array.isArray(e.sweptBy)&&e.sweptBy.every(c)},e.isBatchSweepTransactionsResponse=function(e){return"object"==typeof e&&Array.isArray(e.sweptBy)&&e.sweptBy.every(c)},e.isVirtualTxsResponse=function(e){return"object"==typeof e&&Array.isArray(e.txs)&&e.txs.every(e=>"string"==typeof e)&&(!e.page||d(e.page))},e.isVtxoChainResponse=function(e){return"object"==typeof e&&Array.isArray(e.chain)&&e.chain.every(r)&&(!e.page||d(e.page))},e.isVtxosResponse=function(e){return"object"==typeof e&&Array.isArray(e.vtxos)&&e.vtxos.every(u)&&(!e.page||d(e.page))}}(s||(s={}))},822:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Worker=void 0;const n=r(1440),o=r(6776),i=r(6531),s=r(2087),a=r(8739),c=r(8233),u=r(4864),d=r(24),l=r(682),p=r(3203),h=r(5046);t.Worker=class{constructor(e=new u.IndexedDBVtxoRepository,t=()=>{}){this.vtxoRepository=e,this.messageCallback=t}async start(e=!0){self.addEventListener("message",async e=>{await this.handleMessage(e)}),e&&(self.addEventListener("install",()=>{self.skipWaiting()}),self.addEventListener("activate",()=>{self.clients.claim()}))}async clear(){this.vtxoSubscription&&this.vtxoSubscription.abort(),await this.vtxoRepository.close(),this.wallet=void 0,this.arkProvider=void 0,this.indexerProvider=void 0,this.vtxoSubscription=void 0}async onWalletInitialized(){if(!(this.wallet&&this.arkProvider&&this.indexerProvider&&this.wallet.offchainTapscript&&this.wallet.boardingTapscript))return;await this.vtxoRepository.open();const e=this.wallet.offchainTapscript.encode(),t=this.wallet.offchainTapscript.forfeit(),r=this.wallet.offchainTapscript.exit(),n=p.hex.encode(this.wallet.offchainTapscript.pkScript),o=(await this.indexerProvider.getVtxos({scripts:[n]})).vtxos.map(n=>({...n,forfeitTapLeafScript:t,intentTapLeafScript:r,tapTree:e}));await this.vtxoRepository.addOrUpdate(o),this.processVtxoSubscription({script:n,vtxoScript:this.wallet.offchainTapscript})}async processVtxoSubscription({script:e,vtxoScript:t}){try{const r=t.forfeit(),n=t.exit(),o=new AbortController,i=await this.indexerProvider.subscribeForScripts([e]),s=this.indexerProvider.getSubscription(i,o.signal);this.vtxoSubscription=o;const a=t.encode();for await(const e of s){const t=[...e.newVtxos,...e.spentVtxos];if(0===t.length)continue;const o=t.map(e=>({...e,forfeitTapLeafScript:r,intentTapLeafScript:n,tapTree:a}));await this.vtxoRepository.addOrUpdate(o)}}catch(e){console.error("Error processing address updates:",e)}}async handleClear(e){this.clear(),s.Request.isBase(e.data)&&e.source?.postMessage(a.Response.clearResponse(e.data.id,!0))}async handleInitWallet(e){const t=e.data;if(!s.Request.isInitWallet(t))return console.error("Invalid INIT_WALLET message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid INIT_WALLET message format"));try{this.arkProvider=new c.RestArkProvider(t.arkServerUrl),this.indexerProvider=new l.RestIndexerProvider(t.arkServerUrl),this.wallet=await i.Wallet.create({identity:n.SingleKey.fromHex(t.privateKey),arkServerUrl:t.arkServerUrl,arkServerPublicKey:t.arkServerPublicKey}),e.source?.postMessage(a.Response.walletInitialized(t.id)),await this.onWalletInitialized()}catch(r){console.error("Error initializing wallet:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleSettle(e){const t=e.data;if(!s.Request.isSettle(t))return console.error("Invalid SETTLE message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid SETTLE message format"));try{if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));const r=await this.wallet.settle(t.params,r=>{e.source?.postMessage(a.Response.settleEvent(t.id,r))});e.source?.postMessage(a.Response.settleSuccess(t.id,r))}catch(r){console.error("Error settling:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleSendBitcoin(e){const t=e.data;if(!s.Request.isSendBitcoin(t))return console.error("Invalid SEND_BITCOIN message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid SEND_BITCOIN message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const r=await this.wallet.sendBitcoin(t.params);e.source?.postMessage(a.Response.sendBitcoinSuccess(t.id,r))}catch(r){console.error("Error sending bitcoin:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetAddress(e){const t=e.data;if(!s.Request.isGetAddress(t))return console.error("Invalid GET_ADDRESS message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_ADDRESS message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const r=await this.wallet.getAddress();e.source?.postMessage(a.Response.address(t.id,r))}catch(r){console.error("Error getting address:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetBoardingAddress(e){const t=e.data;if(!s.Request.isGetBoardingAddress(t))return console.error("Invalid GET_BOARDING_ADDRESS message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_BOARDING_ADDRESS message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const r=await this.wallet.getBoardingAddress();e.source?.postMessage(a.Response.boardingAddress(t.id,r))}catch(r){console.error("Error getting boarding address:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetBalance(e){const t=e.data;if(!s.Request.isGetBalance(t))return console.error("Invalid GET_BALANCE message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_BALANCE message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const[r,n,i]=await Promise.all([this.wallet.getBoardingUtxos(),this.vtxoRepository.getSpendableVtxos(),this.vtxoRepository.getSweptVtxos()]);let s=0,c=0;for(const e of r)e.status.confirmed?s+=e.value:c+=e.value;let u=0,d=0,l=0;for(const e of n)"settled"===e.virtualStatus.state?u+=e.value:"preconfirmed"===e.virtualStatus.state&&(d+=e.value);for(const e of i)(0,o.isSpendable)(e)&&(l+=e.value);const p=s+c,h=u+d+l;e.source?.postMessage(a.Response.balance(t.id,{boarding:{confirmed:s,unconfirmed:c,total:p},settled:u,preconfirmed:d,available:u+d,recoverable:l,total:p+h}))}catch(r){console.error("Error getting balance:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetVtxos(e){const t=e.data;if(!s.Request.isGetVtxos(t))return console.error("Invalid GET_VTXOS message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_VTXOS message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{let r=await this.vtxoRepository.getSpendableVtxos();if(!t.filter?.withRecoverable){if(!this.wallet)throw new Error("Wallet not initialized");r=r.filter(e=>!(0,o.isSubdust)(e,this.wallet.dustAmount))}if(t.filter?.withRecoverable){const e=await this.vtxoRepository.getSweptVtxos();r.push(...e.filter(o.isSpendable))}e.source?.postMessage(a.Response.vtxos(t.id,r))}catch(r){console.error("Error getting vtxos:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetBoardingUtxos(e){const t=e.data;if(!s.Request.isGetBoardingUtxos(t))return console.error("Invalid GET_BOARDING_UTXOS message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_BOARDING_UTXOS message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const r=await this.wallet.getBoardingUtxos();e.source?.postMessage(a.Response.boardingUtxos(t.id,r))}catch(r){console.error("Error getting boarding utxos:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetTransactionHistory(e){const t=e.data;if(!s.Request.isGetTransactionHistory(t))return console.error("Invalid GET_TRANSACTION_HISTORY message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_TRANSACTION_HISTORY message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const{boardingTxs:r,commitmentsToIgnore:n}=await this.wallet.getBoardingTxs(),{spendable:o,spent:i}=await this.vtxoRepository.getAllVtxos(),s=(0,d.vtxosToTxs)(o,i,n),c=[...r,...s];c.sort((e,t)=>0===e.createdAt?-1:0===t.createdAt?1:t.createdAt-e.createdAt),e.source?.postMessage(a.Response.transactionHistory(t.id,c))}catch(r){console.error("Error getting transaction history:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleGetStatus(e){const t=e.data;if(!s.Request.isGetStatus(t))return console.error("Invalid GET_STATUS message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid GET_STATUS message format"));e.source?.postMessage(a.Response.walletStatus(t.id,void 0!==this.wallet,this.wallet?.identity.xOnlyPublicKey()))}async handleSign(e){const t=e.data;if(!s.Request.isSign(t))return console.error("Invalid SIGN message format",t),void e.source?.postMessage(a.Response.error(t.id,"Invalid SIGN message format"));if(!this.wallet)return console.error("Wallet not initialized"),void e.source?.postMessage(a.Response.error(t.id,"Wallet not initialized"));try{const r=h.Transaction.fromPSBT(p.base64.decode(t.tx),{allowUnknown:!0,allowUnknownInputs:!0}),n=await this.wallet.identity.sign(r,t.inputIndexes);e.source?.postMessage(a.Response.signSuccess(t.id,p.base64.encode(n.toPSBT())))}catch(r){console.error("Error signing:",r);const n=r instanceof Error?r.message:"Unknown error occurred";e.source?.postMessage(a.Response.error(t.id,n))}}async handleMessage(e){this.messageCallback(e);const t=e.data;if(s.Request.isBase(t))switch(t.type){case"INIT_WALLET":await this.handleInitWallet(e);break;case"SETTLE":await this.handleSettle(e);break;case"SEND_BITCOIN":await this.handleSendBitcoin(e);break;case"GET_ADDRESS":await this.handleGetAddress(e);break;case"GET_BOARDING_ADDRESS":await this.handleGetBoardingAddress(e);break;case"GET_BALANCE":await this.handleGetBalance(e);break;case"GET_VTXOS":await this.handleGetVtxos(e);break;case"GET_BOARDING_UTXOS":await this.handleGetBoardingUtxos(e);break;case"GET_TRANSACTION_HISTORY":await this.handleGetTransactionHistory(e);break;case"GET_STATUS":await this.handleGetStatus(e);break;case"CLEAR":await this.handleClear(e);break;case"SIGN":await this.handleSign(e);break;default:e.source?.postMessage(a.Response.error(t.id,"Unknown message type"))}else console.warn("Invalid message format",JSON.stringify(t))}}},939:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.InvalidContributionErr=void 0,t.IndividualPubkey=I,t.sortKeys=function(e){return S(e,h),e.sort(c.compareBytes)},t.keyAggregate=_,t.keyAggExport=U,t.nonceGen=function(e,t,r=new Uint8Array(0),n,i=new Uint8Array(0),a=(0,s.randomBytes)(32)){(0,s.abytes)(e,h),E(t,32),(0,s.abytes)(r,0,32),E(n),(0,s.abytes)(i),(0,s.abytes)(a,32),void 0!==t&&(a=N(t,a));const c=void 0!==n?(0,o.concatBytes)(new Uint8Array([1]),(0,o.numberToBytesBE)(n.length,8),n):new Uint8Array([0]),u=C(a,e,r,0,c,i),d=C(a,e,r,1,c,i);return{secret:m.encode({k1:u,k2:d,publicKey:e}),public:b.encode({R1:k(u),R2:k(d)})}},t.nonceAggregate=L,t.deterministicSign=function(e,t,r,n,o=[],i=[],a,c=!1){(0,s.abytes)(e,32),(0,s.abytes)(t,66),S(r,h),S(o,32),(0,s.abytes)(n),E(a);const u=void 0!==a?N(e,a):e,d=U(_(r,o,i)),l=M(u,t,d,n,0),p=M(u,t,d,n,1),f=k(l),g=k(p),y=b.encode({R1:f,R2:g}),w=m.encode({k1:l,k2:p,publicKey:I(e)}),v=L([y,t]);return{publicNonce:y,partialSig:new H(v,r,n,o,i).sign(w,e,c)}};const n=r(4967),o=r(1484),i=r(8510),s=r(9175),a=r(2954),c=r(5031);class u extends Error{constructor(e,t){super(t),this.idx=e}}t.InvalidContributionErr=u;const{taggedHash:d,pointToBytes:l}=i.schnorr.utils,p=i.secp256k1.ProjectivePoint,h=33,f=new Uint8Array(h),g=i.secp256k1.CURVE.n,y=a.apply(a.bytes(33),{decode:e=>P(e)?f:e.toRawBytes(!0),encode:e=>(0,o.equalBytes)(e,f)?p.ZERO:p.fromHex(e)}),w=a.validate(a.U256BE,e=>((0,o.aInRange)("n",e,1n,g),e)),b=a.struct({R1:y,R2:y}),m=a.struct({k1:w,k2:w,publicKey:a.bytes(h)});function E(e,...t){void 0!==e&&(0,s.abytes)(e,...t)}function S(e,...t){if(!Array.isArray(e))throw new Error("expected array");e.forEach(e=>(0,s.abytes)(e,...t))}function v(e){if(!Array.isArray(e))throw new Error("expected array");e.forEach((e,t)=>{if("boolean"!=typeof e)throw new Error("expected boolean in xOnly array, got"+e+"("+t+")")})}const x=e=>(0,n.mod)(e,g),T=(e,...t)=>x((0,o.bytesToNumberBE)(d(e,...t))),A=(e,t)=>e.hasEvenY()?t:x(-t);function I(e){return i.secp256k1.getPublicKey(e,!0)}function k(e){return p.BASE.multiply(e)}function P(e){return e.equals(p.ZERO)}function B(e){S(e,h);for(let t=1;t<e.length;t++)if(!(0,o.equalBytes)(e[t],e[0]))return e[t];return f}function O(e){return S(e,h),d("KeyAgg list",...e)}function R(e,t,r){return(0,s.abytes)(e,h),(0,s.abytes)(t,h),(0,o.equalBytes)(e,t)?1n:T("KeyAgg coefficient",r,e)}function _(e,t=[],r=[]){if(S(e,h),S(t,32),t.length!==r.length)throw new Error("The tweaks and isXonly arrays must have the same length");const n=B(e),i=O(e);let s=p.ZERO;for(let t=0;t<e.length;t++){let r;try{r=p.fromHex(e[t])}catch(e){throw new u(t,"pubkey")}s=s.add(r.multiply(R(e[t],n,i)))}let a=1n,c=0n;for(let e=0;e<t.length;e++){const n=r[e]&&!s.hasEvenY()?x(-1n):1n,i=(0,o.bytesToNumberBE)(t[e]);if((0,o.aInRange)("tweak",i,0n,g),s=s.multiply(n).add(k(i)),P(s))throw new Error("The result of tweaking cannot be infinity");a=x(n*a),c=x(i+n*c)}return{aggPublicKey:s,gAcc:a,tweakAcc:c}}function U(e){return l(e.aggPublicKey)}function N(e,t){const r=d("MuSig/aux",t);if(e.length!==r.length)throw new Error("Cannot XOR arrays of different lengths");const n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e[t]^r[t];return n}const C=(e,t,r,n,i,s)=>T("MuSig/nonce",e,new Uint8Array([t.length]),t,new Uint8Array([r.length]),r,i,(0,o.numberToBytesBE)(s.length,4),s,new Uint8Array([n]));function L(e){S(e,66);let t=p.ZERO,r=p.ZERO;for(let n=0;n<e.length;n++){const o=e[n];try{const{R1:e,R2:n}=b.decode(o);if(P(e)||P(n))throw new Error("infinity point");t=t.add(e),r=r.add(n)}catch(e){throw new u(n,"pubnonce")}}return b.encode({R1:t,R2:r})}class H{constructor(e,t,r,n=[],o=[]){if(S(t,33),S(n,32),v(o),(0,s.abytes)(r),n.length!==o.length)throw new Error("The tweaks and isXonly arrays must have the same length");const{aggPublicKey:i,gAcc:a,tweakAcc:c}=_(t,n,o),{R1:u,R2:d}=b.decode(e);this.publicKeys=t,this.Q=i,this.gAcc=a,this.tweakAcc=c,this.b=T("MuSig/noncecoef",e,l(i),r);const h=u.add(d.multiply(this.b));this.R=P(h)?p.BASE:h,this.e=T("BIP0340/challenge",l(this.R),l(i),r),this.tweaks=n,this.isXonly=o,this.L=O(t),this.secondKey=B(t)}getSessionKeyAggCoeff(e){const{publicKeys:t}=this,r=e.toRawBytes(!0);if(!t.some(e=>(0,o.equalBytes)(e,r)))throw new Error("The signer's pubkey must be included in the list of pubkeys");return R(r,this.secondKey,this.L)}partialSigVerifyInternal(e,t,r){const{Q:n,gAcc:i,b:s,R:a,e:c}=this,u=(0,o.bytesToNumberBE)(e);if(u>=g)return!1;const{R1:d,R2:l}=b.decode(t),h=d.add(l.multiply(s)),f=a.hasEvenY()?h:h.negate(),y=p.fromHex(r),w=this.getSessionKeyAggCoeff(y),m=x(A(n,1n)*i),E=k(u),S=f.add(y.multiply(x(c*w*m)));return E.equals(S)}sign(e,t,r=!1){if((0,s.abytes)(t,32),"boolean"!=typeof r)throw new Error("expected boolean");const{Q:n,gAcc:i,b:a,R:c,e:u}=this,{k1:d,k2:l,publicKey:p}=m.decode(e);e.fill(0,0,64),(0,o.aInRange)("k1",d,0n,g),(0,o.aInRange)("k2",l,0n,g);const h=A(c,d),f=A(c,l),y=(0,o.bytesToNumberBE)(t);(0,o.aInRange)("d_",y,1n,g);const w=k(y),E=w.toRawBytes(!0);if(!(0,o.equalBytes)(E,p))throw new Error("Public key does not match nonceGen argument");const S=this.getSessionKeyAggCoeff(w),v=A(n,1n),T=x(v*i*y),I=x(h+a*f+u*S*T),P=(0,o.numberToBytesBE)(I,32);if(!r){const e=b.encode({R1:k(d),R2:k(l)});if(!this.partialSigVerifyInternal(P,e,E))throw new Error("Partial signature verification failed")}return P}partialSigVerify(e,t,r){const{publicKeys:n,tweaks:o,isXonly:i}=this;if((0,s.abytes)(e,32),S(t,66),S(n,h),S(o,32),v(i),(0,s.anumber)(r),t.length!==n.length)throw new Error("The pubNonces and publicKeys arrays must have the same length");if(o.length!==i.length)throw new Error("The tweaks and isXonly arrays must have the same length");if(r>=t.length)throw new Error("index outside of pubKeys/pubNonces");return this.partialSigVerifyInternal(e,t[r],n[r])}partialSigAgg(e){S(e,32);const{Q:t,tweakAcc:r,R:n,e:i}=this;let s=0n;for(let t=0;t<e.length;t++){const r=(0,o.bytesToNumberBE)(e[t]);if(r>=g)throw new u(t,"psig");s=x(s+r)}const a=A(t,1n);return s=x(s+i*a*r),(0,o.concatBytes)(l(n),(0,o.numberToBytesBE)(s,32))}}t.Session=H;const M=(e,t,r,n,i)=>T("MuSig/deterministic/nonce",e,t,r,(0,o.numberToBytesBE)(n.length,8),n,new Uint8Array([i]))},948:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.generateNonces=function(e){const t=a.nonceGen(e);return{secNonce:t.secret,pubNonce:t.public}};const a=s(r(939))},1175:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TxWeightEstimator=void 0;class r{constructor(e,t,r,n,o,i){this.hasWitness=e,this.inputCount=t,this.outputCount=r,this.inputSize=n,this.inputWitnessSize=o,this.outputSize=i}static create(){return new r(!1,0,0,0,0,0)}addP2AInput(){return this.inputCount++,this.inputSize+=r.INPUT_SIZE,this}addKeySpendInput(e=!0){return this.inputCount++,this.inputWitnessSize+=65+(e?0:1),this.inputSize+=r.INPUT_SIZE,this.hasWitness=!0,this}addP2PKHInput(){return this.inputCount++,this.inputWitnessSize++,this.inputSize+=r.INPUT_SIZE+r.P2PKH_SCRIPT_SIG_SIZE,this}addTapscriptInput(e,t,n){const o=1+r.BASE_CONTROL_BLOCK_SIZE+1+t+1+n;return this.inputCount++,this.inputWitnessSize+=e+o,this.inputSize+=r.INPUT_SIZE,this.hasWitness=!0,this.inputCount++,this}addP2WKHOutput(){return this.outputCount++,this.outputSize+=r.OUTPUT_SIZE+r.P2WKH_OUTPUT_SIZE,this}addP2TROutput(){return this.outputCount++,this.outputSize+=r.OUTPUT_SIZE+r.P2TR_OUTPUT_SIZE,this}vsize(){const e=e=>e<253?1:e<65535?3:e<4294967295?5:9,t=e(this.inputCount),o=e(this.outputCount);let i=(r.BASE_TX_SIZE+t+this.inputSize+o+this.outputSize)*r.WITNESS_SCALE_FACTOR;return this.hasWitness&&(i+=r.WITNESS_HEADER_SIZE+this.inputWitnessSize),n(i)}}t.TxWeightEstimator=r,r.P2PKH_SCRIPT_SIG_SIZE=108,r.INPUT_SIZE=41,r.BASE_CONTROL_BLOCK_SIZE=33,r.OUTPUT_SIZE=9,r.P2WKH_OUTPUT_SIZE=22,r.BASE_TX_SIZE=10,r.WITNESS_HEADER_SIZE=2,r.WITNESS_SCALE_FACTOR=4,r.P2TR_OUTPUT_SIZE=34;const n=e=>{const t=BigInt(Math.ceil(e/r.WITNESS_SCALE_FACTOR));return{value:t,fee:e=>e*t}}},1440:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingleKey=void 0;const n=r(5031),o=r(3203),i=r(5046),s=r(3048),a=new Uint8Array(32).fill(0),c=Object.values(i.SigHash).filter(e=>"number"==typeof e);class u{constructor(e){this.key=e||(0,n.randomPrivateKeyBytes)()}static fromPrivateKey(e){return new u(e)}static fromHex(e){return new u(o.hex.decode(e))}async sign(e,t){const r=e.clone();if(!t){try{if(!r.sign(this.key,c,a))throw new Error("Failed to sign transaction")}catch(e){if(!(e instanceof Error&&e.message.includes("No inputs signed")))throw e}return r}for(const e of t)if(!r.signIdx(this.key,e,c,a))throw new Error(`Failed to sign input #${e}`);return r}xOnlyPublicKey(){return(0,n.pubSchnorr)(this.key)}signerSession(){return s.TreeSignerSession.random()}}t.SingleKey=u},1484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notImplemented=t.bitMask=void 0,t.isBytes=o,t.abytes=i,t.abool=function(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)},t.numberToHexUnpadded=s,t.hexToNumber=a,t.bytesToHex=d,t.hexToBytes=h,t.bytesToNumberBE=function(e){return a(d(e))},t.bytesToNumberLE=function(e){return i(e),a(d(Uint8Array.from(e).reverse()))},t.numberToBytesBE=f,t.numberToBytesLE=function(e,t){return f(e,t).reverse()},t.numberToVarBytesBE=function(e){return h(s(e))},t.ensureBytes=function(e,t,r){let n;if("string"==typeof t)try{n=h(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!o(t))throw new Error(e+" must be hex string or Uint8Array");n=Uint8Array.from(t)}const i=n.length;if("number"==typeof r&&i!==r)throw new Error(e+" of length "+r+" expected, got "+i);return n},t.concatBytes=g,t.equalBytes=function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},t.utf8ToBytes=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))},t.inRange=w,t.aInRange=function(e,t,r,n){if(!w(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)},t.bitLen=function(e){let t;for(t=0;e>r;e>>=n,t+=1);return t},t.bitGet=function(e,t){return e>>BigInt(t)&n},t.bitSet=function(e,t,o){return e|(o?n:r)<<BigInt(t)},t.createHmacDrbg=function(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let n=b(e),o=b(e),i=0;const s=()=>{n.fill(1),o.fill(0),i=0},a=(...e)=>r(o,n,...e),c=(e=b(0))=>{o=a(m([0]),e),n=a(),0!==e.length&&(o=a(m([1]),e),n=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){n=a();const t=n.slice();r.push(t),e+=n.length}return g(...r)};return(e,t)=>{let r;for(s(),c(e);!(r=t(u()));)c();return s(),r}},t.validateObject=function(e,t,r={}){const n=(t,r,n)=>{const o=E[r];if("function"!=typeof o)throw new Error("invalid validator function");const i=e[t];if(!(n&&void 0===i||o(i,e)))throw new Error("param "+String(t)+" is invalid. Expected "+r+", got "+i)};for(const[e,r]of Object.entries(t))n(e,r,!1);for(const[e,t]of Object.entries(r))n(e,t,!0);return e},t.memoized=function(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(void 0!==o)return o;const i=e(r,...n);return t.set(r,i),i}};const r=BigInt(0),n=BigInt(1);function o(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function i(e){if(!o(e))throw new Error("Uint8Array expected")}function s(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function a(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?r:BigInt("0x"+e)}const c="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,u=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function d(e){if(i(e),c)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=u[e[r]];return t}const l={_0:48,_9:57,A:65,F:70,a:97,f:102};function p(e){return e>=l._0&&e<=l._9?e-l._0:e>=l.A&&e<=l.F?e-(l.A-10):e>=l.a&&e<=l.f?e-(l.a-10):void 0}function h(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(c)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,o=0;t<r;t++,o+=2){const r=p(e.charCodeAt(o)),i=p(e.charCodeAt(o+1));if(void 0===r||void 0===i){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}n[t]=16*r+i}return n}function f(e,t){return h(e.toString(16).padStart(2*t,"0"))}function g(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];i(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}const y=e=>"bigint"==typeof e&&r<=e;function w(e,t,r){return y(e)&&y(t)&&y(r)&&t<=e&&e<r}t.bitMask=e=>(n<<BigInt(e))-n;const b=e=>new Uint8Array(e),m=e=>Uint8Array.from(e),E={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||o(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};t.notImplemented=()=>{throw new Error("not implemented")}},1676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._Estimator=t._cmpBig=void 0,t.selectUTXO=function(e,t,r,n){const o={createTx:!0,bip69:!0,...n};return new p(e,t,o).result(r)};const n=r(3203),o=r(2954),i=r(8120),s=r(227),a=r(5327),c=r(7338),u=r(5031),d=e=>s.TaprootControlBlock.encode(e);function l(e,t={},r=u.NETWORK){let n;if("script"in e&&(0,u.isBytes)(e.script)&&(n=e.script),"address"in e){if("string"!=typeof e.address)throw new Error(`Estimator: wrong output address=${e.address}`);n=i.OutScript.encode((0,i.Address)(r).decode(e.address))}if(!n)throw new Error("Estimator: wrong output script");if("bigint"!=typeof e.amount)throw new Error(`Estimator: wrong output amount=${e.amount}, should be of type bigint but got ${typeof e.amount}.`);if(n&&!t.allowUnknownOutputs&&"unknown"===i.OutScript.decode(n).type)throw new Error("Estimator: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownOutputs=true, if you sure");return t.disableScriptCheck||(0,i.checkScript)(n),n}t._cmpBig=(e,t)=>{const r=e-t;return r<0n?-1:r>0n?1:0};class p{constructor(e,t,r){if(this.requiredIndices=[],this.outputs=t,this.opts=r,"bigint"!=typeof r.feePerByte)throw new Error(`Estimator: wrong feePerByte=${r.feePerByte}, should be of type bigint but got ${typeof r.feePerByte}.`);const s=void 0===r.dust?BigInt(182):r.dust;if("bigint"!=typeof s)throw new Error(`Estimator: wrong dust=${r.dust}, should be of type bigint but got ${typeof r.dust}.`);const p=void 0===r.dustRelayFeeRate?3n:r.dustRelayFeeRate;if("bigint"!=typeof p)throw new Error(`Estimator: wrong dustRelayFeeRate=${r.dustRelayFeeRate}, should be of type bigint but got ${typeof r.dustRelayFeeRate}.`);if(this.dust=s*p,void 0!==r.requiredInputs&&!Array.isArray(r.requiredInputs))throw new Error(`Estimator: wrong required inputs=${r.requiredInputs}`);const h=r.network||u.NETWORK;let f=0n,g=32;for(const e of t){const t=l(e,r,r.network);g+=32+4*a.VarBytes.encode(t).length,f+=e.amount}if("string"!=typeof r.changeAddress)throw new Error(`Estimator: wrong change address=${r.changeAddress}`);let y=g+32+4*a.VarBytes.encode(i.OutScript.encode((0,i.Address)(h).decode(r.changeAddress))).length;g+=4*a.CompactSizeLen.encode(t.length).length,y+=4*a.CompactSizeLen.encode(t.length+1).length,this.baseWeight=g,this.changeWeight=y,this.amount=f;const w=Array.from(e);if(r.requiredInputs)for(let e=0;e<r.requiredInputs.length;e++)this.requiredIndices.push(w.push(r.requiredInputs[e])-1);const b=new Set;this.normalizedInputs=w.map(e=>{const t=(0,c.normalizeInput)(e,void 0,void 0,r.disableScriptCheck,r.allowUnknown);(0,c.inputBeforeSign)(t);const s=`${n.hex.encode(t.txid)}:${t.index}`;if(!r.allowSameUtxo&&b.has(s))throw new Error(`Estimator: same input passed multiple times: ${s}`);b.add(s);const l=(0,c.getInputType)(t,r.allowLegacyWitnessUtxo),p=(0,c.getPrevOut)(t),h=function(e,t,r){let n,s=o.EMPTY;if("taproot"===e.txType){const s=e.sighash!==c.SignatureHash.DEFAULT?65:64;if(t.tapInternalKey&&!(0,u.equalBytes)(t.tapInternalKey,u.TAPROOT_UNSPENDABLE_KEY))n=[new Uint8Array(s)];else{if(!t.tapLeafScript)throw new Error("estimateInput/taproot: unknown input");n=function(e,t,r){if(!e||!e.length)throw new Error("no leafs");const n=()=>new Uint8Array(t),s=e.sort((e,t)=>d(e[0]).length-d(t[0]).length);for(const[e,t]of s){const s=t.slice(0,-1),c=t[t.length-1],l=i.OutScript.decode(s);let p=[];if("tr_ms"===l.type){const e=l.m,t=l.pubkeys.length-e;for(let t=0;t<e;t++)p.push(n());for(let e=0;e<t;e++)p.push(o.EMPTY)}else if("tr_ns"===l.type)for(const e of l.pubkeys)p.push(n());else{if(!r)throw new Error("Finalize: Unknown tapLeafScript");const t=(0,i.tapLeafHash)(s,c);for(const o of r){if(!o.finalizeTaproot)continue;const r=a.Script.decode(s),i=o.encode(r);if(void 0===i)continue;const c=r.filter(e=>{if(!(0,u.isBytes)(e))return!1;try{return(0,u.validatePubkey)(e,u.PubT.schnorr),!0}catch(e){return!1}}),l=o.finalizeTaproot(s,i,c.map(e=>[{pubKey:e,leafHash:t},n()]));if(l)return l.concat(d(e))}}return p.reverse().concat([s,d(e)])}throw new Error("there was no witness")}(t.tapLeafScript,s,r.customScripts)}}else{const t=()=>new Uint8Array(72),i=()=>new Uint8Array(33);let c=o.EMPTY,d=[];const l=e.last.type;if("ms"===l){const r=e.last.m,n=[0];for(let e=0;e<r;e++)n.push(t());c=a.Script.encode(n)}else if("pk"===l)c=a.Script.encode([t()]);else if("pkh"===l)c=a.Script.encode([t(),i()]);else if("wpkh"===l)c=o.EMPTY,d=[t(),i()];else if("unknown"===l&&!r.allowUnknownInputs)throw new Error("Unknown inputs are not allowed");e.type.includes("wsh-")&&(c.length&&e.lastScript.length&&(d=a.Script.decode(c).map(e=>{if(0===e)return o.EMPTY;if((0,u.isBytes)(e))return e;throw new Error(`Wrong witness op=${e}`)})),d=d.concat(e.lastScript)),"segwit"===e.txType&&(n=d),e.type.startsWith("sh-wsh-")?s=a.Script.encode([a.Script.encode([0,new Uint8Array(u.sha256.outputLen)])]):e.type.startsWith("sh-")?s=a.Script.encode([...a.Script.decode(c),e.lastScript]):e.type.startsWith("wsh-")||"segwit"!==e.txType&&(s=c)}let l=160+4*a.VarBytes.encode(s).length,p=!1;return n&&(l+=a.RawWitness.encode(n).length,p=!0),{weight:l,hasWitnesses:p}}(l,t,this.opts),f=p.amount-r.feePerByte*BigInt((0,c.toVsize)(h.weight));return{inputType:l,normalized:t,amount:p.amount,value:f,estimate:h}})}checkInputIdx(e){if(!Number.isSafeInteger(e)||0>e||e>=this.normalizedInputs.length)throw new Error(`Wrong input index=${e}`);return e}sortIndices(e){return e.slice().sort((e,t)=>{const r=this.normalizedInputs[this.checkInputIdx(e)],n=this.normalizedInputs[this.checkInputIdx(t)],o=(0,u.compareBytes)(r.normalized.txid,n.normalized.txid);return 0!==o?o:r.normalized.index-n.normalized.index})}sortOutputs(e){const r=e.map(e=>l(e,this.opts,this.opts.network));return e.map((e,t)=>t).sort((n,o)=>{const i=e[n].amount,s=e[o].amount,a=(0,t._cmpBig)(i,s);return 0!==a?a:(0,u.compareBytes)(r[n],r[o])})}getSatoshi(e){return this.opts.feePerByte*BigInt((0,c.toVsize)(e))}get biggest(){return this.normalizedInputs.map((e,t)=>t).sort((e,r)=>(0,t._cmpBig)(this.normalizedInputs[r].value,this.normalizedInputs[e].value))}get smallest(){return this.biggest.reverse()}get oldest(){return this.normalizedInputs.map((e,t)=>t)}get newest(){return this.oldest.reverse()}accumulate(e,t=!1,r=!0,n=!1){let o=this.opts.alwaysChange?this.changeWeight:this.baseWeight,i=!1,s=0,c=0n;const u=this.amount,d=new Set;let l;for(const e of this.requiredIndices){if(this.checkInputIdx(e),d.has(e))throw new Error("required input encountered multiple times");const{estimate:t,amount:r}=this.normalizedInputs[e];let p=o+t.weight;!i&&t.hasWitnesses&&(p+=2);const h=p+4*a.CompactSizeLen.encode(s).length;if(l=this.getSatoshi(h),o=p,t.hasWitnesses&&(i=!0),s++,c+=r,d.add(e),!n&&u+l<=c&&s>=this.requiredIndices.length)return{indices:Array.from(d),fee:l,weight:h,total:c}}for(const p of e){if(this.checkInputIdx(p),d.has(p))continue;const{estimate:e,amount:h,value:f}=this.normalizedInputs[p];let g=o+e.weight;!i&&e.hasWitnesses&&(g+=2);const y=g+4*a.CompactSizeLen.encode(s).length;if(l=this.getSatoshi(y),!(t&&h+c>u+l+this.dust||r&&f<=0n)&&(o=g,e.hasWitnesses&&(i=!0),s++,c+=h,d.add(p),!n&&u+l<=c))return{indices:Array.from(d),fee:l,weight:y,total:c}}if(n){const e=o+4*a.CompactSizeLen.encode(s).length;return{indices:Array.from(d),fee:l,weight:e,total:c}}}default(){const{biggest:e}=this;return this.accumulate(e,!0,!1)||this.accumulate(e)}select(e){if("all"===e)return this.accumulate(this.normalizedInputs.map((e,t)=>t),!1,!0,!0);if("default"===e)return this.default();const t={Oldest:()=>this.oldest,Newest:()=>this.newest,Smallest:()=>this.smallest,Biggest:()=>this.biggest};if(e.startsWith("exact")){const[r,n]=e.slice(5).split("/");if(!t[r])throw new Error(`Estimator.select: wrong strategy=${e}`);e=n;const o=this.accumulate(t[r](),!0,!0);if(o)return o}if(e.startsWith("accum")){const r=e.slice(5);if(!t[r])throw new Error(`Estimator.select: wrong strategy=${e}`);return this.accumulate(t[r]())}throw new Error(`Estimator.select: wrong strategy=${e}`)}result(e){const t=this.select(e);if(!t)return;const{indices:r,weight:n,total:o}=t;let i=this.opts.alwaysChange;const s=this.opts.alwaysChange?n:n+(this.changeWeight-this.baseWeight),a=this.getSatoshi(s);let u=t.fee;const d=o-this.amount-a;d>this.dust&&(i=!0);let p=r,h=Array.from(this.outputs);if(i){if(u=a,d<0n)throw new Error(`Estimator.result: negative change=${d}`);h.push({address:this.opts.changeAddress,amount:d})}this.opts.bip69&&(p=this.sortIndices(p),h=this.sortOutputs(h).map(e=>h[e]));const f={inputs:p.map(e=>this.normalizedInputs[e].normalized),outputs:h,fee:u,weight:this.opts.alwaysChange?t.weight:s,change:!!i};let g;if(this.opts.createTx){const{inputs:e,outputs:t}=f;g=new c.Transaction(this.opts);for(const t of e)g.addInput(t);for(const e of t)g.addOutput({...e,script:l(e,this.opts,this.opts.network)})}return Object.assign(f,{tx:g})}}t._Estimator=p},1705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DER=t.DERErr=void 0,t.weierstrassPoints=f,t.weierstrass=function(e){const r=function(e){const t=(0,n.validateBasic)(e);return(0,i.validateObject)(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:a,n:l,nByteLength:p,nBitLength:h}=r,g=a.BYTES+1,y=2*a.BYTES+1;function w(e){return(0,o.mod)(e,l)}function b(e){return(0,o.invert)(e,l)}const{ProjectivePoint:m,normPrivateKeyToScalar:E,weierstrassEquation:S,isWithinCurveOrder:v}=f({...r,toBytes(e,t,r){const n=t.toAffine(),o=a.toBytes(n.x),s=i.concatBytes;return(0,i.abool)("isCompressed",r),r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,a.toBytes(n.y))},fromBytes(e){const t=e.length,r=e[0],n=e.subarray(1);if(t!==g||2!==r&&3!==r){if(t===y&&4===r)return{x:a.fromBytes(n.subarray(0,a.BYTES)),y:a.fromBytes(n.subarray(a.BYTES,2*a.BYTES))};throw new Error("invalid Point, expected length of "+g+", or uncompressed "+y+", got "+t)}{const e=(0,i.bytesToNumberBE)(n);if(!(0,i.inRange)(e,d,a.ORDER))throw new Error("Point is not on curve");const t=S(e);let o;try{o=a.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return!(1&~r)!=((o&d)===d)&&(o=a.neg(o)),{x:e,y:o}}}});function x(e){return e>l>>d}const T=(e,t,r)=>(0,i.bytesToNumberBE)(e.slice(t,r));class A{constructor(e,t,r){(0,i.aInRange)("r",e,d,l),(0,i.aInRange)("s",t,d,l),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){const t=p;return e=(0,i.ensureBytes)("compactSignature",e,2*t),new A(T(e,0,t),T(e,t,2*t))}static fromDER(e){const{r,s:n}=t.DER.toSig((0,i.ensureBytes)("DER",e));return new A(r,n)}assertValidity(){}addRecoveryBit(e){return new A(this.r,this.s,e)}recoverPublicKey(e){const{r:t,s:n,recovery:o}=this,s=B((0,i.ensureBytes)("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const u=2===o||3===o?t+r.n:t;if(u>=a.ORDER)throw new Error("recovery id 2 or 3 invalid");const d=1&o?"03":"02",l=m.fromHex(d+c(u,a.BYTES)),p=b(u),h=w(-s*p),f=w(n*p),g=m.BASE.multiplyAndAddUnsafe(l,h,f);if(!g)throw new Error("point at infinify");return g.assertValidity(),g}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new A(this.r,w(-this.s),this.recovery):this}toDERRawBytes(){return(0,i.hexToBytes)(this.toDERHex())}toDERHex(){return t.DER.hexFromSig(this)}toCompactRawBytes(){return(0,i.hexToBytes)(this.toCompactHex())}toCompactHex(){const e=p;return c(this.r,e)+c(this.s,e)}}const I={isValidPrivateKey(e){try{return E(e),!0}catch(e){return!1}},normPrivateKeyToScalar:E,randomPrivateKey:()=>{const e=(0,o.getMinHashLength)(r.n);return(0,o.mapHashToField)(r.randomBytes(e),r.n)},precompute:(e=8,t=m.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function k(e){if("bigint"==typeof e)return!1;if(e instanceof m)return!0;const t=(0,i.ensureBytes)("key",e).length,n=a.BYTES,o=n+1,s=2*n+1;return r.allowedPrivateKeyLengths||p===o?void 0:t===o||t===s}const P=r.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=(0,i.bytesToNumberBE)(e),r=8*e.length-h;return r>0?t>>BigInt(r):t},B=r.bits2int_modN||function(e){return w(P(e))},O=(0,i.bitMask)(h);function R(e){return(0,i.aInRange)("num < 2^"+h,e,u,O),(0,i.numberToBytesBE)(e,p)}const _={lowS:r.lowS,prehash:!1},U={lowS:r.lowS,prehash:!1};return m.BASE._setWindowSize(8),{CURVE:r,getPublicKey:function(e,t=!0){return m.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(!0===k(e))throw new Error("first arg must be private key");if(!1===k(t))throw new Error("second arg must be public key");return m.fromHex(t).multiply(E(e)).toRawBytes(r)},sign:function(e,t,n=_){const{seed:o,k2sig:c}=function(e,t,n=_){if(["recovered","canonical"].some(e=>e in n))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:c}=r;let{lowS:l,prehash:p,extraEntropy:h}=n;null==l&&(l=!0),e=(0,i.ensureBytes)("msgHash",e),s(n),p&&(e=(0,i.ensureBytes)("prehashed msgHash",o(e)));const f=B(e),g=E(t),y=[R(g),R(f)];if(null!=h&&!1!==h){const e=!0===h?c(a.BYTES):h;y.push((0,i.ensureBytes)("extraEntropy",e))}const S=(0,i.concatBytes)(...y),T=f;return{seed:S,k2sig:function(e){const t=P(e);if(!v(t))return;const r=b(t),n=m.BASE.multiply(t).toAffine(),o=w(n.x);if(o===u)return;const i=w(r*w(T+o*g));if(i===u)return;let s=(n.x===o?0:2)|Number(n.y&d),a=i;return l&&x(i)&&(a=function(e){return x(e)?w(-e):e}(i),s^=1),new A(o,a,s)}}}(e,t,n),l=r;return(0,i.createHmacDrbg)(l.hash.outputLen,l.nByteLength,l.hmac)(o,c)},verify:function(e,n,o,a=U){const c=e;n=(0,i.ensureBytes)("msgHash",n),o=(0,i.ensureBytes)("publicKey",o);const{lowS:u,prehash:d,format:l}=a;if(s(a),"strict"in a)throw new Error("options.strict was renamed to lowS");if(void 0!==l&&"compact"!==l&&"der"!==l)throw new Error("format must be compact or der");const p="string"==typeof c||(0,i.isBytes)(c),h=!p&&!l&&"object"==typeof c&&null!==c&&"bigint"==typeof c.r&&"bigint"==typeof c.s;if(!p&&!h)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let f,g;try{if(h&&(f=new A(c.r,c.s)),p){try{"compact"!==l&&(f=A.fromDER(c))}catch(e){if(!(e instanceof t.DER.Err))throw e}f||"der"===l||(f=A.fromCompact(c))}g=m.fromHex(o)}catch(e){return!1}if(!f)return!1;if(u&&f.hasHighS())return!1;d&&(n=r.hash(n));const{r:y,s:E}=f,S=B(n),v=b(E),x=w(S*v),T=w(y*v),I=m.BASE.multiplyAndAddUnsafe(g,x,T)?.toAffine();return!!I&&w(I.x)===y},ProjectivePoint:m,Signature:A,utils:I}},t.SWUFpSqrtRatio=g,t.mapToCurveSimpleSWU=function(e,t){if((0,o.validateField)(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=g(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return n=>{let i,s,a,c,u,d,l,p;i=e.sqr(n),i=e.mul(i,t.Z),s=e.sqr(i),s=e.add(s,i),a=e.add(s,e.ONE),a=e.mul(a,t.B),c=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),c=e.mul(c,t.A),s=e.sqr(a),d=e.sqr(c),u=e.mul(d,t.A),s=e.add(s,u),s=e.mul(s,a),d=e.mul(d,c),u=e.mul(d,t.B),s=e.add(s,u),l=e.mul(i,a);const{isValid:h,value:f}=r(s,d);p=e.mul(i,n),p=e.mul(p,f),l=e.cmov(l,a,h),p=e.cmov(p,f,h);const g=e.isOdd(n)===e.isOdd(p);p=e.cmov(e.neg(p),p,g);const y=(0,o.FpInvertBatch)(e,[c],!0)[0];return l=e.mul(l,y),{x:l,y:p}}};const n=r(2422),o=r(4967),i=r(1484);function s(e){void 0!==e.lowS&&(0,i.abool)("lowS",e.lowS),void 0!==e.prehash&&(0,i.abool)("prehash",e.prehash)}class a extends Error{constructor(e=""){super(e)}}function c(e,t){return(0,i.bytesToHex)((0,i.numberToBytesBE)(e,t))}t.DERErr=a,t.DER={Err:a,_tlv:{encode:(e,r)=>{const{Err:n}=t.DER;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(1&r.length)throw new n("tlv.encode: unpadded data");const o=r.length/2,s=(0,i.numberToHexUnpadded)(o);if(s.length/2&128)throw new n("tlv.encode: long form length too big");const a=o>127?(0,i.numberToHexUnpadded)(s.length/2|128):"";return(0,i.numberToHexUnpadded)(e)+a+s+r},decode(e,r){const{Err:n}=t.DER;let o=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(r.length<2||r[o++]!==e)throw new n("tlv.decode: wrong tlv");const i=r[o++];let s=0;if(128&i){const e=127&i;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");const t=r.subarray(o,o+e);if(t.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===t[0])throw new n("tlv.decode(long): zero leftmost byte");for(const e of t)s=s<<8|e;if(o+=e,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=i;const a=r.subarray(o,o+s);if(a.length!==s)throw new n("tlv.decode: wrong value length");return{v:a,l:r.subarray(o+s)}}},_int:{encode(e){const{Err:r}=t.DER;if(e<u)throw new r("integer: negative integers are not allowed");let n=(0,i.numberToHexUnpadded)(e);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new r("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:r}=t.DER;if(128&e[0])throw new r("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new r("invalid signature integer: unnecessary leading zero");return(0,i.bytesToNumberBE)(e)}},toSig(e){const{Err:r,_int:n,_tlv:o}=t.DER,s=(0,i.ensureBytes)("signature",e),{v:a,l:c}=o.decode(48,s);if(c.length)throw new r("invalid signature: left bytes after parsing");const{v:u,l:d}=o.decode(2,a),{v:l,l:p}=o.decode(2,d);if(p.length)throw new r("invalid signature: left bytes after parsing");return{r:n.decode(u),s:n.decode(l)}},hexFromSig(e){const{_tlv:r,_int:n}=t.DER,o=r.encode(2,n.encode(e.r))+r.encode(2,n.encode(e.s));return r.encode(48,o)}};const u=BigInt(0),d=BigInt(1),l=BigInt(2),p=BigInt(3),h=BigInt(4);function f(e){const t=function(e){const t=(0,n.validateBasic)(e);(0,i.validateObject)(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:o,a:s}=t;if(r){if(!o.eql(s,o.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}(e),{Fp:r}=t,s=(0,o.Field)(t.n,t.nBitLength),a=t.toBytes||((e,t,n)=>{const o=t.toAffine();return(0,i.concatBytes)(Uint8Array.from([4]),r.toBytes(o.x),r.toBytes(o.y))}),c=t.fromBytes||(e=>{const t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function l(e){const{a:n,b:o}=t,i=r.sqr(e),s=r.mul(i,e);return r.add(r.add(s,r.mul(e,n)),o)}function f(e,t){const n=r.sqr(t),o=l(e);return r.eql(n,o)}if(!f(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const g=r.mul(r.pow(t.a,p),h),y=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(g,y)))throw new Error("bad curve params: a or b");function w(e){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:s,n:a}=t;if(r&&"bigint"!=typeof e){if((0,i.isBytes)(e)&&(e=(0,i.bytesToHex)(e)),"string"!=typeof e||!r.includes(e.length))throw new Error("invalid private key");e=e.padStart(2*n,"0")}let c;try{c="bigint"==typeof e?e:(0,i.bytesToNumberBE)((0,i.ensureBytes)("private key",e,n))}catch(t){throw new Error("invalid private key, expected hex or "+n+" bytes, got "+typeof e)}return s&&(c=(0,o.mod)(c,a)),(0,i.aInRange)("private key",c,d,a),c}function b(e){if(!(e instanceof S))throw new Error("ProjectivePoint expected")}const m=(0,i.memoized)((e,t)=>{const{px:n,py:o,pz:i}=e;if(r.eql(i,r.ONE))return{x:n,y:o};const s=e.is0();null==t&&(t=s?r.ONE:r.inv(i));const a=r.mul(n,t),c=r.mul(o,t),u=r.mul(i,t);if(s)return{x:r.ZERO,y:r.ZERO};if(!r.eql(u,r.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),E=(0,i.memoized)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:n,y:o}=e.toAffine();if(!r.isValid(n)||!r.isValid(o))throw new Error("bad point: x or y not FE");if(!f(n,o))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class S{constructor(e,t,n){if(null==e||!r.isValid(e))throw new Error("x required");if(null==t||!r.isValid(t)||r.is0(t))throw new Error("y required");if(null==n||!r.isValid(n))throw new Error("z required");this.px=e,this.py=t,this.pz=n,Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof S)throw new Error("projective point not allowed");const o=e=>r.eql(e,r.ZERO);return o(t)&&o(n)?S.ZERO:new S(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=(0,o.FpInvertBatch)(r,e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(S.fromAffine)}static fromHex(e){const t=S.fromAffine(c((0,i.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return S.BASE.multiply(w(e))}static msm(e,t){return(0,n.pippenger)(S,s,e,t)}_setWindowSize(e){T.setWindowSize(this,e)}assertValidity(){E(this)}hasEvenY(){const{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){b(e);const{px:t,py:n,pz:o}=this,{px:i,py:s,pz:a}=e,c=r.eql(r.mul(t,a),r.mul(i,o)),u=r.eql(r.mul(n,a),r.mul(s,o));return c&&u}negate(){return new S(this.px,r.neg(this.py),this.pz)}double(){const{a:e,b:n}=t,o=r.mul(n,p),{px:i,py:s,pz:a}=this;let c=r.ZERO,u=r.ZERO,d=r.ZERO,l=r.mul(i,i),h=r.mul(s,s),f=r.mul(a,a),g=r.mul(i,s);return g=r.add(g,g),d=r.mul(i,a),d=r.add(d,d),c=r.mul(e,d),u=r.mul(o,f),u=r.add(c,u),c=r.sub(h,u),u=r.add(h,u),u=r.mul(c,u),c=r.mul(g,c),d=r.mul(o,d),f=r.mul(e,f),g=r.sub(l,f),g=r.mul(e,g),g=r.add(g,d),d=r.add(l,l),l=r.add(d,l),l=r.add(l,f),l=r.mul(l,g),u=r.add(u,l),f=r.mul(s,a),f=r.add(f,f),l=r.mul(f,g),c=r.sub(c,l),d=r.mul(f,h),d=r.add(d,d),d=r.add(d,d),new S(c,u,d)}add(e){b(e);const{px:n,py:o,pz:i}=this,{px:s,py:a,pz:c}=e;let u=r.ZERO,d=r.ZERO,l=r.ZERO;const h=t.a,f=r.mul(t.b,p);let g=r.mul(n,s),y=r.mul(o,a),w=r.mul(i,c),m=r.add(n,o),E=r.add(s,a);m=r.mul(m,E),E=r.add(g,y),m=r.sub(m,E),E=r.add(n,i);let v=r.add(s,c);return E=r.mul(E,v),v=r.add(g,w),E=r.sub(E,v),v=r.add(o,i),u=r.add(a,c),v=r.mul(v,u),u=r.add(y,w),v=r.sub(v,u),l=r.mul(h,E),u=r.mul(f,w),l=r.add(u,l),u=r.sub(y,l),l=r.add(y,l),d=r.mul(u,l),y=r.add(g,g),y=r.add(y,g),w=r.mul(h,w),E=r.mul(f,E),y=r.add(y,w),w=r.sub(g,w),w=r.mul(h,w),E=r.add(E,w),g=r.mul(y,E),d=r.add(d,g),g=r.mul(v,E),u=r.mul(m,u),u=r.sub(u,g),g=r.mul(m,y),l=r.mul(v,l),l=r.add(l,g),new S(u,d,l)}subtract(e){return this.add(e.negate())}is0(){return this.equals(S.ZERO)}wNAF(e){return T.wNAFCached(this,e,S.normalizeZ)}multiplyUnsafe(e){const{endo:n,n:o}=t;(0,i.aInRange)("scalar",e,u,o);const s=S.ZERO;if(e===u)return s;if(this.is0()||e===d)return this;if(!n||T.hasPrecomputes(this))return T.wNAFCachedUnsafe(this,e,S.normalizeZ);let{k1neg:a,k1:c,k2neg:l,k2:p}=n.splitScalar(e),h=s,f=s,g=this;for(;c>u||p>u;)c&d&&(h=h.add(g)),p&d&&(f=f.add(g)),g=g.double(),c>>=d,p>>=d;return a&&(h=h.negate()),l&&(f=f.negate()),f=new S(r.mul(f.px,n.beta),f.py,f.pz),h.add(f)}multiply(e){const{endo:n,n:o}=t;let s,a;if((0,i.aInRange)("scalar",e,d,o),n){const{k1neg:t,k1:o,k2neg:i,k2:c}=n.splitScalar(e);let{p:u,f:d}=this.wNAF(o),{p:l,f:p}=this.wNAF(c);u=T.constTimeNegate(t,u),l=T.constTimeNegate(i,l),l=new S(r.mul(l.px,n.beta),l.py,l.pz),s=u.add(l),a=d.add(p)}else{const{p:t,f:r}=this.wNAF(e);s=t,a=r}return S.normalizeZ([s,a])[0]}multiplyAndAddUnsafe(e,t,r){const n=S.BASE,o=(e,t)=>t!==u&&t!==d&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,r));return i.is0()?void 0:i}toAffine(e){return m(this,e)}isTorsionFree(){const{h:e,isTorsionFree:r}=t;if(e===d)return!0;if(r)return r(S,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:r}=t;return e===d?this:r?r(S,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return(0,i.abool)("isCompressed",e),this.assertValidity(),a(S,this,e)}toHex(e=!0){return(0,i.abool)("isCompressed",e),(0,i.bytesToHex)(this.toRawBytes(e))}}S.BASE=new S(t.Gx,t.Gy,r.ONE),S.ZERO=new S(r.ZERO,r.ONE,r.ZERO);const{endo:v,nBitLength:x}=t,T=(0,n.wNAF)(S,v?Math.ceil(x/2):x);return{CURVE:t,ProjectivePoint:S,normPrivateKeyToScalar:w,weierstrassEquation:l,isWithinCurveOrder:function(e){return(0,i.inRange)(e,d,t.n)}}}function g(e,t){const r=e.ORDER;let n=u;for(let e=r-d;e%l===u;e/=l)n+=d;const o=n,i=l<<o-d-d,s=i*l,a=(r-d)/s,c=(a-d)/l,f=s-d,g=i,y=e.pow(t,a),w=e.pow(t,(a+d)/l);let b=(t,r)=>{let n=y,i=e.pow(r,f),s=e.sqr(i);s=e.mul(s,r);let a=e.mul(t,s);a=e.pow(a,c),a=e.mul(a,i),i=e.mul(a,r),s=e.mul(a,t);let u=e.mul(s,i);a=e.pow(u,g);let p=e.eql(a,e.ONE);i=e.mul(s,w),a=e.mul(u,n),s=e.cmov(i,s,p),u=e.cmov(a,u,p);for(let t=o;t>d;t--){let r=t-l;r=l<<r-d;let o=e.pow(u,r);const a=e.eql(o,e.ONE);i=e.mul(s,n),n=e.mul(n,n),o=e.mul(u,n),s=e.cmov(i,s,a),u=e.cmov(o,u,a)}return{isValid:p,value:s}};if(e.ORDER%h===p){const r=(e.ORDER-p)/h,n=e.sqrt(e.neg(t));b=(t,o)=>{let i=e.sqr(o);const s=e.mul(t,o);i=e.mul(i,s);let a=e.pow(i,r);a=e.mul(a,s);const c=e.mul(a,n),u=e.mul(e.sqr(a),o),d=e.eql(u,t);return{isValid:d,value:e.cmov(c,a,d)}}}return b}},1761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand_message_xmd=u,t.expand_message_xof=d,t.hash_to_field=l,t.isogenyMap=function(e,t){const r=t.map(e=>Array.from(e).reverse());return(t,o)=>{const[i,s,a,c]=r.map(r=>r.reduce((r,n)=>e.add(e.mul(r,t),n))),[u,d]=(0,n.FpInvertBatch)(e,[s,c],!0);return t=e.mul(i,u),o=e.mul(o,e.mul(a,d)),{x:t,y:o}}},t.createHasher=function(e,t,r){if("function"!=typeof t)throw new Error("mapToCurve() must be defined");function n(r){return e.fromAffine(t(r))}function o(t){const r=t.clearCofactor();return r.equals(e.ZERO)?e.ZERO:(r.assertValidity(),r)}return{defaults:r,hashToCurve(e,t){const i=l(e,2,{...r,DST:r.DST,...t}),s=n(i[0]),a=n(i[1]);return o(s.add(a))},encodeToCurve:(e,t)=>o(n(l(e,1,{...r,DST:r.encodeDST,...t})[0])),mapToCurve(e){if(!Array.isArray(e))throw new Error("expected array of bigints");for(const t of e)if("bigint"!=typeof t)throw new Error("expected array of bigints");return o(n(e))}}};const n=r(4967),o=r(1484),i=o.bytesToNumberBE;function s(e,t){if(c(e),c(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=255&e,e>>>=8;return new Uint8Array(r)}function a(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function c(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function u(e,t,r,n){(0,o.abytes)(e),(0,o.abytes)(t),c(r),t.length>255&&(t=n((0,o.concatBytes)((0,o.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:u}=n,d=Math.ceil(r/i);if(r>65535||d>255)throw new Error("expand_message_xmd: invalid lenInBytes");const l=(0,o.concatBytes)(t,s(t.length,1)),p=s(0,u),h=s(r,2),f=new Array(d),g=n((0,o.concatBytes)(p,e,h,s(0,1),l));f[0]=n((0,o.concatBytes)(g,s(1,1),l));for(let e=1;e<=d;e++){const t=[a(g,f[e-1]),s(e+1,1),l];f[e]=n((0,o.concatBytes)(...t))}return(0,o.concatBytes)(...f).slice(0,r)}function d(e,t,r,n,i){if((0,o.abytes)(e),(0,o.abytes)(t),c(r),t.length>255){const e=Math.ceil(2*n/8);t=i.create({dkLen:e}).update((0,o.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:r}).update(e).update(s(r,2)).update(t).update(s(t.length,1)).digest()}function l(e,t,r){(0,o.validateObject)(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:s,k:a,m:l,hash:p,expand:h,DST:f}=r;(0,o.abytes)(e),c(t);const g="string"==typeof f?(0,o.utf8ToBytes)(f):f,y=s.toString(2).length,w=Math.ceil((y+a)/8),b=t*l*w;let m;if("xmd"===h)m=u(e,g,b,p);else if("xof"===h)m=d(e,g,b,a,p);else{if("_internal_pass"!==h)throw new Error('expand must be "xmd" or "xof"');m=e}const E=new Array(t);for(let e=0;e<t;e++){const t=new Array(l);for(let r=0;r<l;r++){const o=w*(r+e*l),a=m.subarray(o,o+w);t[r]=(0,n.mod)(i(a),s)}E[e]=t}return E}},1839:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ripemd160=t.RIPEMD160=t.md5=t.MD5=t.sha1=t.SHA1=void 0;const n=r(7202),o=r(9175),i=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),s=new Uint32Array(80);class a extends n.HashMD{constructor(){super(64,20,8,!1),this.A=0|i[0],this.B=0|i[1],this.C=0|i[2],this.D=0|i[3],this.E=0|i[4]}get(){const{A:e,B:t,C:r,D:n,E:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)s[r]=e.getUint32(t,!1);for(let e=16;e<80;e++)s[e]=(0,o.rotl)(s[e-3]^s[e-8]^s[e-14]^s[e-16],1);let{A:r,B:i,C:a,D:c,E:u}=this;for(let e=0;e<80;e++){let t,d;e<20?(t=(0,n.Chi)(i,a,c),d=1518500249):e<40?(t=i^a^c,d=1859775393):e<60?(t=(0,n.Maj)(i,a,c),d=2400959708):(t=i^a^c,d=3395469782);const l=(0,o.rotl)(r,5)+t+u+d+s[e]|0;u=c,c=a,a=(0,o.rotl)(i,30),i=r,r=l}r=r+this.A|0,i=i+this.B|0,a=a+this.C|0,c=c+this.D|0,u=u+this.E|0,this.set(r,i,a,c,u)}roundClean(){(0,o.clean)(s)}destroy(){this.set(0,0,0,0,0),(0,o.clean)(this.buffer)}}t.SHA1=a,t.sha1=(0,o.createHasher)(()=>new a);const c=Math.pow(2,32),u=Array.from({length:64},(e,t)=>Math.floor(c*Math.abs(Math.sin(t+1)))),d=i.slice(0,4),l=new Uint32Array(16);class p extends n.HashMD{constructor(){super(64,16,8,!0),this.A=0|d[0],this.B=0|d[1],this.C=0|d[2],this.D=0|d[3]}get(){const{A:e,B:t,C:r,D:n}=this;return[e,t,r,n]}set(e,t,r,n){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n}process(e,t){for(let r=0;r<16;r++,t+=4)l[r]=e.getUint32(t,!0);let{A:r,B:i,C:s,D:a}=this;for(let e=0;e<64;e++){let t,c,d;e<16?(t=(0,n.Chi)(i,s,a),c=e,d=[7,12,17,22]):e<32?(t=(0,n.Chi)(a,i,s),c=(5*e+1)%16,d=[5,9,14,20]):e<48?(t=i^s^a,c=(3*e+5)%16,d=[4,11,16,23]):(t=s^(i|~a),c=7*e%16,d=[6,10,15,21]),t=t+r+u[e]+l[c],r=a,a=s,s=i,i+=(0,o.rotl)(t,d[e%4])}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,a=a+this.D|0,this.set(r,i,s,a)}roundClean(){(0,o.clean)(l)}destroy(){this.set(0,0,0,0),(0,o.clean)(this.buffer)}}t.MD5=p,t.md5=(0,o.createHasher)(()=>new p);const h=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),f=(()=>Uint8Array.from(new Array(16).fill(0).map((e,t)=>t)))(),g=(()=>f.map(e=>(9*e+5)%16))(),y=(()=>{const e=[[f],[g]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(e=>h[e]));return e})(),w=(()=>y[0])(),b=(()=>y[1])(),m=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),E=w.map((e,t)=>e.map(e=>m[t][e])),S=b.map((e,t)=>e.map(e=>m[t][e])),v=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),x=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function T(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const A=new Uint32Array(16);class I extends n.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)A[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,i=0|this.h1,s=i,a=0|this.h2,c=a,u=0|this.h3,d=u,l=0|this.h4,p=l;for(let e=0;e<5;e++){const t=4-e,h=v[e],f=x[e],g=w[e],y=b[e],m=E[e],I=S[e];for(let t=0;t<16;t++){const n=(0,o.rotl)(r+T(e,i,a,u)+A[g[t]]+h,m[t])+l|0;r=l,l=u,u=0|(0,o.rotl)(a,10),a=i,i=n}for(let e=0;e<16;e++){const r=(0,o.rotl)(n+T(t,s,c,d)+A[y[e]]+f,I[e])+p|0;n=p,p=d,d=0|(0,o.rotl)(c,10),c=s,s=r}}this.set(this.h1+a+d|0,this.h2+u+p|0,this.h3+l+n|0,this.h4+r+s|0,this.h0+i+c|0)}roundClean(){(0,o.clean)(A)}destroy(){this.destroyed=!0,(0,o.clean)(this.buffer),this.set(0,0,0,0,0)}}t.RIPEMD160=I,t.ripemd160=(0,o.createHasher)(()=>new I)},1962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OnchainWallet=void 0,t.selectCoins=d;const n=r(8120),o=r(7857),i=r(2999),s=r(5046),a=r(9145),c=r(1175);class u{constructor(e,t,r){this.identity=e;const s=e.xOnlyPublicKey();if(!s)throw new Error("Invalid configured public key");this.provider=r||new i.EsploraProvider(i.ESPLORA_URL[t]),this.network=(0,o.getNetwork)(t),this.onchainP2TR=(0,n.p2tr)(s,void 0,this.network)}get address(){return this.onchainP2TR.address||""}async getCoins(){return this.provider.getCoins(this.address)}async getBalance(){const e=await this.getCoins();return e.filter(e=>e.status.confirmed).reduce((e,t)=>e+t.value,0)+e.filter(e=>!e.status.confirmed).reduce((e,t)=>e+t.value,0)}async send(e){if(e.amount<=0)throw new Error("Amount must be positive");if(e.amount<u.DUST_AMOUNT)throw new Error("Amount is below dust limit");const t=await this.getCoins();let r=e.feeRate;r||(r=await this.provider.getFeeRate()),(!r||r<u.MIN_FEE_RATE)&&(r=u.MIN_FEE_RATE);const n=Math.ceil(174*r),o=d(t,e.amount+n);let i=new s.Transaction;for(const e of o.inputs)i.addInput({txid:e.txid,index:e.vout,witnessUtxo:{script:this.onchainP2TR.script,amount:BigInt(e.value)},tapInternalKey:this.onchainP2TR.tapInternalKey});return i.addOutputAddress(e.address,BigInt(e.amount),this.network),o.changeAmount>0n&&i.addOutputAddress(this.address,o.changeAmount,this.network),i=await this.identity.sign(i),i.finalize(),await this.provider.broadcastTransaction(i.hex)}async bumpP2A(e){const t=e.vsize;let r=new s.Transaction({allowUnknownInputs:!0,allowLegacyWitnessUtxo:!0,version:3});r.addInput((0,a.findP2AOutput)(e));const n=c.TxWeightEstimator.create().addKeySpendInput(!0).addP2AInput().addP2TROutput().vsize().value,o=t+Number(n);let i=await this.provider.getFeeRate();(!i||i<u.MIN_FEE_RATE)&&(i=u.MIN_FEE_RATE);const l=Math.ceil(i*o);if(!l)throw new Error(`invalid fee, got ${l} with vsize ${o}, feeRate ${i}`);const p=d(await this.getCoins(),l,!0);for(const e of p.inputs)r.addInput({txid:e.txid,index:e.vout,witnessUtxo:{script:this.onchainP2TR.script,amount:BigInt(e.value)},tapInternalKey:this.onchainP2TR.tapInternalKey});r.addOutputAddress(this.address,a.P2A.amount+p.changeAmount,this.network),r=await this.identity.sign(r);for(let e=1;e<r.inputsLength;e++)r.finalizeIdx(e);try{await this.provider.broadcastTransaction(e.hex,r.hex)}catch(e){console.error(e)}finally{return[e.hex,r.hex]}}}function d(e,t,r=!1){if(isNaN(t))throw new Error("Target amount is NaN, got "+t);if(t<0)throw new Error("Target amount is negative, got "+t);if(0===t)return{inputs:[],changeAmount:0n};const n=[...e].sort((e,t)=>t.value-e.value),o=[];let i=0;for(const e of n)if(o.push(e),i+=e.value,r?i>t:i>=t)break;if(i===t)return{inputs:o,changeAmount:0n};if(i<t)throw new Error("Insufficient funds");return{inputs:o,changeAmount:BigInt(i-t)}}t.OnchainWallet=u,u.MIN_FEE_RATE=1,u.DUST_AMOUNT=546},2087:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0,function(e){e.isBase=function(e){return"object"==typeof e&&null!==e&&"type"in e},e.isInitWallet=function(e){return"INIT_WALLET"===e.type&&"privateKey"in e&&"string"==typeof e.privateKey&&"arkServerUrl"in e&&"string"==typeof e.arkServerUrl&&(!("arkServerPublicKey"in e)||"string"==typeof e.arkServerPublicKey||void 0===e.arkServerPublicKey)},e.isSettle=function(e){return"SETTLE"===e.type},e.isGetAddress=function(e){return"GET_ADDRESS"===e.type},e.isGetBoardingAddress=function(e){return"GET_BOARDING_ADDRESS"===e.type},e.isGetBalance=function(e){return"GET_BALANCE"===e.type},e.isGetVtxos=function(e){return"GET_VTXOS"===e.type},e.isGetVirtualCoins=function(e){return"GET_VIRTUAL_COINS"===e.type},e.isGetBoardingUtxos=function(e){return"GET_BOARDING_UTXOS"===e.type},e.isSendBitcoin=function(e){return"SEND_BITCOIN"===e.type&&"params"in e&&null!==e.params&&"object"==typeof e.params&&"address"in e.params&&"string"==typeof e.params.address&&"amount"in e.params&&"number"==typeof e.params.amount},e.isGetTransactionHistory=function(e){return"GET_TRANSACTION_HISTORY"===e.type},e.isGetStatus=function(e){return"GET_STATUS"===e.type},e.isSign=function(e){return"SIGN"===e.type&&"tx"in e&&"string"==typeof e.tx&&(!("inputIndexes"in e)||null==e.inputIndexes||Array.isArray(e.inputIndexes)&&e.inputIndexes.every(e=>"number"==typeof e))}}(r||(t.Request=r={}))},2318:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toBig=t.shrSL=t.shrSH=t.rotrSL=t.rotrSH=t.rotrBL=t.rotrBH=t.rotr32L=t.rotr32H=t.rotlSL=t.rotlSH=t.rotlBL=t.rotlBH=t.add5L=t.add5H=t.add4L=t.add4H=t.add3L=t.add3H=void 0,t.add=m,t.fromBig=o,t.split=i;const r=BigInt(2**32-1),n=BigInt(32);function o(e,t=!1){return t?{h:Number(e&r),l:Number(e>>n&r)}:{h:0|Number(e>>n&r),l:0|Number(e&r)}}function i(e,t=!1){const r=e.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:r,l:a}=o(e[s],t);[n[s],i[s]]=[r,a]}return[n,i]}const s=(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0);t.toBig=s;const a=(e,t,r)=>e>>>r;t.shrSH=a;const c=(e,t,r)=>e<<32-r|t>>>r;t.shrSL=c;const u=(e,t,r)=>e>>>r|t<<32-r;t.rotrSH=u;const d=(e,t,r)=>e<<32-r|t>>>r;t.rotrSL=d;const l=(e,t,r)=>e<<64-r|t>>>r-32;t.rotrBH=l;const p=(e,t,r)=>e>>>r-32|t<<64-r;t.rotrBL=p;const h=(e,t)=>t;t.rotr32H=h;const f=(e,t)=>e;t.rotr32L=f;const g=(e,t,r)=>e<<r|t>>>32-r;t.rotlSH=g;const y=(e,t,r)=>t<<r|e>>>32-r;t.rotlSL=y;const w=(e,t,r)=>t<<r-32|e>>>64-r;t.rotlBH=w;const b=(e,t,r)=>e<<r-32|t>>>64-r;function m(e,t,r,n){const o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:0|o}}t.rotlBL=b;const E=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);t.add3L=E;const S=(e,t,r,n)=>t+r+n+(e/2**32|0)|0;t.add3H=S;const v=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0);t.add4L=v;const x=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0;t.add4H=x;const T=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0);t.add5L=T;const A=(e,t,r,n,o,i)=>t+r+n+o+i+(e/2**32|0)|0;t.add5H=A;const I={fromBig:o,split:i,toBig:s,shrSH:a,shrSL:c,rotrSH:u,rotrSL:d,rotrBH:l,rotrBL:p,rotr32H:h,rotr32L:f,rotlSH:g,rotlSL:y,rotlBH:w,rotlBL:b,add:m,add3L:E,add3H:S,add4L:v,add4H:x,add5H:A,add5L:T};t.default=I},2422:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wNAF=function(e,t){return{constTimeNegate:a,hasPrecomputes:e=>1!==g(e),unsafeLadder(t,r,n=e.ZERO){let o=t;for(;r>i;)r&s&&(n=n.add(o)),o=o.double(),r>>=s;return n},precomputeWindow(e,r){const{windows:n,windowSize:o}=u(r,t),i=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,i.push(a);for(let e=1;e<o;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(r,n,o){let i=e.ZERO,s=e.BASE;const c=u(r,t);for(let e=0;e<c.windows;e++){const{nextN:t,offset:r,isZero:u,isNeg:l,isNegF:p,offsetF:h}=d(o,e,c);o=t,u?s=s.add(a(p,n[h])):i=i.add(a(l,n[r]))}return{p:i,f:s}},wNAFUnsafe(r,n,o,s=e.ZERO){const a=u(r,t);for(let e=0;e<a.windows&&o!==i;e++){const{nextN:t,offset:r,isZero:i,isNeg:c}=d(o,e,a);if(o=t,!i){const e=n[r];s=s.add(c?e.negate():e)}}return s},getPrecomputes(e,t,r){let n=h.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&h.set(t,r(n))),n},wNAFCached(e,t,r){const n=g(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){const o=g(e);return 1===o?this.unsafeLadder(e,t,n):this.wNAFUnsafe(o,this.getPrecomputes(o,e,r),t,n)},setWindowSize(e,r){c(r,t),f.set(e,r),h.delete(e)}}},t.pippenger=function(e,t,r,n){l(r,e),p(n,t);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const a=e.ZERO,c=(0,o.bitLen)(BigInt(i));let u=1;c>12?u=c-3:c>4?u=c-2:c>0&&(u=2);const d=(0,o.bitMask)(u),h=new Array(Number(d)+1).fill(a);let f=a;for(let e=Math.floor((t.BITS-1)/u)*u;e>=0;e-=u){h.fill(a);for(let t=0;t<s;t++){const o=n[t],i=Number(o>>BigInt(e)&d);h[i]=h[i].add(r[t])}let t=a;for(let e=h.length-1,r=a;e>0;e--)r=r.add(h[e]),t=t.add(r);if(f=f.add(t),0!==e)for(let e=0;e<u;e++)f=f.double()}return f},t.precomputeMSMUnsafe=function(e,t,r,n){c(n,t.BITS),l(r,e);const i=e.ZERO,s=2**n-1,a=Math.ceil(t.BITS/n),u=(0,o.bitMask)(n),d=r.map(e=>{const t=[];for(let r=0,n=e;r<s;r++)t.push(n),n=n.add(e);return t});return e=>{if(p(e,t),e.length>r.length)throw new Error("array of scalars must be smaller than array of points");let o=i;for(let t=0;t<a;t++){if(o!==i)for(let e=0;e<n;e++)o=o.double();const r=BigInt(a*n-(t+1)*n);for(let t=0;t<e.length;t++){const n=e[t],i=Number(n>>r&u);i&&(o=o.add(d[t][i-1]))}}return o}},t.validateBasic=function(e){return(0,n.validateField)(e.Fp),(0,o.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,n.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})};const n=r(4967),o=r(1484),i=BigInt(0),s=BigInt(1);function a(e,t){const r=t.negate();return e?r:t}function c(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function u(e,t){c(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:(0,o.bitMask)(e),maxNumber:r,shiftBy:BigInt(e)}}function d(e,t,r){const{windowSize:n,mask:o,maxNumber:i,shiftBy:a}=r;let c=Number(e&o),u=e>>a;c>n&&(c-=i,u+=s);const d=t*n;return{nextN:u,offset:d+Math.abs(c)-1,isZero:0===c,isNeg:c<0,isNegF:t%2!=0,offsetF:d}}function l(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)})}function p(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)})}const h=new WeakMap,f=new WeakMap;function g(e){return f.get(e)||1}},2501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerWallet=void 0;const n=r(8739),o=r(3203),i=r(1440),s=r(3048),a=r(5046);class c extends Error{constructor(e){super(`Unexpected response type. Got: ${JSON.stringify(e,null,2)}`),this.name="UnexpectedResponseError"}}function u(){const e=crypto.getRandomValues(new Uint8Array(16));return o.hex.encode(e)}t.ServiceWorkerWallet=class{constructor(e){this.serviceWorker=e}async getStatus(){const e={type:"GET_STATUS",id:u()},t=await this.sendMessage(e);if(n.Response.isWalletStatus(t)){const{walletInitialized:e,xOnlyPublicKey:r}=t.status;return e&&(this.cachedXOnlyPublicKey=r),t.status}throw new c(t)}async init(e,t=!1){const r={type:"GET_STATUS",id:u()},s=await this.sendMessage(r);if(n.Response.isWalletStatus(s)&&s.status.walletInitialized){if(t)throw new Error("Wallet already initialized");return void(this.cachedXOnlyPublicKey=s.status.xOnlyPublicKey)}const a={type:"INIT_WALLET",id:u(),privateKey:e.privateKey,arkServerUrl:e.arkServerUrl,arkServerPublicKey:e.arkServerPublicKey};await this.sendMessage(a);const c=o.hex.decode(e.privateKey);this.cachedXOnlyPublicKey=i.SingleKey.fromPrivateKey(c).xOnlyPublicKey()}async clear(){const e={type:"CLEAR",id:u()};await this.sendMessage(e),this.cachedXOnlyPublicKey=void 0}async sendMessage(e){return new Promise((t,r)=>{const n=o=>{const i=o.data;""!==i.id?i.id===e.id&&(navigator.serviceWorker.removeEventListener("message",n),i.success?t(i):r(new Error(i.message))):r(new Error("Invalid response id"))};navigator.serviceWorker.addEventListener("message",n),this.serviceWorker.postMessage(e)})}async getAddress(){const e={type:"GET_ADDRESS",id:u()};try{const t=await this.sendMessage(e);if(n.Response.isAddress(t))return t.address;throw new c(t)}catch(e){throw new Error(`Failed to get address: ${e}`)}}async getBoardingAddress(){const e={type:"GET_BOARDING_ADDRESS",id:u()};try{const t=await this.sendMessage(e);if(n.Response.isBoardingAddress(t))return t.address;throw new c(t)}catch(e){throw new Error(`Failed to get boarding address: ${e}`)}}async getBalance(){const e={type:"GET_BALANCE",id:u()};try{const t=await this.sendMessage(e);if(n.Response.isBalance(t))return t.balance;throw new c(t)}catch(e){throw new Error(`Failed to get balance: ${e}`)}}async getVtxos(e){const t={type:"GET_VTXOS",id:u(),filter:e};try{const e=await this.sendMessage(t);if(n.Response.isVtxos(e))return e.vtxos;throw new c(e)}catch(e){throw new Error(`Failed to get vtxos: ${e}`)}}async getBoardingUtxos(){const e={type:"GET_BOARDING_UTXOS",id:u()};try{const t=await this.sendMessage(e);if(n.Response.isBoardingUtxos(t))return t.boardingUtxos;throw new c(t)}catch(e){throw new Error(`Failed to get boarding UTXOs: ${e}`)}}async sendBitcoin(e){const t={type:"SEND_BITCOIN",params:e,id:u()};try{const e=await this.sendMessage(t);if(n.Response.isSendBitcoinSuccess(e))return e.txid;throw new c(e)}catch(e){throw new Error(`Failed to send bitcoin: ${e}`)}}async settle(e,t){const r={type:"SETTLE",params:e,id:u()};try{return new Promise((e,n)=>{const o=r=>{const i=r.data;if(!i.success)return navigator.serviceWorker.removeEventListener("message",o),void n(new Error(i.message));switch(i.type){case"SETTLE_EVENT":t&&t(i.event);break;case"SETTLE_SUCCESS":navigator.serviceWorker.removeEventListener("message",o),e(i.txid)}};navigator.serviceWorker.addEventListener("message",o),this.serviceWorker.postMessage(r)})}catch(e){throw new Error(`Settlement failed: ${e}`)}}async getTransactionHistory(){const e={type:"GET_TRANSACTION_HISTORY",id:u()};try{const t=await this.sendMessage(e);if(n.Response.isTransactionHistory(t))return t.transactions;throw new c(t)}catch(e){throw new Error(`Failed to get transaction history: ${e}`)}}xOnlyPublicKey(){if(!this.cachedXOnlyPublicKey)throw new Error("Wallet not initialized");return this.cachedXOnlyPublicKey}signerSession(){return s.TreeSignerSession.random()}async sign(e,t){const r={type:"SIGN",tx:o.base64.encode(e.toPSBT()),inputIndexes:t,id:u()};try{const e=await this.sendMessage(r);if(n.Response.isSignSuccess(e))return a.Transaction.fromPSBT(o.base64.decode(e.tx),{allowUnknown:!0,allowUnknownInputs:!0});throw new c(e)}catch(e){throw new Error(`Failed to sign: ${e}`)}}}},2954:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._TEST=t.ZeroPad=t.magicBytes=t.flag=t.cstring=t.string=t.hex=t.bytes=t.bool=t.F64LE=t.F64BE=t.F32LE=t.F32BE=t.I8=t.U8=t.I16BE=t.I16LE=t.U16BE=t.U16LE=t.I32BE=t.I32LE=t.U32BE=t.U32LE=t.int=t.I64BE=t.I64LE=t.U64BE=t.U64LE=t.I128BE=t.I128LE=t.U128BE=t.U128LE=t.I256BE=t.I256LE=t.U256BE=t.U256LE=t.bigint=t.bits=t.coders=t.wrap=t.utils=t.NULL=t.EMPTY=void 0,t.validate=w,t.isCoder=m,t.prefix=function(e,t){if(!m(t))throw new Error(`prefix: invalid inner value ${t}`);return k(I(e),S(t))},t.apply=k,t.lazy=function(e){if("function"!=typeof e)throw new Error("lazy: expected function, got "+typeof e);return(0,t.wrap)({encodeStream:(t,r)=>e().encodeStream(t,r),decodeStream:t=>e().decodeStream(t)})},t.flagged=function(e,r,n){if(!m(r))throw new Error(`flagged: invalid inner value ${r}`);if("string"!=typeof e&&!m(r))throw new Error(`flagged: wrong path=${e}`);return(0,t.wrap)({encodeStream:(t,o)=>{"string"==typeof e?l.resolve(t.stack,e)?r.encodeStream(t,o):n&&r.encodeStream(t,n):(e.encodeStream(t,!!o),o?r.encodeStream(t,o):n&&r.encodeStream(t,n))},decodeStream:t=>{let o=!1;if(o="string"==typeof e?!!l.resolve(t.stack,e):e.decodeStream(t),o)return r.decodeStream(t);n&&r.decodeStream(t)}})},t.optional=function(e,r,n){if(!m(e)||!m(r))throw new Error(`optional: invalid flag or inner value flag=${e} inner=${r}`);return(0,t.wrap)({size:void 0!==n&&e.size&&r.size?e.size+r.size:void 0,encodeStream:(t,o)=>{e.encodeStream(t,!!o),o?r.encodeStream(t,o):void 0!==n&&r.encodeStream(t,n)},decodeStream:t=>{if(e.decodeStream(t))return r.decodeStream(t);void 0!==n&&r.decodeStream(t)}})},t.magic=P,t.constant=function(e){return(0,t.wrap)({encodeStream:(t,r)=>{if(r!==e)throw new Error(`constant: invalid value ${r} (exp: ${e})`)},decodeStream:t=>e})},t.struct=function(e){if(!a(e))throw new Error(`struct: expected plain object, got ${e}`);for(const t in e)if(!m(e[t]))throw new Error(`struct: field ${t} is not CoderType`);return(0,t.wrap)({size:B(Object.values(e)),encodeStream:(t,r)=>{t.pushObj(r,n=>{for(const o in e)n(o,()=>e[o].encodeStream(t,r[o]))})},decodeStream:t=>{const r={};return t.pushObj(r,n=>{for(const o in e)n(o,()=>r[o]=e[o].decodeStream(t))}),r},validate:e=>{if("object"!=typeof e||null===e)throw new Error(`struct: invalid value ${e}`);return e}})},t.tuple=function(e){if(!Array.isArray(e))throw new Error(`Packed.Tuple: got ${typeof e} instead of array`);for(let t=0;t<e.length;t++)if(!m(e[t]))throw new Error(`tuple: field ${t} is not CoderType`);return(0,t.wrap)({size:B(e),encodeStream:(t,r)=>{if(!Array.isArray(r))throw t.err(`tuple: invalid value ${r}`);t.pushObj(r,n=>{for(let o=0;o<e.length;o++)n(`${o}`,()=>e[o].encodeStream(t,r[o]))})},decodeStream:t=>{const r=[];return t.pushObj(r,n=>{for(let o=0;o<e.length;o++)n(`${o}`,()=>r.push(e[o].decodeStream(t)))}),r},validate:t=>{if(!Array.isArray(t))throw new Error(`tuple: invalid value ${t}`);if(t.length!==e.length)throw new Error(`tuple: wrong length=${t.length}, expected ${e.length}`);return t}})},t.array=function(e,r){if(!m(r))throw new Error(`array: invalid inner value ${r}`);const n=u("string"==typeof e?`../${e}`:e);return(0,t.wrap)({size:"number"==typeof e&&r.size?e*r.size:void 0,encodeStream:(t,s)=>{const a=t;a.pushObj(s,c=>{i(e)||n.encodeStream(t,s.length);for(let n=0;n<s.length;n++)c(`${n}`,()=>{const c=s[n],u=t.pos;if(r.encodeStream(t,c),i(e)){if(e.length>a.pos-u)return;const t=a.finish(!1).subarray(u,a.pos);if(o(t.subarray(0,e.length),e))throw a.err(`array: inner element encoding same as separator. elm=${c} data=${t}`)}})}),i(e)&&t.bytes(e)},decodeStream:t=>{const s=[];return t.pushObj(s,a=>{if(null===e)for(let e=0;!(t.isEnd()||(a(`${e}`,()=>s.push(r.decodeStream(t))),r.size&&t.leftBytes<r.size));e++);else if(i(e))for(let n=0;;n++){if(o(t.bytes(e.length,!0),e)){t.bytes(e.length);break}a(`${n}`,()=>s.push(r.decodeStream(t)))}else{let e;a("arrayLen",()=>e=n.decodeStream(t));for(let n=0;n<e;n++)a(`${n}`,()=>s.push(r.decodeStream(t)))}}),s},validate:e=>{if(!Array.isArray(e))throw new Error(`array: invalid value ${e}`);return e}})},t.map=O,t.tag=R,t.mappedTag=function(e,t){if(!m(e))throw new Error(`mappedTag: invalid tag value ${R}`);if(!a(t))throw new Error("mappedTag: variants should be plain object");const r={},n={};for(const e in t){const o=t[e];r[e]=o[0],n[e]=o[1]}return R(O(e,r),n)},t.bitset=function(e,r=!1){if("boolean"!=typeof r)throw new Error("bitset/pad: expected boolean, got "+typeof r);if(!Array.isArray(e))throw new Error("bitset/names: expected array");for(const t of e)if("string"!=typeof t)throw new Error("bitset/names: expected array of strings");return(0,t.wrap)({encodeStream:(t,n)=>{for(let r=0;r<e.length;r++)t.bits(+n[e[r]],1);r&&e.length%8&&t.bits(0,8-e.length%8)},decodeStream:t=>{const n={};for(let r=0;r<e.length;r++)n[e[r]]=!!t.bits(1);return r&&e.length%8&&t.bits(8-e.length%8),n},validate:e=>{if(!a(e))throw new Error(`bitset: invalid value ${e}`);for(const t of Object.values(e))if("boolean"!=typeof t)throw new Error("expected boolean");return e}})},t.padLeft=function(e,r,n){if(!c(e)||e<=0)throw new Error(`padLeft: wrong blockSize=${e}`);if(!m(r))throw new Error(`padLeft: invalid inner value ${r}`);if(void 0!==n&&"function"!=typeof n)throw new Error("padLeft: wrong padFn="+typeof n);const o=n||t.ZeroPad;if(!r.size)throw new Error("padLeft cannot have dynamic size");return(0,t.wrap)({size:r.size+_(e,r.size),encodeStream:(t,n)=>{const i=_(e,r.size);for(let e=0;e<i;e++)t.byte(o(e));r.encodeStream(t,n)},decodeStream:t=>(t.bytes(_(e,r.size)),r.decodeStream(t))})},t.padRight=function(e,r,n){if(!m(r))throw new Error(`padRight: invalid inner value ${r}`);if(!c(e)||e<=0)throw new Error(`padLeft: wrong blockSize=${e}`);if(void 0!==n&&"function"!=typeof n)throw new Error("padRight: wrong padFn="+typeof n);const o=n||t.ZeroPad;return(0,t.wrap)({size:r.size?r.size+_(e,r.size):void 0,encodeStream:(t,n)=>{const i=t,s=i.pos;r.encodeStream(t,n);const a=_(e,i.pos-s);for(let e=0;e<a;e++)t.byte(o(e))},decodeStream:t=>{const n=t.pos,o=r.decodeStream(t);return t.bytes(_(e,t.pos-n)),o}})},t.pointer=function(e,r,n=!1){if(!m(e))throw new Error(`pointer: invalid ptr value ${e}`);if(!m(r))throw new Error(`pointer: invalid inner value ${r}`);if("boolean"!=typeof n)throw new Error("pointer/sized: expected boolean, got "+typeof n);if(!e.size)throw new Error("unsized pointer");return(0,t.wrap)({size:n?e.size:void 0,encodeStream:(t,n)=>{const o=t,i=o.pos;e.encodeStream(t,0),o.ptrs.push({pos:i,ptr:e,buffer:r.encode(n)})},decodeStream:t=>{const n=e.decodeStream(t);return t._enablePointers(),r.decodeStream(t.offsetReader(n))}})};const n=r(3203);function o(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function i(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}t.EMPTY=new Uint8Array,t.NULL=new Uint8Array([0]);const s=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e){return Number.isSafeInteger(e)}t.utils={equalBytes:o,isBytes:i,isCoder:m,checkBounds:g,concatBytes:function(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!i(n))throw new Error("Uint8Array expected");t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r},createView:s,isPlainObject:a};const u=e=>{if(null!==e&&"string"!=typeof e&&!m(e)&&!i(e)&&!c(e))throw new Error(`lengthCoder: expected null | number | Uint8Array | CoderType, got ${e} (${typeof e})`);return{encodeStream(t,r){if(null===e)return;if(m(e))return e.encodeStream(t,r);let n;if("number"==typeof e?n=e:"string"==typeof e&&(n=l.resolve(t.stack,e)),"bigint"==typeof n&&(n=Number(n)),void 0===n||n!==r)throw t.err(`Wrong length: ${n} len=${e} exp=${r} (${typeof r})`)},decodeStream(t){let r;if(m(e)?r=Number(e.decodeStream(t)):"number"==typeof e?r=e:"string"==typeof e&&(r=l.resolve(t.stack,e)),"bigint"==typeof r&&(r=Number(r)),"number"!=typeof r)throw t.err(`Wrong length: ${r}`);return r}}},d={BITS:32,FULL_MASK:-1>>>0,len:e=>Math.ceil(e/32),create:e=>new Uint32Array(d.len(e)),clean:e=>e.fill(0),debug:e=>Array.from(e).map(e=>(e>>>0).toString(2).padStart(32,"0")),checkLen:(e,t)=>{if(d.len(t)!==e.length)throw new Error(`wrong length=${e.length}. Expected: ${d.len(t)}`)},chunkLen:(e,t,r)=>{if(t<0)throw new Error(`wrong pos=${t}`);if(t+r>e)throw new Error(`wrong range=${t}/${r} of ${e}`)},set:(e,t,r,n=!0)=>!(!n&&0!==(e[t]&r)||(e[t]|=r,0)),pos:(e,t)=>({chunk:Math.floor((e+t)/32),mask:1<<32-(e+t)%32-1}),indices:(e,t,r=!1)=>{d.checkLen(e,t);const{FULL_MASK:n,BITS:o}=d,i=o-t%o,s=i?n>>>i<<i:n,a=[];for(let t=0;t<e.length;t++){let n=e[t];if(r&&(n=~n),t===e.length-1&&(n&=s),0!==n)for(let e=0;e<o;e++)n&1<<o-e-1&&a.push(t*o+e)}return a},range:e=>{const t=[];let r;for(const n of e)void 0===r||n!==r.pos+r.length?t.push(r={pos:n,length:1}):r.length+=1;return t},rangeDebug:(e,t,r=!1)=>`[${d.range(d.indices(e,t,r)).map(e=>`(${e.pos}/${e.length})`).join(", ")}]`,setRange:(e,t,r,n,o=!0)=>{d.chunkLen(t,r,n);const{FULL_MASK:i,BITS:s}=d,a=r%s?Math.floor(r/s):void 0,c=r+n,u=c%s?Math.floor(c/s):void 0;if(void 0!==a&&a===u)return d.set(e,a,i>>>s-n<<s-n-r,o);if(void 0!==a&&!d.set(e,a,i>>>r%s,o))return!1;const l=void 0!==u?u:c/s;for(let t=void 0!==a?a+1:r/s;t<l;t++)if(!d.set(e,t,i,o))return!1;return!(void 0!==u&&a!==u&&!d.set(e,u,i<<s-c%s,o))}},l={pushObj:(e,t,r)=>{const n={obj:t};e.push(n),r((e,t)=>{n.field=e,t(),n.field=void 0}),e.pop()},path:e=>{const t=[];for(const r of e)void 0!==r.field&&t.push(r.field);return t.join("/")},err:(e,t,r)=>{const n=new Error(`${e}(${l.path(t)}): ${"string"==typeof r?r:r.message}`);return r instanceof Error&&r.stack&&(n.stack=r.stack),n},resolve:(e,t)=>{const r=t.split("/"),n=e.map(e=>e.obj);let o=0;for(;o<r.length&&".."===r[o];o++)n.pop();let i=n.pop();for(;o<r.length;o++){if(!i||void 0===i[r[o]])return;i=i[r[o]]}return i}};class p{constructor(e,t={},r=[],n=void 0,o=0){this.pos=0,this.bitBuf=0,this.bitPos=0,this.data=e,this.opts=t,this.stack=r,this.parent=n,this.parentOffset=o,this.view=s(e)}_enablePointers(){if(this.parent)return this.parent._enablePointers();this.bs||(this.bs=d.create(this.data.length),d.setRange(this.bs,this.data.length,0,this.pos,this.opts.allowMultipleReads))}markBytesBS(e,t){return this.parent?this.parent.markBytesBS(this.parentOffset+e,t):!t||!this.bs||d.setRange(this.bs,this.data.length,e,t,!1)}markBytes(e){const t=this.pos;this.pos+=e;const r=this.markBytesBS(t,e);if(!this.opts.allowMultipleReads&&!r)throw this.err(`multiple read pos=${this.pos} len=${e}`);return r}pushObj(e,t){return l.pushObj(this.stack,e,t)}readView(e,t){if(!Number.isFinite(e))throw this.err(`readView: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readView: Unexpected end of buffer");const r=t(this.view,this.pos);return this.markBytes(e),r}absBytes(e){if(e>this.data.length)throw new Error("Unexpected end of buffer");return this.data.subarray(e)}finish(){if(!this.opts.allowUnreadBytes){if(this.bitPos)throw this.err(`${this.bitPos} bits left after unpack: ${n.hex.encode(this.data.slice(this.pos))}`);if(this.bs&&!this.parent){const e=d.indices(this.bs,this.data.length,!0);if(e.length){const t=d.range(e).map(({pos:e,length:t})=>`(${e}/${t})[${n.hex.encode(this.data.subarray(e,e+t))}]`).join(", ");throw this.err(`unread byte ranges: ${t} (total=${this.data.length})`)}return}if(!this.isEnd())throw this.err(`${this.leftBytes} bytes ${this.bitPos} bits left after unpack: ${n.hex.encode(this.data.slice(this.pos))}`)}}err(e){return l.err("Reader",this.stack,e)}offsetReader(e){if(e>this.data.length)throw this.err("offsetReader: Unexpected end of buffer");return new p(this.absBytes(e),this.opts,this.stack,this,e)}bytes(e,t=!1){if(this.bitPos)throw this.err("readBytes: bitPos not empty");if(!Number.isFinite(e))throw this.err(`readBytes: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const r=this.data.subarray(this.pos,this.pos+e);return t||this.markBytes(e),r}byte(e=!1){if(this.bitPos)throw this.err("readByte: bitPos not empty");if(this.pos+1>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const t=this.data[this.pos];return e||this.markBytes(1),t}get leftBytes(){return this.data.length-this.pos}get totalBytes(){return this.data.length}isEnd(){return this.pos>=this.data.length&&!this.bitPos}bits(e){if(e>32)throw this.err("BitReader: cannot read more than 32 bits in single call");let t=0;for(;e;){this.bitPos||(this.bitBuf=this.byte(),this.bitPos=8);const r=Math.min(e,this.bitPos);this.bitPos-=r,t=t<<r|this.bitBuf>>this.bitPos&2**r-1,this.bitBuf&=2**this.bitPos-1,e-=r}return t>>>0}find(e,t=this.pos){if(!i(e))throw this.err(`find: needle is not bytes! ${e}`);if(this.bitPos)throw this.err("findByte: bitPos not empty");if(!e.length)throw this.err("find: needle is empty");for(let r=t;-1!==(r=this.data.indexOf(e[0],r));r++){if(-1===r)return;if(this.data.length-r<e.length)return;if(o(e,this.data.subarray(r,r+e.length)))return r}}}class h{constructor(e=[]){this.pos=0,this.buffers=[],this.ptrs=[],this.bitBuf=0,this.bitPos=0,this.viewBuf=new Uint8Array(8),this.finished=!1,this.stack=e,this.view=s(this.viewBuf)}pushObj(e,t){return l.pushObj(this.stack,e,t)}writeView(e,t){if(this.finished)throw this.err("buffer: finished");if(!c(e)||e>8)throw new Error(`wrong writeView length=${e}`);t(this.view),this.bytes(this.viewBuf.slice(0,e)),this.viewBuf.fill(0)}err(e){if(this.finished)throw this.err("buffer: finished");return l.err("Reader",this.stack,e)}bytes(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeBytes: ends with non-empty bit buffer");this.buffers.push(e),this.pos+=e.length}byte(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeByte: ends with non-empty bit buffer");this.buffers.push(new Uint8Array([e])),this.pos++}finish(e=!0){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("buffer: ends with non-empty bit buffer");const t=this.buffers.concat(this.ptrs.map(e=>e.buffer)),r=t.map(e=>e.length).reduce((e,t)=>e+t,0),n=new Uint8Array(r);for(let e=0,r=0;e<t.length;e++){const o=t[e];n.set(o,r),r+=o.length}for(let e=this.pos,t=0;t<this.ptrs.length;t++){const r=this.ptrs[t];n.set(r.ptr.encode(e),r.pos),e+=r.buffer.length}if(e){this.buffers=[];for(const e of this.ptrs)e.buffer.fill(0);this.ptrs=[],this.finished=!0,this.bitBuf=0}return n}bits(e,t){if(t>32)throw this.err("writeBits: cannot write more than 32 bits in single call");if(e>=2**t)throw this.err(`writeBits: value (${e}) >= 2**bits (${t})`);for(;t;){const r=Math.min(t,8-this.bitPos);this.bitBuf=this.bitBuf<<r|e>>t-r,this.bitPos+=r,e&=2**(t-=r)-1,8===this.bitPos&&(this.bitPos=0,this.buffers.push(new Uint8Array([this.bitBuf])),this.pos++)}}}const f=e=>Uint8Array.from(e).reverse();function g(e,t,r){if(r){const r=2n**(t-1n);if(e<-r||e>=r)throw new Error(`value out of signed bounds. Expected ${-r} <= ${e} < ${r}`)}else if(0n>e||e>=2n**t)throw new Error(`value out of unsigned bounds. Expected 0 <= ${e} < ${2n**t}`)}function y(e){return{encodeStream:e.encodeStream,decodeStream:e.decodeStream,size:e.size,encode:t=>{const r=new h;return e.encodeStream(r,t),r.finish()},decode:(t,r={})=>{const n=new p(t,r),o=e.decodeStream(n);return n.finish(),o}}}function w(e,t){if(!m(e))throw new Error(`validate: invalid inner value ${e}`);if("function"!=typeof t)throw new Error("validate: fn should be function");return y({size:e.size,encodeStream:(r,n)=>{let o;try{o=t(n)}catch(e){throw r.err(e)}e.encodeStream(r,o)},decodeStream:r=>{const n=e.decodeStream(r);try{return t(n)}catch(e){throw r.err(e)}}})}t.wrap=e=>{const t=y(e);return e.validate?w(t,e.validate):t};const b=e=>a(e)&&"function"==typeof e.decode&&"function"==typeof e.encode;function m(e){return a(e)&&b(e)&&"function"==typeof e.encodeStream&&"function"==typeof e.decodeStream&&(void 0===e.size||c(e.size))}const E={encode:e=>{if("bigint"!=typeof e)throw new Error("expected bigint, got "+typeof e);if(e>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`element bigger than MAX_SAFE_INTEGER=${e}`);return Number(e)},decode:e=>{if(!c(e))throw new Error("element is not a safe integer");return BigInt(e)}},S=e=>{if(!b(e))throw new Error("BaseCoder expected");return{encode:e.decode,decode:e.encode}};t.coders={dict:function(){return{encode:e=>{if(!Array.isArray(e))throw new Error("array expected");const t={};for(const r of e){if(!Array.isArray(r)||2!==r.length)throw new Error("array of two elements expected");const e=r[0],n=r[1];if(void 0!==t[e])throw new Error(`key(${e}) appears twice in struct`);t[e]=n}return t},decode:e=>{if(!a(e))throw new Error(`expected plain object, got ${e}`);return Object.entries(e)}}},numberBigint:E,tsEnum:function(e){if(!a(e))throw new Error("plain object expected");return{encode:t=>{if(!c(t)||!(t in e))throw new Error(`wrong value ${t}`);return e[t]},decode:t=>{if("string"!=typeof t)throw new Error("wrong value "+typeof t);return e[t]}}},decimal:function(e,t=!1){if(!c(e))throw new Error(`decimal/precision: wrong value ${e}`);if("boolean"!=typeof t)throw new Error("decimal/round: expected boolean, got "+typeof t);const r=10n**BigInt(e);return{encode:t=>{if("bigint"!=typeof t)throw new Error("expected bigint, got "+typeof t);let r=(t<0n?-t:t).toString(10),n=r.length-e;n<0&&(r=r.padStart(r.length-n,"0"),n=0);let o=r.length-1;for(;o>=n&&"0"===r[o];o--);let i=r.slice(0,n),s=r.slice(n,o+1);return i||(i="0"),t<0n&&(i="-"+i),s?`${i}.${s}`:i},decode:n=>{if("string"!=typeof n)throw new Error("expected string, got "+typeof n);if("-0"===n)throw new Error("negative zero is not allowed");let o=!1;if(n.startsWith("-")&&(o=!0,n=n.slice(1)),!/^(0|[1-9]\d*)(\.\d+)?$/.test(n))throw new Error(`wrong string value=${n}`);let i=n.indexOf(".");i=-1===i?n.length:i;const s=n.slice(0,i),a=n.slice(i+1).replace(/0+$/,""),c=BigInt(s)*r;if(!t&&a.length>e)throw new Error(`fractional part cannot be represented with this precision (num=${n}, prec=${e})`);const u=Math.min(a.length,e),d=c+BigInt(a.slice(0,u))*10n**BigInt(e-u);return o?-d:d}}},match:function(e){if(!Array.isArray(e))throw new Error("expected array, got "+typeof e);for(const t of e)if(!b(t))throw new Error(`wrong base coder ${t}`);return{encode:t=>{for(const r of e){const e=r.encode(t);if(void 0!==e)return e}throw new Error(`match/encode: cannot find match in ${t}`)},decode:t=>{for(const r of e){const e=r.decode(t);if(void 0!==e)return e}throw new Error(`match/decode: cannot find match in ${t}`)}}},reverse:S},t.bits=e=>{if(!c(e))throw new Error(`bits: wrong length ${e} (${typeof e})`);return(0,t.wrap)({encodeStream:(t,r)=>t.bits(r,e),decodeStream:t=>t.bits(e),validate:e=>{if(!c(e))throw new Error(`bits: wrong value ${e}`);return e}})},t.bigint=(e,r=!1,n=!1,o=!0)=>{if(!c(e))throw new Error(`bigint/size: wrong value ${e}`);if("boolean"!=typeof r)throw new Error("bigint/le: expected boolean, got "+typeof r);if("boolean"!=typeof n)throw new Error("bigint/signed: expected boolean, got "+typeof n);if("boolean"!=typeof o)throw new Error("bigint/sized: expected boolean, got "+typeof o);const i=BigInt(e),s=2n**(8n*i-1n);return(0,t.wrap)({size:o?e:void 0,encodeStream:(t,i)=>{n&&i<0&&(i|=s);const a=[];for(let t=0;t<e;t++)a.push(Number(255n&i)),i>>=8n;let c=new Uint8Array(a).reverse();if(!o){let e=0;for(e=0;e<c.length&&0===c[e];e++);c=c.subarray(e)}t.bytes(r?c.reverse():c)},decodeStream:t=>{const i=t.bytes(o?e:Math.min(e,t.leftBytes)),a=r?i:f(i);let c=0n;for(let e=0;e<a.length;e++)c|=BigInt(a[e])<<8n*BigInt(e);return n&&c&s&&(c=(c^s)-s),c},validate:e=>{if("bigint"!=typeof e)throw new Error(`bigint: invalid value: ${e}`);return g(e,8n*i,!!n),e}})},t.U256LE=(0,t.bigint)(32,!0),t.U256BE=(0,t.bigint)(32,!1),t.I256LE=(0,t.bigint)(32,!0,!0),t.I256BE=(0,t.bigint)(32,!1,!0),t.U128LE=(0,t.bigint)(16,!0),t.U128BE=(0,t.bigint)(16,!1),t.I128LE=(0,t.bigint)(16,!0,!0),t.I128BE=(0,t.bigint)(16,!1,!0),t.U64LE=(0,t.bigint)(8,!0),t.U64BE=(0,t.bigint)(8,!1),t.I64LE=(0,t.bigint)(8,!0,!0),t.I64BE=(0,t.bigint)(8,!1,!0),t.int=(e,r=!1,n=!1,o=!0)=>{if(!c(e))throw new Error(`int/size: wrong value ${e}`);if("boolean"!=typeof r)throw new Error("int/le: expected boolean, got "+typeof r);if("boolean"!=typeof n)throw new Error("int/signed: expected boolean, got "+typeof n);if("boolean"!=typeof o)throw new Error("int/sized: expected boolean, got "+typeof o);if(e>6)throw new Error("int supports size up to 6 bytes (48 bits): use bigints instead");return k((0,t.bigint)(e,r,n,o),t.coders.numberBigint)};const v=(e,r)=>(0,t.wrap)({size:e,encodeStream:(t,n)=>t.writeView(e,e=>r.write(e,n)),decodeStream:t=>t.readView(e,r.read),validate:e=>{if("number"!=typeof e)throw new Error("viewCoder: expected number, got "+typeof e);return r.validate&&r.validate(e),e}}),x=(e,t,r)=>{const n=8*e,o=2**(n-1),i=2**n;return v(e,{write:r.write,read:r.read,validate:t?e=>{if(!c(e))throw new Error(`sintView: value is not safe integer: ${e}`);if(e<-o||e>=o)throw new Error(`sintView: value out of bounds. Expected ${-o} <= ${e} < ${o}`)}:e=>{if(!c(e))throw new Error(`uintView: value is not safe integer: ${e}`);if(0>e||e>=i)throw new Error(`uintView: value out of bounds. Expected 0 <= ${e} < ${i}`)}})};t.U32LE=x(4,!1,{read:(e,t)=>e.getUint32(t,!0),write:(e,t)=>e.setUint32(0,t,!0)}),t.U32BE=x(4,!1,{read:(e,t)=>e.getUint32(t,!1),write:(e,t)=>e.setUint32(0,t,!1)}),t.I32LE=x(4,!0,{read:(e,t)=>e.getInt32(t,!0),write:(e,t)=>e.setInt32(0,t,!0)}),t.I32BE=x(4,!0,{read:(e,t)=>e.getInt32(t,!1),write:(e,t)=>e.setInt32(0,t,!1)}),t.U16LE=x(2,!1,{read:(e,t)=>e.getUint16(t,!0),write:(e,t)=>e.setUint16(0,t,!0)}),t.U16BE=x(2,!1,{read:(e,t)=>e.getUint16(t,!1),write:(e,t)=>e.setUint16(0,t,!1)}),t.I16LE=x(2,!0,{read:(e,t)=>e.getInt16(t,!0),write:(e,t)=>e.setInt16(0,t,!0)}),t.I16BE=x(2,!0,{read:(e,t)=>e.getInt16(t,!1),write:(e,t)=>e.setInt16(0,t,!1)}),t.U8=x(1,!1,{read:(e,t)=>e.getUint8(t),write:(e,t)=>e.setUint8(0,t)}),t.I8=x(1,!0,{read:(e,t)=>e.getInt8(t),write:(e,t)=>e.setInt8(0,t)});const T=e=>v(4,{read:(t,r)=>t.getFloat32(r,e),write:(t,r)=>t.setFloat32(0,r,e),validate:e=>{if(Math.fround(e)!==e&&!Number.isNaN(e))throw new Error(`f32: wrong value=${e}`)}}),A=e=>v(8,{read:(t,r)=>t.getFloat64(r,e),write:(t,r)=>t.setFloat64(0,r,e)});t.F32BE=T(!1),t.F32LE=T(!0),t.F64BE=A(!1),t.F64LE=A(!0),t.bool=(0,t.wrap)({size:1,encodeStream:(e,t)=>e.byte(t?1:0),decodeStream:e=>{const t=e.byte();if(0!==t&&1!==t)throw e.err(`bool: invalid value ${t}`);return 1===t},validate:e=>{if("boolean"!=typeof e)throw new Error(`bool: invalid value ${e}`);return e}});const I=(e,r=!1)=>{if("boolean"!=typeof r)throw new Error("bytes/le: expected boolean, got "+typeof r);const n=u(e),o=i(e);return(0,t.wrap)({size:"number"==typeof e?e:void 0,encodeStream:(t,i)=>{o||n.encodeStream(t,i.length),t.bytes(r?f(i):i),o&&t.bytes(e)},decodeStream:t=>{let i;if(o){const r=t.find(e);if(!r)throw t.err("bytes: cannot find terminator");i=t.bytes(r-t.pos),t.bytes(e.length)}else i=t.bytes(null===e?t.leftBytes:n.decodeStream(t));return r?f(i):i},validate:e=>{if(!i(e))throw new Error(`bytes: invalid value ${e}`);return e}})};function k(e,r){if(!m(e))throw new Error(`apply: invalid inner value ${e}`);if(!b(r))throw new Error(`apply: invalid base value ${e}`);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>{let o;try{o=r.decode(n)}catch(e){throw t.err(""+e)}return e.encodeStream(t,o)},decodeStream:t=>{const n=e.decodeStream(t);try{return r.encode(n)}catch(e){throw t.err(""+e)}}})}function P(e,r,n=!0){if(!m(e))throw new Error(`magic: invalid inner value ${e}`);if("boolean"!=typeof n)throw new Error("magic: expected boolean, got "+typeof n);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>e.encodeStream(t,r),decodeStream:t=>{const s=e.decodeStream(t);if(n&&"object"!=typeof s&&s!==r||i(r)&&!o(r,s))throw t.err(`magic: invalid value: ${s} !== ${r}`)},validate:e=>{if(void 0!==e)throw new Error("magic: wrong value="+typeof e);return e}})}function B(e){let t=0;for(const r of e){if(void 0===r.size)return;if(!c(r.size))throw new Error(`sizeof: wrong element size=${t}`);t+=r.size}return t}function O(e,r){if(!m(e))throw new Error(`map: invalid inner value ${e}`);if(!a(r))throw new Error("map: variants should be plain object");const n=new Map;for(const e in r)n.set(r[e],e);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>e.encodeStream(t,r[n]),decodeStream:t=>{const r=e.decodeStream(t),o=n.get(r);if(void 0===o)throw t.err(`Enum: unknown value: ${r} ${Array.from(n.keys())}`);return o},validate:e=>{if("string"!=typeof e)throw new Error(`map: invalid value ${e}`);if(!(e in r))throw new Error(`Map: unknown variant: ${e}`);return e}})}function R(e,r){if(!m(e))throw new Error(`tag: invalid tag value ${e}`);if(!a(r))throw new Error("tag: variants should be plain object");for(const e in r)if(!m(r[e]))throw new Error(`tag: variant ${e} is not CoderType`);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>{const{TAG:o,data:i}=n,s=r[o];e.encodeStream(t,o),s.encodeStream(t,i)},decodeStream:t=>{const n=e.decodeStream(t),o=r[n];if(!o)throw t.err(`Tag: invalid tag ${n}`);return{TAG:n,data:o.decodeStream(t)}},validate:e=>{const{TAG:t}=e;if(!r[t])throw new Error(`Tag: invalid tag ${t.toString()}`);return e}})}function _(e,t){return t%e===0?0:e-t%e}t.bytes=I,t.string=(e,t=!1)=>w(k(I(e,t),n.utf8),e=>{if("string"!=typeof e)throw new Error("expected string, got "+typeof e);return e}),t.cstring=(0,t.string)(t.NULL),t.hex=(e,t={isLE:!1,with0x:!1})=>{let r=k(I(e,t.isLE),n.hex);const o=t.with0x;if("boolean"!=typeof o)throw new Error("hex/with0x: expected boolean, got "+typeof o);return o&&(r=k(r,{encode:e=>`0x${e}`,decode:e=>{if(!e.startsWith("0x"))throw new Error("hex(with0x=true).encode input should start with 0x");return e.slice(2)}})),r},t.flag=(e,r=!1)=>{if(!i(e))throw new Error("flag/flagValue: expected Uint8Array, got "+typeof e);if("boolean"!=typeof r)throw new Error("flag/xor: expected boolean, got "+typeof r);return(0,t.wrap)({size:e.length,encodeStream:(t,n)=>{!!n!==r&&t.bytes(e)},decodeStream:t=>{let n=t.leftBytes>=e.length;return n&&(n=o(t.bytes(e.length,!0),e),n&&t.bytes(e.length)),n!==r},validate:e=>{if(void 0!==e&&"boolean"!=typeof e)throw new Error("flag: expected boolean value or undefined, got "+typeof e);return e}})},t.magicBytes=e=>{const t="string"==typeof e?n.utf8.decode(e):e;return P(I(t.length),t)},t.ZeroPad=e=>0,t._TEST={_bitset:d,_Reader:p,_Writer:h,Path:l}},2999:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EsploraProvider=t.ESPLORA_URL=void 0,t.ESPLORA_URL={bitcoin:"https://mempool.space/api",testnet:"https://mempool.space/testnet/api",signet:"https://mempool.space/signet/api",mutinynet:"https://mutinynet.com/api",regtest:"http://localhost:3000"},t.EsploraProvider=class{constructor(e){this.baseUrl=e}async getCoins(e){const t=await fetch(`${this.baseUrl}/address/${e}/utxo`);if(!t.ok)throw new Error(`Failed to fetch UTXOs: ${t.statusText}`);return t.json()}async getFeeRate(){const e=await fetch(`${this.baseUrl}/fee-estimates`);if(!e.ok)throw new Error(`Failed to fetch fee rate: ${e.statusText}`);return(await e.json())[1]??void 0}async broadcastTransaction(...e){switch(e.length){case 1:return this.broadcastTx(e[0]);case 2:return this.broadcastPackage(e[0],e[1]);default:throw new Error("Only 1 or 1C1P package can be broadcast")}}async getTxOutspends(e){const t=await fetch(`${this.baseUrl}/tx/${e}/outspends`);if(!t.ok){const e=await t.text();throw new Error(`Failed to get transaction outspends: ${e}`)}return t.json()}async getTransactions(e){const t=await fetch(`${this.baseUrl}/address/${e}/txs`);if(!t.ok){const e=await t.text();throw new Error(`Failed to get transactions: ${e}`)}return t.json()}async getTxStatus(e){const t=await fetch(`${this.baseUrl}/tx/${e}`);if(!t.ok)throw new Error(t.statusText);if(!(await t.json()).status.confirmed)return{confirmed:!1};const r=await fetch(`${this.baseUrl}/tx/${e}/status`);if(!r.ok)throw new Error(`Failed to get transaction status: ${r.statusText}`);const n=await r.json();return n.confirmed?{confirmed:n.confirmed,blockTime:n.block_time,blockHeight:n.block_height}:{confirmed:!1}}async watchAddresses(e,t){let n=null;const o=this.baseUrl.replace(/^http(s)?:/,"ws$1:")+"/v1/ws",i=async()=>{const r=()=>Promise.all(e.map(e=>this.getTransactions(e))).then(e=>e.flat()),o=await r(),i=e=>`${e.txid}_${e.status.block_time}`;n=setInterval(async()=>{try{const e=await r(),n=new Set(o.map(i)),s=e.filter(e=>!n.has(i(e)));s.length>0&&(o.push(...s),t(s))}catch(e){console.error("Error in polling mechanism:",e)}},5e3)};let s=null;try{s=new WebSocket(o),s.addEventListener("open",()=>{const t={"track-addresses":e};s.send(JSON.stringify(t))}),s.addEventListener("message",e=>{try{const n=[],o=JSON.parse(e.data.toString());if(!o["multi-address-transactions"])return;const i=o["multi-address-transactions"];for(const e in i)for(const t of["mempool","confirmed","removed"])i[e][t]&&n.push(...i[e][t].filter(r));n.length>0&&t(n)}catch(e){console.error("Failed to process WebSocket message:",e)}}),s.addEventListener("error",async()=>{await i()})}catch{n&&clearInterval(n),await i()}return()=>{s&&s.readyState===WebSocket.OPEN&&s.close(),n&&clearInterval(n)}}async getChainTip(){const e=await fetch(`${this.baseUrl}/blocks/tip`);if(!e.ok)throw new Error(`Failed to get chain tip: ${e.statusText}`);const t=await e.json();if(!function(e){return Array.isArray(e)&&e.every(e=>{e&&"object"==typeof e&&"string"==typeof e.id&&e.id.length>0&&"number"==typeof e.height&&e.height>=0&&"number"==typeof e.mediantime&&e.mediantime})}(t))throw new Error(`Invalid chain tip: ${JSON.stringify(t)}`);if(0===t.length)throw new Error("No chain tip found");const r=t[0].id;return{height:t[0].height,time:t[0].mediantime,hash:r}}async broadcastPackage(e,t){const r=await fetch(`${this.baseUrl}/txs/package`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([e,t])});if(!r.ok){const e=await r.text();throw new Error(`Failed to broadcast package: ${e}`)}return r.json()}async broadcastTx(e){const t=await fetch(`${this.baseUrl}/tx`,{method:"POST",headers:{"Content-Type":"text/plain"},body:e});if(!t.ok){const e=await t.text();throw new Error(`Failed to broadcast transaction: ${e}`)}return t.text()}};const r=e=>"string"==typeof e.txid&&Array.isArray(e.vout)&&e.vout.every(e=>"string"==typeof e.scriptpubkey_address&&"string"==typeof e.value)&&"object"==typeof e.status&&"boolean"==typeof e.status.confirmed&&"number"==typeof e.status.block_time},3048:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.TreeSignerSession=t.ErrMissingAggregateKey=t.ErrMissingVtxoGraph=void 0,t.validateTreeSigs=async function(e,t,r){for(const n of r){const o=n.root.getInput(0);if(!o.tapKeySig)throw new Error("unsigned tree input");const i=f(e,r,t,n.root),s=n.root.preimageWitnessV1(0,[i.script],c.SigHash.DEFAULT,[i.amount]);if(!d.schnorr.verify(o.tapKeySig,s,e))throw new Error("invalid signature")}};const a=s(r(6238)),c=r(5046),u=r(3203),d=r(8510),l=r(5031),p=r(9689);t.ErrMissingVtxoGraph=new Error("missing vtxo graph"),t.ErrMissingAggregateKey=new Error("missing aggregate key");class h{constructor(e){this.secretKey=e,this.myNonces=null,this.aggregateNonces=null,this.graph=null,this.scriptRoot=null,this.rootSharedOutputAmount=null}static random(){const e=(0,l.randomPrivateKeyBytes)();return new h(e)}init(e,t,r){this.graph=e,this.scriptRoot=t,this.rootSharedOutputAmount=r}getPublicKey(){return d.secp256k1.getPublicKey(this.secretKey)}getNonces(){if(!this.graph)throw t.ErrMissingVtxoGraph;this.myNonces||(this.myNonces=this.generateNonces());const e=new Map;for(const[t,r]of this.myNonces)e.set(t,{pubNonce:r.pubNonce});return e}setAggregatedNonces(e){if(this.aggregateNonces)throw new Error("nonces already set");this.aggregateNonces=e}sign(){if(!this.graph)throw t.ErrMissingVtxoGraph;if(!this.aggregateNonces)throw new Error("nonces not set");if(!this.myNonces)throw new Error("nonces not generated");const e=new Map;for(const t of this.graph){const r=this.signPartial(t);e.set(t.txid,r)}return e}generateNonces(){if(!this.graph)throw t.ErrMissingVtxoGraph;const e=new Map,r=d.secp256k1.getPublicKey(this.secretKey);for(const t of this.graph){const n=a.generateNonces(r);e.set(t.txid,n)}return e}signPartial(e){if(!this.graph||!this.scriptRoot||!this.rootSharedOutputAmount)throw h.NOT_INITIALIZED;if(!this.myNonces||!this.aggregateNonces)throw new Error("session not properly initialized");const t=this.myNonces.get(e.txid);if(!t)throw new Error("missing private nonce");const r=this.aggregateNonces.get(e.txid);if(!r)throw new Error("missing aggregate nonce");const n=[],o=[],i=(0,p.getArkPsbtFields)(e.root,0,p.CosignerPublicKey).map(e=>e.key),{finalKey:s}=a.aggregateKeys(i,!0,{taprootTweak:this.scriptRoot});for(let t=0;t<e.root.inputsLength;t++){const t=f(s,this.graph,this.rootSharedOutputAmount,e.root);n.push(t.amount),o.push(t.script)}const u=e.root.preimageWitnessV1(0,o,c.SigHash.DEFAULT,n);return a.sign(t.secNonce,this.secretKey,r.pubNonce,i,u,{taprootTweak:this.scriptRoot,sortKeys:!0})}}function f(e,t,r,n){const o=c.Script.encode(["OP_1",e.slice(1)]);if(u.hex.encode((0,l.sha256x2)(n.toBytes(!0)).reverse())===t.txid)return{amount:r,script:o};const i=n.getInput(0);if(!i.txid)throw new Error("missing parent input txid");const s=u.hex.encode(new Uint8Array(i.txid)),a=t.find(s);if(!a)throw new Error("parent  tx not found");if(void 0===i.index)throw new Error("missing input index");const d=a.root.getOutput(i.index);if(!d)throw new Error("parent output not found");if(!d.amount)throw new Error("parent output amount not found");return{amount:d.amount,script:o}}t.TreeSignerSession=h,h.NOT_INITIALIZED=new Error("session not initialized, call init method")},3203:(e,t)=>{"use strict";function r(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function n(e,...t){if(!r(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function o(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every(e=>"string"==typeof e):t.every(e=>Number.isSafeInteger(e))))}function i(e){if("function"!=typeof e)throw new Error("function expected");return!0}function s(e,t){if("string"!=typeof t)throw new Error(`${e}: string expected`);return!0}function a(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function c(e){if(!Array.isArray(e))throw new Error("array expected")}function u(e,t){if(!o(!0,t))throw new Error(`${e}: array of strings expected`)}function d(e,t){if(!o(!1,t))throw new Error(`${e}: array of numbers expected`)}function l(...e){const t=e=>e,r=(e,t)=>r=>e(t(r));return{encode:e.map(e=>e.encode).reduceRight(r,t),decode:e.map(e=>e.decode).reduce(r,t)}}function p(e){const t="string"==typeof e?e.split(""):e,r=t.length;u("alphabet",t);const n=new Map(t.map((e,t)=>[e,t]));return{encode:n=>(c(n),n.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${e}`);return t[n]})),decode:t=>(c(t),t.map(t=>{s("alphabet.decode",t);const r=n.get(t);if(void 0===r)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return r}))}}function h(e=""){return s("join",e),{encode:t=>(u("join.decode",t),t.join(e)),decode:t=>(s("join.decode",t),t.split(e))}}function f(e,t="="){return a(e),s("padding",t),{encode(r){for(u("padding.encode",r);r.length*e%8;)r.push(t);return r},decode(r){u("padding.decode",r);let n=r.length;if(n*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if((n-1)*e%8==0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function g(e){return i(e),{encode:e=>e,decode:t=>e(t)}}function y(e,t,r){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(c(e),!e.length)return[];let n=0;const o=[],i=Array.from(e,e=>{if(a(e),e<0||e>=t)throw new Error(`invalid integer: ${e}`);return e}),s=i.length;for(;;){let e=0,a=!0;for(let o=n;o<s;o++){const s=i[o],c=t*e,u=c+s;if(!Number.isSafeInteger(u)||c/t!==e||u-s!==c)throw new Error("convertRadix: carry overflow");const d=u/r;e=u%r;const l=Math.floor(d);if(i[o]=l,!Number.isSafeInteger(l)||l*r+e!==u)throw new Error("convertRadix: carry overflow");a&&(l?a=!1:n=o)}if(o.push(e),a)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.createBase58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64urlnopad=t.base64url=t.base64nopad=t.base64=t.base32crockford=t.base32hexnopad=t.base32hex=t.base32nopad=t.base32=t.base16=t.utils=void 0;const w=(e,t)=>0===t?e:w(t,e%t),b=(e,t)=>e+(t-w(e,t)),m=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function E(e,t,r,n){if(c(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(b(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${b(t,r)}`);let o=0,i=0;const s=m[t],u=m[r]-1,d=[];for(const n of e){if(a(n),n>=s)throw new Error(`convertRadix2: invalid data word=${n} from=${t}`);if(o=o<<t|n,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=r;i-=r)d.push((o>>i-r&u)>>>0);const e=m[i];if(void 0===e)throw new Error("invalid carry");o&=e-1}if(o=o<<r-i&u,!n&&i>=t)throw new Error("Excess padding");if(!n&&o>0)throw new Error(`Non-zero padding: ${o}`);return n&&i>0&&d.push(o>>>0),d}function S(e){return a(e),{encode:t=>{if(!r(t))throw new Error("radix.encode input should be Uint8Array");return y(Array.from(t),256,e)},decode:t=>(d("radix.decode",t),Uint8Array.from(y(t,e,256)))}}function v(e,t=!1){if(a(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(b(8,e)>32||b(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!r(n))throw new Error("radix2.encode input should be Uint8Array");return E(Array.from(n),8,e,!t)},decode:r=>(d("radix2.decode",r),Uint8Array.from(E(r,e,8,t)))}}function x(e){return i(e),function(...t){try{return e.apply(null,t)}catch(e){}}}function T(e,t){return a(e),i(t),{encode(n){if(!r(n))throw new Error("checksum.encode: input should be Uint8Array");const o=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(o,n.length),i},decode(n){if(!r(n))throw new Error("checksum.decode: input should be Uint8Array");const o=n.slice(0,-e),i=n.slice(-e),s=t(o).slice(0,e);for(let t=0;t<e;t++)if(s[t]!==i[t])throw new Error("Invalid checksum");return o}}}t.utils={alphabet:p,chain:l,checksum:T,convertRadix:y,convertRadix2:E,radix:S,radix2:v,join:h,padding:f},t.base16=l(v(4),p("0123456789ABCDEF"),h("")),t.base32=l(v(5),p("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),f(5),h("")),t.base32nopad=l(v(5),p("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),h("")),t.base32hex=l(v(5),p("0123456789ABCDEFGHIJKLMNOPQRSTUV"),f(5),h("")),t.base32hexnopad=l(v(5),p("0123456789ABCDEFGHIJKLMNOPQRSTUV"),h("")),t.base32crockford=l(v(5),p("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),h(""),g(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const A=(()=>"function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64)(),I=(e,t)=>{s("base64",e);const r=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,n=t?"base64url":"base64";if(e.length>0&&!r.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:n,lastChunkHandling:"strict"})};t.base64=A?{encode:e=>(n(e),e.toBase64()),decode:e=>I(e,!1)}:l(v(6),p("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),f(6),h("")),t.base64nopad=l(v(6),p("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),h("")),t.base64url=A?{encode:e=>(n(e),e.toBase64({alphabet:"base64url"})),decode:e=>I(e,!0)}:l(v(6),p("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),f(6),h("")),t.base64urlnopad=l(v(6),p("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),h(""));const k=e=>l(S(58),p(e),h(""));t.base58=k("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=k("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=k("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const P=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let r="";for(let n=0;n<e.length;n+=8){const o=e.subarray(n,n+8);r+=t.base58.encode(o).padStart(P[o.length],"1")}return r},decode(e){let r=[];for(let n=0;n<e.length;n+=11){const o=e.slice(n,n+11),i=P.indexOf(o.length),s=t.base58.decode(o);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");r=r.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(r)}},t.createBase58check=e=>l(T(4,t=>e(e(t))),t.base58),t.base58check=t.createBase58check;const B=l(p("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),h("")),O=[996825010,642813549,513874426,1027748829,705979059];function R(e){const t=e>>25;let r=(33554431&e)<<5;for(let e=0;e<O.length;e++)1==(t>>e&1)&&(r^=O[e]);return r}function _(e,t,r=1){const n=e.length;let o=1;for(let t=0;t<n;t++){const r=e.charCodeAt(t);if(r<33||r>126)throw new Error(`Invalid prefix (${e})`);o=R(o)^r>>5}o=R(o);for(let t=0;t<n;t++)o=R(o)^31&e.charCodeAt(t);for(let e of t)o=R(o)^e;for(let e=0;e<6;e++)o=R(o);return o^=r,B.encode(E([o%m[30]],30,5,!1))}function U(e){const t="bech32"===e?1:734539939,n=v(5),o=n.decode,i=n.encode,a=x(o);function c(e,n,o=90){s("bech32.encode prefix",e),r(n)&&(n=Array.from(n)),d("bech32.encode",n);const i=e.length;if(0===i)throw new TypeError(`Invalid prefix length ${i}`);const a=i+7+n.length;if(!1!==o&&a>o)throw new TypeError(`Length ${a} exceeds limit ${o}`);const c=e.toLowerCase(),u=_(c,n,t);return`${c}1${B.encode(n)}${u}`}function u(e,r=90){s("bech32.decode input",e);const n=e.length;if(n<8||!1!==r&&n>r)throw new TypeError(`invalid string length: ${n} (${e}). Expected (8..${r})`);const o=e.toLowerCase();if(e!==o&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=o.lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const a=o.slice(0,i),c=o.slice(i+1);if(c.length<6)throw new Error("Data must be at least 6 characters long");const u=B.decode(c).slice(0,-6),d=_(a,u,t);if(!c.endsWith(d))throw new Error(`Invalid checksum in ${e}: expected "${d}"`);return{prefix:a,words:u}}return{encode:c,decode:u,encodeFromBytes:function(e,t){return c(e,i(t))},decodeToBytes:function(e){const{prefix:t,words:r}=u(e,!1);return{prefix:t,words:r,bytes:o(r)}},decodeUnsafe:x(u),fromWords:o,fromWordsUnsafe:a,toWords:i}}t.bech32=U("bech32"),t.bech32m=U("bech32m"),t.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)};const N=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),C={encode:e=>(n(e),e.toHex()),decode:e=>(s("hex",e),Uint8Array.fromHex(e))};t.hex=N?C:l(v(4),p("0123456789abcdef"),h(""),g(e=>{if("string"!=typeof e||e.length%2!=0)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));const L={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},H="Invalid encoding type. Available types: utf8, hex, base16, base32, base64, base64url, base58, base58xmr";t.bytesToString=(e,t)=>{if("string"!=typeof e||!L.hasOwnProperty(e))throw new TypeError(H);if(!r(t))throw new TypeError("bytesToString() expects Uint8Array");return L[e].encode(t)},t.str=t.bytesToString,t.stringToBytes=(e,t)=>{if(!L.hasOwnProperty(e))throw new TypeError(H);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return L[e].decode(t)},t.bytes=t.stringToBytes},3562:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHash=s,t.createCurve=function(e,t){const r=t=>(0,i.weierstrass)({...e,...s(t)});return{...r(t),create:r}};const n=r(9615),o=r(9175),i=r(1705);function s(e){return{hash:e,hmac:(t,...r)=>(0,n.hmac)(e,t,(0,o.concatBytes)(...r)),randomBytes:o.randomBytes}}},4537:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BIP322=void 0,t.craftToSpendTx=f;const n=r(5046),o=r(9854),i=r(8510),s=r(3203);var a;!function(e){e.create=function(e,t,r=[]){if(0==t.length)throw o.ErrMissingInputs;if(!function(e){return e.forEach(p),!0}(t))throw o.ErrMissingData;if(!function(e){return e.forEach(h),!0}(r))throw o.ErrMissingData;return function(e,t,r){const o=t[0],i=new n.Transaction({version:2,allowUnknownOutputs:0===r.length,allowUnknown:!0,allowUnknownInputs:!0,lockTime:0});i.addInput({...o,txid:e.id,index:0,witnessUtxo:{script:o.witnessUtxo.script,amount:0n},sighashType:n.SigHash.ALL});for(const e of t)i.addInput({...e,sighashType:n.SigHash.ALL});0===r.length&&(r=[{amount:0n,script:c}]);for(const e of r)i.addOutput({amount:e.amount,script:e.script});return i}(f(e,t[0].witnessUtxo.script),t,r)},e.signature=function(e,t=e=>e.finalize()){return t(e),s.base64.encode(e.extract())}}(a||(t.BIP322=a={}));const c=new Uint8Array([n.OP.RETURN]),u=new Uint8Array(32).fill(0),d=4294967295,l="BIP0322-signed-message";function p(e){if(void 0===e.index)throw o.ErrMissingData;if(void 0===e.txid)throw o.ErrMissingData;if(void 0===e.witnessUtxo)throw o.ErrMissingWitnessUtxo;return!0}function h(e){if(void 0===e.amount)throw o.ErrMissingData;if(void 0===e.script)throw o.ErrMissingData;return!0}function f(e,t){const r=function(e){return i.schnorr.utils.taggedHash(l,(new TextEncoder).encode(e))}(e),o=new n.Transaction({version:0,allowUnknownOutputs:!0,allowUnknown:!0,allowUnknownInputs:!0});return o.addInput({txid:u,index:d,sequence:0}),o.addOutput({amount:0n,script:t}),o.updateInput(0,{finalScriptSig:n.Script.encode(["OP_0",r])}),o}},4864:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBVtxoRepository=void 0;class r{constructor(){this.db=null}static delete(){return new Promise((e,t)=>{try{const n=indexedDB.deleteDatabase(r.DB_NAME);n.onblocked=()=>{setTimeout(()=>{const n=indexedDB.deleteDatabase(r.DB_NAME);n.onsuccess=()=>e(),n.onerror=()=>t(n.error||new Error("Failed to delete database"))},100)},n.onsuccess=()=>{e()},n.onerror=()=>{t(n.error||new Error("Failed to delete database"))}}catch(e){t(e instanceof Error?e:new Error("Failed to delete database"))}})}async close(){this.db&&(this.db.close(),this.db=null)}async open(){return new Promise((e,t)=>{const n=indexedDB.open(r.DB_NAME,r.DB_VERSION);n.onerror=()=>{t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(r.STORE_NAME)){const e=t.createObjectStore(r.STORE_NAME,{keyPath:["txid","vout"]});e.createIndex("state","virtualStatus.state",{unique:!1}),e.createIndex("spentBy","spentBy",{unique:!1})}}})}async addOrUpdate(e){if(!this.db)throw new Error("Database not opened");return new Promise((t,n)=>{const o=this.db.transaction(r.STORE_NAME,"readwrite").objectStore(r.STORE_NAME),i=e.map(e=>new Promise((t,r)=>{const n=o.put(e);n.onsuccess=()=>t(),n.onerror=()=>r(n.error)}));Promise.all(i).then(()=>t()).catch(n)})}async deleteAll(){if(!this.db)throw new Error("Database not opened");return new Promise((e,t)=>{const n=this.db.transaction(r.STORE_NAME,"readwrite").objectStore(r.STORE_NAME).clear();n.onsuccess=()=>e(),n.onerror=()=>t(n.error)})}async getSpendableVtxos(){if(!this.db)throw new Error("Database not opened");return new Promise((e,t)=>{const n=this.db.transaction(r.STORE_NAME,"readonly").objectStore(r.STORE_NAME).index("spentBy").getAll(IDBKeyRange.only(""));n.onsuccess=()=>{e(n.result)},n.onerror=()=>t(n.error)})}async getSweptVtxos(){if(!this.db)throw new Error("Database not opened");return new Promise((e,t)=>{const n=this.db.transaction(r.STORE_NAME,"readonly").objectStore(r.STORE_NAME).index("state").getAll(IDBKeyRange.only("swept"));n.onsuccess=()=>{e(n.result)},n.onerror=()=>t(n.error)})}async getSpentVtxos(){if(!this.db)throw new Error("Database not opened");return new Promise((e,t)=>{const n=this.db.transaction(r.STORE_NAME,"readonly").objectStore(r.STORE_NAME).index("spentBy").getAll(IDBKeyRange.lowerBound("",!0));n.onsuccess=()=>{e(n.result)},n.onerror=()=>t(n.error)})}async getAllVtxos(){if(!this.db)throw new Error("Database not opened");return new Promise((e,t)=>{const n=this.db.transaction(r.STORE_NAME,"readonly").objectStore(r.STORE_NAME).index("spentBy"),o=n.getAll(IDBKeyRange.only("")),i=n.getAll(IDBKeyRange.lowerBound("",!0));Promise.all([new Promise((e,t)=>{o.onsuccess=()=>{e(o.result)},o.onerror=()=>t(o.error)}),new Promise((e,t)=>{i.onsuccess=()=>{e(i.result)},i.onerror=()=>t(i.error)})]).then(([t,r])=>{e({spendable:t,spent:r})}).catch(t)})}}t.IndexedDBVtxoRepository=r,r.DB_NAME="wallet-db",r.STORE_NAME="vtxos",r.DB_VERSION=1},4917:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.PartialSig=t.PartialSignatureError=void 0,t.sign=function(e,t,r,n,o,i){let s;if(void 0!==i?.taprootTweak){const{preTweakedKey:e}=(0,d.aggregateKeys)(i?.sortKeys?a.sortKeys(n):n,!0);s=l.schnorr.utils.taggedHash("TapTweak",e.subarray(1),i.taprootTweak)}const c=new a.Session(r,i?.sortKeys?a.sortKeys(n):n,o,s?[s]:void 0,s?[!0]:void 0).sign(e,t);return h.decode(c)};const a=s(r(939)),c=r(1484),u=r(7591),d=r(5692),l=r(8510);class p extends Error{constructor(e){super(e),this.name="PartialSignatureError"}}t.PartialSignatureError=p;class h{constructor(e,t){if(this.s=e,this.R=t,32!==e.length)throw new p("Invalid s length");if(33!==t.length)throw new p("Invalid R length")}encode(){return new Uint8Array(this.s)}static decode(e){if(32!==e.length)throw new p("Invalid partial signature length");if((0,c.bytesToNumberBE)(e)>=u.CURVE.n)throw new p("s value overflows curve order");const t=new Uint8Array(33);return new h(e,t)}}t.PartialSig=h},4967:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNegativeLE=void 0,t.mod=p,t.pow=function(e,t,r){return m(x(r),e,t)},t.pow2=function(e,t,r){let n=e;for(;t-- >i;)n*=n,n%=r;return n},t.invert=h,t.tonelliShanks=y,t.FpSqrt=w,t.validateField=function(e){const t=b.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,o.validateObject)(e,t)},t.FpPow=m,t.FpInvertBatch=E,t.FpDiv=function(e,t,r){return e.mul(t,"bigint"==typeof r?h(r,e.ORDER):e.inv(r))},t.FpLegendre=S,t.FpIsSquare=function(e,t){return 1===S(e,t)},t.nLength=v,t.Field=x,t.FpSqrtOdd=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)},t.FpSqrtEven=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r},t.hashToPrivateScalar=function(e,t,r=!1){const n=(e=(0,o.ensureBytes)("privateHash",e)).length,i=v(t).nByteLength+8;if(i<24||n<i||n>1024)throw new Error("hashToPrivateScalar: expected "+i+"-1024 bytes of input, got "+n);return p(r?(0,o.bytesToNumberLE)(e):(0,o.bytesToNumberBE)(e),t-s)+s},t.getFieldBytesLength=T,t.getMinHashLength=A,t.mapHashToField=function(e,t,r=!1){const n=e.length,i=T(t),a=A(t);if(n<16||n<a||n>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+n);const c=p(r?(0,o.bytesToNumberLE)(e):(0,o.bytesToNumberBE)(e),t-s)+s;return r?(0,o.numberToBytesLE)(c,i):(0,o.numberToBytesBE)(c,i)};const n=r(9175),o=r(1484),i=BigInt(0),s=BigInt(1),a=BigInt(2),c=BigInt(3),u=BigInt(4),d=BigInt(5),l=BigInt(8);function p(e,t){const r=e%t;return r>=i?r:t+r}function h(e,t){if(e===i)throw new Error("invert: expected non-zero number");if(t<=i)throw new Error("invert: expected positive modulus, got "+t);let r=p(e,t),n=t,o=i,a=s,c=s,u=i;for(;r!==i;){const e=n/r,t=n%r,i=o-c*e,s=a-u*e;n=r,r=t,o=c,a=u,c=i,u=s}if(n!==s)throw new Error("invert: does not exist");return p(o,t)}function f(e,t){const r=(e.ORDER+s)/u,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function g(e,t){const r=(e.ORDER-d)/l,n=e.mul(t,a),o=e.pow(n,r),i=e.mul(t,o),s=e.mul(e.mul(i,a),o),c=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(c),t))throw new Error("Cannot find square root");return c}function y(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-s,r=0;for(;t%a===i;)t/=a,r++;let n=a;const o=x(e);for(;1===S(o,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return f;let c=o.pow(n,t);const u=(t+s)/a;return function(e,n){if(e.is0(n))return n;if(1!==S(e,n))throw new Error("Cannot find square root");let o=r,i=e.mul(e.ONE,c),a=e.pow(n,t),d=e.pow(n,u);for(;!e.eql(a,e.ONE);){if(e.is0(a))return e.ZERO;let t=1,r=e.sqr(a);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===o)throw new Error("Cannot find square root");const n=s<<BigInt(o-t-1),c=e.pow(i,n);o=t,i=e.sqr(c),a=e.mul(a,i),d=e.mul(d,c)}return d}}function w(e){return e%u===c?f:e%l===d?g:y(e)}t.isNegativeLE=(e,t)=>(p(e,t)&s)===s;const b=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function m(e,t,r){if(r<i)throw new Error("invalid exponent, negatives unsupported");if(r===i)return e.ONE;if(r===s)return t;let n=e.ONE,o=t;for(;r>i;)r&s&&(n=e.mul(n,o)),o=e.sqr(o),r>>=s;return n}function E(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r)),e.ONE),i=e.inv(o);return t.reduceRight((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r)),i),n}function S(e,t){const r=(e.ORDER-s)/a,n=e.pow(t,r),o=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),c=e.eql(n,e.neg(e.ONE));if(!o&&!i&&!c)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function v(e,t){void 0!==t&&(0,n.anumber)(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function x(e,t,r=!1,n={}){if(e<=i)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:a,nByteLength:c}=v(e,t);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:r,BITS:a,BYTES:c,MASK:(0,o.bitMask)(a),ZERO:i,ONE:s,create:t=>p(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return i<=t&&t<e},is0:e=>e===i,isOdd:e=>(e&s)===s,neg:t=>p(-t,e),eql:(e,t)=>e===t,sqr:t=>p(t*t,e),add:(t,r)=>p(t+r,e),sub:(t,r)=>p(t-r,e),mul:(t,r)=>p(t*r,e),pow:(e,t)=>m(d,e,t),div:(t,r)=>p(t*h(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>h(t,e),sqrt:n.sqrt||(t=>(u||(u=w(e)),u(d,t))),toBytes:e=>r?(0,o.numberToBytesLE)(e,c):(0,o.numberToBytesBE)(e,c),fromBytes:e=>{if(e.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+e.length);return r?(0,o.bytesToNumberLE)(e):(0,o.bytesToNumberBE)(e)},invertBatch:e=>E(d,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(d)}function T(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function A(e){const t=T(e);return t+Math.ceil(t/2)}},5031:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEST_NETWORK=t.NETWORK=t.TAPROOT_UNSPENDABLE_KEY=t.PubT=t.tagSchnorr=t.signSchnorr=t.pubECDSA=t.pubSchnorr=t.randomPrivateKeyBytes=t.sha256x2=t.hash160=t.sha256=t.isBytes=t.equalBytes=t.concatBytes=void 0,t.signECDSA=function(e,t,r=!1){let o=n.secp256k1.sign(e,t);if(r&&!p(o)){const r=new Uint8Array(32);let i=0;for(;!p(o);)if(r.set(s.U32LE.encode(i++)),o=n.secp256k1.sign(e,t,{extraEntropy:r}),i>4294967295)throw new Error("lowR counter overflow: report the error")}return o.toDERRawBytes()},t.validatePubkey=function(e,t){const r=e.length;if(t===h.ecdsa){if(32===r)throw new Error("Expected non-Schnorr key");return a.fromHex(e),e}if(t===h.schnorr){if(32!==r)throw new Error("Expected 32-byte Schnorr key");return n.schnorr.utils.lift_x(n.schnorr.utils.bytesToNumberBE(e)),e}throw new Error("Unknown key type")},t.tapTweak=f,t.taprootTweakPrivKey=function(e,t=Uint8Array.of()){const r=n.schnorr.utils,o=r.bytesToNumberBE(e),i=a.fromPrivateKey(o),s=i.hasEvenY()?o:r.mod(-o,c),u=f(r.pointToBytes(i),t);return r.numberToBytesBE(r.mod(s+u,c),32)},t.taprootTweakPubkey=function(e,t){const r=n.schnorr.utils,o=f(e,t),i=r.lift_x(r.bytesToNumberBE(e)).add(a.fromPrivateKey(o)),s=i.hasEvenY()?0:1;return[r.pointToBytes(i),s]},t.compareBytes=function(e,t){if(!u(e)||!u(t))throw new Error(`cmp: wrong type a=${typeof e} b=${typeof t}`);const r=Math.min(e.length,t.length);for(let n=0;n<r;n++)if(e[n]!=t[n])return Math.sign(e[n]-t[n]);return Math.sign(e.length-t.length)};const n=r(8510),o=r(1839),i=r(7076);Object.defineProperty(t,"sha256",{enumerable:!0,get:function(){return i.sha256}});const s=r(2954),a=n.secp256k1.ProjectivePoint,c=n.secp256k1.CURVE.n,u=s.utils.isBytes;t.isBytes=u;const d=s.utils.concatBytes;t.concatBytes=d;const l=s.utils.equalBytes;t.equalBytes=l,t.hash160=e=>(0,o.ripemd160)((0,i.sha256)(e)),t.sha256x2=(...e)=>(0,i.sha256)((0,i.sha256)(d(...e))),t.randomPrivateKeyBytes=n.schnorr.utils.randomPrivateKey,t.pubSchnorr=n.schnorr.getPublicKey,t.pubECDSA=n.secp256k1.getPublicKey;const p=e=>e.r<c/2n;var h;function f(e,t){const r=n.schnorr.utils,o=r.taggedHash("TapTweak",e,t),i=r.bytesToNumberBE(o);if(i>=c)throw new Error("tweak higher than curve order");return i}t.signSchnorr=n.schnorr.sign,t.tagSchnorr=n.schnorr.utils.taggedHash,function(e){e[e.ecdsa=0]="ecdsa",e[e.schnorr=1]="schnorr"}(h||(t.PubT=h={})),t.TAPROOT_UNSPENDABLE_KEY=(0,i.sha256)(a.BASE.toRawBytes(!1)),t.NETWORK={bech32:"bc",pubKeyHash:0,scriptHash:5,wif:128},t.TEST_NETWORK={bech32:"tb",pubKeyHash:111,scriptHash:196,wif:239}},5035:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildForfeitTx=function(e,t,r){const i=new n.Transaction({version:3,lockTime:r});let s=0n;for(const t of e){if(!t.witnessUtxo)throw new Error("input needs witness utxo");s+=t.witnessUtxo.amount,i.addInput(t)}return i.addOutput({script:t,amount:s}),i.addOutput(o.P2A),i};const n=r(5046),o=r(9145)},5046:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._Estimator=t._cmpBig=t.SigHash=t.PSBTCombine=t.DEFAULT_SEQUENCE=t.Decimal=t.bip32Path=t.TaprootControlBlock=t._DebugPSBT=t.WIF=t.taprootListToTree=t.sortedMultisig=t.OutScript=t.getAddress=t.combinations=t.Address=t._sortPubkeys=t.utils=t.selectUTXO=t.TEST_NETWORK=t.TAPROOT_UNSPENDABLE_KEY=t.NETWORK=t.Transaction=t.getInputType=t.ScriptNum=t.Script=t.RawWitness=t.RawTx=t.OP=t.MAX_SCRIPT_BYTE_LENGTH=t.CompactSize=t.p2wsh=t.p2wpkh=t.p2tr_pk=t.p2tr_ns=t.p2tr_ms=t.p2tr=t.p2sh=t.p2pkh=t.p2pk=t.p2ms=t.multisig=void 0;const n=r(5031);var o=r(8120);Object.defineProperty(t,"multisig",{enumerable:!0,get:function(){return o.multisig}}),Object.defineProperty(t,"p2ms",{enumerable:!0,get:function(){return o.p2ms}}),Object.defineProperty(t,"p2pk",{enumerable:!0,get:function(){return o.p2pk}}),Object.defineProperty(t,"p2pkh",{enumerable:!0,get:function(){return o.p2pkh}}),Object.defineProperty(t,"p2sh",{enumerable:!0,get:function(){return o.p2sh}}),Object.defineProperty(t,"p2tr",{enumerable:!0,get:function(){return o.p2tr}}),Object.defineProperty(t,"p2tr_ms",{enumerable:!0,get:function(){return o.p2tr_ms}}),Object.defineProperty(t,"p2tr_ns",{enumerable:!0,get:function(){return o.p2tr_ns}}),Object.defineProperty(t,"p2tr_pk",{enumerable:!0,get:function(){return o.p2tr_pk}}),Object.defineProperty(t,"p2wpkh",{enumerable:!0,get:function(){return o.p2wpkh}}),Object.defineProperty(t,"p2wsh",{enumerable:!0,get:function(){return o.p2wsh}});var i=r(5327);Object.defineProperty(t,"CompactSize",{enumerable:!0,get:function(){return i.CompactSize}}),Object.defineProperty(t,"MAX_SCRIPT_BYTE_LENGTH",{enumerable:!0,get:function(){return i.MAX_SCRIPT_BYTE_LENGTH}}),Object.defineProperty(t,"OP",{enumerable:!0,get:function(){return i.OP}}),Object.defineProperty(t,"RawTx",{enumerable:!0,get:function(){return i.RawTx}}),Object.defineProperty(t,"RawWitness",{enumerable:!0,get:function(){return i.RawWitness}}),Object.defineProperty(t,"Script",{enumerable:!0,get:function(){return i.Script}}),Object.defineProperty(t,"ScriptNum",{enumerable:!0,get:function(){return i.ScriptNum}});var s=r(7338);Object.defineProperty(t,"getInputType",{enumerable:!0,get:function(){return s.getInputType}}),Object.defineProperty(t,"Transaction",{enumerable:!0,get:function(){return s.Transaction}});var a=r(5031);Object.defineProperty(t,"NETWORK",{enumerable:!0,get:function(){return a.NETWORK}}),Object.defineProperty(t,"TAPROOT_UNSPENDABLE_KEY",{enumerable:!0,get:function(){return a.TAPROOT_UNSPENDABLE_KEY}}),Object.defineProperty(t,"TEST_NETWORK",{enumerable:!0,get:function(){return a.TEST_NETWORK}});var c=r(1676);Object.defineProperty(t,"selectUTXO",{enumerable:!0,get:function(){return c.selectUTXO}}),t.utils={isBytes:n.isBytes,concatBytes:n.concatBytes,compareBytes:n.compareBytes,pubSchnorr:n.pubSchnorr,randomPrivateKeyBytes:n.randomPrivateKeyBytes,taprootTweakPubkey:n.taprootTweakPubkey};var u=r(8120);Object.defineProperty(t,"_sortPubkeys",{enumerable:!0,get:function(){return u._sortPubkeys}}),Object.defineProperty(t,"Address",{enumerable:!0,get:function(){return u.Address}}),Object.defineProperty(t,"combinations",{enumerable:!0,get:function(){return u.combinations}}),Object.defineProperty(t,"getAddress",{enumerable:!0,get:function(){return u.getAddress}}),Object.defineProperty(t,"OutScript",{enumerable:!0,get:function(){return u.OutScript}}),Object.defineProperty(t,"sortedMultisig",{enumerable:!0,get:function(){return u.sortedMultisig}}),Object.defineProperty(t,"taprootListToTree",{enumerable:!0,get:function(){return u.taprootListToTree}}),Object.defineProperty(t,"WIF",{enumerable:!0,get:function(){return u.WIF}});var d=r(227);Object.defineProperty(t,"_DebugPSBT",{enumerable:!0,get:function(){return d._DebugPSBT}}),Object.defineProperty(t,"TaprootControlBlock",{enumerable:!0,get:function(){return d.TaprootControlBlock}});var l=r(7338);Object.defineProperty(t,"bip32Path",{enumerable:!0,get:function(){return l.bip32Path}}),Object.defineProperty(t,"Decimal",{enumerable:!0,get:function(){return l.Decimal}}),Object.defineProperty(t,"DEFAULT_SEQUENCE",{enumerable:!0,get:function(){return l.DEFAULT_SEQUENCE}}),Object.defineProperty(t,"PSBTCombine",{enumerable:!0,get:function(){return l.PSBTCombine}}),Object.defineProperty(t,"SigHash",{enumerable:!0,get:function(){return l.SigHash}});var p=r(1676);Object.defineProperty(t,"_cmpBig",{enumerable:!0,get:function(){return p._cmpBig}}),Object.defineProperty(t,"_Estimator",{enumerable:!0,get:function(){return p._Estimator}})},5145:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crypto=void 0,t.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0},5147:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArkNote=void 0;const n=r(3203),o=r(9761),i=r(5031),s=r(5046);class a{constructor(e,t,r=a.DefaultHRP){this.preimage=e,this.value=t,this.HRP=r,this.vout=0;const s=(0,i.sha256)(this.preimage);this.vtxoScript=new o.VtxoScript([c(s)]);const u=this.vtxoScript.leaves[0];this.txid=n.hex.encode(new Uint8Array(s).reverse()),this.tapTree=this.vtxoScript.encode(),this.forfeitTapLeafScript=u,this.intentTapLeafScript=u,this.value=t,this.status={confirmed:!0},this.extraWitness=[this.preimage]}encode(){const e=new Uint8Array(a.Length);var t,r,n;return e.set(this.preimage,0),t=e,r=this.value,n=this.preimage.length,new DataView(t.buffer,t.byteOffset+n,4).setUint32(0,r,!1),e}static decode(e,t=a.DefaultHRP){if(e.length!==a.Length)throw new Error(`invalid data length: expected ${a.Length} bytes, got ${e.length}`);const r=e.subarray(0,a.PreimageLength),n=(o=e,i=a.PreimageLength,new DataView(o.buffer,o.byteOffset+i,4).getUint32(0,!1));var o,i;return new a(r,n,t)}static fromString(e,t=a.DefaultHRP){if(!(e=e.trim()).startsWith(t))throw new Error(`invalid human-readable part: expected ${t} prefix (note '${e}')`);const r=e.slice(t.length),o=n.base58.decode(r);if(0===o.length)throw new Error("failed to decode base58 string");return a.decode(o,t)}toString(){return this.HRP+n.base58.encode(this.encode())}}function c(e){return s.Script.encode(["SHA256",e,"EQUAL"])}t.ArkNote=a,a.DefaultHRP="arknote",a.PreimageLength=32,a.ValueLength=4,a.Length=a.PreimageLength+a.ValueLength,a.FakeOutpointIndex=0},5327:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawOldTx=t.RawTx=t.RawOutput=t.RawInput=t.BTCArray=t.RawWitness=t.VarBytes=t.CompactSizeLen=t.CompactSize=t.Script=t.OP=t.MAX_SCRIPT_BYTE_LENGTH=void 0,t.ScriptNum=s,t.OpToNum=function(e,t=4,r=!0){if("number"==typeof e)return e;if((0,o.isBytes)(e))try{const n=s(t,r).decode(e);if(n>Number.MAX_SAFE_INTEGER)return;return Number(n)}catch(e){return}};const n=r(2954),o=r(5031);var i;function s(e=6,t=!1){return n.wrap({encodeStream:(e,t)=>{if(0n===t)return;const r=t<0,n=BigInt(t),o=[];for(let e=r?-n:n;e;e>>=8n)o.push(Number(0xffn&e));o[o.length-1]>=128?o.push(r?128:0):r&&(o[o.length-1]|=128),e.bytes(new Uint8Array(o))},decodeStream:r=>{const n=r.leftBytes;if(n>e)throw new Error(`ScriptNum: number (${n}) bigger than limit=${e}`);if(0===n)return 0n;if(t){const e=r.bytes(n,!0);if(!(127&e[e.length-1]||!(n<=1)&&128&e[e.length-2]))throw new Error("Non-minimally encoded ScriptNum")}let o=0,i=0n;for(let e=0;e<n;++e)o=r.byte(),i|=BigInt(o)<<8n*BigInt(e);return o>=128&&(i&=2n**BigInt(8*n)-1n>>1n,i=-i),i}})}t.MAX_SCRIPT_BYTE_LENGTH=520,function(e){e[e.OP_0=0]="OP_0",e[e.PUSHDATA1=76]="PUSHDATA1",e[e.PUSHDATA2=77]="PUSHDATA2",e[e.PUSHDATA4=78]="PUSHDATA4",e[e["1NEGATE"]=79]="1NEGATE",e[e.RESERVED=80]="RESERVED",e[e.OP_1=81]="OP_1",e[e.OP_2=82]="OP_2",e[e.OP_3=83]="OP_3",e[e.OP_4=84]="OP_4",e[e.OP_5=85]="OP_5",e[e.OP_6=86]="OP_6",e[e.OP_7=87]="OP_7",e[e.OP_8=88]="OP_8",e[e.OP_9=89]="OP_9",e[e.OP_10=90]="OP_10",e[e.OP_11=91]="OP_11",e[e.OP_12=92]="OP_12",e[e.OP_13=93]="OP_13",e[e.OP_14=94]="OP_14",e[e.OP_15=95]="OP_15",e[e.OP_16=96]="OP_16",e[e.NOP=97]="NOP",e[e.VER=98]="VER",e[e.IF=99]="IF",e[e.NOTIF=100]="NOTIF",e[e.VERIF=101]="VERIF",e[e.VERNOTIF=102]="VERNOTIF",e[e.ELSE=103]="ELSE",e[e.ENDIF=104]="ENDIF",e[e.VERIFY=105]="VERIFY",e[e.RETURN=106]="RETURN",e[e.TOALTSTACK=107]="TOALTSTACK",e[e.FROMALTSTACK=108]="FROMALTSTACK",e[e["2DROP"]=109]="2DROP",e[e["2DUP"]=110]="2DUP",e[e["3DUP"]=111]="3DUP",e[e["2OVER"]=112]="2OVER",e[e["2ROT"]=113]="2ROT",e[e["2SWAP"]=114]="2SWAP",e[e.IFDUP=115]="IFDUP",e[e.DEPTH=116]="DEPTH",e[e.DROP=117]="DROP",e[e.DUP=118]="DUP",e[e.NIP=119]="NIP",e[e.OVER=120]="OVER",e[e.PICK=121]="PICK",e[e.ROLL=122]="ROLL",e[e.ROT=123]="ROT",e[e.SWAP=124]="SWAP",e[e.TUCK=125]="TUCK",e[e.CAT=126]="CAT",e[e.SUBSTR=127]="SUBSTR",e[e.LEFT=128]="LEFT",e[e.RIGHT=129]="RIGHT",e[e.SIZE=130]="SIZE",e[e.INVERT=131]="INVERT",e[e.AND=132]="AND",e[e.OR=133]="OR",e[e.XOR=134]="XOR",e[e.EQUAL=135]="EQUAL",e[e.EQUALVERIFY=136]="EQUALVERIFY",e[e.RESERVED1=137]="RESERVED1",e[e.RESERVED2=138]="RESERVED2",e[e["1ADD"]=139]="1ADD",e[e["1SUB"]=140]="1SUB",e[e["2MUL"]=141]="2MUL",e[e["2DIV"]=142]="2DIV",e[e.NEGATE=143]="NEGATE",e[e.ABS=144]="ABS",e[e.NOT=145]="NOT",e[e["0NOTEQUAL"]=146]="0NOTEQUAL",e[e.ADD=147]="ADD",e[e.SUB=148]="SUB",e[e.MUL=149]="MUL",e[e.DIV=150]="DIV",e[e.MOD=151]="MOD",e[e.LSHIFT=152]="LSHIFT",e[e.RSHIFT=153]="RSHIFT",e[e.BOOLAND=154]="BOOLAND",e[e.BOOLOR=155]="BOOLOR",e[e.NUMEQUAL=156]="NUMEQUAL",e[e.NUMEQUALVERIFY=157]="NUMEQUALVERIFY",e[e.NUMNOTEQUAL=158]="NUMNOTEQUAL",e[e.LESSTHAN=159]="LESSTHAN",e[e.GREATERTHAN=160]="GREATERTHAN",e[e.LESSTHANOREQUAL=161]="LESSTHANOREQUAL",e[e.GREATERTHANOREQUAL=162]="GREATERTHANOREQUAL",e[e.MIN=163]="MIN",e[e.MAX=164]="MAX",e[e.WITHIN=165]="WITHIN",e[e.RIPEMD160=166]="RIPEMD160",e[e.SHA1=167]="SHA1",e[e.SHA256=168]="SHA256",e[e.HASH160=169]="HASH160",e[e.HASH256=170]="HASH256",e[e.CODESEPARATOR=171]="CODESEPARATOR",e[e.CHECKSIG=172]="CHECKSIG",e[e.CHECKSIGVERIFY=173]="CHECKSIGVERIFY",e[e.CHECKMULTISIG=174]="CHECKMULTISIG",e[e.CHECKMULTISIGVERIFY=175]="CHECKMULTISIGVERIFY",e[e.NOP1=176]="NOP1",e[e.CHECKLOCKTIMEVERIFY=177]="CHECKLOCKTIMEVERIFY",e[e.CHECKSEQUENCEVERIFY=178]="CHECKSEQUENCEVERIFY",e[e.NOP4=179]="NOP4",e[e.NOP5=180]="NOP5",e[e.NOP6=181]="NOP6",e[e.NOP7=182]="NOP7",e[e.NOP8=183]="NOP8",e[e.NOP9=184]="NOP9",e[e.NOP10=185]="NOP10",e[e.CHECKSIGADD=186]="CHECKSIGADD",e[e.INVALID=255]="INVALID"}(i||(t.OP=i={})),t.Script=n.wrap({encodeStream:(e,t)=>{for(let r of t){if("string"==typeof r){if(void 0===i[r])throw new Error(`Unknown opcode=${r}`);e.byte(i[r]);continue}if("number"==typeof r){if(0===r){e.byte(0);continue}if(1<=r&&r<=16){e.byte(i.OP_1-1+r);continue}}if("number"==typeof r&&(r=s().encode(BigInt(r))),!(0,o.isBytes)(r))throw new Error(`Wrong Script OP=${r} (${typeof r})`);const t=r.length;t<i.PUSHDATA1?e.byte(t):t<=255?(e.byte(i.PUSHDATA1),e.byte(t)):t<=65535?(e.byte(i.PUSHDATA2),e.bytes(n.U16LE.encode(t))):(e.byte(i.PUSHDATA4),e.bytes(n.U32LE.encode(t))),e.bytes(r)}},decodeStream:e=>{const t=[];for(;!e.isEnd();){const r=e.byte();if(i.OP_0<r&&r<=i.PUSHDATA4){let o;if(r<i.PUSHDATA1)o=r;else if(r===i.PUSHDATA1)o=n.U8.decodeStream(e);else if(r===i.PUSHDATA2)o=n.U16LE.decodeStream(e);else{if(r!==i.PUSHDATA4)throw new Error("Should be not possible");o=n.U32LE.decodeStream(e)}t.push(e.bytes(o))}else if(0===r)t.push(0);else if(i.OP_1<=r&&r<=i.OP_16)t.push(r-(i.OP_1-1));else{const e=i[r];if(void 0===e)throw new Error(`Unknown opcode=${r.toString(16)}`);t.push(e)}}return t}});const a={253:[253,2,253n,65535n],254:[254,4,65536n,4294967295n],255:[255,8,4294967296n,18446744073709551615n]};t.CompactSize=n.wrap({encodeStream:(e,t)=>{if("number"==typeof t&&(t=BigInt(t)),0n<=t&&t<=252n)return e.byte(Number(t));for(const[r,n,o,i]of Object.values(a))if(!(o>t||t>i)){e.byte(r);for(let r=0;r<n;r++)e.byte(Number(t>>8n*BigInt(r)&0xffn));return}throw e.err(`VarInt too big: ${t}`)},decodeStream:e=>{const t=e.byte();if(t<=252)return BigInt(t);const[r,n,o]=a[t];let i=0n;for(let t=0;t<n;t++)i|=BigInt(e.byte())<<8n*BigInt(t);if(i<o)throw e.err(`Wrong CompactSize(${8*n})`);return i}}),t.CompactSizeLen=n.apply(t.CompactSize,n.coders.numberBigint),t.VarBytes=n.bytes(t.CompactSize),t.RawWitness=n.array(t.CompactSizeLen,t.VarBytes),t.BTCArray=e=>n.array(t.CompactSize,e),t.RawInput=n.struct({txid:n.bytes(32,!0),index:n.U32LE,finalScriptSig:t.VarBytes,sequence:n.U32LE}),t.RawOutput=n.struct({amount:n.U64LE,script:t.VarBytes});const c=n.struct({version:n.I32LE,segwitFlag:n.flag(new Uint8Array([0,1])),inputs:(0,t.BTCArray)(t.RawInput),outputs:(0,t.BTCArray)(t.RawOutput),witnesses:n.flagged("segwitFlag",n.array("inputs/length",t.RawWitness)),lockTime:n.U32LE});t.RawTx=n.validate(c,function(e){if(e.segwitFlag&&e.witnesses&&!e.witnesses.length)throw new Error("Segwit flag with empty witnesses array");return e}),t.RawOldTx=n.struct({version:n.I32LE,inputs:(0,t.BTCArray)(t.RawInput),outputs:(0,t.BTCArray)(t.RawOutput),lockTime:n.U32LE})},5482:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArkAddress=void 0;const n=r(3203),o=r(5046);class i{constructor(e,t,r,n=0){if(this.serverPubKey=e,this.vtxoTaprootKey=t,this.hrp=r,this.version=n,32!==e.length)throw new Error("Invalid server public key length, expected 32 bytes, got "+e.length);if(32!==t.length)throw new Error("Invalid vtxo taproot public key length, expected 32 bytes, got "+t.length)}static decode(e){const t=n.bech32m.decodeUnsafe(e,1023);if(!t)throw new Error("Invalid address");const r=new Uint8Array(n.bech32m.fromWords(t.words));if(65!==r.length)throw new Error("Invalid data length, expected 65 bytes, got "+r.length);const o=r[0],s=r.slice(1,33),a=r.slice(33,65);return new i(s,a,t.prefix,o)}encode(){const e=new Uint8Array(65);e[0]=this.version,e.set(this.serverPubKey,1),e.set(this.vtxoTaprootKey,33);const t=n.bech32m.toWords(e);return n.bech32m.encode(this.hrp,t,1023)}get pkScript(){return o.Script.encode(["OP_1",this.vtxoTaprootKey])}get subdustPkScript(){return o.Script.encode(["RETURN",this.vtxoTaprootKey])}}t.ArkAddress=i},5692:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateKeys=function(e,t,r={}){t&&(e=a.sortKeys(e));const{aggPublicKey:n}=a.keyAggregate(e);if(!r.taprootTweak)return{preTweakedKey:n.toRawBytes(!0),finalKey:n.toRawBytes(!0)};const o=c.schnorr.utils.taggedHash("TapTweak",n.toRawBytes(!0).subarray(1),r.taprootTweak??new Uint8Array(0)),{aggPublicKey:i}=a.keyAggregate(e,[o],[!0]);return{preTweakedKey:n.toRawBytes(!0),finalKey:i.toRawBytes(!0)}};const a=s(r(939)),c=r(8510)},5780:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.CLTVMultisigTapscript=t.ConditionMultisigTapscript=t.ConditionCSVMultisigTapscript=t.CSVMultisigTapscript=t.MultisigTapscript=t.TapscriptType=void 0,t.decodeTapscript=function(e){const t=[h,f,g,y,w];for(const r of t)try{return r.decode(e)}catch(e){continue}throw new Error(`Failed to decode: script ${d.hex.encode(e)} is not a valid tapscript`)};const a=s(r(8534)),c=r(5327),u=r(8120),d=r(3203),l=(0,c.ScriptNum)(void 0,!0);var p,h,f,g,y,w;!function(e){e.Multisig="multisig",e.CSVMultisig="csv-multisig",e.ConditionCSVMultisig="condition-csv-multisig",e.ConditionMultisig="condition-multisig",e.CLTVMultisig="cltv-multisig"}(p||(t.TapscriptType=p={})),function(e){let t;function r(e){if(0===e.pubkeys.length)throw new Error("At least 1 pubkey is required");for(const t of e.pubkeys)if(32!==t.length)throw new Error(`Invalid pubkey length: expected 32, got ${t.length}`);if(e.type||(e.type=t.CHECKSIG),e.type===t.CHECKSIGADD)return{type:p.Multisig,params:e,script:(0,u.p2tr_ms)(e.pubkeys.length,e.pubkeys).script};const r=[];for(let t=0;t<e.pubkeys.length;t++)r.push(e.pubkeys[t]),t<e.pubkeys.length-1?r.push("CHECKSIGVERIFY"):r.push("CHECKSIG");return{type:p.Multisig,params:e,script:c.Script.encode(r)}}!function(e){e[e.CHECKSIG=0]="CHECKSIG",e[e.CHECKSIGADD=1]="CHECKSIGADD"}(t=e.MultisigType||(e.MultisigType={})),e.encode=r,e.decode=function(e){if(0===e.length)throw new Error("Failed to decode: script is empty");try{return function(e){const n=c.Script.decode(e),o=[];let i=!1;for(let e=0;e<n.length;e++){const t=n[e];if("string"==typeof t||"number"==typeof t){if(e===n.length-1){if("NUMEQUAL"!==t)throw new Error("Expected NUMEQUAL at end of script");i=!0}}else{if(32!==t.length)throw new Error(`Invalid pubkey length: expected 32, got ${t.length}`);if(o.push(t),e+1>=n.length||"CHECKSIGADD"!==n[e+1]&&"CHECKSIG"!==n[e+1])throw new Error("Expected CHECKSIGADD or CHECKSIG after pubkey");e++}}if(!i)throw new Error("Missing NUMEQUAL operation");if(0===o.length)throw new Error("Invalid script: must have at least 1 pubkey");const s=r({pubkeys:o,type:t.CHECKSIGADD});if(d.hex.encode(s.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.Multisig,params:{pubkeys:o,type:t.CHECKSIGADD},script:e}}(e)}catch(n){try{return function(e){const n=c.Script.decode(e),o=[];for(let e=0;e<n.length;e++){const t=n[e];if("string"!=typeof t&&"number"!=typeof t){if(32!==t.length)throw new Error(`Invalid pubkey length: expected 32, got ${t.length}`);if(o.push(t),e+1>=n.length)throw new Error("Unexpected end of script");const r=n[e+1];if("CHECKSIGVERIFY"!==r&&"CHECKSIG"!==r)throw new Error("Expected CHECKSIGVERIFY or CHECKSIG after pubkey");if(e===n.length-2&&"CHECKSIG"!==r)throw new Error("Last operation must be CHECKSIG");e++;continue}}if(0===o.length)throw new Error("Invalid script: must have at least 1 pubkey");const i=r({pubkeys:o,type:t.CHECKSIG});if(d.hex.encode(i.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.Multisig,params:{pubkeys:o,type:t.CHECKSIG},script:e}}(e)}catch(e){throw new Error(`Failed to decode script: ${e instanceof Error?e.message:String(e)}`)}}},e.is=function(e){return e.type===p.Multisig}}(h||(t.MultisigTapscript=h={})),function(e){function t(e){for(const t of e.pubkeys)if(32!==t.length)throw new Error(`Invalid pubkey length: expected 32, got ${t.length}`);const t=l.encode(BigInt(a.encode("blocks"===e.timelock.type?{blocks:Number(e.timelock.value)}:{seconds:Number(e.timelock.value)}))),r=[1===t.length?t[0]:t,"CHECKSEQUENCEVERIFY","DROP"],n=h.encode(e),o=new Uint8Array([...c.Script.encode(r),...n.script]);return{type:p.CSVMultisig,params:e,script:o}}e.encode=t,e.decode=function(e){if(0===e.length)throw new Error("Failed to decode: script is empty");const r=c.Script.decode(e);if(r.length<3)throw new Error("Invalid script: too short (expected at least 3)");const n=r[0];if("string"==typeof n||"number"==typeof n)throw new Error("Invalid script: expected sequence number");if("CHECKSEQUENCEVERIFY"!==r[1]||"DROP"!==r[2])throw new Error("Invalid script: expected CHECKSEQUENCEVERIFY DROP");const o=new Uint8Array(c.Script.encode(r.slice(3)));let i;try{i=h.decode(o)}catch(e){throw new Error(`Invalid multisig script: ${e instanceof Error?e.message:String(e)}`)}const s=Number(l.decode(n)),u=a.decode(s),f=void 0!==u.blocks?{type:"blocks",value:BigInt(u.blocks)}:{type:"seconds",value:BigInt(u.seconds)},g=t({timelock:f,...i.params});if(d.hex.encode(g.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.CSVMultisig,params:{timelock:f,...i.params},script:e}},e.is=function(e){return e.type===p.CSVMultisig}}(f||(t.CSVMultisigTapscript=f={})),function(e){function t(e){const t=new Uint8Array([...e.conditionScript,...c.Script.encode(["VERIFY"]),...f.encode(e).script]);return{type:p.ConditionCSVMultisig,params:e,script:t}}e.encode=t,e.decode=function(e){if(0===e.length)throw new Error("Failed to decode: script is empty");const r=c.Script.decode(e);if(r.length<1)throw new Error("Invalid script: too short (expected at least 1)");let n=-1;for(let e=r.length-1;e>=0;e--)"VERIFY"===r[e]&&(n=e);if(-1===n)throw new Error("Invalid script: missing VERIFY operation");const o=new Uint8Array(c.Script.encode(r.slice(0,n))),i=new Uint8Array(c.Script.encode(r.slice(n+1)));let s;try{s=f.decode(i)}catch(e){throw new Error(`Invalid CSV multisig script: ${e instanceof Error?e.message:String(e)}`)}const a=t({conditionScript:o,...s.params});if(d.hex.encode(a.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.ConditionCSVMultisig,params:{conditionScript:o,...s.params},script:e}},e.is=function(e){return e.type===p.ConditionCSVMultisig}}(g||(t.ConditionCSVMultisigTapscript=g={})),function(e){function t(e){const t=new Uint8Array([...e.conditionScript,...c.Script.encode(["VERIFY"]),...h.encode(e).script]);return{type:p.ConditionMultisig,params:e,script:t}}e.encode=t,e.decode=function(e){if(0===e.length)throw new Error("Failed to decode: script is empty");const r=c.Script.decode(e);if(r.length<1)throw new Error("Invalid script: too short (expected at least 1)");let n=-1;for(let e=r.length-1;e>=0;e--)"VERIFY"===r[e]&&(n=e);if(-1===n)throw new Error("Invalid script: missing VERIFY operation");const o=new Uint8Array(c.Script.encode(r.slice(0,n))),i=new Uint8Array(c.Script.encode(r.slice(n+1)));let s;try{s=h.decode(i)}catch(e){throw new Error(`Invalid multisig script: ${e instanceof Error?e.message:String(e)}`)}const a=t({conditionScript:o,...s.params});if(d.hex.encode(a.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.ConditionMultisig,params:{conditionScript:o,...s.params},script:e}},e.is=function(e){return e.type===p.ConditionMultisig}}(y||(t.ConditionMultisigTapscript=y={})),function(e){function t(e){const t=l.encode(e.absoluteTimelock),r=[1===t.length?t[0]:t,"CHECKLOCKTIMEVERIFY","DROP"],n=c.Script.encode(r),o=new Uint8Array([...n,...h.encode(e).script]);return{type:p.CLTVMultisig,params:e,script:o}}e.encode=t,e.decode=function(e){if(0===e.length)throw new Error("Failed to decode: script is empty");const r=c.Script.decode(e);if(r.length<3)throw new Error("Invalid script: too short (expected at least 3)");const n=r[0];if("string"==typeof n||"number"==typeof n)throw new Error("Invalid script: expected locktime number");if("CHECKLOCKTIMEVERIFY"!==r[1]||"DROP"!==r[2])throw new Error("Invalid script: expected CHECKLOCKTIMEVERIFY DROP");const o=new Uint8Array(c.Script.encode(r.slice(3)));let i;try{i=h.decode(o)}catch(e){throw new Error(`Invalid multisig script: ${e instanceof Error?e.message:String(e)}`)}const s=l.decode(n),a=t({absoluteTimelock:s,...i.params});if(d.hex.encode(a.script)!==d.hex.encode(e))throw new Error("Invalid script format: script reconstruction mismatch");return{type:p.CLTVMultisig,params:{absoluteTimelock:s,...i.params},script:e}},e.is=function(e){return e.type===p.CLTVMultisig}}(w||(t.CLTVMultisigTapscript=w={}))},6215:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupServiceWorker=async function(e){if(!("serviceWorker"in navigator))throw new Error("Service workers are not supported in this browser");const t=await navigator.serviceWorker.register(e);t.update();const r=t.active||t.waiting||t.installing;if(!r)throw new Error("Failed to get service worker instance");return new Promise((e,t)=>{if("activated"===r.state)return e(r);const n=()=>{s(),e(r)},o=()=>{s(),t(new Error("Service worker failed to activate"))},i=setTimeout(()=>{s(),t(new Error("Service worker activation timed out"))},1e4),s=()=>{r.removeEventListener("activate",n),r.removeEventListener("error",o),clearTimeout(i)};r.addEventListener("activate",n),r.addEventListener("error",o)})}},6238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateKeys=t.sign=t.PartialSig=t.generateNonces=void 0;var n=r(948);Object.defineProperty(t,"generateNonces",{enumerable:!0,get:function(){return n.generateNonces}});var o=r(4917);Object.defineProperty(t,"PartialSig",{enumerable:!0,get:function(){return o.PartialSig}}),Object.defineProperty(t,"sign",{enumerable:!0,get:function(){return o.sign}});var i=r(5692);Object.defineProperty(t,"aggregateKeys",{enumerable:!0,get:function(){return i.aggregateKeys}})},6531:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.Wallet=void 0,t.waitForIncomingFunds=async function(e){let t;return new Promise(r=>{e.notifyIncomingFunds(e=>{r(e),t&&t()}).then(e=>{t=e})})};const a=r(3203),c=s(r(8534)),u=r(8120),d=r(5046),l=r(227),p=r(24),h=r(5482),f=r(9443),g=r(7857),y=r(2999),w=r(8233),b=r(5035),m=r(8634),E=r(6776),S=r(5031),v=r(9761),x=r(5780),T=r(6868),A=r(5147),I=r(4537),k=r(682),P=r(6629);class B{constructor(e,t,r,n,o,i,s,a,c,u,d,l){this.identity=e,this.network=t,this.networkName=r,this.onchainProvider=n,this.arkProvider=o,this.indexerProvider=i,this.arkServerPublicKey=s,this.offchainTapscript=a,this.boardingTapscript=c,this.serverUnrollScript=u,this.forfeitOutputScript=d,this.dustAmount=l}static async create(e){const t=e.identity.xOnlyPublicKey();if(!t)throw new Error("Invalid configured public key");const r=new w.RestArkProvider(e.arkServerUrl),n=new k.RestIndexerProvider(e.arkServerUrl),o=await r.getInfo(),i=(0,g.getNetwork)(o.network),s=new y.EsploraProvider(e.esploraUrl||y.ESPLORA_URL[o.network]),c={value:o.unilateralExitDelay,type:o.unilateralExitDelay<512n?"blocks":"seconds"},d={value:o.boardingExitDelay,type:o.boardingExitDelay<512n?"blocks":"seconds"},l=a.hex.decode(o.signerPubkey).slice(1),p=new f.DefaultVtxo.Script({pubKey:t,serverPubKey:l,csvTimelock:c}),h=new f.DefaultVtxo.Script({pubKey:t,serverPubKey:l,csvTimelock:d}),b=p,m=x.CSVMultisigTapscript.encode({timelock:c,pubkeys:[l]}),E=(0,u.Address)(i).decode(o.forfeitAddress),S=u.OutScript.encode(E);return new B(e.identity,i,o.network,s,r,n,l,b,h,m,S,o.dust)}get arkAddress(){return this.offchainTapscript.address(this.network.hrp,this.arkServerPublicKey)}async getAddress(){return this.arkAddress.encode()}async getBoardingAddress(){return this.boardingTapscript.onchainAddress(this.network)}async getBalance(){const[e,t]=await Promise.all([this.getBoardingUtxos(),this.getVtxos()]);let r=0,n=0;for(const t of e)t.status.confirmed?r+=t.value:n+=t.value;let o=0,i=0,s=0;o=t.filter(e=>"settled"===e.virtualStatus.state).reduce((e,t)=>e+t.value,0),i=t.filter(e=>"preconfirmed"===e.virtualStatus.state).reduce((e,t)=>e+t.value,0),s=t.filter(e=>(0,E.isSpendable)(e)&&"swept"===e.virtualStatus.state).reduce((e,t)=>e+t.value,0);const a=r+n;return{boarding:{confirmed:r,unconfirmed:n,total:a},settled:o,preconfirmed:i,available:o+i,recoverable:s,total:a+(o+i+s)}}async getVtxos(e){const t=await this.getVirtualCoins(e),r=this.offchainTapscript.encode(),n=this.offchainTapscript.forfeit(),o=this.offchainTapscript.exit();return t.map(e=>({...e,forfeitTapLeafScript:n,intentTapLeafScript:o,tapTree:r}))}async getVirtualCoins(e={withRecoverable:!0,withUnrolled:!1}){const t=[a.hex.encode(this.offchainTapscript.pkScript)],r=(await this.indexerProvider.getVtxos({scripts:t,spendableOnly:!0})).vtxos;if(e.withRecoverable){const e=await this.indexerProvider.getVtxos({scripts:t,recoverableOnly:!0});r.push(...e.vtxos)}if(e.withUnrolled){const e=await this.indexerProvider.getVtxos({scripts:t,spentOnly:!0});r.push(...e.vtxos.filter(e=>e.isUnrolled))}return r}async getTransactionHistory(){if(!this.indexerProvider)return[];const e=await this.indexerProvider.getVtxos({scripts:[a.hex.encode(this.offchainTapscript.pkScript)]}),{boardingTxs:t,commitmentsToIgnore:r}=await this.getBoardingTxs(),n=[],o=[];for(const t of e.vtxos)(0,E.isSpendable)(t)?n.push(t):o.push(t);const i=[...t,...(0,p.vtxosToTxs)(n,o,r)];return i.sort((e,t)=>0===e.createdAt?-1:0===t.createdAt?1:t.createdAt-e.createdAt),i}async getBoardingTxs(){const e=await this.getBoardingAddress(),t=await this.onchainProvider.getTransactions(e),r=[],n=new Set;for(const o of t)for(let t=0;t<o.vout.length;t++){const i=o.vout[t];if(i.scriptpubkey_address===e){const e=(await this.onchainProvider.getTxOutspends(o.txid))[t];e?.spent&&n.add(e.txid),r.push({txid:o.txid,vout:t,value:Number(i.value),status:{confirmed:o.status.confirmed,block_time:o.status.block_time},isUnrolled:!0,virtualStatus:{state:e?.spent?"spent":"settled",commitmentTxIds:e?.spent?[e.txid]:void 0},createdAt:o.status.confirmed?new Date(1e3*o.status.block_time):new Date(0)})}}const o=[],i=[];for(const e of r){const t={key:{boardingTxid:e.txid,commitmentTxid:"",arkTxid:""},amount:e.value,type:E.TxType.TxReceived,settled:"spent"===e.virtualStatus.state,createdAt:e.status.block_time?new Date(1e3*e.status.block_time).getTime():0};e.status.block_time?i.push(t):o.push(t)}return{boardingTxs:[...o,...i],commitmentsToIgnore:n}}async getBoardingUtxos(){const e=await this.getBoardingAddress(),t=await this.onchainProvider.getCoins(e),r=this.boardingTapscript.encode(),n=this.boardingTapscript.forfeit(),o=this.boardingTapscript.exit();return t.map(e=>({...e,forfeitTapLeafScript:n,intentTapLeafScript:o,tapTree:r}))}async sendBitcoin(e){if(e.amount<=0)throw new Error("Amount must be positive");if(!function(e){try{return h.ArkAddress.decode(e),!0}catch(e){return!1}}(e.address))throw new Error("Invalid Ark address "+e.address);const t=function(e,t){const r=[...e].sort((e,t)=>{const r=e.virtualStatus.batchExpiry||Number.MAX_SAFE_INTEGER,n=t.virtualStatus.batchExpiry||Number.MAX_SAFE_INTEGER;return r!==n?r-n:t.value-e.value}),n=[];let o=0;for(const e of r)if(n.push(e),o+=e.value,o>=t)break;if(o===t)return{inputs:n,changeAmount:0n};if(o<t)throw new Error("Insufficient funds");return{inputs:n,changeAmount:BigInt(o-t)}}(await this.getVirtualCoins({withRecoverable:!1}),e.amount),r=this.offchainTapscript.forfeit();if(!r)throw new Error("Selected leaf not found");const n=h.ArkAddress.decode(e.address),o=[{script:BigInt(e.amount)<this.dustAmount?n.subdustPkScript:n.pkScript,amount:BigInt(e.amount)}];if(t.changeAmount>0n){const e=t.changeAmount<this.dustAmount?this.arkAddress.subdustPkScript:this.arkAddress.pkScript;o.push({script:e,amount:BigInt(t.changeAmount)})}const i=this.offchainTapscript.encode();let s=(0,T.buildOffchainTx)(t.inputs.map(e=>({...e,tapLeafScript:r,tapTree:i})),o,this.serverUnrollScript);const c=await this.identity.sign(s.arkTx),{arkTxid:u,signedCheckpointTxs:l}=await this.arkProvider.submitTx(a.base64.encode(c.toPSBT()),s.checkpoints.map(e=>a.base64.encode(e.toPSBT()))),p=await Promise.all(l.map(async e=>{const t=d.Transaction.fromPSBT(a.base64.decode(e)),r=await this.identity.sign(t);return a.base64.encode(r.toPSBT())}));return await this.arkProvider.finalizeTx(u,p),u}async settle(e,t){if(e?.inputs)for(const t of e.inputs)if("string"==typeof t)try{A.ArkNote.fromString(t)}catch(e){throw new Error(`Invalid arknote "${t}"`)}if(!e){let t=0;const r=await this.getBoardingUtxos();t+=r.reduce((e,t)=>e+t.value,0);const n=await this.getVtxos();t+=n.reduce((e,t)=>e+t.value,0);const o=[...r,...n];if(0===o.length)throw new Error("No inputs found");e={inputs:o,outputs:[{address:await this.getAddress(),amount:BigInt(t)}]}}const r=[],n=[];let o,i=!1;for(const[t,o]of e.outputs.entries()){let e;try{e=h.ArkAddress.decode(o.address).pkScript,i=!0}catch{const n=(0,u.Address)(this.network).decode(o.address);e=u.OutScript.encode(n),r.push(t)}n.push({amount:o.amount,script:e})}const s=[];i&&(o=this.identity.signerSession(),s.push(a.hex.encode(o.getPublicKey())));const[c,d]=await Promise.all([this.makeRegisterIntentSignature(e.inputs,n,r,s),this.makeDeleteIntentSignature(e.inputs)]),l=await this.arkProvider.registerIntent(c),p=new AbortController;try{let r;const n=[...s,...e.inputs.map(e=>`${e.txid}:${e.vout}`)],c=this.arkProvider.getEventStream(p.signal,n);let u,d;const h=[],f=[];let g,y;for await(const n of c)switch(t&&t(n),n.type){case w.SettlementEventType.BatchFailed:if(n.id===u)throw new Error(n.reason);break;case w.SettlementEventType.BatchStarted:if(void 0!==r)continue;const t=await this.handleBatchStartedEvent(n,l,this.arkServerPublicKey,this.forfeitOutputScript);t.skip||(r=n.type,d=t.sweepTapTreeRoot,u=t.roundId,i||(r=w.SettlementEventType.TreeNoncesAggregated));break;case w.SettlementEventType.TreeTx:if(r!==w.SettlementEventType.BatchStarted&&r!==w.SettlementEventType.TreeNoncesAggregated)continue;if(0===n.batchIndex)h.push(n.chunk);else{if(1!==n.batchIndex)throw new Error(`Invalid batch index: ${n.batchIndex}`);f.push(n.chunk)}break;case w.SettlementEventType.TreeSignature:if(r!==w.SettlementEventType.TreeNoncesAggregated)continue;if(!i)continue;if(!g)throw new Error("Vtxo graph not set, something went wrong");if(0===n.batchIndex){const e=a.hex.decode(n.signature);g.update(n.txid,t=>{t.updateInput(0,{tapKeySig:e})})}break;case w.SettlementEventType.TreeSigningStarted:if(r!==w.SettlementEventType.BatchStarted)continue;if(i){if(!o)throw new Error("Signing session not set");if(!d)throw new Error("Sweep tap tree root not set");if(0===h.length)throw new Error("unsigned vtxo graph not received");g=P.TxTree.create(h),await this.handleSettlementSigningEvent(n,d,o,g)}r=n.type;break;case w.SettlementEventType.TreeNoncesAggregated:if(r!==w.SettlementEventType.TreeSigningStarted)continue;if(i){if(!o)throw new Error("Signing session not set");await this.handleSettlementSigningNoncesGeneratedEvent(n,o)}r=n.type;break;case w.SettlementEventType.BatchFinalization:if(r!==w.SettlementEventType.TreeNoncesAggregated)continue;if(!this.forfeitOutputScript)throw new Error("Forfeit output script not set");f.length>0&&(y=P.TxTree.create(f),(0,m.validateConnectorsTxGraph)(n.commitmentTx,y)),await this.handleSettlementFinalizationEvent(n,e.inputs,this.forfeitOutputScript,y),r=n.type;break;case w.SettlementEventType.BatchFinalized:if(r!==w.SettlementEventType.BatchFinalization)continue;return p.abort(),n.commitmentTxid}}catch(e){p.abort();try{await this.arkProvider.deleteIntent(d)}catch{}throw e}throw new Error("Settlement failed")}async notifyIncomingFunds(e){const t=await this.getAddress(),r=await this.getBoardingAddress();let n,o;if(this.onchainProvider&&r&&(n=await this.onchainProvider.watchAddresses([r],t=>{const n=t.map(e=>{const t=e.vout.findIndex(e=>e.scriptpubkey_address===r);return-1===t?(console.warn(`No vout found for address ${r} in transaction ${e.txid}`),null):{txid:e.txid,vout:t,value:Number(e.vout[t].value),status:e.status}}).filter(e=>null!==e);e({type:"utxo",coins:n})})),this.indexerProvider&&t){const t=this.offchainTapscript,r=await this.indexerProvider.subscribeForScripts([a.hex.encode(t.pkScript)]),n=new AbortController,i=this.indexerProvider.getSubscription(r,n.signal);o=async()=>{n.abort(),await(this.indexerProvider?.unsubscribeForScripts(r))},(async()=>{try{for await(const t of i)t.newVtxos?.length>0&&e({type:"vtxo",vtxos:t.newVtxos})}catch(e){console.error("Subscription error:",e)}})()}return()=>{n?.(),o?.()}}async handleBatchStartedEvent(e,t,r,n){const o=(new TextEncoder).encode(t),i=(0,S.sha256)(o),s=a.hex.encode(new Uint8Array(i));let c=!0;for(const r of e.intentIdHashes)if(r===s){if(!this.arkProvider)throw new Error("Ark provider not configured");await this.arkProvider.confirmRegistration(t),c=!1}if(c)return{skip:c};const d=x.CSVMultisigTapscript.encode({timelock:{value:e.batchExpiry,type:e.batchExpiry>=512n?"seconds":"blocks"},pubkeys:[r]}).script,l=(0,u.tapLeafHash)(d);return{roundId:e.id,sweepTapTreeRoot:l,forfeitOutputScript:n,skip:!1}}async handleSettlementSigningEvent(e,t,r,n){const o=d.Transaction.fromPSBT(a.base64.decode(e.unsignedCommitmentTx));(0,m.validateVtxoTxGraph)(n,o,t);const i=o.getOutput(0);if(!i?.amount)throw new Error("Shared output not found");r.init(n,t,i.amount),await this.arkProvider.submitTreeNonces(e.id,a.hex.encode(r.getPublicKey()),r.getNonces())}async handleSettlementSigningNoncesGeneratedEvent(e,t){t.setAggregatedNonces(e.treeNonces);const r=t.sign();await this.arkProvider.submitTreeSignatures(e.id,a.hex.encode(t.getPublicKey()),r)}async handleSettlementFinalizationEvent(e,t,r,n){const o=[],i=await this.getVirtualCoins();let s=d.Transaction.fromPSBT(a.base64.decode(e.commitmentTx)),c=!1,u=0;const l=n?.leaves()||[];for(const e of t){const t=i.find(t=>t.txid===e.txid&&t.vout===e.vout);if(!t){c=!0;const t=[];for(let r=0;r<s.inputsLength;r++){const n=s.getInput(r);if(!n.txid||void 0===n.index)throw new Error("The server returned incomplete data. No settlement input found in the PSBT");a.hex.encode(n.txid)===e.txid&&n.index===e.vout&&(s.updateInput(r,{tapLeafScript:[e.forfeitTapLeafScript]}),t.push(r))}s=await this.identity.sign(s,t);continue}if((0,E.isRecoverable)(t)||(0,E.isSubdust)(t,this.dustAmount))continue;if(0===l.length)throw new Error("connectors not received");if(u>=l.length)throw new Error("not enough connectors received");const n=l[u],p=a.hex.encode((0,S.sha256x2)(n.toBytes(!0)).reverse()),h=n.getOutput(0);if(!h)throw new Error("connector output not found");const f=h.amount,g=h.script;if(!f||!g)throw new Error("invalid connector output");u++;let y=(0,b.buildForfeitTx)([{txid:e.txid,index:e.vout,witnessUtxo:{amount:BigInt(t.value),script:v.VtxoScript.decode(e.tapTree).pkScript},sighashType:d.SigHash.DEFAULT,tapLeafScript:[e.forfeitTapLeafScript]},{txid:p,index:0,witnessUtxo:{amount:f,script:g}}],r);y=await this.identity.sign(y,[0]),o.push(a.base64.encode(y.toPSBT()))}(o.length>0||c)&&await this.arkProvider.submitSignedForfeitTxs(o,c?a.base64.encode(s.toPSBT()):void 0)}async makeRegisterIntentSignature(e,t,r,n){const o=Math.floor(Date.now()/1e3),{inputs:i,inputTapTrees:s,finalizer:a}=this.prepareBIP322Inputs(e),c={type:"register",input_tap_trees:s,onchain_output_indexes:r,valid_at:o,expire_at:o+120,cosigners_public_keys:n},u=JSON.stringify(c,null,0);return{signature:await this.makeBIP322Signature(u,i,a,t),message:u}}async makeDeleteIntentSignature(e){const t=Math.floor(Date.now()/1e3),{inputs:r,finalizer:n}=this.prepareBIP322Inputs(e),o={type:"delete",expire_at:t+120},i=JSON.stringify(o,null,0);return{signature:await this.makeBIP322Signature(i,r,n),message:i}}prepareBIP322Inputs(e){const t=[],r=[],n=[];for(const o of e){const e=v.VtxoScript.decode(o.tapTree),i=R(o);t.push({txid:a.hex.decode(o.txid),index:o.vout,witnessUtxo:{amount:BigInt(o.value),script:e.pkScript},sequence:i,tapLeafScript:[o.intentTapLeafScript]}),r.push(a.hex.encode(o.tapTree)),n.push(o.extraWitness||[])}return{inputs:t,inputTapTrees:r,finalizer:O(n)}}async makeBIP322Signature(e,t,r,n){const o=I.BIP322.create(e,t,n),i=await this.identity.sign(o);return I.BIP322.signature(i,r)}}function O(e){return function(t){for(let r=0;r<t.inputsLength;r++){try{t.finalizeIdx(r)}catch(e){if(e instanceof Error&&e.message.includes("finalize/taproot: empty witness")){const n=t.getInput(r).tapLeafScript;if(!n||n.length<=0)throw e;const[o,i]=n[0],s=i.slice(0,-1);t.updateInput(r,{finalScriptWitness:[s,l.TaprootControlBlock.encode(o)]})}}const n=t.getInput(r).finalScriptWitness;if(!n)throw new Error("input not finalized");const o=e[0===r?0:r-1];o&&o.length>0&&t.updateInput(r,{finalScriptWitness:[...o,...n]})}}}function R(e){let t;try{const r=e.intentTapLeafScript[1],n=r.subarray(0,r.length-1),o=x.CSVMultisigTapscript.decode(n).params;t=c.encode("blocks"===o.timelock.type?{blocks:Number(o.timelock.value)}:{seconds:Number(o.timelock.value)})}catch{}return t}t.Wallet=B,B.MIN_FEE_RATE=1},6629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TxTree=void 0;const n=r(5046),o=r(3203),i=r(3203),s=r(5031);class a{constructor(e,t=new Map){this.root=e,this.children=t}static create(e){if(0===e.length)throw new Error("empty chunks");const t=new Map;for(const r of e){const e=d(r),n=i.hex.encode((0,s.sha256x2)(e.tx.toBytes(!0)).reverse());t.set(n,e)}const r=[];for(const[e]of t){let n=!1;for(const[r,o]of t)if(r!==e&&(n=c(o,e),n))break;n||r.push(e)}if(0===r.length)throw new Error("no root chunk found");if(r.length>1)throw new Error(`multiple root chunks found: ${r.join(", ")}`);const n=u(r[0],t);if(!n)throw new Error(`chunk not found for root txid: ${r[0]}`);if(n.nbOfNodes()!==e.length)throw new Error(`number of chunks (${e.length}) is not equal to the number of nodes in the graph (${n.nbOfNodes()})`);return n}nbOfNodes(){let e=1;for(const t of this.children.values())e+=t.nbOfNodes();return e}validate(){if(!this.root)throw new Error("unexpected nil root");const e=this.root.outputsLength,t=this.root.inputsLength;if(1!==t)throw new Error(`unexpected number of inputs: ${t}, expected 1`);if(this.children.size>e-1)throw new Error(`unexpected number of children: ${this.children.size}, expected maximum ${e-1}`);for(const[t,r]of this.children){if(t>=e)throw new Error(`output index ${t} is out of bounds (nb of outputs: ${e})`);r.validate();const n=r.root.getInput(0),o=i.hex.encode((0,s.sha256x2)(this.root.toBytes(!0)).reverse());if(!n.txid||i.hex.encode(n.txid)!==o||n.index!==t)throw new Error(`input of child ${t} is not the output of the parent`);let a=0n;for(let e=0;e<r.root.outputsLength;e++){const t=r.root.getOutput(e);t?.amount&&(a+=t.amount)}const c=this.root.getOutput(t);if(!c?.amount)throw new Error(`parent output ${t} has no amount`);if(a!==c.amount)throw new Error(`sum of child's outputs is not equal to the output of the parent: ${a} != ${c.amount}`)}}leaves(){if(0===this.children.size)return[this.root];const e=[];for(const t of this.children.values())e.push(...t.leaves());return e}get txid(){return i.hex.encode((0,s.sha256x2)(this.root.toBytes(!0)).reverse())}find(e){if(e===this.txid)return this;for(const t of this.children.values()){const r=t.find(e);if(r)return r}return null}update(e,t){if(e!==this.txid){for(const r of this.children.values())try{return void r.update(e,t)}catch(e){continue}throw new Error(`tx not found: ${e}`)}t(this.root)}*[Symbol.iterator](){yield this;for(const e of this.children.values())yield*e}}function c(e,t){return Object.values(e.children).includes(t)}function u(e,t){const r=t.get(e);if(!r)return null;const n=r.tx,o=new Map;for(const[e,n]of Object.entries(r.children)){const r=parseInt(e),i=u(n,t);i&&o.set(r,i)}return new a(n,o)}function d(e){return{tx:n.Transaction.fromPSBT(o.base64.decode(e.tx)),children:e.children}}t.TxTree=a},6776:(e,t)=>{"use strict";var r;function n(e){return void 0===e.spentBy||""===e.spentBy}Object.defineProperty(t,"__esModule",{value:!0}),t.TxType=void 0,t.isSpendable=n,t.isRecoverable=function(e){return"swept"===e.virtualStatus.state&&n(e)},t.isSubdust=function(e,t){return e.value<t},function(e){e.TxSent="SENT",e.TxReceived="RECEIVED"}(r||(t.TxType=r={}))},6868:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildOffchainTx=function(e,t,r){const n=e.map(e=>function(e,t){const r=(0,o.decodeTapscript)(e.checkpointTapLeafScript??(0,i.scriptFromTapLeafScript)(e.tapLeafScript)),n=new i.VtxoScript([t.script,r.script]),s=d([e],[{amount:BigInt(e.value),script:n.pkScript}]),u=n.findLeaf(a.hex.encode(r.script)),l={txid:a.hex.encode((0,c.sha256x2)(s.toBytes(!0)).reverse()),vout:0,value:e.value,tapLeafScript:u,tapTree:n.encode()};return{tx:s,input:l}}(e,r));return{arkTx:d(n.map(e=>e.input),t),checkpoints:n.map(e=>e.tx)}};const n=r(5046),o=r(5780),i=r(9761),s=r(9145),a=r(3203),c=r(5031),u=r(9689);function d(e,t){let r=0n;for(const t of e){const e=(0,o.decodeTapscript)((0,i.scriptFromTapLeafScript)(t.tapLeafScript));if(o.CLTVMultisigTapscript.is(e)){if(0n!==r&&p(r)!==p(e.params.absoluteTimelock))throw new Error("cannot mix seconds and blocks locktime");e.params.absoluteTimelock>r&&(r=e.params.absoluteTimelock)}}const a=new n.Transaction({version:3,allowUnknown:!0,allowUnknownOutputs:!0,lockTime:Number(r)});for(const[t,o]of e.entries())a.addInput({txid:o.txid,index:o.vout,sequence:r?n.DEFAULT_SEQUENCE-1:void 0,witnessUtxo:{script:i.VtxoScript.decode(o.tapTree).pkScript,amount:BigInt(o.value)},tapLeafScript:[o.tapLeafScript]}),(0,u.setArkPsbtField)(a,t,u.VtxoTaprootTree,o.tapTree);for(const e of t)a.addOutput(e);return a.addOutput(s.P2A),a}const l=500000000n;function p(e){return e>=l}},7076:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha512_224=t.sha512_256=t.sha384=t.sha512=t.sha224=t.sha256=t.SHA512_256=t.SHA512_224=t.SHA384=t.SHA512=t.SHA224=t.SHA256=void 0;const n=r(7202),o=r(2318),i=r(9175),s=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new Uint32Array(64);class c extends n.HashMD{constructor(e=32){super(64,e,8,!1),this.A=0|n.SHA256_IV[0],this.B=0|n.SHA256_IV[1],this.C=0|n.SHA256_IV[2],this.D=0|n.SHA256_IV[3],this.E=0|n.SHA256_IV[4],this.F=0|n.SHA256_IV[5],this.G=0|n.SHA256_IV[6],this.H=0|n.SHA256_IV[7]}get(){const{A:e,B:t,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[e,t,r,n,o,i,s,a]}set(e,t,r,n,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)a[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=a[e-15],r=a[e-2],n=(0,i.rotr)(t,7)^(0,i.rotr)(t,18)^t>>>3,o=(0,i.rotr)(r,17)^(0,i.rotr)(r,19)^r>>>10;a[e]=o+a[e-7]+n+a[e-16]|0}let{A:r,B:o,C:c,D:u,E:d,F:l,G:p,H:h}=this;for(let e=0;e<64;e++){const t=h+((0,i.rotr)(d,6)^(0,i.rotr)(d,11)^(0,i.rotr)(d,25))+(0,n.Chi)(d,l,p)+s[e]+a[e]|0,f=((0,i.rotr)(r,2)^(0,i.rotr)(r,13)^(0,i.rotr)(r,22))+(0,n.Maj)(r,o,c)|0;h=p,p=l,l=d,d=u+t|0,u=c,c=o,o=r,r=t+f|0}r=r+this.A|0,o=o+this.B|0,c=c+this.C|0,u=u+this.D|0,d=d+this.E|0,l=l+this.F|0,p=p+this.G|0,h=h+this.H|0,this.set(r,o,c,u,d,l,p,h)}roundClean(){(0,i.clean)(a)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,i.clean)(this.buffer)}}t.SHA256=c;class u extends c{constructor(){super(28),this.A=0|n.SHA224_IV[0],this.B=0|n.SHA224_IV[1],this.C=0|n.SHA224_IV[2],this.D=0|n.SHA224_IV[3],this.E=0|n.SHA224_IV[4],this.F=0|n.SHA224_IV[5],this.G=0|n.SHA224_IV[6],this.H=0|n.SHA224_IV[7]}}t.SHA224=u;const d=(()=>o.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),l=(()=>d[0])(),p=(()=>d[1])(),h=new Uint32Array(80),f=new Uint32Array(80);class g extends n.HashMD{constructor(e=64){super(128,e,16,!1),this.Ah=0|n.SHA512_IV[0],this.Al=0|n.SHA512_IV[1],this.Bh=0|n.SHA512_IV[2],this.Bl=0|n.SHA512_IV[3],this.Ch=0|n.SHA512_IV[4],this.Cl=0|n.SHA512_IV[5],this.Dh=0|n.SHA512_IV[6],this.Dl=0|n.SHA512_IV[7],this.Eh=0|n.SHA512_IV[8],this.El=0|n.SHA512_IV[9],this.Fh=0|n.SHA512_IV[10],this.Fl=0|n.SHA512_IV[11],this.Gh=0|n.SHA512_IV[12],this.Gl=0|n.SHA512_IV[13],this.Hh=0|n.SHA512_IV[14],this.Hl=0|n.SHA512_IV[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:a,Eh:c,El:u,Fh:d,Fl:l,Gh:p,Gl:h,Hh:f,Hl:g}=this;return[e,t,r,n,o,i,s,a,c,u,d,l,p,h,f,g]}set(e,t,r,n,o,i,s,a,c,u,d,l,p,h,f,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|d,this.Fl=0|l,this.Gh=0|p,this.Gl=0|h,this.Hh=0|f,this.Hl=0|g}process(e,t){for(let r=0;r<16;r++,t+=4)h[r]=e.getUint32(t),f[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|h[e-15],r=0|f[e-15],n=o.rotrSH(t,r,1)^o.rotrSH(t,r,8)^o.shrSH(t,r,7),i=o.rotrSL(t,r,1)^o.rotrSL(t,r,8)^o.shrSL(t,r,7),s=0|h[e-2],a=0|f[e-2],c=o.rotrSH(s,a,19)^o.rotrBH(s,a,61)^o.shrSH(s,a,6),u=o.rotrSL(s,a,19)^o.rotrBL(s,a,61)^o.shrSL(s,a,6),d=o.add4L(i,u,f[e-7],f[e-16]),l=o.add4H(d,n,c,h[e-7],h[e-16]);h[e]=0|l,f[e]=0|d}let{Ah:r,Al:n,Bh:i,Bl:s,Ch:a,Cl:c,Dh:u,Dl:d,Eh:g,El:y,Fh:w,Fl:b,Gh:m,Gl:E,Hh:S,Hl:v}=this;for(let e=0;e<80;e++){const t=o.rotrSH(g,y,14)^o.rotrSH(g,y,18)^o.rotrBH(g,y,41),x=o.rotrSL(g,y,14)^o.rotrSL(g,y,18)^o.rotrBL(g,y,41),T=g&w^~g&m,A=y&b^~y&E,I=o.add5L(v,x,A,p[e],f[e]),k=o.add5H(I,S,t,T,l[e],h[e]),P=0|I,B=o.rotrSH(r,n,28)^o.rotrBH(r,n,34)^o.rotrBH(r,n,39),O=o.rotrSL(r,n,28)^o.rotrBL(r,n,34)^o.rotrBL(r,n,39),R=r&i^r&a^i&a,_=n&s^n&c^s&c;S=0|m,v=0|E,m=0|w,E=0|b,w=0|g,b=0|y,({h:g,l:y}=o.add(0|u,0|d,0|k,0|P)),u=0|a,d=0|c,a=0|i,c=0|s,i=0|r,s=0|n;const U=o.add3L(P,O,_);r=o.add3H(U,k,B,R),n=0|U}({h:r,l:n}=o.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:s}=o.add(0|this.Bh,0|this.Bl,0|i,0|s)),({h:a,l:c}=o.add(0|this.Ch,0|this.Cl,0|a,0|c)),({h:u,l:d}=o.add(0|this.Dh,0|this.Dl,0|u,0|d)),({h:g,l:y}=o.add(0|this.Eh,0|this.El,0|g,0|y)),({h:w,l:b}=o.add(0|this.Fh,0|this.Fl,0|w,0|b)),({h:m,l:E}=o.add(0|this.Gh,0|this.Gl,0|m,0|E)),({h:S,l:v}=o.add(0|this.Hh,0|this.Hl,0|S,0|v)),this.set(r,n,i,s,a,c,u,d,g,y,w,b,m,E,S,v)}roundClean(){(0,i.clean)(h,f)}destroy(){(0,i.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}t.SHA512=g;class y extends g{constructor(){super(48),this.Ah=0|n.SHA384_IV[0],this.Al=0|n.SHA384_IV[1],this.Bh=0|n.SHA384_IV[2],this.Bl=0|n.SHA384_IV[3],this.Ch=0|n.SHA384_IV[4],this.Cl=0|n.SHA384_IV[5],this.Dh=0|n.SHA384_IV[6],this.Dl=0|n.SHA384_IV[7],this.Eh=0|n.SHA384_IV[8],this.El=0|n.SHA384_IV[9],this.Fh=0|n.SHA384_IV[10],this.Fl=0|n.SHA384_IV[11],this.Gh=0|n.SHA384_IV[12],this.Gl=0|n.SHA384_IV[13],this.Hh=0|n.SHA384_IV[14],this.Hl=0|n.SHA384_IV[15]}}t.SHA384=y;const w=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),b=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class m extends g{constructor(){super(28),this.Ah=0|w[0],this.Al=0|w[1],this.Bh=0|w[2],this.Bl=0|w[3],this.Ch=0|w[4],this.Cl=0|w[5],this.Dh=0|w[6],this.Dl=0|w[7],this.Eh=0|w[8],this.El=0|w[9],this.Fh=0|w[10],this.Fl=0|w[11],this.Gh=0|w[12],this.Gl=0|w[13],this.Hh=0|w[14],this.Hl=0|w[15]}}t.SHA512_224=m;class E extends g{constructor(){super(32),this.Ah=0|b[0],this.Al=0|b[1],this.Bh=0|b[2],this.Bl=0|b[3],this.Ch=0|b[4],this.Cl=0|b[5],this.Dh=0|b[6],this.Dl=0|b[7],this.Eh=0|b[8],this.El=0|b[9],this.Fh=0|b[10],this.Fl=0|b[11],this.Gh=0|b[12],this.Gl=0|b[13],this.Hh=0|b[14],this.Hl=0|b[15]}}t.SHA512_256=E,t.sha256=(0,i.createHasher)(()=>new c),t.sha224=(0,i.createHasher)(()=>new u),t.sha512=(0,i.createHasher)(()=>new g),t.sha384=(0,i.createHasher)(()=>new y),t.sha512_256=(0,i.createHasher)(()=>new E),t.sha512_224=(0,i.createHasher)(()=>new m)},7202:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA512_IV=t.SHA384_IV=t.SHA224_IV=t.SHA256_IV=t.HashMD=void 0,t.setBigUint64=o,t.Chi=function(e,t,r){return e&t^~e&r},t.Maj=function(e,t,r){return e&t^e&r^t&r};const n=r(9175);function o(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+u,a,n)}class i extends n.Hash{constructor(e,t,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){(0,n.aexists)(this),e=(0,n.toBytes)(e),(0,n.abytes)(e);const{view:t,buffer:r,blockLen:o}=this,i=e.length;for(let s=0;s<i;){const a=Math.min(o-this.pos,i-s);if(a===o){const t=(0,n.createView)(e);for(;o<=i-s;s+=o)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,n.aexists)(this),(0,n.aoutput)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:a}=this;t[a++]=128,(0,n.clean)(this.buffer.subarray(a)),this.padOffset>i-a&&(this.process(r,0),a=0);for(let e=a;e<i;e++)t[e]=0;o(r,i-8,BigInt(8*this.length),s),this.process(r,0);const c=(0,n.createView)(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=u/4,l=this.get();if(d>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)c.setUint32(4*e,l[e],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return e.destroyed=i,e.finished=o,e.length=n,e.pos=s,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}t.HashMD=i,t.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),t.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),t.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),t.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209])},7338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=t.SigHash=t.SignatureHash=t.def=t.Decimal=t.DEFAULT_SEQUENCE=t.DEFAULT_LOCKTIME=t.DEFAULT_VERSION=t.PRECISION=t.toVsize=void 0,t.cloneDeep=p,t.inputBeforeSign=y,t.getPrevOut=v,t.normalizeInput=x,t.getInputType=T,t.PSBTCombine=function(e){if(!e||!Array.isArray(e)||!e.length)throw new Error("PSBTCombine: wrong PSBT list");const t=A.fromPSBT(e[0]);for(let r=1;r<e.length;r++)t.combine(A.fromPSBT(e[r]));return t.toPSBT()},t.bip32Path=function(e){const t=[];if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return t;const r=e.replace(/^[mM]'?\//,"").split("/");for(const e of r){const r=/^(\d+)('?)$/.exec(e);if(!r||3!==r.length)throw new Error(`Invalid child index: ${e}`);let n=+r[1];if(!Number.isSafeInteger(n)||n>=I)throw new Error("Invalid index");"'"===r[2]&&(n+=I),t.push(n)}return t};const n=r(3203),o=r(2954),i=r(8120),s=r(227),a=r(5327),c=r(5031),u=r(5031),d=new Uint8Array(32),l={amount:0xffffffffffffffffn,script:o.EMPTY};function p(e){if(Array.isArray(e))return e.map(e=>p(e));if((0,u.isBytes)(e))return Uint8Array.from(e);if(["number","bigint","boolean","string","undefined"].includes(typeof e))return e;if(null===e)return e;if("object"==typeof e)return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,p(t)]));throw new Error(`cloneDeep: unknown type=${e} (${typeof e})`)}var h,f;function g(e){if(void 0===e.script||void 0===e.amount)throw new Error("Transaction/output: script and amount required");return{script:e.script,amount:e.amount}}function y(e){if(void 0===e.txid||void 0===e.index)throw new Error("Transaction/input: txid and index required");return{txid:e.txid,index:e.index,sequence:(0,t.def)(e.sequence,t.DEFAULT_SEQUENCE),finalScriptSig:(0,t.def)(e.finalScriptSig,o.EMPTY)}}function w(e){for(const t in e){const r=t;s.PSBTInputFinalKeys.includes(r)||delete e[r]}}t.toVsize=e=>Math.ceil(e/4),t.PRECISION=8,t.DEFAULT_VERSION=2,t.DEFAULT_LOCKTIME=0,t.DEFAULT_SEQUENCE=4294967295,t.Decimal=o.coders.decimal(t.PRECISION),t.def=(e,t)=>void 0===e?t:e,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ALL=1]="ALL",e[e.NONE=2]="NONE",e[e.SINGLE=3]="SINGLE",e[e.ANYONECANPAY=128]="ANYONECANPAY"}(h||(t.SignatureHash=h={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ALL=1]="ALL",e[e.NONE=2]="NONE",e[e.SINGLE=3]="SINGLE",e[e.DEFAULT_ANYONECANPAY=128]="DEFAULT_ANYONECANPAY",e[e.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",e[e.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",e[e.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY"}(f||(t.SigHash=f={}));const b=o.struct({txid:o.bytes(32,!0),index:o.U32LE});function m(e){if("number"!=typeof e||"string"!=typeof f[e])throw new Error(`Invalid SigHash=${e}`);return e}function E(e){const t=31&e;return{isAny:!!(e&h.ANYONECANPAY),isNone:t===h.NONE,isSingle:t===h.SINGLE}}function S(e){if(e.nonWitnessUtxo&&void 0!==e.index){const t=e.nonWitnessUtxo.outputs.length-1;if(e.index>t)throw new Error(`validateInput: index(${e.index}) not in nonWitnessUtxo`);const r=e.nonWitnessUtxo.outputs[e.index];if(e.witnessUtxo&&(!(0,u.equalBytes)(e.witnessUtxo.script,r.script)||e.witnessUtxo.amount!==r.amount))throw new Error("validateInput: witnessUtxo different from nonWitnessUtxo");if(e.txid){if(e.nonWitnessUtxo.outputs.length-1<e.index)throw new Error("nonWitnessUtxo: incorect output index");const t=A.fromRaw(a.RawTx.encode(e.nonWitnessUtxo),{allowUnknownOutputs:!0,disableScriptCheck:!0,allowUnknownInputs:!0}),r=n.hex.encode(e.txid);if(t.isFinal&&t.id!==r)throw new Error(`nonWitnessUtxo: wrong txid, exp=${r} got=${t.id}`)}}return e}function v(e){if(e.nonWitnessUtxo){if(void 0===e.index)throw new Error("Unknown input index");return e.nonWitnessUtxo.outputs[e.index]}if(e.witnessUtxo)return e.witnessUtxo;throw new Error("Cannot find previous output info")}function x(e,r,o,c=!1,d=!1){let{nonWitnessUtxo:l,txid:p}=e;"string"==typeof l&&(l=n.hex.decode(l)),(0,u.isBytes)(l)&&(l=a.RawTx.decode(l)),"nonWitnessUtxo"in e||void 0!==l||(l=r?.nonWitnessUtxo),"string"==typeof p&&(p=n.hex.decode(p)),void 0===p&&(p=r?.txid);let h,f={...r,...e,nonWitnessUtxo:l,txid:p};return"nonWitnessUtxo"in e||void 0!==f.nonWitnessUtxo||delete f.nonWitnessUtxo,void 0===f.sequence&&(f.sequence=t.DEFAULT_SEQUENCE),null===f.tapMerkleRoot&&delete f.tapMerkleRoot,f=s.mergeKeyMap(s.PSBTInput,f,r,o,d),s.PSBTInputCoder.encode(f),f.nonWitnessUtxo&&void 0!==f.index?h=f.nonWitnessUtxo.outputs[f.index]:f.witnessUtxo&&(h=f.witnessUtxo),h&&!c&&(0,i.checkScript)(h&&h.script,f.redeemScript,f.witnessScript),f}function T(e,t=!1){let r="legacy",n=h.ALL;const o=v(e),s=i.OutScript.decode(o.script);let a=s.type,c=s;const u=[s];if("tr"===s.type)return n=h.DEFAULT,{txType:"taproot",type:"tr",last:s,lastScript:o.script,defaultSighash:n,sighash:e.sighashType||n};{if("wpkh"!==s.type&&"wsh"!==s.type||(r="segwit"),"sh"===s.type){if(!e.redeemScript)throw new Error("inputType: sh without redeemScript");let t=i.OutScript.decode(e.redeemScript);"wpkh"!==t.type&&"wsh"!==t.type||(r="segwit"),u.push(t),c=t,a+=`-${t.type}`}if("wsh"===c.type){if(!e.witnessScript)throw new Error("inputType: wsh without witnessScript");let t=i.OutScript.decode(e.witnessScript);"wsh"===t.type&&(r="segwit"),u.push(t),c=t,a+=`-${t.type}`}const o=u[u.length-1];if("sh"===o.type||"wsh"===o.type)throw new Error("inputType: sh/wsh cannot be terminal type");const d={type:a,txType:r,last:o,lastScript:i.OutScript.encode(o),defaultSighash:n,sighash:e.sighashType||n};if("legacy"===r&&!t&&!e.nonWitnessUtxo)throw new Error("Transaction/sign: legacy input without nonWitnessUtxo, can result in attack that forces paying higher fees. Pass allowLegacyWitnessUtxo=true, if you sure");return d}}class A{constructor(e={}){this.global={},this.inputs=[],this.outputs=[];const r=this.opts=function(e){if(void 0!==e&&"[object Object]"!=={}.toString.call(e))throw new Error(`Wrong object type for transaction options: ${e}`);const r={...e,version:(0,t.def)(e.version,t.DEFAULT_VERSION),lockTime:(0,t.def)(e.lockTime,0),PSBTVersion:(0,t.def)(e.PSBTVersion,0)};if(void 0!==r.allowUnknowInput&&(e.allowUnknownInputs=r.allowUnknowInput),void 0!==r.allowUnknowOutput&&(e.allowUnknownOutputs=r.allowUnknowOutput),"number"!=typeof r.lockTime)throw new Error("Transaction lock time should be number");if(o.U32LE.encode(r.lockTime),0!==r.PSBTVersion&&2!==r.PSBTVersion)throw new Error(`Unknown PSBT version ${r.PSBTVersion}`);for(const e of["allowUnknownVersion","allowUnknownOutputs","allowUnknownInputs","disableScriptCheck","bip174jsCompat","allowLegacyWitnessUtxo","lowR"]){const t=r[e];if(void 0!==t&&"boolean"!=typeof t)throw new Error(`Transation options wrong type: ${e}=${t} (${typeof t})`)}if(r.allowUnknownVersion?"number"==typeof r.version:![-1,0,1,2,3].includes(r.version))throw new Error(`Unknown version: ${r.version}`);if(void 0!==r.customScripts){const e=r.customScripts;if(!Array.isArray(e))throw new Error(`wrong custom scripts type (expected array): customScripts=${e} (${typeof e})`);for(const t of e){if("function"!=typeof t.encode||"function"!=typeof t.decode)throw new Error(`wrong script=${t} (${typeof t})`);if(void 0!==t.finalizeTaproot&&"function"!=typeof t.finalizeTaproot)throw new Error(`wrong script=${t} (${typeof t})`)}}return Object.freeze(r)}(e);r.lockTime!==t.DEFAULT_LOCKTIME&&(this.global.fallbackLocktime=r.lockTime),this.global.txVersion=r.version}static fromRaw(e,t={}){const r=a.RawTx.decode(e),n=new A({...t,version:r.version,lockTime:r.lockTime});for(const e of r.outputs)n.addOutput(e);if(n.outputs=r.outputs,n.inputs=r.inputs,r.witnesses)for(let e=0;e<r.witnesses.length;e++)n.inputs[e].finalScriptWitness=r.witnesses[e];return n}static fromPSBT(e,r={}){let n;try{n=s.RawPSBTV0.decode(e)}catch(t){try{n=s.RawPSBTV2.decode(e)}catch(e){throw t}}const i=n.global.version||0;if(0!==i&&2!==i)throw new Error(`Wrong PSBT version=${i}`);const a=n.global.unsignedTx,c=0===i?a?.version:n.global.txVersion,u=0===i?a?.lockTime:n.global.fallbackLocktime,d=new A({...r,version:c,lockTime:u,PSBTVersion:i}),l=0===i?a?.inputs.length:n.global.inputCount;d.inputs=n.inputs.slice(0,l).map((e,t)=>S({finalScriptSig:o.EMPTY,...n.global.unsignedTx?.inputs[t],...e}));const p=0===i?a?.outputs.length:n.global.outputCount;return d.outputs=n.outputs.slice(0,p).map((e,t)=>({...e,...n.global.unsignedTx?.outputs[t]})),d.global={...n.global,txVersion:c},u!==t.DEFAULT_LOCKTIME&&(d.global.fallbackLocktime=u),d}toPSBT(e=this.opts.PSBTVersion){if(0!==e&&2!==e)throw new Error(`Wrong PSBT version=${e}`);const r=this.inputs.map(t=>S(s.cleanPSBTFields(e,s.PSBTInput,t)));for(const e of r)e.partialSig&&!e.partialSig.length&&delete e.partialSig,e.finalScriptSig&&!e.finalScriptSig.length&&delete e.finalScriptSig,e.finalScriptWitness&&!e.finalScriptWitness.length&&delete e.finalScriptWitness;const n=this.outputs.map(t=>s.cleanPSBTFields(e,s.PSBTOutput,t)),i={...this.global};return 0===e?(i.unsignedTx=a.RawOldTx.decode(a.RawOldTx.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(y).map(e=>({...e,finalScriptSig:o.EMPTY})),outputs:this.outputs.map(g)})),delete i.fallbackLocktime,delete i.txVersion):(i.version=e,i.txVersion=this.version,i.inputCount=this.inputs.length,i.outputCount=this.outputs.length,i.fallbackLocktime&&i.fallbackLocktime===t.DEFAULT_LOCKTIME&&delete i.fallbackLocktime),this.opts.bip174jsCompat&&(r.length||r.push({}),n.length||n.push({})),(0===e?s.RawPSBTV0:s.RawPSBTV2).encode({global:i,inputs:r,outputs:n})}get lockTime(){let e=t.DEFAULT_LOCKTIME,r=0,n=t.DEFAULT_LOCKTIME,o=0;for(const t of this.inputs)t.requiredHeightLocktime&&(e=Math.max(e,t.requiredHeightLocktime),r++),t.requiredTimeLocktime&&(n=Math.max(n,t.requiredTimeLocktime),o++);return r&&r>=o?e:n!==t.DEFAULT_LOCKTIME?n:this.global.fallbackLocktime||t.DEFAULT_LOCKTIME}get version(){if(void 0===this.global.txVersion)throw new Error("No global.txVersion");return this.global.txVersion}inputStatus(e){this.checkInputIdx(e);const t=this.inputs[e];return t.finalScriptSig&&t.finalScriptSig.length||t.finalScriptWitness&&t.finalScriptWitness.length?"finalized":t.tapKeySig||t.tapScriptSig&&t.tapScriptSig.length||t.partialSig&&t.partialSig.length?"signed":"unsigned"}inputSighash(e){this.checkInputIdx(e);const t=this.inputs[e].sighashType,r=void 0===t?h.DEFAULT:t,n=r===h.DEFAULT?h.ALL:3&r;return{sigInputs:r&h.ANYONECANPAY,sigOutputs:n}}signStatus(){let e=!0,t=!0,r=[],n=[];for(let o=0;o<this.inputs.length;o++){if("unsigned"===this.inputStatus(o))continue;const{sigInputs:i,sigOutputs:s}=this.inputSighash(o);if(i===h.ANYONECANPAY?r.push(o):e=!1,s===h.ALL)t=!1;else if(s===h.SINGLE)n.push(o);else if(s!==h.NONE)throw new Error(`Wrong signature hash output type: ${s}`)}return{addInput:e,addOutput:t,inputs:r,outputs:n}}get isFinal(){for(let e=0;e<this.inputs.length;e++)if("finalized"!==this.inputStatus(e))return!1;return!0}get hasWitnesses(){let e=!1;for(const t of this.inputs)t.finalScriptWitness&&t.finalScriptWitness.length&&(e=!0);return e}get weight(){if(!this.isFinal)throw new Error("Transaction is not finalized");let e=32;const t=this.outputs.map(g);e+=4*a.CompactSizeLen.encode(this.outputs.length).length;for(const r of t)e+=32+4*a.VarBytes.encode(r.script).length;this.hasWitnesses&&(e+=2),e+=4*a.CompactSizeLen.encode(this.inputs.length).length;for(const t of this.inputs)e+=160+4*a.VarBytes.encode(t.finalScriptSig||o.EMPTY).length,this.hasWitnesses&&t.finalScriptWitness&&(e+=a.RawWitness.encode(t.finalScriptWitness).length);return e}get vsize(){return(0,t.toVsize)(this.weight)}toBytes(e=!1,t=!1){return a.RawTx.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(y).map(t=>({...t,finalScriptSig:e&&t.finalScriptSig||o.EMPTY})),outputs:this.outputs.map(g),witnesses:this.inputs.map(e=>e.finalScriptWitness||[]),segwitFlag:t&&this.hasWitnesses})}get unsignedTx(){return this.toBytes(!1,!1)}get hex(){return n.hex.encode(this.toBytes(!0,this.hasWitnesses))}get hash(){if(!this.isFinal)throw new Error("Transaction is not finalized");return n.hex.encode(c.sha256x2(this.toBytes(!0)))}get id(){if(!this.isFinal)throw new Error("Transaction is not finalized");return n.hex.encode(c.sha256x2(this.toBytes(!0)).reverse())}checkInputIdx(e){if(!Number.isSafeInteger(e)||0>e||e>=this.inputs.length)throw new Error(`Wrong input index=${e}`)}getInput(e){return this.checkInputIdx(e),p(this.inputs[e])}get inputsLength(){return this.inputs.length}addInput(e,t=!1){if(!t&&!this.signStatus().addInput)throw new Error("Tx has signed inputs, cannot add new one");return this.inputs.push(x(e,void 0,void 0,this.opts.disableScriptCheck)),this.inputs.length-1}updateInput(e,t,r=!1){let n;if(this.checkInputIdx(e),!r){const t=this.signStatus();t.addInput&&!t.inputs.includes(e)||(n=s.PSBTInputUnsignedKeys)}this.inputs[e]=x(t,this.inputs[e],n,this.opts.disableScriptCheck,this.opts.allowUnknown)}checkOutputIdx(e){if(!Number.isSafeInteger(e)||0>e||e>=this.outputs.length)throw new Error(`Wrong output index=${e}`)}getOutput(e){return this.checkOutputIdx(e),p(this.outputs[e])}getOutputAddress(e,t=u.NETWORK){const r=this.getOutput(e);if(r.script)return(0,i.Address)(t).encode(i.OutScript.decode(r.script))}get outputsLength(){return this.outputs.length}normalizeOutput(e,t,r){let{amount:o,script:a}=e;if(void 0===o&&(o=t?.amount),"bigint"!=typeof o)throw new Error(`Wrong amount type, should be of type bigint in sats, but got ${o} of type ${typeof o}`);"string"==typeof a&&(a=n.hex.decode(a)),void 0===a&&(a=t?.script);let c={...t,...e,amount:o,script:a};if(void 0===c.amount&&delete c.amount,c=s.mergeKeyMap(s.PSBTOutput,c,t,r,this.opts.allowUnknown),s.PSBTOutputCoder.encode(c),c.script&&!this.opts.allowUnknownOutputs&&"unknown"===i.OutScript.decode(c.script).type)throw new Error("Transaction/output: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownOutputs=true, if you sure");return this.opts.disableScriptCheck||(0,i.checkScript)(c.script,c.redeemScript,c.witnessScript),c}addOutput(e,t=!1){if(!t&&!this.signStatus().addOutput)throw new Error("Tx has signed outputs, cannot add new one");return this.outputs.push(this.normalizeOutput(e)),this.outputs.length-1}updateOutput(e,t,r=!1){let n;if(this.checkOutputIdx(e),!r){const t=this.signStatus();t.addOutput&&!t.outputs.includes(e)||(n=s.PSBTOutputUnsignedKeys)}this.outputs[e]=this.normalizeOutput(t,this.outputs[e],n)}addOutputAddress(e,t,r=u.NETWORK){return this.addOutput({script:i.OutScript.encode((0,i.Address)(r).decode(e)),amount:t})}get fee(){let e=0n;for(const t of this.inputs){const r=v(t);if(!r)throw new Error("Empty input amount");e+=r.amount}const t=this.outputs.map(g);for(const r of t)e-=r.amount;return e}preimageLegacy(e,t,r){const{isAny:n,isNone:i,isSingle:s}=E(r);if(e<0||!Number.isSafeInteger(e))throw new Error(`Invalid input idx=${e}`);if(s&&e>=this.outputs.length||e>=this.inputs.length)return o.U256BE.encode(1n);t=a.Script.encode(a.Script.decode(t).filter(e=>"CODESEPARATOR"!==e));let u=this.inputs.map(y).map((r,n)=>({...r,finalScriptSig:n===e?t:o.EMPTY}));n?u=[u[e]]:(i||s)&&(u=u.map((t,r)=>({...t,sequence:r===e?t.sequence:0})));let d=this.outputs.map(g);i?d=[]:s&&(d=d.slice(0,e).fill(l).concat([d[e]]));const p=a.RawTx.encode({lockTime:this.lockTime,version:this.version,segwitFlag:!1,inputs:u,outputs:d});return c.sha256x2(p,o.I32LE.encode(r))}preimageWitnessV0(e,t,r,n){const{isAny:i,isNone:s,isSingle:u}=E(r);let l=d,p=d,h=d;const f=this.inputs.map(y),w=this.outputs.map(g);i||(l=c.sha256x2(...f.map(b.encode))),i||u||s||(p=c.sha256x2(...f.map(e=>o.U32LE.encode(e.sequence)))),u||s?u&&e<w.length&&(h=c.sha256x2(a.RawOutput.encode(w[e]))):h=c.sha256x2(...w.map(a.RawOutput.encode));const m=f[e];return c.sha256x2(o.I32LE.encode(this.version),l,p,o.bytes(32,!0).encode(m.txid),o.U32LE.encode(m.index),a.VarBytes.encode(t),o.U64LE.encode(n),o.U32LE.encode(m.sequence),h,o.U32LE.encode(this.lockTime),o.U32LE.encode(r))}preimageWitnessV1(e,t,r,n,s=-1,l,p=192,f){if(!Array.isArray(n)||this.inputs.length!==n.length)throw new Error(`Invalid amounts array=${n}`);if(!Array.isArray(t)||this.inputs.length!==t.length)throw new Error(`Invalid prevOutScript array=${t}`);const w=[o.U8.encode(0),o.U8.encode(r),o.I32LE.encode(this.version),o.U32LE.encode(this.lockTime)],m=r===h.DEFAULT?h.ALL:3&r,E=r&h.ANYONECANPAY,S=this.inputs.map(y),v=this.outputs.map(g);E!==h.ANYONECANPAY&&w.push(...[S.map(b.encode),n.map(o.U64LE.encode),t.map(a.VarBytes.encode),S.map(e=>o.U32LE.encode(e.sequence))].map(e=>c.sha256((0,u.concatBytes)(...e)))),m===h.ALL&&w.push(c.sha256((0,u.concatBytes)(...v.map(a.RawOutput.encode))));const x=(f?1:0)|(l?2:0);if(w.push(new Uint8Array([x])),E===h.ANYONECANPAY){const r=S[e];w.push(b.encode(r),o.U64LE.encode(n[e]),a.VarBytes.encode(t[e]),o.U32LE.encode(r.sequence))}else w.push(o.U32LE.encode(e));return 1&x&&w.push(c.sha256(a.VarBytes.encode(f||o.EMPTY))),m===h.SINGLE&&w.push(e<v.length?c.sha256(a.RawOutput.encode(v[e])):d),l&&w.push((0,i.tapLeafHash)(l,p),o.U8.encode(0),o.I32LE.encode(s)),c.tagSchnorr("TapSighash",...w)}signIdx(e,t,r,n){this.checkInputIdx(t);const s=this.inputs[t],d=T(s,this.opts.allowLegacyWitnessUtxo);if(!(0,u.isBytes)(e)){if(!s.bip32Derivation||!s.bip32Derivation.length)throw new Error("bip32Derivation: empty");const r=s.bip32Derivation.filter(t=>t[1].fingerprint==e.fingerprint).map(([t,{path:r}])=>{let n=e;for(const e of r)n=n.deriveChild(e);if(!(0,u.equalBytes)(n.publicKey,t))throw new Error("bip32Derivation: wrong pubKey");if(!n.privateKey)throw new Error("bip32Derivation: no privateKey");return n});if(!r.length)throw new Error(`bip32Derivation: no items with fingerprint=${e.fingerprint}`);let n=!1;for(const e of r)this.signIdx(e.privateKey,t)&&(n=!0);return n}r?r.forEach(m):r=[d.defaultSighash];const l=d.sighash;if(!r.includes(l))throw new Error(`Input with not allowed sigHash=${l}. Allowed: ${r.join(", ")}`);const{sigOutputs:p}=this.inputSighash(t);if(p===h.SINGLE&&t>=this.outputs.length)throw new Error(`Input with sighash SINGLE, but there is no output with corresponding index=${t}`);const f=v(s);if("taproot"===d.txType){const r=this.inputs.map(v),d=r.map(e=>e.script),p=r.map(e=>e.amount);let f=!1,g=c.pubSchnorr(e),y=s.tapMerkleRoot||o.EMPTY;if(s.tapInternalKey){const{pubKey:r,privKey:i}=function(e,t,r,n=o.EMPTY){return(0,u.equalBytes)(r,t)&&(e=c.taprootTweakPrivKey(e,n),t=c.pubSchnorr(e)),{privKey:e,pubKey:t}}(e,g,s.tapInternalKey,y),[a,w]=c.taprootTweakPubkey(s.tapInternalKey,y);if((0,u.equalBytes)(a,r)){const e=this.preimageWitnessV1(t,d,l,p),r=(0,u.concatBytes)(c.signSchnorr(e,i,n),l!==h.DEFAULT?new Uint8Array([l]):o.EMPTY);this.updateInput(t,{tapKeySig:r},!0),f=!0}}if(s.tapLeafScript){s.tapScriptSig=s.tapScriptSig||[];for(const[r,y]of s.tapLeafScript){const r=y.subarray(0,-1),s=a.Script.decode(r),w=y[y.length-1],b=(0,i.tapLeafHash)(r,w);if(-1===s.findIndex(e=>(0,u.isBytes)(e)&&(0,u.equalBytes)(e,g)))continue;const m=this.preimageWitnessV1(t,d,l,p,void 0,r,w),E=(0,u.concatBytes)(c.signSchnorr(m,e,n),l!==h.DEFAULT?new Uint8Array([l]):o.EMPTY);this.updateInput(t,{tapScriptSig:[[{pubKey:g,leafHash:b},E]]},!0),f=!0}}if(!f)throw new Error("No taproot scripts signed");return!0}{const r=c.pubECDSA(e);let n=!1;const o=c.hash160(r);for(const e of a.Script.decode(d.lastScript))(0,u.isBytes)(e)&&((0,u.equalBytes)(e,r)||(0,u.equalBytes)(e,o))&&(n=!0);if(!n)throw new Error(`Input script doesn't have pubKey: ${d.lastScript}`);let s;if("legacy"===d.txType)s=this.preimageLegacy(t,d.lastScript,l);else{if("segwit"!==d.txType)throw new Error(`Transaction/sign: unknown tx type: ${d.txType}`);{let e=d.lastScript;"wpkh"===d.last.type&&(e=i.OutScript.encode({type:"pkh",hash:d.last.hash})),s=this.preimageWitnessV0(t,e,l,f.amount)}}const p=c.signECDSA(s,e,this.opts.lowR);this.updateInput(t,{partialSig:[[r,(0,u.concatBytes)(p,new Uint8Array([l]))]]},!0)}return!0}sign(e,t,r){let n=0;for(let o=0;o<this.inputs.length;o++)try{this.signIdx(e,o,t,r)&&n++}catch(e){}if(!n)throw new Error("No inputs signed");return n}finalizeIdx(e){if(this.checkInputIdx(e),this.fee<0n)throw new Error("Outputs spends more than inputs amount");const t=this.inputs[e],r=T(t,this.opts.allowLegacyWitnessUtxo);if("taproot"===r.txType){if(t.tapKeySig)t.finalScriptWitness=[t.tapKeySig];else{if(!t.tapLeafScript||!t.tapScriptSig)throw new Error("finalize/taproot: unknown input");{const e=t.tapLeafScript.sort((e,t)=>s.TaprootControlBlock.encode(e[0]).length-s.TaprootControlBlock.encode(t[0]).length);for(const[r,n]of e){const e=n.slice(0,-1),c=n[n.length-1],d=i.OutScript.decode(e),l=(0,i.tapLeafHash)(e,c),p=t.tapScriptSig.filter(e=>(0,u.equalBytes)(e[0].leafHash,l));let h=[];if("tr_ms"===d.type){const e=d.m,t=d.pubkeys;let r=0;for(const n of t){const t=p.findIndex(e=>(0,u.equalBytes)(e[0].pubKey,n));r!==e&&-1!==t?(h.push(p[t][1]),r++):h.push(o.EMPTY)}if(r!==e)continue}else if("tr_ns"===d.type){for(const e of d.pubkeys){const t=p.findIndex(t=>(0,u.equalBytes)(t[0].pubKey,e));-1!==t&&h.push(p[t][1])}if(h.length!==d.pubkeys.length)continue}else{if("unknown"!==d.type||!this.opts.allowUnknownInputs){const n=this.opts.customScripts;if(n)for(const i of n){if(!i.finalizeTaproot)continue;const n=a.Script.decode(e),c=i.encode(n);if(void 0===c)continue;const u=i.finalizeTaproot(e,c,p);if(u)return t.finalScriptWitness=u.concat(s.TaprootControlBlock.encode(r)),t.finalScriptSig=o.EMPTY,void w(t)}throw new Error("Finalize: Unknown tapLeafScript")}{const t=a.Script.decode(e);if(h=p.map(([{pubKey:e},r])=>{const n=t.findIndex(t=>(0,u.isBytes)(t)&&(0,u.equalBytes)(t,e));if(-1===n)throw new Error("finalize/taproot: cannot find position of pubkey in script");return{signature:r,pos:n}}).sort((e,t)=>e.pos-t.pos).map(e=>e.signature),!h.length)continue}}t.finalScriptWitness=h.reverse().concat([e,s.TaprootControlBlock.encode(r)]);break}if(!t.finalScriptWitness)throw new Error("finalize/taproot: empty witness")}}return t.finalScriptSig=o.EMPTY,void w(t)}if(!t.partialSig||!t.partialSig.length)throw new Error("Not enough partial sign");let n,d,l=o.EMPTY,p=[];if("ms"===r.last.type){const e=r.last.m,n=r.last.pubkeys;let o=[];for(const e of n){const r=t.partialSig.find(t=>(0,u.equalBytes)(e,t[0]));r&&o.push(r[1])}if(o=o.slice(0,e),o.length!==e)throw new Error(`Multisig: wrong signatures count, m=${e} n=${n.length} signatures=${o.length}`);l=a.Script.encode([0,...o])}else if("pk"===r.last.type)l=a.Script.encode([t.partialSig[0][1]]);else if("pkh"===r.last.type)l=a.Script.encode([t.partialSig[0][1],t.partialSig[0][0]]);else if("wpkh"===r.last.type)l=o.EMPTY,p=[t.partialSig[0][1],t.partialSig[0][0]];else if("unknown"===r.last.type&&!this.opts.allowUnknownInputs)throw new Error("Unknown inputs not allowed");if(r.type.includes("wsh-")&&(l.length&&r.lastScript.length&&(p=a.Script.decode(l).map(e=>{if(0===e)return o.EMPTY;if((0,u.isBytes)(e))return e;throw new Error(`Wrong witness op=${e}`)})),p=p.concat(r.lastScript)),"segwit"===r.txType&&(d=p),r.type.startsWith("sh-wsh-")?n=a.Script.encode([a.Script.encode([0,c.sha256(r.lastScript)])]):r.type.startsWith("sh-")?n=a.Script.encode([...a.Script.decode(l),r.lastScript]):r.type.startsWith("wsh-")||"segwit"!==r.txType&&(n=l),!n&&!d)throw new Error("Unknown error finalizing input");n&&(t.finalScriptSig=n),d&&(t.finalScriptWitness=d),w(t)}finalize(){for(let e=0;e<this.inputs.length;e++)this.finalizeIdx(e)}extract(){if(!this.isFinal)throw new Error("Transaction has unfinalized inputs");if(!this.outputs.length)throw new Error("Transaction has no outputs");if(this.fee<0n)throw new Error("Outputs spends more than inputs amount");return this.toBytes(!0,!0)}combine(e){for(const t of["PSBTVersion","version","lockTime"])if(this.opts[t]!==e.opts[t])throw new Error(`Transaction/combine: different ${t} this=${this.opts[t]} other=${e.opts[t]}`);for(const t of["inputs","outputs"])if(this[t].length!==e[t].length)throw new Error(`Transaction/combine: different ${t} length this=${this[t].length} other=${e[t].length}`);const t=this.global.unsignedTx?a.RawOldTx.encode(this.global.unsignedTx):o.EMPTY,r=e.global.unsignedTx?a.RawOldTx.encode(e.global.unsignedTx):o.EMPTY;if(!(0,u.equalBytes)(t,r))throw new Error("Transaction/combine: different unsigned tx");this.global=s.mergeKeyMap(s.PSBTGlobal,this.global,e.global,void 0,this.opts.allowUnknown);for(let t=0;t<this.inputs.length;t++)this.updateInput(t,e.inputs[t],!0);for(let t=0;t<this.outputs.length;t++)this.updateOutput(t,e.outputs[t],!0);return this}clone(){return A.fromPSBT(this.toPSBT(this.opts.PSBTVersion),this.opts)}}t.Transaction=A;const I=2147483648},7591:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CURVE:()=>c,ProjectivePoint:()=>S,Signature:()=>M,etc:()=>J,getPublicKey:()=>H,getSharedSecret:()=>X,sign:()=>Y,signAsync:()=>q,utils:()=>ee,verify:()=>Z});const n=2n**256n,o=n-0x1000003d1n,i=n-0x14551231950b75fc4402da1732fc9bebfn,s=0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,a=0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n,c={p:o,n:i,a:0n,b:7n,Gx:s,Gy:a},u=32,d=e=>m(m(e*e)*e+c.b),l=(e="")=>{throw new Error(e)},p=e=>"bigint"==typeof e,h=e=>"string"==typeof e,f=e=>p(e)&&0n<e&&e<o,g=e=>p(e)&&0n<e&&e<i,y=(e,t)=>!(e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name)(e)||"number"==typeof t&&t>0&&e.length!==t?l("Uint8Array expected"):e,w=e=>new Uint8Array(e),b=(e,t)=>y(h(e)?k(e):w(y(e)),t),m=(e,t=o)=>{const r=e%t;return r>=0n?r:t+r},E=e=>e instanceof S?e:l("Point expected");class S{constructor(e,t,r){this.px=e,this.py=t,this.pz=r,Object.freeze(this)}static fromAffine(e){return 0n===e.x&&0n===e.y?x:new S(e.x,e.y,1n)}static fromHex(e){let t;const r=(e=b(e))[0],n=e.subarray(1),o=B(n,0,u),i=e.length;if(33===i&&[2,3].includes(r)){f(o)||l("Point hex invalid: x not FE");let e=N(d(o));!(1&~r)!=(1n==(1n&e))&&(e=m(-e)),t=new S(o,e,1n)}return 65===i&&4===r&&(t=new S(o,B(n,u,64),1n)),t?t.ok():l("Point invalid: not on curve")}static fromPrivateKey(e){return v.mul(C(e))}get x(){return this.aff().x}get y(){return this.aff().y}equals(e){const{px:t,py:r,pz:n}=this,{px:o,py:i,pz:s}=E(e),a=m(t*s),c=m(o*n),u=m(r*s),d=m(i*n);return a===c&&u===d}negate(){return new S(this.px,m(-this.py),this.pz)}double(){return this.add(this)}add(e){const{px:t,py:r,pz:n}=this,{px:o,py:i,pz:s}=E(e),{a,b:u}=c;let d=0n,l=0n,p=0n;const h=m(3n*u);let f=m(t*o),g=m(r*i),y=m(n*s),w=m(t+r),b=m(o+i);w=m(w*b),b=m(f+g),w=m(w-b),b=m(t+n);let v=m(o+s);return b=m(b*v),v=m(f+y),b=m(b-v),v=m(r+n),d=m(i+s),v=m(v*d),d=m(g+y),v=m(v-d),p=m(a*b),d=m(h*y),p=m(d+p),d=m(g-p),p=m(g+p),l=m(d*p),g=m(f+f),g=m(g+f),y=m(a*y),b=m(h*b),g=m(g+y),y=m(f-y),y=m(a*y),b=m(b+y),f=m(g*b),l=m(l+f),f=m(v*b),d=m(w*d),d=m(d-f),f=m(w*g),p=m(v*p),p=m(p+f),new S(d,l,p)}mul(e,t=!0){if(!t&&0n===e)return x;if(g(e)||l("scalar invalid"),this.equals(v))return re(e).p;let r=x,n=v;for(let o=this;e>0n;o=o.double(),e>>=1n)1n&e?r=r.add(o):t&&(n=n.add(o));return r}mulAddQUns(e,t,r){return this.mul(t,!1).add(e.mul(r,!1)).ok()}toAffine(){const{px:e,py:t,pz:r}=this;if(this.equals(x))return{x:0n,y:0n};if(1n===r)return{x:e,y:t};const n=U(r,o);return 1n!==m(r*n)&&l("inverse invalid"),{x:m(e*n),y:m(t*n)}}assertValidity(){const{x:e,y:t}=this.aff();return f(e)&&f(t)||l("Point invalid: x or y"),m(t*t)===d(e)?this:l("Point invalid: not on curve")}multiply(e){return this.mul(e)}aff(){return this.toAffine()}ok(){return this.assertValidity()}toHex(e=!0){const{x:t,y:r}=this.aff();return(e?0n==(1n&r)?"02":"03":"04")+R(t)+(e?"":R(r))}toRawBytes(e=!0){return k(this.toHex(e))}}S.BASE=new S(s,a,1n),S.ZERO=new S(0n,1n,0n);const{BASE:v,ZERO:x}=S,T=(e,t)=>e.toString(16).padStart(t,"0"),A=e=>Array.from(y(e)).map(e=>T(e,2)).join(""),I=e=>e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0,k=e=>{const t="hex invalid";if(!h(e))return l(t);const r=e.length,n=r/2;if(r%2)return l(t);const o=w(n);for(let r=0,i=0;r<n;r++,i+=2){const n=I(e.charCodeAt(i)),s=I(e.charCodeAt(i+1));if(void 0===n||void 0===s)return l(t);o[r]=16*n+s}return o},P=e=>BigInt("0x"+(A(e)||"0")),B=(e,t,r)=>P(e.slice(t,r)),O=e=>p(e)&&e>=0n&&e<n?k(T(e,64)):l("bigint expected"),R=e=>A(O(e)),_=(...e)=>{const t=w(e.reduce((e,t)=>e+y(t).length,0));let r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t},U=(e,t)=>{(0n===e||t<=0n)&&l("no inverse n="+e+" mod="+t);let r=m(e,t),n=t,o=0n,i=1n,s=1n,a=0n;for(;0n!==r;){const e=n/r,t=n%r,c=o-s*e,u=i-a*e;n=r,r=t,o=s,i=a,s=c,a=u}return 1n===n?m(o,t):l("no inverse")},N=e=>{let t=1n;for(let r=e,n=(o+1n)/4n;n>0n;n>>=1n)1n&n&&(t=t*r%o),r=r*r%o;return m(t*t)===e?t:l("sqrt invalid")},C=e=>(p(e)||(e=P(b(e,u))),g(e)?e:l("private key invalid 3")),L=e=>e>i>>1n,H=(e,t=!0)=>S.fromPrivateKey(e).toRawBytes(t);class M{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){return e=b(e,64),new M(B(e,0,u),B(e,u,64))}assertValidity(){return g(this.r)&&g(this.s)?this:l()}addRecoveryBit(e){return new M(this.r,this.s,e)}hasHighS(){return L(this.s)}normalizeS(){return L(this.s)?new M(this.r,m(-this.s,i),this.recovery):this}recoverPublicKey(e){const{r:t,s:r,recovery:n}=this;[0,1,2,3].includes(n)||l("recovery id invalid");const s=D(b(e,u)),a=2===n||3===n?t+i:t;a>=o&&l("q.x invalid");const c=1&n?"03":"02",d=S.fromHex(c+R(a)),p=U(a,i),h=m(-s*p,i),f=m(r*p,i);return v.mulAddQUns(d,h,f)}toCompactRawBytes(){return k(this.toCompactHex())}toCompactHex(){return R(this.r)+R(this.s)}}const V=e=>{const t=8*e.length-256;t>1024&&l("msg invalid");const r=P(e);return t>0?r>>BigInt(t):r},D=e=>m(V(e),i),$=e=>O(e),K=()=>"object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;let F;const j={lowS:!0},W={lowS:!0},z=(e,t,r=j)=>{["der","recovered","canonical"].some(e=>e in r)&&l("option not supported");let{lowS:n}=r;null==n&&(n=!0);const o=D(b(e)),s=$(o),a=C(t),c=[$(a),s];let d=r.extraEntropy;d&&c.push(!0===d?J.randomBytes(u):b(d));const p=o;return{seed:_(...c),k2sig:e=>{const t=V(e);if(!g(t))return;const r=U(t,i),o=v.mul(t).aff(),s=m(o.x,i);if(0n===s)return;const c=m(r*m(p+m(a*s,i),i),i);if(0n===c)return;let u=c,d=(o.x===s?0:2)|Number(1n&o.y);return n&&L(c)&&(u=m(-c,i),d^=1),new M(s,u,d)}}};function G(e){let t=w(u),r=w(u),n=0;const o=()=>{t.fill(1),r.fill(0),n=0},i="drbg: tried 1000 values";if(e){const e=(...e)=>J.hmacSha256Async(r,t,...e),s=async(n=w())=>{r=await e(w([0]),n),t=await e(),0!==n.length&&(r=await e(w([1]),n),t=await e())},a=async()=>(n++>=1e3&&l(i),t=await e(),t);return async(e,t)=>{let r;for(o(),await s(e);!(r=t(await a()));)await s();return o(),r}}{const e=(...e)=>{const n=F;return n||l("etc.hmacSha256Sync not set"),n(r,t,...e)},s=(n=w())=>{r=e(w([0]),n),t=e(),0!==n.length&&(r=e(w([1]),n),t=e())},a=()=>(n++>=1e3&&l(i),t=e(),t);return(e,t)=>{let r;for(o(),s(e);!(r=t(a()));)s();return o(),r}}}const q=async(e,t,r=j)=>{const{seed:n,k2sig:o}=z(e,t,r);return G(!0)(n,o)},Y=(e,t,r=j)=>{const{seed:n,k2sig:o}=z(e,t,r);return G(!1)(n,o)},Z=(e,t,r,n=W)=>{let o,s,a,{lowS:c}=n;null==c&&(c=!0),"strict"in n&&l("option not supported");const u=e&&"object"==typeof e&&"r"in e;u||64===b(e).length||l("signature must be 64 bytes");try{o=u?new M(e.r,e.s).assertValidity():M.fromCompact(e),s=D(b(t)),a=r instanceof S?r.ok():S.fromHex(r)}catch(e){return!1}if(!o)return!1;const{r:d,s:p}=o;if(c&&L(p))return!1;let h;try{const e=U(p,i),t=m(s*e,i),r=m(d*e,i);h=v.mulAddQUns(a,t,r).aff()}catch(e){return!1}return!!h&&m(h.x,i)===d},X=(e,t,r=!0)=>S.fromHex(t).mul(C(e)).toRawBytes(r),Q=e=>{((e=b(e)).length<40||e.length>1024)&&l("expected 40-1024b");const t=m(P(e),i-1n);return O(t+1n)},J={hexToBytes:k,bytesToHex:A,concatBytes:_,bytesToNumberBE:P,numberToBytesBE:O,mod:m,invert:U,hmacSha256Async:async(e,...t)=>{const r=K(),n=r&&r.subtle;if(!n)return l("etc.hmacSha256Async or crypto.subtle must be defined");const o=await n.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return w(await n.sign("HMAC",o,_(...t)))},hmacSha256Sync:F,hashToPrivateKey:Q,randomBytes:(e=32)=>{const t=K();return t&&t.getRandomValues||l("crypto.getRandomValues must be defined"),t.getRandomValues(w(e))}},ee={normPrivateKeyToScalar:C,isValidPrivateKey:e=>{try{return!!C(e)}catch(e){return!1}},randomPrivateKey:()=>Q(J.randomBytes(48)),precompute:(e=8,t=v)=>(t.multiply(3n),t)};let te;Object.defineProperties(J,{hmacSha256Sync:{configurable:!1,get:()=>F,set(e){F||(F=e)}}});const re=e=>{const t=te||(te=(()=>{const e=[];let t=v,r=t;for(let n=0;n<33;n++){r=t,e.push(r);for(let n=1;n<128;n++)r=r.add(t),e.push(r);t=r.double()}return e})()),r=(e,t)=>{let r=t.negate();return e?r:t};let n=x,o=v;const i=BigInt(255),s=BigInt(8);for(let a=0;a<33;a++){const c=128*a;let u=Number(e&i);e>>=s,u>128&&(u-=256,e+=1n);const d=c,l=c+Math.abs(u)-1,p=a%2!=0,h=u<0;0===u?o=o.add(r(p,t[d])):n=n.add(r(h,t[l]))}return{p:n,f:o}}},7857:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.networks=t.getNetwork=void 0;const n=r(5046);function o(e,t){return{...e,hrp:t}}t.getNetwork=e=>t.networks[e],t.networks={bitcoin:o(n.NETWORK,"ark"),testnet:o(n.TEST_NETWORK,"tark"),signet:o(n.TEST_NETWORK,"tark"),mutinynet:o(n.TEST_NETWORK,"tark"),regtest:o({...n.TEST_NETWORK,bech32:"bcrt",pubKeyHash:111,scriptHash:196},"tark")}},8120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._sortPubkeys=t.p2tr_pk=t.p2tr_ns=t.tapLeafHash=t.TAP_LEAF_VERSION=t.p2ms=t.p2wpkh=t.p2wsh=t.p2sh=t.p2pkh=t.p2pk=t.OutScript=void 0,t.checkScript=h,t.taprootListToTree=g,t.p2tr=m,t.combinations=E,t.p2tr_ms=function(e,r,n=!1){return n||f(r),{type:"tr_ms",script:t.OutScript.encode({type:"tr_ms",pubkeys:r,m:e})}},t.getAddress=function(e,r,n=c.NETWORK){if("tr"===e)return m(a.pubSchnorr(r),void 0,n).address;const o=a.pubECDSA(r);if("pkh"===e)return(0,t.p2pkh)(o,n).address;if("wpkh"===e)return(0,t.p2wpkh)(o,n).address;throw new Error(`getAddress: unknown type=${e}`)},t.multisig=S,t.sortedMultisig=function(e,t,r=!1,n=c.NETWORK){return S(e,t,!0,r,n)},t.WIF=function(e=c.NETWORK){return{encode:t=>A(a.concatBytes(t,new Uint8Array([1])).subarray(0,33),[e.wif]),decode(t){let r=v.decode(t);if(r[0]!==e.wif)throw new Error("Wrong WIF prefix");if(r=r.subarray(1),33!==r.length)throw new Error("Wrong WIF length");if(1!==r[32])throw new Error("Wrong WIF postfix");return r.subarray(0,-1)}}},t.Address=I;const n=r(3203),o=r(2954),i=r(227),s=r(5327),a=r(5031),c=r(5031);function u(e,t){try{return a.validatePubkey(e,t),!0}catch(e){return!1}}const d=[{encode(e){if(2===e.length&&1===e[0]&&a.isBytes(e[1])&&"4e73"===n.hex.encode(e[1]))return{type:"p2a",script:s.Script.encode(e)}},decode:e=>{if("p2a"===e.type)return[1,n.hex.decode("4e73")]}},{encode(e){if(2===e.length&&a.isBytes(e[0])&&u(e[0],a.PubT.ecdsa)&&"CHECKSIG"===e[1])return{type:"pk",pubkey:e[0]}},decode:e=>"pk"===e.type?[e.pubkey,"CHECKSIG"]:void 0},{encode(e){if(5===e.length&&"DUP"===e[0]&&"HASH160"===e[1]&&a.isBytes(e[2])&&"EQUALVERIFY"===e[3]&&"CHECKSIG"===e[4])return{type:"pkh",hash:e[2]}},decode:e=>"pkh"===e.type?["DUP","HASH160",e.hash,"EQUALVERIFY","CHECKSIG"]:void 0},{encode(e){if(3===e.length&&"HASH160"===e[0]&&a.isBytes(e[1])&&"EQUAL"===e[2])return{type:"sh",hash:e[1]}},decode:e=>"sh"===e.type?["HASH160",e.hash,"EQUAL"]:void 0},{encode(e){if(2===e.length&&0===e[0]&&a.isBytes(e[1])&&32===e[1].length)return{type:"wsh",hash:e[1]}},decode:e=>"wsh"===e.type?[0,e.hash]:void 0},{encode(e){if(2===e.length&&0===e[0]&&a.isBytes(e[1])&&20===e[1].length)return{type:"wpkh",hash:e[1]}},decode:e=>"wpkh"===e.type?[0,e.hash]:void 0},{encode(e){const t=e.length-1;if("CHECKMULTISIG"!==e[t])return;const r=e[0],n=e[t-1];if("number"!=typeof r||"number"!=typeof n)return;const o=e.slice(1,-2);if(n===o.length){for(const e of o)if(!a.isBytes(e))return;return{type:"ms",m:r,pubkeys:o}}},decode:e=>"ms"===e.type?[e.m,...e.pubkeys,e.pubkeys.length,"CHECKMULTISIG"]:void 0},{encode(e){if(2===e.length&&1===e[0]&&a.isBytes(e[1]))return{type:"tr",pubkey:e[1]}},decode:e=>"tr"===e.type?[1,e.pubkey]:void 0},{encode(e){const t=e.length-1;if("CHECKSIG"!==e[t])return;const r=[];for(let n=0;n<t;n++){const o=e[n];if(1&n){if("CHECKSIGVERIFY"!==o||n===t-1)return}else{if(!a.isBytes(o))return;r.push(o)}}return{type:"tr_ns",pubkeys:r}},decode:e=>{if("tr_ns"!==e.type)return;const t=[];for(let r=0;r<e.pubkeys.length-1;r++)t.push(e.pubkeys[r],"CHECKSIGVERIFY");return t.push(e.pubkeys[e.pubkeys.length-1],"CHECKSIG"),t}},{encode(e){const t=e.length-1;if("NUMEQUAL"!==e[t]||"CHECKSIG"!==e[1])return;const r=[],n=(0,s.OpToNum)(e[t-1]);if("number"==typeof n){for(let n=0;n<t-1;n++){const t=e[n];if(1&n){if(t!==(1===n?"CHECKSIG":"CHECKSIGADD"))throw new Error("OutScript.encode/tr_ms: wrong element")}else{if(!a.isBytes(t))throw new Error("OutScript.encode/tr_ms: wrong key element");r.push(t)}}return{type:"tr_ms",pubkeys:r,m:n}}},decode:e=>{if("tr_ms"!==e.type)return;const t=[e.pubkeys[0],"CHECKSIG"];for(let r=1;r<e.pubkeys.length;r++)t.push(e.pubkeys[r],"CHECKSIGADD");return t.push(e.m,"NUMEQUAL"),t}},{encode:e=>({type:"unknown",script:s.Script.encode(e)}),decode:e=>"unknown"===e.type?s.Script.decode(e.script):void 0}],l=o.apply(s.Script,o.coders.match(d));function p(e,r){if(!a.equalBytes(e.hash,a.sha256(r)))throw new Error("checkScript: wsh wrong witnessScript hash");const n=t.OutScript.decode(r);if("tr"===n.type||"tr_ns"===n.type||"tr_ms"===n.type)throw new Error(`checkScript: P2${n.type} cannot be wrapped in P2SH`);if("wpkh"===n.type||"sh"===n.type)throw new Error(`checkScript: P2${n.type} cannot be wrapped in P2WSH`)}function h(e,r,n){if(e){const o=t.OutScript.decode(e);if("tr_ns"===o.type||"tr_ms"===o.type||"ms"===o.type||"pk"==o.type)throw new Error(`checkScript: non-wrapped ${o.type}`);if("sh"===o.type&&r){if(!a.equalBytes(o.hash,a.hash160(r)))throw new Error("checkScript: sh wrong redeemScript hash");const e=t.OutScript.decode(r);if("tr"===e.type||"tr_ns"===e.type||"tr_ms"===e.type)throw new Error(`checkScript: P2${e.type} cannot be wrapped in P2SH`);if("sh"===e.type)throw new Error("checkScript: P2SH cannot be wrapped in P2SH")}"wsh"===o.type&&n&&p(o,n)}if(r){const e=t.OutScript.decode(r);"wsh"===e.type&&n&&p(e,n)}}function f(e){const t={};for(const r of e){const o=n.hex.encode(r);if(t[o])throw new Error(`Multisig: non-uniq pubkey: ${e.map(n.hex.encode)}`);t[o]=!0}}function g(e){const t=Array.from(e);for(;t.length>=2;){t.sort((e,t)=>(t.weight||1)-(e.weight||1));const e=t.pop(),r=t.pop(),n=(r?.weight||1)+(e?.weight||1);t.push({weight:n,childs:[r?.childs||r,e?.childs||e]})}const r=t[0];return r?.childs||r}function y(e,t=[]){if(!e)throw new Error("taprootAddPath: empty tree");if("leaf"===e.type)return{...e,path:t};if("branch"!==e.type)throw new Error(`taprootAddPath: wrong type=${e}`);return{...e,path:t,left:y(e.left,[e.right.hash,...t]),right:y(e.right,[e.left.hash,...t])}}function w(e){if(!e)throw new Error("taprootAddPath: empty tree");if("leaf"===e.type)return[e];if("branch"!==e.type)throw new Error(`taprootWalkTree: wrong type=${e}`);return[...w(e.left),...w(e.right)]}function b(e,r,i=!1,c){if(!e)throw new Error("taprootHashTree: empty tree");if(Array.isArray(e)&&1===e.length&&(e=e[0]),!Array.isArray(e)){const{leafVersion:u,script:d}=e;if(e.tapLeafScript||e.tapMerkleRoot&&!a.equalBytes(e.tapMerkleRoot,o.EMPTY))throw new Error("P2TR: tapRoot leafScript cannot have tree");const l="string"==typeof d?n.hex.decode(d):d;if(!a.isBytes(l))throw new Error(`checkScript: wrong script type=${l}`);return function(e,r,n=!1,i){const c=t.OutScript.decode(e);if("unknown"===c.type){if(i){const t=o.apply(s.Script,o.coders.match(i)).decode(e);if(void 0!==t){if("string"!=typeof t.type||!t.type.startsWith("tr_"))throw new Error(`P2TR: invalid custom type=${t.type}`);return}}if(n)return}if(!["tr_ns","tr_ms"].includes(c.type))throw new Error(`P2TR: invalid leaf script=${c.type}`);const u=c;if(!n&&u.pubkeys)for(const e of u.pubkeys){if(a.equalBytes(e,a.TAPROOT_UNSPENDABLE_KEY))throw new Error("Unspendable taproot key in leaf script");if(a.equalBytes(e,r))throw new Error("Using P2TR with leaf script with same key as internal key is not supported")}}(l,r,i,c),{type:"leaf",version:u,script:l,hash:(0,t.tapLeafHash)(l,u)}}if(2!==e.length&&(e=g(e)),2!==e.length)throw new Error("hashTree: non binary tree!");const u=b(e[0],r,i,c),d=b(e[1],r,i,c);let[l,p]=[u.hash,d.hash];return-1===a.compareBytes(p,l)&&([l,p]=[p,l]),{type:"branch",left:u,right:d,hash:a.tagSchnorr("TapBranch",l,p)}}function m(e,r,s=c.NETWORK,d=!1,l){if(!e&&!r)throw new Error("p2tr: should have pubKey or scriptTree (or both)");const p="string"==typeof e?n.hex.decode(e):e||a.TAPROOT_UNSPENDABLE_KEY;if(!u(p,a.PubT.schnorr))throw new Error("p2tr: non-schnorr pubkey");if(r){let e=y(b(r,p,d,l));const n=e.hash,[o,c]=a.taprootTweakPubkey(p,n),u=w(e).map(e=>({...e,controlBlock:i.TaprootControlBlock.encode({version:(e.version||t.TAP_LEAF_VERSION)+c,internalKey:p,merklePath:e.path})}));return{type:"tr",script:t.OutScript.encode({type:"tr",pubkey:o}),address:I(s).encode({type:"tr",pubkey:o}),tweakedPubkey:o,tapInternalKey:p,leaves:u,tapLeafScript:u.map(e=>[i.TaprootControlBlock.decode(e.controlBlock),a.concatBytes(e.script,new Uint8Array([e.version||t.TAP_LEAF_VERSION]))]),tapMerkleRoot:n}}{const e=a.taprootTweakPubkey(p,o.EMPTY)[0];return{type:"tr",script:t.OutScript.encode({type:"tr",pubkey:e}),address:I(s).encode({type:"tr",pubkey:e}),tweakedPubkey:e,tapInternalKey:p}}}function E(e,t){const r=[];if(!Array.isArray(t))throw new Error("combinations: lst arg should be array");const n=t.length;if(e>n)throw new Error("combinations: m > lst.length, no combinations possible");const o=Array.from({length:e},(e,t)=>t),i=o.length-1;e:for(;;){r.push(o.map(e=>t[e])),o[i]+=1;let s=i;for(;s>=0&&o[s]>n-e+s;s--){if(o[s]=0,0===s)break e;o[s-1]+=1}for(s+=1;s<o.length;s++)o[s]=o[s-1]+1}return r}function S(e,r,n=!1,o=!1,i=c.NETWORK){const s=(0,t.p2ms)(e,n?(0,t._sortPubkeys)(r):r);return o?(0,t.p2wsh)(s,i):(0,t.p2sh)(s,i)}t.OutScript=o.validate(l,e=>{if("pk"===e.type&&!u(e.pubkey,a.PubT.ecdsa))throw new Error("OutScript/pk: wrong key");if(!("pkh"!==e.type&&"sh"!==e.type&&"wpkh"!==e.type||a.isBytes(e.hash)&&20===e.hash.length))throw new Error(`OutScript/${e.type}: wrong hash`);if("wsh"===e.type&&(!a.isBytes(e.hash)||32!==e.hash.length))throw new Error("OutScript/wsh: wrong hash");if(!("tr"!==e.type||a.isBytes(e.pubkey)&&u(e.pubkey,a.PubT.schnorr)))throw new Error("OutScript/tr: wrong taproot public key");if(("ms"===e.type||"tr_ns"===e.type||"tr_ms"===e.type)&&!Array.isArray(e.pubkeys))throw new Error("OutScript/multisig: wrong pubkeys array");if("ms"===e.type){const t=e.pubkeys.length;for(const t of e.pubkeys)if(!u(t,a.PubT.ecdsa))throw new Error("OutScript/multisig: wrong pubkey");if(e.m<=0||t>16||e.m>t)throw new Error("OutScript/multisig: invalid params")}if("tr_ns"===e.type||"tr_ms"===e.type)for(const t of e.pubkeys)if(!u(t,a.PubT.schnorr))throw new Error(`OutScript/${e.type}: wrong pubkey`);if("tr_ms"===e.type){const t=e.pubkeys.length;if(e.m<=0||t>999||e.m>t)throw new Error("OutScript/tr_ms: invalid params")}return e}),t.p2pk=(e,r=c.NETWORK)=>{if(!u(e,a.PubT.ecdsa))throw new Error("P2PK: invalid publicKey");return{type:"pk",script:t.OutScript.encode({type:"pk",pubkey:e})}},t.p2pkh=(e,r=c.NETWORK)=>{if(!u(e,a.PubT.ecdsa))throw new Error("P2PKH: invalid publicKey");const n=a.hash160(e);return{type:"pkh",script:t.OutScript.encode({type:"pkh",hash:n}),address:I(r).encode({type:"pkh",hash:n}),hash:n}},t.p2sh=(e,r=c.NETWORK)=>{const n=e.script;if(!a.isBytes(n))throw new Error(`Wrong script: ${typeof e.script}, expected Uint8Array`);const o=a.hash160(n);return h(t.OutScript.encode({type:"sh",hash:o}),n,e.witnessScript),e.witnessScript?{type:"sh",redeemScript:n,script:t.OutScript.encode({type:"sh",hash:o}),address:I(r).encode({type:"sh",hash:o}),hash:o,witnessScript:e.witnessScript}:{type:"sh",redeemScript:n,script:t.OutScript.encode({type:"sh",hash:o}),address:I(r).encode({type:"sh",hash:o}),hash:o}},t.p2wsh=(e,r=c.NETWORK)=>{const n=e.script;if(!a.isBytes(n))throw new Error(`Wrong script: ${typeof n}, expected Uint8Array`);const o=a.sha256(n);return h(t.OutScript.encode({type:"wsh",hash:o}),void 0,n),{type:"wsh",witnessScript:n,script:t.OutScript.encode({type:"wsh",hash:o}),address:I(r).encode({type:"wsh",hash:o}),hash:o}},t.p2wpkh=(e,r=c.NETWORK)=>{if(!u(e,a.PubT.ecdsa))throw new Error("P2WPKH: invalid publicKey");if(65===e.length)throw new Error("P2WPKH: uncompressed public key");const n=a.hash160(e);return{type:"wpkh",script:t.OutScript.encode({type:"wpkh",hash:n}),address:I(r).encode({type:"wpkh",hash:n}),hash:n}},t.p2ms=(e,r,n=!1)=>(n||f(r),{type:"ms",script:t.OutScript.encode({type:"ms",pubkeys:r,m:e})}),t.TAP_LEAF_VERSION=192,t.tapLeafHash=(e,r=t.TAP_LEAF_VERSION)=>a.tagSchnorr("TapLeaf",new Uint8Array([r]),s.VarBytes.encode(e)),t.p2tr_ns=(e,r,n=!1)=>(n||f(r),E(e,r).map(e=>({type:"tr_ns",script:t.OutScript.encode({type:"tr_ns",pubkeys:e})}))),t.p2tr_pk=e=>(0,t.p2tr_ns)(1,[e],void 0)[0],t._sortPubkeys=e=>Array.from(e).sort(a.compareBytes);const v=(0,n.createBase58check)(a.sha256);function x(e,t){if(t.length<2||t.length>40)throw new Error("Witness: invalid length");if(e>16)throw new Error("Witness: invalid version");if(0===e&&20!==t.length&&32!==t.length)throw new Error("Witness: invalid length for version")}function T(e,t,r=c.NETWORK){x(e,t);const o=0===e?n.bech32:n.bech32m;return o.encode(r.bech32,[e].concat(o.toWords(t)))}function A(e,t){return v.encode(a.concatBytes(Uint8Array.from(t),e))}function I(e=c.NETWORK){return{encode(t){const{type:r}=t;if("wpkh"===r)return T(0,t.hash,e);if("wsh"===r)return T(0,t.hash,e);if("tr"===r)return T(1,t.pubkey,e);if("pkh"===r)return A(t.hash,[e.pubKeyHash]);if("sh"===r)return A(t.hash,[e.scriptHash]);throw new Error(`Unknown address type=${r}`)},decode(t){if(t.length<14||t.length>74)throw new Error("Invalid address length");if(e.bech32&&t.toLowerCase().startsWith(`${e.bech32}1`)){let r;try{if(r=n.bech32.decode(t),0!==r.words[0])throw new Error(`bech32: wrong version=${r.words[0]}`)}catch(e){if(r=n.bech32m.decode(t),0===r.words[0])throw new Error(`bech32m: wrong version=${r.words[0]}`)}if(r.prefix!==e.bech32)throw new Error(`wrong bech32 prefix=${r.prefix}`);const[o,...i]=r.words,s=n.bech32.fromWords(i);if(x(o,s),0===o&&32===s.length)return{type:"wsh",hash:s};if(0===o&&20===s.length)return{type:"wpkh",hash:s};if(1===o&&32===s.length)return{type:"tr",pubkey:s};throw new Error("Unknown witness program")}const r=v.decode(t);if(21!==r.length)throw new Error("Invalid base58 address");if(r[0]===e.pubKeyHash)return{type:"pkh",hash:r.slice(1)};if(r[0]===e.scriptHash)return{type:"sh",hash:r.slice(1)};throw new Error(`Invalid address prefix=${r[0]}`)}}}},8233:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestArkProvider=t.SettlementEventType=void 0,t.isFetchTimeoutError=c;const n=r(3203);var o;function i(e){const t={};for(const[r,o]of e)t[r]=n.hex.encode(o.pubNonce);return JSON.stringify(t)}function s(e){const t={};for(const[r,o]of e)t[r]=n.hex.encode(o.encode());return JSON.stringify(t)}function a(e){const t=JSON.parse(e);return new Map(Object.entries(t).map(([e,t])=>{if("string"!=typeof t)throw new Error("invalid nonce");return[e,{pubNonce:n.hex.decode(t)}]}))}function c(e){const t=e=>e instanceof Error&&("TypeError"===e.name&&"Failed to fetch"===e.message||"HeadersTimeoutError"===e.name||"BodyTimeoutError"===e.name||"UND_ERR_HEADERS_TIMEOUT"===e.code||"UND_ERR_BODY_TIMEOUT"===e.code);return t(e)||t(e.cause)}function u(e){return{outpoint:{txid:e.outpoint.txid,vout:e.outpoint.vout},amount:e.amount,script:e.script,createdAt:e.createdAt,expiresAt:e.expiresAt,commitmentTxids:e.commitmentTxids,isPreconfirmed:e.isPreconfirmed,isSwept:e.isSwept,isUnrolled:e.isUnrolled,isSpent:e.isSpent,spentBy:e.spentBy,settledBy:e.settledBy,arkTxid:e.arkTxid}}!function(e){e.BatchStarted="batch_started",e.BatchFinalization="batch_finalization",e.BatchFinalized="batch_finalized",e.BatchFailed="batch_failed",e.TreeSigningStarted="tree_signing_started",e.TreeNoncesAggregated="tree_nonces_aggregated",e.TreeTx="tree_tx",e.TreeSignature="tree_signature"}(o||(t.SettlementEventType=o={})),t.RestArkProvider=class{constructor(e){this.serverUrl=e}async getInfo(){const e=`${this.serverUrl}/v1/info`,t=await fetch(e);if(!t.ok)throw new Error(`Failed to get server info: ${t.statusText}`);const r=await t.json();return{...r,vtxoTreeExpiry:BigInt(r.vtxoTreeExpiry??0),unilateralExitDelay:BigInt(r.unilateralExitDelay??0),roundInterval:BigInt(r.roundInterval??0),dust:BigInt(r.dust??0),utxoMinAmount:BigInt(r.utxoMinAmount??0),utxoMaxAmount:BigInt(r.utxoMaxAmount??-1),vtxoMinAmount:BigInt(r.vtxoMinAmount??0),vtxoMaxAmount:BigInt(r.vtxoMaxAmount??-1),boardingExitDelay:BigInt(r.boardingExitDelay??0),marketHour:"marketHour"in r&&null!=r.marketHour?{nextStartTime:BigInt(r.marketHour.nextStartTime??0),nextEndTime:BigInt(r.marketHour.nextEndTime??0),period:BigInt(r.marketHour.period??0),roundInterval:BigInt(r.marketHour.roundInterval??0)}:void 0}}async submitTx(e,t){const r=`${this.serverUrl}/v1/tx/submit`,n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedArkTx:e,checkpointTxs:t})});if(!n.ok){const e=await n.text();try{const t=JSON.parse(e);throw new Error(`Failed to submit virtual transaction: ${t.message||t.error||e}`)}catch(t){throw new Error(`Failed to submit virtual transaction: ${e}`)}}const o=await n.json();return{arkTxid:o.arkTxid,finalArkTx:o.finalArkTx,signedCheckpointTxs:o.signedCheckpointTxs}}async finalizeTx(e,t){const r=`${this.serverUrl}/v1/tx/finalize`,n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arkTxid:e,finalCheckpointTxs:t})});if(!n.ok){const e=await n.text();throw new Error(`Failed to finalize offchain transaction: ${e}`)}}async registerIntent(e){const t=`${this.serverUrl}/v1/batch/registerIntent`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:{signature:e.signature,message:e.message}})});if(!r.ok){const e=await r.text();throw new Error(`Failed to register intent: ${e}`)}return(await r.json()).intentId}async deleteIntent(e){const t=`${this.serverUrl}/v1/batch/deleteIntent`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{signature:e.signature,message:e.message}})});if(!r.ok){const e=await r.text();throw new Error(`Failed to delete intent: ${e}`)}}async confirmRegistration(e){const t=`${this.serverUrl}/v1/batch/ack`,r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intentId:e})});if(!r.ok){const e=await r.text();throw new Error(`Failed to confirm registration: ${e}`)}}async submitTreeNonces(e,t,r){const n=`${this.serverUrl}/v1/batch/tree/submitNonces`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batchId:e,pubkey:t,treeNonces:i(r)})});if(!o.ok){const e=await o.text();throw new Error(`Failed to submit tree nonces: ${e}`)}}async submitTreeSignatures(e,t,r){const n=`${this.serverUrl}/v1/batch/tree/submitSignatures`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batchId:e,pubkey:t,treeSignatures:s(r)})});if(!o.ok){const e=await o.text();throw new Error(`Failed to submit tree signatures: ${e}`)}}async submitSignedForfeitTxs(e,t){const r=`${this.serverUrl}/v1/batch/submitForfeitTxs`,n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedForfeitTxs:e,signedCommitmentTx:t})});if(!n.ok)throw new Error(`Failed to submit forfeit transactions: ${n.statusText}`)}async*getEventStream(e,t){const r=`${this.serverUrl}/v1/batch/events`,n=t.length>0?`?${t.map(e=>`topics=${encodeURIComponent(e)}`).join("&")}`:"";for(;!e?.aborted;)try{const t=await fetch(r+n,{headers:{Accept:"application/json"},signal:e});if(!t.ok)throw new Error(`Unexpected status ${t.status} when fetching event stream`);if(!t.body)throw new Error("Response body is null");const o=t.body.getReader(),i=new TextDecoder;let s="";for(;!e?.aborted;){const{done:e,value:t}=await o.read();if(e)break;s+=i.decode(t,{stream:!0});const r=s.split("\n");for(let e=0;e<r.length-1;e++){const t=r[e].trim();if(t)try{const e=JSON.parse(t),r=this.parseSettlementEvent(e.result);r&&(yield r)}catch(e){throw console.error("Failed to parse event:",e),e}}s=r[r.length-1]}}catch(e){if(e instanceof Error&&"AbortError"===e.name)break;if(c(e)){console.debug("Timeout error ignored");continue}throw console.error("Event stream error:",e),e}}async*getTransactionsStream(e){const t=`${this.serverUrl}/v1/txs`;for(;!e?.aborted;)try{const r=await fetch(t,{headers:{Accept:"application/json"},signal:e});if(!r.ok)throw new Error(`Unexpected status ${r.status} when fetching transaction stream`);if(!r.body)throw new Error("Response body is null");const n=r.body.getReader(),o=new TextDecoder;let i="";for(;!e?.aborted;){const{done:e,value:t}=await n.read();if(e)break;i+=o.decode(t,{stream:!0});const r=i.split("\n");for(let e=0;e<r.length-1;e++){const t=r[e].trim();if(!t)continue;const n=JSON.parse(t),o=this.parseTransactionNotification(n.result);o&&(yield o)}i=r[r.length-1]}}catch(e){if(e instanceof Error&&"AbortError"===e.name)break;if(c(e)){console.debug("Timeout error ignored");continue}throw console.error("Address subscription error:",e),e}}parseSettlementEvent(e){if(e.batchStarted)return{type:o.BatchStarted,id:e.batchStarted.id,intentIdHashes:e.batchStarted.intentIdHashes,batchExpiry:BigInt(e.batchStarted.batchExpiry)};if(e.batchFinalization)return{type:o.BatchFinalization,id:e.batchFinalization.id,commitmentTx:e.batchFinalization.commitmentTx};if(e.batchFinalized)return{type:o.BatchFinalized,id:e.batchFinalized.id,commitmentTxid:e.batchFinalized.commitmentTxid};if(e.batchFailed)return{type:o.BatchFailed,id:e.batchFailed.id,reason:e.batchFailed.reason};if(e.treeSigningStarted)return{type:o.TreeSigningStarted,id:e.treeSigningStarted.id,cosignersPublicKeys:e.treeSigningStarted.cosignersPubkeys,unsignedCommitmentTx:e.treeSigningStarted.unsignedCommitmentTx};if(e.treeNoncesAggregated)return{type:o.TreeNoncesAggregated,id:e.treeNoncesAggregated.id,treeNonces:a(e.treeNoncesAggregated.treeNonces)};if(e.treeTx){const t=Object.fromEntries(Object.entries(e.treeTx.children).map(([e,t])=>[parseInt(e),t]));return{type:o.TreeTx,id:e.treeTx.id,topic:e.treeTx.topic,batchIndex:e.treeTx.batchIndex,chunk:{txid:e.treeTx.txid,tx:e.treeTx.tx,children:t}}}return e.treeSignature?{type:o.TreeSignature,id:e.treeSignature.id,topic:e.treeSignature.topic,batchIndex:e.treeSignature.batchIndex,txid:e.treeSignature.txid,signature:e.treeSignature.signature}:(console.warn("Unknown event type:",e),null)}parseTransactionNotification(e){return e.commitmentTx?{commitmentTx:{txid:e.commitmentTx.txid,tx:e.commitmentTx.tx,spentVtxos:e.commitmentTx.spentVtxos.map(u),spendableVtxos:e.commitmentTx.spendableVtxos.map(u),checkpointTxs:e.commitmentTx.checkpointTxs}}:e.arkTx?{arkTx:{txid:e.arkTx.txid,tx:e.arkTx.tx,spentVtxos:e.arkTx.spentVtxos.map(u),spendableVtxos:e.arkTx.spendableVtxos.map(u),checkpointTxs:e.arkTx.checkpointTxs}}:(console.warn("Unknown transaction notification type:",e),null)}}},8428:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=t.Unroll=t.P2A=t.TxTree=t.BIP322=t.IndexedDBVtxoRepository=t.networks=t.ArkNote=t.waitForIncomingFunds=t.buildOffchainTx=t.ConditionWitness=t.VtxoTaprootTree=t.VtxoTreeExpiry=t.CosignerPublicKey=t.getArkPsbtFields=t.setArkPsbtField=t.ArkPsbtFieldKeyType=t.ArkPsbtFieldKey=t.CLTVMultisigTapscript=t.ConditionMultisigTapscript=t.ConditionCSVMultisigTapscript=t.CSVMultisigTapscript=t.MultisigTapscript=t.decodeTapscript=t.Response=t.Request=t.ServiceWorkerWallet=t.Worker=t.setupServiceWorker=t.SettlementEventType=t.ChainTxType=t.IndexerTxType=t.TxType=t.VHTLC=t.VtxoScript=t.DefaultVtxo=t.ArkAddress=t.RestIndexerProvider=t.RestArkProvider=t.EsploraProvider=t.ESPLORA_URL=t.Ramps=t.OnchainWallet=t.SingleKey=t.Wallet=void 0;const n=r(5046);Object.defineProperty(t,"Transaction",{enumerable:!0,get:function(){return n.Transaction}});const o=r(1440);Object.defineProperty(t,"SingleKey",{enumerable:!0,get:function(){return o.SingleKey}});const i=r(5482);Object.defineProperty(t,"ArkAddress",{enumerable:!0,get:function(){return i.ArkAddress}});const s=r(669);Object.defineProperty(t,"VHTLC",{enumerable:!0,get:function(){return s.VHTLC}});const a=r(9443);Object.defineProperty(t,"DefaultVtxo",{enumerable:!0,get:function(){return a.DefaultVtxo}});const c=r(9761);Object.defineProperty(t,"VtxoScript",{enumerable:!0,get:function(){return c.VtxoScript}});const u=r(6776);Object.defineProperty(t,"TxType",{enumerable:!0,get:function(){return u.TxType}});const d=r(6531);Object.defineProperty(t,"Wallet",{enumerable:!0,get:function(){return d.Wallet}}),Object.defineProperty(t,"waitForIncomingFunds",{enumerable:!0,get:function(){return d.waitForIncomingFunds}});const l=r(6629);Object.defineProperty(t,"TxTree",{enumerable:!0,get:function(){return l.TxTree}});const p=r(9953);Object.defineProperty(t,"Ramps",{enumerable:!0,get:function(){return p.Ramps}});const h=r(2501);Object.defineProperty(t,"ServiceWorkerWallet",{enumerable:!0,get:function(){return h.ServiceWorkerWallet}});const f=r(1962);Object.defineProperty(t,"OnchainWallet",{enumerable:!0,get:function(){return f.OnchainWallet}});const g=r(6215);Object.defineProperty(t,"setupServiceWorker",{enumerable:!0,get:function(){return g.setupServiceWorker}});const y=r(822);Object.defineProperty(t,"Worker",{enumerable:!0,get:function(){return y.Worker}});const w=r(2087);Object.defineProperty(t,"Request",{enumerable:!0,get:function(){return w.Request}});const b=r(8739);Object.defineProperty(t,"Response",{enumerable:!0,get:function(){return b.Response}});const m=r(2999);Object.defineProperty(t,"ESPLORA_URL",{enumerable:!0,get:function(){return m.ESPLORA_URL}}),Object.defineProperty(t,"EsploraProvider",{enumerable:!0,get:function(){return m.EsploraProvider}});const E=r(8233);Object.defineProperty(t,"RestArkProvider",{enumerable:!0,get:function(){return E.RestArkProvider}}),Object.defineProperty(t,"SettlementEventType",{enumerable:!0,get:function(){return E.SettlementEventType}});const S=r(5780);Object.defineProperty(t,"CLTVMultisigTapscript",{enumerable:!0,get:function(){return S.CLTVMultisigTapscript}}),Object.defineProperty(t,"ConditionCSVMultisigTapscript",{enumerable:!0,get:function(){return S.ConditionCSVMultisigTapscript}}),Object.defineProperty(t,"ConditionMultisigTapscript",{enumerable:!0,get:function(){return S.ConditionMultisigTapscript}}),Object.defineProperty(t,"CSVMultisigTapscript",{enumerable:!0,get:function(){return S.CSVMultisigTapscript}}),Object.defineProperty(t,"decodeTapscript",{enumerable:!0,get:function(){return S.decodeTapscript}}),Object.defineProperty(t,"MultisigTapscript",{enumerable:!0,get:function(){return S.MultisigTapscript}});const v=r(6868);Object.defineProperty(t,"buildOffchainTx",{enumerable:!0,get:function(){return v.buildOffchainTx}});const x=r(9689);Object.defineProperty(t,"VtxoTaprootTree",{enumerable:!0,get:function(){return x.VtxoTaprootTree}}),Object.defineProperty(t,"ConditionWitness",{enumerable:!0,get:function(){return x.ConditionWitness}}),Object.defineProperty(t,"getArkPsbtFields",{enumerable:!0,get:function(){return x.getArkPsbtFields}}),Object.defineProperty(t,"setArkPsbtField",{enumerable:!0,get:function(){return x.setArkPsbtField}}),Object.defineProperty(t,"ArkPsbtFieldKey",{enumerable:!0,get:function(){return x.ArkPsbtFieldKey}}),Object.defineProperty(t,"ArkPsbtFieldKeyType",{enumerable:!0,get:function(){return x.ArkPsbtFieldKeyType}}),Object.defineProperty(t,"CosignerPublicKey",{enumerable:!0,get:function(){return x.CosignerPublicKey}}),Object.defineProperty(t,"VtxoTreeExpiry",{enumerable:!0,get:function(){return x.VtxoTreeExpiry}});const T=r(4537);Object.defineProperty(t,"BIP322",{enumerable:!0,get:function(){return T.BIP322}});const A=r(5147);Object.defineProperty(t,"ArkNote",{enumerable:!0,get:function(){return A.ArkNote}});const I=r(4864);Object.defineProperty(t,"IndexedDBVtxoRepository",{enumerable:!0,get:function(){return I.IndexedDBVtxoRepository}});const k=r(7857);Object.defineProperty(t,"networks",{enumerable:!0,get:function(){return k.networks}});const P=r(682);Object.defineProperty(t,"RestIndexerProvider",{enumerable:!0,get:function(){return P.RestIndexerProvider}}),Object.defineProperty(t,"IndexerTxType",{enumerable:!0,get:function(){return P.IndexerTxType}}),Object.defineProperty(t,"ChainTxType",{enumerable:!0,get:function(){return P.ChainTxType}});const B=r(9145);Object.defineProperty(t,"P2A",{enumerable:!0,get:function(){return B.P2A}});const O=r(9558);Object.defineProperty(t,"Unroll",{enumerable:!0,get:function(){return O.Unroll}})},8510:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeToCurve=t.hashToCurve=t.secp256k1_hasher=t.schnorr=t.secp256k1=void 0;const n=r(7076),o=r(9175),i=r(3562),s=r(1761),a=r(4967),c=r(1484),u=r(1705),d=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),l=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),p=BigInt(0),h=BigInt(1),f=BigInt(2),g=(e,t)=>(e+t/f)/t;function y(e){const t=d,r=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),u=BigInt(88),l=e*e*e%t,p=l*l*e%t,h=(0,a.pow2)(p,r,t)*p%t,g=(0,a.pow2)(h,r,t)*p%t,y=(0,a.pow2)(g,f,t)*l%t,b=(0,a.pow2)(y,o,t)*y%t,m=(0,a.pow2)(b,i,t)*b%t,E=(0,a.pow2)(m,c,t)*m%t,S=(0,a.pow2)(E,u,t)*E%t,v=(0,a.pow2)(S,c,t)*m%t,x=(0,a.pow2)(v,r,t)*p%t,T=(0,a.pow2)(x,s,t)*b%t,A=(0,a.pow2)(T,n,t)*l%t,I=(0,a.pow2)(A,f,t);if(!w.eql(w.sqr(I),e))throw new Error("Cannot find square root");return I}const w=(0,a.Field)(d,void 0,void 0,{sqrt:y});t.secp256k1=(0,i.createCurve)({a:p,b:BigInt(7),Fp:w,n:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=l,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-h*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,s=BigInt("0x100000000000000000000000000000000"),c=g(i*e,t),u=g(-n*e,t);let d=(0,a.mod)(e-c*r-u*o,t),p=(0,a.mod)(-c*n-u*i,t);const f=d>s,y=p>s;if(f&&(d=t-d),y&&(p=t-p),d>s||p>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:d,k2neg:y,k2:p}}}},n.sha256);const b={};function m(e,...t){let r=b[e];if(void 0===r){const t=(0,n.sha256)(Uint8Array.from(e,e=>e.charCodeAt(0)));r=(0,c.concatBytes)(t,t),b[e]=r}return(0,n.sha256)((0,c.concatBytes)(r,...t))}const E=e=>e.toRawBytes(!0).slice(1),S=e=>(0,c.numberToBytesBE)(e,32),v=e=>(0,a.mod)(e,d),x=e=>(0,a.mod)(e,l),T=(()=>t.secp256k1.ProjectivePoint)();function A(e){let r=t.secp256k1.utils.normPrivateKeyToScalar(e),n=T.fromPrivateKey(r);return{scalar:n.hasEvenY()?r:x(-r),bytes:E(n)}}function I(e){(0,c.aInRange)("x",e,h,d);const t=v(e*e);let r=y(v(t*e+BigInt(7)));r%f!==p&&(r=v(-r));const n=new T(e,r,h);return n.assertValidity(),n}const k=c.bytesToNumberBE;function P(...e){return x(k(m("BIP0340/challenge",...e)))}function B(e,t,r){const n=(0,c.ensureBytes)("signature",e,64),o=(0,c.ensureBytes)("message",t),i=(0,c.ensureBytes)("publicKey",r,32);try{const e=I(k(i)),t=k(n.subarray(0,32));if(!(0,c.inRange)(t,h,d))return!1;const r=k(n.subarray(32,64));if(!(0,c.inRange)(r,h,l))return!1;const p=P(S(t),E(e),o),f=(s=e,a=r,u=x(-p),T.BASE.multiplyAndAddUnsafe(s,a,u));return!(!f||!f.hasEvenY()||f.toAffine().x!==t)}catch(e){return!1}var s,a,u}t.schnorr={getPublicKey:function(e){return A(e).bytes},sign:function(e,t,r=(0,o.randomBytes)(32)){const n=(0,c.ensureBytes)("message",e),{bytes:i,scalar:s}=A(t),a=(0,c.ensureBytes)("auxRand",r,32),u=S(s^k(m("BIP0340/aux",a))),d=m("BIP0340/nonce",u,i,n),l=x(k(d));if(l===p)throw new Error("sign failed: k is zero");const{bytes:h,scalar:f}=A(l),g=P(h,i,n),y=new Uint8Array(64);if(y.set(h,0),y.set(S(x(f+g*s)),32),!B(y,n,i))throw new Error("sign: Invalid signature produced");return y},verify:B,utils:{randomPrivateKey:t.secp256k1.utils.randomPrivateKey,lift_x:I,pointToBytes:E,numberToBytesBE:c.numberToBytesBE,bytesToNumberBE:c.bytesToNumberBE,taggedHash:m,mod:a.mod}};const O=(()=>(0,s.isogenyMap)(w,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))))(),R=(()=>(0,u.mapToCurveSimpleSWU)(w,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:w.create(BigInt("-11"))}))();t.secp256k1_hasher=(0,s.createHasher)(t.secp256k1.ProjectivePoint,e=>{const{x:t,y:r}=R(w.create(e[0]));return O(t,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:w.ORDER,m:1,k:128,expand:"xmd",hash:n.sha256}),t.hashToCurve=t.secp256k1_hasher.hashToCurve,t.encodeToCurve=t.secp256k1_hasher.encodeToCurve},8534:e=>{const t=1<<31,r=65535,n=1<<22,o=33553920;e.exports={decode:function(e){return e&t?{}:e&n?{seconds:(e&r)<<9}:{blocks:e&r}},encode:function({blocks:e,seconds:t}){if(void 0!==e&&void 0!==t)throw new TypeError("Cannot encode blocks AND seconds");if(void 0===e&&void 0===t)return 4294967295;if(void 0!==t){if(!Number.isFinite(t))throw new TypeError("Expected Number seconds");if(t>o)throw new TypeError("Expected Number seconds <= "+o);if(t%512!=0)throw new TypeError("Expected Number seconds as a multiple of 512");return n|t>>9}if(!Number.isFinite(e))throw new TypeError("Expected Number blocks");if(e>r)throw new TypeError("Expected Number blocks <= 65535");return e}}},8634:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrMissingCosignersPublicKeys=t.ErrWrongCommitmentTxid=t.ErrInvalidRoundTxOutputs=t.ErrInvalidTaprootScript=t.ErrNoLeaves=t.ErrInvalidAmount=t.ErrWrongSettlementTxid=t.ErrNumberOfInputs=t.ErrEmptyTree=t.ErrInvalidSettlementTxOutputs=t.ErrInvalidSettlementTx=void 0,t.validateConnectorsTxGraph=function(e,r){if(r.validate(),1!==r.root.inputsLength)throw t.ErrNumberOfInputs;const a=r.root.getInput(0),c=o.Transaction.fromPSBT(i.base64.decode(e));if(c.outputsLength<=d)throw t.ErrInvalidSettlementTxOutputs;const u=n.hex.encode((0,s.sha256x2)(c.toBytes(!0)).reverse());if(!a.txid)throw t.ErrWrongSettlementTxid;if(n.hex.encode(a.txid)!==u)throw t.ErrWrongSettlementTxid;if(a.index!==d)throw t.ErrWrongSettlementTxid},t.validateVtxoTxGraph=function(e,r,o){if(r.outputsLength<u+1)throw t.ErrInvalidRoundTxOutputs;const i=r.getOutput(u)?.amount;if(!i)throw t.ErrInvalidRoundTxOutputs;if(!e.root)throw t.ErrEmptyTree;const d=e.root.getInput(0),l=n.hex.encode((0,s.sha256x2)(r.toBytes(!0)).reverse());if(!d.txid||n.hex.encode(d.txid)!==l||d.index!==u)throw t.ErrWrongCommitmentTxid;let p=0n;for(let t=0;t<e.root.outputsLength;t++){const r=e.root.getOutput(t);r?.amount&&(p+=r.amount)}if(p!==i)throw t.ErrInvalidAmount;if(0===e.leaves().length)throw t.ErrNoLeaves;e.validate();for(const r of e)for(const[e,i]of r.children){const s=r.root.getOutput(e);if(!s?.script)throw new Error(`parent output ${e} not found`);const u=s.script.slice(2);if(32!==u.length)throw new Error(`parent output ${e} has invalid script`);const d=(0,c.getArkPsbtFields)(i.root,0,c.CosignerPublicKey);if(0===d.length)throw t.ErrMissingCosignersPublicKeys;const l=d.map(e=>e.key),{finalKey:p}=(0,a.aggregateKeys)(l,!0,{taprootTweak:o});if(!p||n.hex.encode(p.slice(1))!==n.hex.encode(u))throw t.ErrInvalidTaprootScript}};const n=r(3203),o=r(5046),i=r(3203),s=r(5031),a=r(6238),c=r(9689);t.ErrInvalidSettlementTx=e=>new Error(`invalid settlement transaction: ${e}`),t.ErrInvalidSettlementTxOutputs=new Error("invalid settlement transaction outputs"),t.ErrEmptyTree=new Error("empty tree"),t.ErrNumberOfInputs=new Error("invalid number of inputs"),t.ErrWrongSettlementTxid=new Error("wrong settlement txid"),t.ErrInvalidAmount=new Error("invalid amount"),t.ErrNoLeaves=new Error("no leaves"),t.ErrInvalidTaprootScript=new Error("invalid taproot script"),t.ErrInvalidRoundTxOutputs=new Error("invalid round transaction outputs"),t.ErrWrongCommitmentTxid=new Error("wrong commitment txid"),t.ErrMissingCosignersPublicKeys=new Error("missing cosigners public keys");const u=0,d=1},8739:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Response=void 0,function(e){e.walletInitialized=e=>({type:"WALLET_INITIALIZED",success:!0,id:e}),e.error=function(e,t){return{type:"ERROR",success:!1,message:t,id:e}},e.settleEvent=function(e,t){return{type:"SETTLE_EVENT",success:!0,event:t,id:e}},e.settleSuccess=function(e,t){return{type:"SETTLE_SUCCESS",success:!0,txid:t,id:e}},e.isSettleSuccess=function(e){return"SETTLE_SUCCESS"===e.type&&e.success},e.isAddress=function(e){return"ADDRESS"===e.type&&!0===e.success},e.isBoardingAddress=function(e){return"BOARDING_ADDRESS"===e.type&&!0===e.success},e.address=function(e,t){return{type:"ADDRESS",success:!0,address:t,id:e}},e.boardingAddress=function(e,t){return{type:"BOARDING_ADDRESS",success:!0,address:t,id:e}},e.isBalance=function(e){return"BALANCE"===e.type&&!0===e.success},e.balance=function(e,t){return{type:"BALANCE",success:!0,balance:t,id:e}},e.isVtxos=function(e){return"VTXOS"===e.type&&!0===e.success},e.vtxos=function(e,t){return{type:"VTXOS",success:!0,vtxos:t,id:e}},e.isVirtualCoins=function(e){return"VIRTUAL_COINS"===e.type&&!0===e.success},e.virtualCoins=function(e,t){return{type:"VIRTUAL_COINS",success:!0,virtualCoins:t,id:e}},e.isBoardingUtxos=function(e){return"BOARDING_UTXOS"===e.type&&!0===e.success},e.boardingUtxos=function(e,t){return{type:"BOARDING_UTXOS",success:!0,boardingUtxos:t,id:e}},e.isSendBitcoinSuccess=function(e){return"SEND_BITCOIN_SUCCESS"===e.type&&!0===e.success},e.sendBitcoinSuccess=function(e,t){return{type:"SEND_BITCOIN_SUCCESS",success:!0,txid:t,id:e}},e.isTransactionHistory=function(e){return"TRANSACTION_HISTORY"===e.type&&!0===e.success},e.transactionHistory=function(e,t){return{type:"TRANSACTION_HISTORY",success:!0,transactions:t,id:e}},e.isWalletStatus=function(e){return"WALLET_STATUS"===e.type&&!0===e.success},e.walletStatus=function(e,t,r){return{type:"WALLET_STATUS",success:!0,status:{walletInitialized:t,xOnlyPublicKey:r},id:e}},e.isClearResponse=function(e){return"CLEAR_RESPONSE"===e.type},e.clearResponse=function(e,t){return{type:"CLEAR_RESPONSE",success:t,id:e}},e.signSuccess=function(e,t){return{type:"SIGN_SUCCESS",success:!0,tx:t,id:e}},e.isSignSuccess=function(e){return"SIGN_SUCCESS"===e.type&&!0===e.success}}(r||(t.Response=r={}))},9145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.P2A=t.ANCHOR_PKSCRIPT=t.ANCHOR_VALUE=void 0,t.findP2AOutput=function(e){for(let r=0;r<e.outputsLength;r++){const i=e.getOutput(r);if(i.script&&n.hex.encode(i.script)===o){if(i.amount!==t.P2A.amount)throw new Error(`P2A output has wrong amount, expected ${t.P2A.amount} got ${i.amount}`);return{txid:e.id,index:r,witnessUtxo:t.P2A}}}throw new Error("P2A output not found")};const n=r(3203);t.ANCHOR_VALUE=0n,t.ANCHOR_PKSCRIPT=new Uint8Array([81,2,78,115]),t.P2A={script:t.ANCHOR_PKSCRIPT,amount:t.ANCHOR_VALUE};const o=n.hex.encode(t.P2A.script)},9175:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapXOFConstructorWithOpts=t.wrapConstructorWithOpts=t.wrapConstructor=t.Hash=t.nextTick=t.swap32IfBE=t.byteSwapIfBE=t.swap8IfBE=t.isLE=void 0,t.isBytes=o,t.anumber=i,t.abytes=s,t.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");i(e.outputLen),i(e.blockLen)},t.aexists=function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},t.aoutput=function(e,t){s(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)},t.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},t.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},t.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},t.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},t.rotr=function(e,t){return e<<32-t|e>>>t},t.rotl=function(e,t){return e<<t|e>>>32-t>>>0},t.byteSwap=a,t.byteSwap32=c,t.bytesToHex=function(e){if(s(e),u)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=d[e[r]];return t},t.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(u)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,o=0;t<r;t++,o+=2){const r=p(e.charCodeAt(o)),i=p(e.charCodeAt(o+1));if(void 0===r||void 0===i){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}n[t]=16*r+i}return n},t.asyncLoop=async function(e,r,n){let o=Date.now();for(let i=0;i<e;i++){n(i);const e=Date.now()-o;e>=0&&e<r||(await(0,t.nextTick)(),o+=e)}},t.utf8ToBytes=h,t.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},t.toBytes=f,t.kdfInputToBytes=function(e){return"string"==typeof e&&(e=h(e)),s(e),e},t.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];s(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r},t.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("options should be object or undefined");return Object.assign(e,t)},t.createHasher=g,t.createOptHasher=y,t.createXOFer=w,t.randomBytes=function(e=32){if(n.crypto&&"function"==typeof n.crypto.getRandomValues)return n.crypto.getRandomValues(new Uint8Array(e));if(n.crypto&&"function"==typeof n.crypto.randomBytes)return Uint8Array.from(n.crypto.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")};const n=r(5145);function o(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function i(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function s(e,...t){if(!o(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function a(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function c(e){for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e}t.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],t.swap8IfBE=t.isLE?e=>e:e=>a(e),t.byteSwapIfBE=t.swap8IfBE,t.swap32IfBE=t.isLE?e=>e:c;const u=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),d=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),l={_0:48,_9:57,A:65,F:70,a:97,f:102};function p(e){return e>=l._0&&e<=l._9?e-l._0:e>=l.A&&e<=l.F?e-(l.A-10):e>=l.a&&e<=l.f?e-(l.a-10):void 0}function h(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function f(e){return"string"==typeof e&&(e=h(e)),s(e),e}function g(e){const t=t=>e().update(f(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function y(e){const t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function w(e){const t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}t.nextTick=async()=>{},t.Hash=class{},t.wrapConstructor=g,t.wrapConstructorWithOpts=y,t.wrapXOFConstructorWithOpts=w},9443:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultVtxo=void 0;const n=r(9761),o=r(5780),i=r(3203);var s;!function(e){class t extends n.VtxoScript{constructor(e){const{pubKey:r,serverPubKey:n,csvTimelock:s=t.DEFAULT_TIMELOCK}=e,a=o.MultisigTapscript.encode({pubkeys:[r,n]}).script,c=o.CSVMultisigTapscript.encode({timelock:s,pubkeys:[r]}).script;super([a,c]),this.options=e,this.forfeitScript=i.hex.encode(a),this.exitScript=i.hex.encode(c)}forfeit(){return this.findLeaf(this.forfeitScript)}exit(){return this.findLeaf(this.exitScript)}}t.DEFAULT_TIMELOCK={value:144n,type:"blocks"},e.Script=t}(s||(t.DefaultVtxo=s={}))},9558:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Unroll=void 0;const n=r(5046),o=r(682),i=r(3203),s=r(9761),a=r(227),c=r(1175),u=r(6531);var d;function l(e){return new Promise(t=>setTimeout(t,e))}function p(e,t,r){return async()=>{const[n,o]=await e.bumpP2A(r);await t.broadcastTransaction(n,o)}}function h(e,t){return()=>new Promise((r,n)=>{const o=setInterval(async()=>{try{(await e.getTxStatus(t)).confirmed&&(clearInterval(o),r())}catch(e){clearInterval(o),n(e)}},5e3)})}function f(e,t,r){const n=s.VtxoScript.decode(r.tapTree).exitPaths();for(const r of n)if("blocks"===r.params.timelock.type){if(t.height>=e.height+Number(r.params.timelock.value))return r}else if(t.time>=e.time+Number(r.params.timelock.value))return r}!function(e){let t;!function(e){e[e.UNROLL=0]="UNROLL",e[e.WAIT=1]="WAIT",e[e.DONE=2]="DONE"}(t=e.StepType||(e.StepType={}));class r{constructor(e,t,r,n){this.toUnroll=e,this.bumper=t,this.explorer=r,this.indexer=n}static async create(e,t,n,o){const{chain:i}=await o.getVtxoChain(e);return new r({...e,chain:i},t,n,o)}async next(){let e;const r=this.toUnroll.chain;for(let n=r.length-1;n>=0;n--){const i=r[n];if(i.type!==o.ChainTxType.COMMITMENT&&i.type!==o.ChainTxType.UNSPECIFIED)try{if(!(await this.explorer.getTxStatus(i.txid)).confirmed)return{type:t.WAIT,txid:i.txid,do:h(this.explorer,i.txid)}}catch(t){e=i;break}}if(!e)return{type:t.DONE,vtxoTxid:this.toUnroll.txid,do:()=>Promise.resolve()};const s=await this.indexer.getVirtualTxs([e.txid]);if(0===s.txs.length)throw new Error(`Tx ${e.txid} not found`);const a=n.Transaction.fromPSBT(i.base64.decode(s.txs[0]),{allowUnknownInputs:!0});if(e.type===o.ChainTxType.TREE){const e=a.getInput(0);if(!e)throw new Error("Input not found");const t=e.tapKeySig;if(!t)throw new Error("Tap key sig not found");a.updateInput(0,{finalScriptWitness:[t]})}else a.finalize();return{type:t.UNROLL,tx:a,do:p(this.bumper,this.explorer,a)}}async*[Symbol.asyncIterator](){let e;do{void 0!==e&&await l(1e3);const t=await this.next();await t.do(),yield t,e=t.type}while(e!==t.DONE)}}e.Session=r,e.completeUnroll=async function(e,t,r){const o=await e.onchainProvider.getChainTip();let d=await e.getVtxos({withUnrolled:!0});if(d=d.filter(e=>t.includes(e.txid)),0===d.length)throw new Error("No vtxos to complete unroll");const l=[];let p=0n;const h=c.TxWeightEstimator.create();for(const t of d){if(!t.isUnrolled)throw new Error(`Vtxo ${t.txid}:${t.vout} is not fully unrolled, use unroll first`);const r=await e.onchainProvider.getTxStatus(t.txid);if(!r.confirmed)throw new Error(`tx ${t.txid} is not confirmed`);const c=f({height:r.blockHeight,time:r.blockTime},o,t);if(!c)throw new Error(`no available exit path found for vtxo ${t.txid}:${t.vout}`);const u=s.VtxoScript.decode(t.tapTree).findLeaf(i.hex.encode(c.script));if(!u)throw new Error(`spending leaf not found for vtxo ${t.txid}:${t.vout}`);p+=BigInt(t.value),l.push({txid:t.txid,index:t.vout,tapLeafScript:[u],sequence:4294967294,witnessUtxo:{amount:BigInt(t.value),script:s.VtxoScript.decode(t.tapTree).pkScript},sighashType:n.SigHash.DEFAULT}),h.addTapscriptInput(64,u[1].length,a.TaprootControlBlock.encode(u[0]).length)}const g=new n.Transaction({allowUnknownInputs:!0,version:2});for(const e of l)g.addInput(e);h.addP2TROutput();let y=await e.onchainProvider.getFeeRate();(!y||y<u.Wallet.MIN_FEE_RATE)&&(y=u.Wallet.MIN_FEE_RATE);const w=h.vsize().fee(BigInt(y));if(w>p)throw new Error("fee amount is greater than the total amount");g.addOutputAddress(r,p-w);const b=await e.identity.sign(g);return b.finalize(),await e.onchainProvider.broadcastTransaction(b.hex),b.id}}(d||(t.Unroll=d={}))},9615:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hmac=t.HMAC=void 0;const n=r(9175);class o extends n.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,n.ahash)(e);const r=(0,n.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),(0,n.clean)(i)}update(e){return(0,n.aexists)(this),this.iHash.update(e),this}digestInto(e){(0,n.aexists)(this),(0,n.abytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=n,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}t.HMAC=o,t.hmac=(e,t,r)=>new o(e,t).update(r).digest(),t.hmac.create=(e,t)=>new o(e,t)},9689:function(e,t,r){"use strict";var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),s=0;s<r.length;s++)"default"!==r[s]&&o(t,e,r[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.VtxoTreeExpiry=t.CosignerPublicKey=t.ConditionWitness=t.VtxoTaprootTree=t.ArkPsbtFieldKeyType=t.ArkPsbtFieldKey=void 0,t.setArkPsbtField=function(e,t,r,n){e.updateInput(t,{unknown:[...e.getInput(t)?.unknown??[],r.encode(n)]})},t.getArkPsbtFields=function(e,t,r){const n=e.getInput(t)?.unknown??[],o=[];for(const e of n){const t=r.decode(e);t&&o.push(t)}return o};const a=s(r(8534)),c=r(5046),u=r(3203);var d;!function(e){e.VtxoTaprootTree="taptree",e.VtxoTreeExpiry="expiry",e.Cosigner="cosigner",e.ConditionWitness="condition"}(d||(t.ArkPsbtFieldKey=d={})),t.ArkPsbtFieldKeyType=255,t.VtxoTaprootTree={key:d.VtxoTaprootTree,encode:e=>[{type:t.ArkPsbtFieldKeyType,key:l[d.VtxoTaprootTree]},e],decode:e=>p(()=>h(e[0],d.VtxoTaprootTree)?e[1]:null)},t.ConditionWitness={key:d.ConditionWitness,encode:e=>[{type:t.ArkPsbtFieldKeyType,key:l[d.ConditionWitness]},c.RawWitness.encode(e)],decode:e=>p(()=>h(e[0],d.ConditionWitness)?c.RawWitness.decode(e[1]):null)},t.CosignerPublicKey={key:d.Cosigner,encode:e=>[{type:t.ArkPsbtFieldKeyType,key:new Uint8Array([...l[d.Cosigner],e.index])},e.key],decode:e=>p(()=>h(e[0],d.Cosigner)?{index:e[0].key[e[0].key.length-1],key:e[1]}:null)},t.VtxoTreeExpiry={key:d.VtxoTreeExpiry,encode:e=>[{type:t.ArkPsbtFieldKeyType,key:l[d.VtxoTreeExpiry]},(0,c.ScriptNum)(6,!0).encode(0n===e.value?0n:e.value)],decode:e=>p(()=>{if(!h(e[0],d.VtxoTreeExpiry))return null;const t=(0,c.ScriptNum)(6,!0).decode(e[1]);if(!t)return null;const{blocks:r,seconds:n}=a.decode(Number(t));return{type:r?"blocks":"seconds",value:BigInt(r??n??0)}})};const l=Object.fromEntries(Object.values(d).map(e=>[e,(new TextEncoder).encode(e)])),p=e=>{try{return e()}catch(e){return null}};function h(e,t){const r=u.hex.encode(l[t]);return u.hex.encode(new Uint8Array([e.type,...e.key])).includes(r)}},9761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VtxoScript=void 0,t.scriptFromTapLeafScript=u;const n=r(8120),o=r(5031),i=r(5482),s=r(5046),a=r(3203),c=r(5780);function u(e){return e[1].subarray(0,e[1].length-1)}class d{static decode(e){const t=function(e){let t=0;const r=[],[n,o]=l(e,t);t+=o;for(let o=0;o<n;o++){t+=1,t+=1;const[n,o]=l(e,t);t+=o;const i=e.slice(t,t+n);r.push(i),t+=n}return r}(e);return new d(t)}constructor(e){this.scripts=e;const t=(0,n.taprootListToTree)(e.map(e=>({script:e,leafVersion:n.TAP_LEAF_VERSION}))),r=(0,n.p2tr)(o.TAPROOT_UNSPENDABLE_KEY,t,void 0,!0);if(!r.tapLeafScript||r.tapLeafScript.length!==e.length)throw new Error("invalid scripts");this.leaves=r.tapLeafScript,this.tweakedPublicKey=r.tweakedPubkey}encode(){return function(e){const t=[];t.push(p(e.length));for(const r of e)t.push(new Uint8Array([1])),t.push(new Uint8Array([192])),t.push(p(r.length)),t.push(r);const r=t.reduce((e,t)=>e+t.length,0),n=new Uint8Array(r);let o=0;for(const e of t)n.set(e,o),o+=e.length;return n}(this.scripts)}address(e,t){return new i.ArkAddress(t,this.tweakedPublicKey,e)}get pkScript(){return s.Script.encode(["OP_1",this.tweakedPublicKey])}onchainAddress(e){return(0,n.Address)(e).encode({type:"tr",pubkey:this.tweakedPublicKey})}findLeaf(e){const t=this.leaves.find(t=>a.hex.encode(u(t))===e);if(!t)throw new Error(`leaf '${e}' not found`);return t}exitPaths(){const e=[];for(const t of this.leaves)try{const r=c.CSVMultisigTapscript.decode(u(t));e.push(r);continue}catch(r){try{const r=c.ConditionCSVMultisigTapscript.decode(u(t));e.push(r)}catch(e){continue}}return e}}function l(e,t){const r=e[t];return r<253?[r,1]:253===r?[new DataView(e.buffer).getUint16(t+1,!0),3]:254===r?[new DataView(e.buffer).getUint32(t+1,!0),5]:[Number(new DataView(e.buffer).getBigUint64(t+1,!0)),9]}function p(e){if(e<253)return new Uint8Array([e]);if(e<=65535){const t=new Uint8Array(3);return t[0]=253,new DataView(t.buffer).setUint16(1,e,!0),t}if(e<=4294967295){const t=new Uint8Array(5);return t[0]=254,new DataView(t.buffer).setUint32(1,e,!0),t}{const t=new Uint8Array(9);return t[0]=255,new DataView(t.buffer).setBigUint64(1,BigInt(e),!0),t}}t.VtxoScript=d},9854:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrMissingWitnessUtxo=t.ErrMissingData=t.ErrMissingInputs=t.BIP322Error=void 0;class r extends Error{constructor(e){super(e),this.name="BIP322Error"}}t.BIP322Error=r,t.ErrMissingInputs=new r("missing inputs"),t.ErrMissingData=new r("missing data"),t.ErrMissingWitnessUtxo=new r("missing witness utxo")},9953:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ramps=void 0,t.Ramps=class{constructor(e){this.wallet=e}async onboard(e,t,r){const n=(e=e??await this.wallet.getBoardingUtxos()).reduce((e,t)=>e+BigInt(t.value),0n);let o=0n;if(t){if(t>n)throw new Error("Amount is greater than total amount of boarding utxos");o=n-t}t=t??n;const i=[{address:await this.wallet.getAddress(),amount:t}];if(o>0n){const e=await this.wallet.getBoardingAddress();i.push({address:e,amount:o})}return this.wallet.settle({inputs:e,outputs:i},r)}async offboard(e,t,r){const n=await this.wallet.getVtxos({withRecoverable:!0,withUnrolled:!1}),o=n.reduce((e,t)=>e+BigInt(t.value),0n);let i=0n;if(t){if(t>o)throw new Error("Amount is greater than total amount of vtxos");i=o-t}const s=[{address:e,amount:t=t??o}];if(i>0n){const e=await this.wallet.getAddress();s.push({address:e,amount:i})}return this.wallet.settle({inputs:n,outputs:s},r)}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const{DefaultVtxo:n,ArkAddress:o}=r(8428);function i(e){const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}function s(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}window.ArkSDK={generateArkProtocolAddress:function(e,t,r,o){try{const a=i(e);let c;c=66===t.length&&(t.startsWith("02")||t.startsWith("03"))?i(t.substring(2)):i(t);const u=new n.Script({pubKey:a,serverPubKey:c,timelock:r}),d="mainnet"===o?"ark":"tark",l=u.address(d,c);return{address:l.encode(),vtxoKey:s(l.vtxoTaprootKey),serverPubKey:s(l.serverPubKey),tweakedPublicKey:s(u.tweakedPublicKey),success:!0}}catch(e){return console.error("Error generating Ark Protocol address:",e),{success:!1,error:e.message}}},decodeArkAddress:function(e){try{const t=o.decode(e);return{serverPubKey:s(t.serverPubKey),vtxoTaprootKey:s(t.vtxoTaprootKey),hrp:t.hrp,version:t.version,success:!0}}catch(e){return console.error("Error decoding Ark address:",e),{success:!1,error:e.message}}},DefaultVtxo:n,ArkAddress:o},window.ArkSDK={}})();